var pc=Object.defineProperty;var hc=(t,e,n)=>e in t?pc(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Ee=(t,e,n)=>(hc(t,typeof e!="symbol"?e+"":e,n),n);import{E as dc,V as ne,M as st,T as at,Q as ht,S as Si,a as te,b as Fn,C as mc,L as gc,c as Fr,F as vc,d as Et,R as Ai,e as Ti,f as Mi,g as Zn,h as yc,i as re,s as ye,j as _c,k as U,G as Ci,B as Li,P as bn,O as qn,l as Br,m as Ho,n as dr,o as Ce,p as wc,D as Wo,q as bc,r as Go,t as xc,u as Ec,v as Pc,A as Xo,w as dt,x as Me,U as Sc,y as Ac,z as Ko,H as We,I as Tc,J as Mc,N as Cc,K as Lc,W as kc,X as $r,Y as Rt,Z as Nt,_ as ki,$ as Oc,a0 as Oi,a1 as Dc,a2 as Ic,a3 as Rc,a4 as Yo,a5 as Fc,a6 as Bc,a7 as $c,a8 as jc,a9 as zc,aa as Nc,ab as Uc,ac as Vc,ad as Hc,ae as Wc,af as Gc,ag as Xc,ah as Kc,ai as Yc,aj as Zo,ak as qo,al as Di,am as Zc,an as qc,ao as Qc,ap as Jc}from"./three-d62902c6.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();var qt,S,Qo,Bt,Ii,Jo,xn={},es=[],el=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function Fe(t,e){for(var n in e)t[n]=e[n];return t}function ts(t){var e=t.parentNode;e&&e.removeChild(t)}function ke(t,e,n){var r,i,o,s={};for(o in e)o=="key"?r=e[o]:o=="ref"?i=e[o]:s[o]=e[o];if(arguments.length>2&&(s.children=arguments.length>3?qt.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(o in t.defaultProps)s[o]===void 0&&(s[o]=t.defaultProps[o]);return $t(t,s,r,i,null)}function $t(t,e,n,r,i){var o={type:t,props:e,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:i??++Qo};return i==null&&S.vnode!=null&&S.vnode(o),o}function ns(){return{current:null}}function Oe(t){return t.children}function Ae(t,e){this.props=t,this.context=e}function Ut(t,e){if(e==null)return t.__?Ut(t.__,t.__.__k.indexOf(t)+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?Ut(t):null}function rs(t){var e,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return rs(t)}}function mr(t){(!t.__d&&(t.__d=!0)&&Bt.push(t)&&!En.__r++||Ii!==S.debounceRendering)&&((Ii=S.debounceRendering)||setTimeout)(En)}function En(){for(var t;En.__r=Bt.length;)t=Bt.sort(function(e,n){return e.__v.__b-n.__v.__b}),Bt=[],t.some(function(e){var n,r,i,o,s,l;e.__d&&(s=(o=(n=e).__v).__e,(l=n.__P)&&(r=[],(i=Fe({},o)).__v=o.__v+1,jr(l,o,i,n.__n,l.ownerSVGElement!==void 0,o.__h!=null?[s]:null,r,s??Ut(o),o.__h),as(r,o),o.__e!=s&&rs(o)))})}function is(t,e,n,r,i,o,s,l,c,u){var a,f,p,h,d,m,y,_=r&&r.__k||es,w=_.length;for(n.__k=[],a=0;a<e.length;a++)if((h=n.__k[a]=(h=e[a])==null||typeof h=="boolean"?null:typeof h=="string"||typeof h=="number"||typeof h=="bigint"?$t(null,h,null,null,h):Array.isArray(h)?$t(Oe,{children:h},null,null,null):h.__b>0?$t(h.type,h.props,h.key,h.ref?h.ref:null,h.__v):h)!=null){if(h.__=n,h.__b=n.__b+1,(p=_[a])===null||p&&h.key==p.key&&h.type===p.type)_[a]=void 0;else for(f=0;f<w;f++){if((p=_[f])&&h.key==p.key&&h.type===p.type){_[f]=void 0;break}p=null}jr(t,h,p=p||xn,i,o,s,l,c,u),d=h.__e,(f=h.ref)&&p.ref!=f&&(y||(y=[]),p.ref&&y.push(p.ref,null,h),y.push(f,h.__c||d,h)),d!=null?(m==null&&(m=d),typeof h.type=="function"&&h.__k===p.__k?h.__d=c=os(h,c,t):c=ss(t,h,p,_,d,c),typeof n.type=="function"&&(n.__d=c)):c&&p.__e==c&&c.parentNode!=t&&(c=Ut(p))}for(n.__e=m,a=w;a--;)_[a]!=null&&ls(_[a],_[a]);if(y)for(a=0;a<y.length;a++)cs(y[a],y[++a],y[++a])}function os(t,e,n){for(var r,i=t.__k,o=0;i&&o<i.length;o++)(r=i[o])&&(r.__=t,e=typeof r.type=="function"?os(r,e,n):ss(n,r,r,i,r.__e,e));return e}function ze(t,e){return e=e||[],t==null||typeof t=="boolean"||(Array.isArray(t)?t.some(function(n){ze(n,e)}):e.push(t)),e}function ss(t,e,n,r,i,o){var s,l,c;if(e.__d!==void 0)s=e.__d,e.__d=void 0;else if(n==null||i!=o||i.parentNode==null)e:if(o==null||o.parentNode!==t)t.appendChild(i),s=null;else{for(l=o,c=0;(l=l.nextSibling)&&c<r.length;c+=1)if(l==i)break e;t.insertBefore(i,o),s=o}return s!==void 0?s:i.nextSibling}function tl(t,e,n,r,i){var o;for(o in n)o==="children"||o==="key"||o in e||Pn(t,o,null,n[o],r);for(o in e)i&&typeof e[o]!="function"||o==="children"||o==="key"||o==="value"||o==="checked"||n[o]===e[o]||Pn(t,o,e[o],n[o],r)}function Ri(t,e,n){e[0]==="-"?t.setProperty(e,n):t[e]=n==null?"":typeof n!="number"||el.test(e)?n:n+"px"}function Pn(t,e,n,r,i){var o;e:if(e==="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof r=="string"&&(t.style.cssText=r=""),r)for(e in r)n&&e in n||Ri(t.style,e,"");if(n)for(e in n)r&&n[e]===r[e]||Ri(t.style,e,n[e])}else if(e[0]==="o"&&e[1]==="n")o=e!==(e=e.replace(/Capture$/,"")),e=e.toLowerCase()in t?e.toLowerCase().slice(2):e.slice(2),t.l||(t.l={}),t.l[e+o]=n,n?r||t.addEventListener(e,o?Bi:Fi,o):t.removeEventListener(e,o?Bi:Fi,o);else if(e!=="dangerouslySetInnerHTML"){if(i)e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!=="href"&&e!=="list"&&e!=="form"&&e!=="tabIndex"&&e!=="download"&&e in t)try{t[e]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&e.indexOf("-")==-1?t.removeAttribute(e):t.setAttribute(e,n))}}function Fi(t){this.l[t.type+!1](S.event?S.event(t):t)}function Bi(t){this.l[t.type+!0](S.event?S.event(t):t)}function jr(t,e,n,r,i,o,s,l,c){var u,a,f,p,h,d,m,y,_,w,v,E,b,P,A,x=e.type;if(e.constructor!==void 0)return null;n.__h!=null&&(c=n.__h,l=e.__e=n.__e,e.__h=null,o=[l]),(u=S.__b)&&u(e);try{e:if(typeof x=="function"){if(y=e.props,_=(u=x.contextType)&&r[u.__c],w=u?_?_.props.value:u.__:r,n.__c?m=(a=e.__c=n.__c).__=a.__E:("prototype"in x&&x.prototype.render?e.__c=a=new x(y,w):(e.__c=a=new Ae(y,w),a.constructor=x,a.render=rl),_&&_.sub(a),a.props=y,a.state||(a.state={}),a.context=w,a.__n=r,f=a.__d=!0,a.__h=[],a._sb=[]),a.__s==null&&(a.__s=a.state),x.getDerivedStateFromProps!=null&&(a.__s==a.state&&(a.__s=Fe({},a.__s)),Fe(a.__s,x.getDerivedStateFromProps(y,a.__s))),p=a.props,h=a.state,f)x.getDerivedStateFromProps==null&&a.componentWillMount!=null&&a.componentWillMount(),a.componentDidMount!=null&&a.__h.push(a.componentDidMount);else{if(x.getDerivedStateFromProps==null&&y!==p&&a.componentWillReceiveProps!=null&&a.componentWillReceiveProps(y,w),!a.__e&&a.shouldComponentUpdate!=null&&a.shouldComponentUpdate(y,a.__s,w)===!1||e.__v===n.__v){for(a.props=y,a.state=a.__s,e.__v!==n.__v&&(a.__d=!1),a.__v=e,e.__e=n.__e,e.__k=n.__k,e.__k.forEach(function(k){k&&(k.__=e)}),v=0;v<a._sb.length;v++)a.__h.push(a._sb[v]);a._sb=[],a.__h.length&&s.push(a);break e}a.componentWillUpdate!=null&&a.componentWillUpdate(y,a.__s,w),a.componentDidUpdate!=null&&a.__h.push(function(){a.componentDidUpdate(p,h,d)})}if(a.context=w,a.props=y,a.__v=e,a.__P=t,E=S.__r,b=0,"prototype"in x&&x.prototype.render){for(a.state=a.__s,a.__d=!1,E&&E(e),u=a.render(a.props,a.state,a.context),P=0;P<a._sb.length;P++)a.__h.push(a._sb[P]);a._sb=[]}else do a.__d=!1,E&&E(e),u=a.render(a.props,a.state,a.context),a.state=a.__s;while(a.__d&&++b<25);a.state=a.__s,a.getChildContext!=null&&(r=Fe(Fe({},r),a.getChildContext())),f||a.getSnapshotBeforeUpdate==null||(d=a.getSnapshotBeforeUpdate(p,h)),A=u!=null&&u.type===Oe&&u.key==null?u.props.children:u,is(t,Array.isArray(A)?A:[A],e,n,r,i,o,s,l,c),a.base=e.__e,e.__h=null,a.__h.length&&s.push(a),m&&(a.__E=a.__=null),a.__e=!1}else o==null&&e.__v===n.__v?(e.__k=n.__k,e.__e=n.__e):e.__e=nl(n.__e,e,n,r,i,o,s,c);(u=S.diffed)&&u(e)}catch(k){e.__v=null,(c||o!=null)&&(e.__e=l,e.__h=!!c,o[o.indexOf(l)]=null),S.__e(k,e,n)}}function as(t,e){S.__c&&S.__c(e,t),t.some(function(n){try{t=n.__h,n.__h=[],t.some(function(r){r.call(n)})}catch(r){S.__e(r,n.__v)}})}function nl(t,e,n,r,i,o,s,l){var c,u,a,f=n.props,p=e.props,h=e.type,d=0;if(h==="svg"&&(i=!0),o!=null){for(;d<o.length;d++)if((c=o[d])&&"setAttribute"in c==!!h&&(h?c.localName===h:c.nodeType===3)){t=c,o[d]=null;break}}if(t==null){if(h===null)return document.createTextNode(p);t=i?document.createElementNS("http://www.w3.org/2000/svg",h):document.createElement(h,p.is&&p),o=null,l=!1}if(h===null)f===p||l&&t.data===p||(t.data=p);else{if(o=o&&qt.call(t.childNodes),u=(f=n.props||xn).dangerouslySetInnerHTML,a=p.dangerouslySetInnerHTML,!l){if(o!=null)for(f={},d=0;d<t.attributes.length;d++)f[t.attributes[d].name]=t.attributes[d].value;(a||u)&&(a&&(u&&a.__html==u.__html||a.__html===t.innerHTML)||(t.innerHTML=a&&a.__html||""))}if(tl(t,p,f,i,l),a)e.__k=[];else if(d=e.props.children,is(t,Array.isArray(d)?d:[d],e,n,r,i&&h!=="foreignObject",o,s,o?o[0]:n.__k&&Ut(n,0),l),o!=null)for(d=o.length;d--;)o[d]!=null&&ts(o[d]);l||("value"in p&&(d=p.value)!==void 0&&(d!==t.value||h==="progress"&&!d||h==="option"&&d!==f.value)&&Pn(t,"value",d,f.value,!1),"checked"in p&&(d=p.checked)!==void 0&&d!==t.checked&&Pn(t,"checked",d,f.checked,!1))}return t}function cs(t,e,n){try{typeof t=="function"?t(e):t.current=e}catch(r){S.__e(r,n)}}function ls(t,e,n){var r,i;if(S.unmount&&S.unmount(t),(r=t.ref)&&(r.current&&r.current!==t.__e||cs(r,null,e)),(r=t.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(o){S.__e(o,e)}r.base=r.__P=null,t.__c=void 0}if(r=t.__k)for(i=0;i<r.length;i++)r[i]&&ls(r[i],e,n||typeof t.type!="function");n||t.__e==null||ts(t.__e),t.__=t.__e=t.__d=void 0}function rl(t,e,n){return this.constructor(t,n)}function gt(t,e,n){var r,i,o;S.__&&S.__(t,e),i=(r=typeof n=="function")?null:n&&n.__k||e.__k,o=[],jr(e,t=(!r&&n||e).__k=ke(Oe,null,[t]),i||xn,xn,e.ownerSVGElement!==void 0,!r&&n?[n]:i?null:e.firstChild?qt.call(e.childNodes):null,o,!r&&n?n:i?i.__e:e.firstChild,r),as(o,t)}function us(t,e){gt(t,e,us)}function il(t,e,n){var r,i,o,s=Fe({},t.props);for(o in e)o=="key"?r=e[o]:o=="ref"?i=e[o]:s[o]=e[o];return arguments.length>2&&(s.children=arguments.length>3?qt.call(arguments,2):n),$t(t.type,s,r||t.key,i||t.ref,null)}function fs(t,e){var n={__c:e="__cC"+Jo++,__:t,Consumer:function(r,i){return r.children(i)},Provider:function(r){var i,o;return this.getChildContext||(i=[],(o={})[e]=this,this.getChildContext=function(){return o},this.shouldComponentUpdate=function(s){this.props.value!==s.value&&i.some(mr)},this.sub=function(s){i.push(s);var l=s.componentWillUnmount;s.componentWillUnmount=function(){i.splice(i.indexOf(s),1),l&&l.call(s)}}),r.children}};return n.Provider.__=n.Consumer.contextType=n}qt=es.slice,S={__e:function(t,e,n,r){for(var i,o,s;e=e.__;)if((i=e.__c)&&!i.__)try{if((o=i.constructor)&&o.getDerivedStateFromError!=null&&(i.setState(o.getDerivedStateFromError(t)),s=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(t,r||{}),s=i.__d),s)return i.__E=i}catch(l){t=l}throw t}},Qo=0,Ae.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=Fe({},this.state),typeof t=="function"&&(t=t(Fe({},n),this.props)),t&&Fe(n,t),t!=null&&this.__v&&(e&&this._sb.push(e),mr(this))},Ae.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),mr(this))},Ae.prototype.render=Oe,Bt=[],En.__r=0,Jo=0;const ol="modulepreload",sl=function(t){return"/dl-model/"+t},$i={},N=function(e,n,r){if(!n||n.length===0)return e();const i=document.getElementsByTagName("link");return Promise.all(n.map(o=>{if(o=sl(o),o in $i)return;$i[o]=!0;const s=o.endsWith(".css"),l=s?'[rel="stylesheet"]':"";if(!!r)for(let a=i.length-1;a>=0;a--){const f=i[a];if(f.href===o&&(!s||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${l}`))return;const u=document.createElement("link");if(u.rel=s?"stylesheet":ol,s||(u.as="script",u.crossOrigin=""),u.href=o,document.head.appendChild(u),s)return new Promise((a,f)=>{u.addEventListener("load",a),u.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${o}`)))})})).then(()=>e())};var Ke,B,Qn,ji,vt=0,ps=[],dn=[],zi=S.__b,Ni=S.__r,Ui=S.diffed,Vi=S.__c,Hi=S.unmount;function nt(t,e){S.__h&&S.__h(B,t,vt||e),vt=0;var n=B.__H||(B.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({__V:dn}),n.__[t]}function Bn(t){return vt=1,zr(vs,t)}function zr(t,e,n){var r=nt(Ke++,2);if(r.t=t,!r.__c&&(r.__=[n?n(e):vs(void 0,e),function(o){var s=r.__N?r.__N[0]:r.__[0],l=r.t(s,o);s!==l&&(r.__N=[l,r.__[1]],r.__c.setState({}))}],r.__c=B,!B.u)){B.u=!0;var i=B.shouldComponentUpdate;B.shouldComponentUpdate=function(o,s,l){if(!r.__c.__H)return!0;var c=r.__c.__H.__.filter(function(a){return a.__c});if(c.every(function(a){return!a.__N}))return!i||i.call(this,o,s,l);var u=!1;return c.forEach(function(a){if(a.__N){var f=a.__[0];a.__=a.__N,a.__N=void 0,f!==a.__[0]&&(u=!0)}}),!(!u&&r.__c.props===o)&&(!i||i.call(this,o,s,l))}}return r.__N||r.__}function yt(t,e){var n=nt(Ke++,3);!S.__s&&Ur(n.__H,e)&&(n.__=t,n.i=e,B.__H.__h.push(n))}function Qt(t,e){var n=nt(Ke++,4);!S.__s&&Ur(n.__H,e)&&(n.__=t,n.i=e,B.__h.push(n))}function Vt(t){return vt=5,$n(function(){return{current:t}},[])}function hs(t,e,n){vt=6,Qt(function(){return typeof t=="function"?(t(e()),function(){return t(null)}):t?(t.current=e(),function(){return t.current=null}):void 0},n==null?n:n.concat(t))}function $n(t,e){var n=nt(Ke++,7);return Ur(n.__H,e)?(n.__V=t(),n.i=e,n.__h=t,n.__V):n.__}function ds(t,e){return vt=8,$n(function(){return t},e)}function ms(t){var e=B.context[t.__c],n=nt(Ke++,9);return n.c=t,e?(n.__==null&&(n.__=!0,e.sub(B)),e.props.value):t.__}function Nr(t,e){S.useDebugValue&&S.useDebugValue(e?e(t):t)}function al(t){var e=nt(Ke++,10),n=Bn();return e.__=t,B.componentDidCatch||(B.componentDidCatch=function(r,i){e.__&&e.__(r,i),n[1](r)}),[n[0],function(){n[1](void 0)}]}function gs(){var t=nt(Ke++,11);if(!t.__){for(var e=B.__v;e!==null&&!e.__m&&e.__!==null;)e=e.__;var n=e.__m||(e.__m=[0,0]);t.__="P"+n[0]+"-"+n[1]++}return t.__}function cl(){for(var t;t=ps.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(mn),t.__H.__h.forEach(gr),t.__H.__h=[]}catch(e){t.__H.__h=[],S.__e(e,t.__v)}}S.__b=function(t){B=null,zi&&zi(t)},S.__r=function(t){Ni&&Ni(t),Ke=0;var e=(B=t.__c).__H;e&&(Qn===B?(e.__h=[],B.__h=[],e.__.forEach(function(n){n.__N&&(n.__=n.__N),n.__V=dn,n.__N=n.i=void 0})):(e.__h.forEach(mn),e.__h.forEach(gr),e.__h=[])),Qn=B},S.diffed=function(t){Ui&&Ui(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(ps.push(e)!==1&&ji===S.requestAnimationFrame||((ji=S.requestAnimationFrame)||ll)(cl)),e.__H.__.forEach(function(n){n.i&&(n.__H=n.i),n.__V!==dn&&(n.__=n.__V),n.i=void 0,n.__V=dn})),Qn=B=null},S.__c=function(t,e){e.some(function(n){try{n.__h.forEach(mn),n.__h=n.__h.filter(function(r){return!r.__||gr(r)})}catch(r){e.some(function(i){i.__h&&(i.__h=[])}),e=[],S.__e(r,n.__v)}}),Vi&&Vi(t,e)},S.unmount=function(t){Hi&&Hi(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(r){try{mn(r)}catch(i){e=i}}),n.__H=void 0,e&&S.__e(e,n.__v))};var Wi=typeof requestAnimationFrame=="function";function ll(t){var e,n=function(){clearTimeout(r),Wi&&cancelAnimationFrame(e),setTimeout(t)},r=setTimeout(n,100);Wi&&(e=requestAnimationFrame(n))}function mn(t){var e=B,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),B=e}function gr(t){var e=B;t.__c=t.__(),B=e}function Ur(t,e){return!t||t.length!==e.length||e.some(function(n,r){return n!==t[r]})}function vs(t,e){return typeof e=="function"?e(t):e}function ys(t,e){for(var n in e)t[n]=e[n];return t}function vr(t,e){for(var n in t)if(n!=="__source"&&!(n in e))return!0;for(var r in e)if(r!=="__source"&&t[r]!==e[r])return!0;return!1}function Jn(t,e){return t===e&&(t!==0||1/t==1/e)||t!=t&&e!=e}function Sn(t){this.props=t}function _s(t,e){function n(i){var o=this.props.ref,s=o==i.ref;return!s&&o&&(o.call?o(null):o.current=null),e?!e(this.props,i)||!s:vr(this.props,i)}function r(i){return this.shouldComponentUpdate=n,ke(t,i)}return r.displayName="Memo("+(t.displayName||t.name)+")",r.prototype.isReactComponent=!0,r.__f=!0,r}(Sn.prototype=new Ae).isPureReactComponent=!0,Sn.prototype.shouldComponentUpdate=function(t,e){return vr(this.props,t)||vr(this.state,e)};var Gi=S.__b;S.__b=function(t){t.type&&t.type.__f&&t.ref&&(t.props.ref=t.ref,t.ref=null),Gi&&Gi(t)};var ul=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function ws(t){function e(n){var r=ys({},n);return delete r.ref,t(r,n.ref||null)}return e.$$typeof=ul,e.render=e,e.prototype.isReactComponent=e.__f=!0,e.displayName="ForwardRef("+(t.displayName||t.name)+")",e}var Xi=function(t,e){return t==null?null:ze(ze(t).map(e))},bs={map:Xi,forEach:Xi,count:function(t){return t?ze(t).length:0},only:function(t){var e=ze(t);if(e.length!==1)throw"Children.only";return e[0]},toArray:ze},fl=S.__e;S.__e=function(t,e,n,r){if(t.then){for(var i,o=e;o=o.__;)if((i=o.__c)&&i.__c)return e.__e==null&&(e.__e=n.__e,e.__k=n.__k),i.__c(t,e)}fl(t,e,n,r)};var Ki=S.unmount;function xs(t,e,n){return t&&(t.__c&&t.__c.__H&&(t.__c.__H.__.forEach(function(r){typeof r.__c=="function"&&r.__c()}),t.__c.__H=null),(t=ys({},t)).__c!=null&&(t.__c.__P===n&&(t.__c.__P=e),t.__c=null),t.__k=t.__k&&t.__k.map(function(r){return xs(r,e,n)})),t}function Es(t,e,n){return t&&(t.__v=null,t.__k=t.__k&&t.__k.map(function(r){return Es(r,e,n)}),t.__c&&t.__c.__P===e&&(t.__e&&n.insertBefore(t.__e,t.__d),t.__c.__e=!0,t.__c.__P=n)),t}function et(){this.__u=0,this.t=null,this.__b=null}function Ps(t){var e=t.__.__c;return e&&e.__a&&e.__a(t)}function le(t){var e,n,r;function i(o){if(e||(e=t()).then(function(s){n=s.default||s},function(s){r=s}),r)throw r;if(!n)throw e;return ke(n,o)}return i.displayName="Lazy",i.__f=!0,i}function mt(){this.u=null,this.o=null}S.unmount=function(t){var e=t.__c;e&&e.__R&&e.__R(),e&&t.__h===!0&&(t.type=null),Ki&&Ki(t)},(et.prototype=new Ae).__c=function(t,e){var n=e.__c,r=this;r.t==null&&(r.t=[]),r.t.push(n);var i=Ps(r.__v),o=!1,s=function(){o||(o=!0,n.__R=null,i?i(l):l())};n.__R=s;var l=function(){if(!--r.__u){if(r.state.__a){var u=r.state.__a;r.__v.__k[0]=Es(u,u.__c.__P,u.__c.__O)}var a;for(r.setState({__a:r.__b=null});a=r.t.pop();)a.forceUpdate()}},c=e.__h===!0;r.__u++||c||r.setState({__a:r.__b=r.__v.__k[0]}),t.then(s,s)},et.prototype.componentWillUnmount=function(){this.t=[]},et.prototype.render=function(t,e){if(this.__b){if(this.__v.__k){var n=document.createElement("div"),r=this.__v.__k[0].__c;this.__v.__k[0]=xs(this.__b,n,r.__O=r.__P)}this.__b=null}var i=e.__a&&ke(Oe,null,t.fallback);return i&&(i.__h=null),[ke(Oe,null,e.__a?null:t.children),i]};var Yi=function(t,e,n){if(++n[1]===n[0]&&t.o.delete(e),t.props.revealOrder&&(t.props.revealOrder[0]!=="t"||!t.o.size))for(n=t.u;n;){for(;n.length>3;)n.pop()();if(n[1]<n[0])break;t.u=n=n[2]}};function pl(t){return this.getChildContext=function(){return t.context},t.children}function hl(t){var e=this,n=t.i;e.componentWillUnmount=function(){gt(null,e.l),e.l=null,e.i=null},e.i&&e.i!==n&&e.componentWillUnmount(),t.__v?(e.l||(e.i=n,e.l={nodeType:1,parentNode:n,childNodes:[],appendChild:function(r){this.childNodes.push(r),e.i.appendChild(r)},insertBefore:function(r,i){this.childNodes.push(r),e.i.appendChild(r)},removeChild:function(r){this.childNodes.splice(this.childNodes.indexOf(r)>>>1,1),e.i.removeChild(r)}}),gt(ke(pl,{context:e.context},t.__v),e.l)):e.l&&e.componentWillUnmount()}function Ss(t,e){var n=ke(hl,{__v:t,i:e});return n.containerInfo=e,n}(mt.prototype=new Ae).__a=function(t){var e=this,n=Ps(e.__v),r=e.o.get(t);return r[0]++,function(i){var o=function(){e.props.revealOrder?(r.push(i),Yi(e,t,r)):i()};n?n(o):o()}},mt.prototype.render=function(t){this.u=null,this.o=new Map;var e=ze(t.children);t.revealOrder&&t.revealOrder[0]==="b"&&e.reverse();for(var n=e.length;n--;)this.o.set(e[n],this.u=[1,0,this.u]);return t.children},mt.prototype.componentDidUpdate=mt.prototype.componentDidMount=function(){var t=this;this.o.forEach(function(e,n){Yi(t,n,e)})};var As=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,dl=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,ml=typeof document<"u",gl=function(t){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/i:/fil|che|ra/i).test(t)};function Ts(t,e,n){return e.__k==null&&(e.textContent=""),gt(t,e),typeof n=="function"&&n(),t?t.__c:null}function Ms(t,e,n){return us(t,e),typeof n=="function"&&n(),t?t.__c:null}Ae.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(t){Object.defineProperty(Ae.prototype,t,{configurable:!0,get:function(){return this["UNSAFE_"+t]},set:function(e){Object.defineProperty(this,t,{configurable:!0,writable:!0,value:e})}})});var Zi=S.event;function vl(){}function yl(){return this.cancelBubble}function _l(){return this.defaultPrevented}S.event=function(t){return Zi&&(t=Zi(t)),t.persist=vl,t.isPropagationStopped=yl,t.isDefaultPrevented=_l,t.nativeEvent=t};var Cs,qi={configurable:!0,get:function(){return this.class}},Qi=S.vnode;S.vnode=function(t){var e=t.type,n=t.props,r=n;if(typeof e=="string"){var i=e.indexOf("-")===-1;for(var o in r={},n){var s=n[o];ml&&o==="children"&&e==="noscript"||o==="value"&&"defaultValue"in n&&s==null||(o==="defaultValue"&&"value"in n&&n.value==null?o="value":o==="download"&&s===!0?s="":/ondoubleclick/i.test(o)?o="ondblclick":/^onchange(textarea|input)/i.test(o+e)&&!gl(n.type)?o="oninput":/^onfocus$/i.test(o)?o="onfocusin":/^onblur$/i.test(o)?o="onfocusout":/^on(Ani|Tra|Tou|BeforeInp|Compo)/.test(o)?o=o.toLowerCase():i&&dl.test(o)?o=o.replace(/[A-Z0-9]/g,"-$&").toLowerCase():s===null&&(s=void 0),/^oninput$/i.test(o)&&(o=o.toLowerCase(),r[o]&&(o="oninputCapture")),r[o]=s)}e=="select"&&r.multiple&&Array.isArray(r.value)&&(r.value=ze(n.children).forEach(function(l){l.props.selected=r.value.indexOf(l.props.value)!=-1})),e=="select"&&r.defaultValue!=null&&(r.value=ze(n.children).forEach(function(l){l.props.selected=r.multiple?r.defaultValue.indexOf(l.props.value)!=-1:r.defaultValue==l.props.value})),t.props=r,n.class!=n.className&&(qi.enumerable="className"in n,n.className!=null&&(r.class=n.className),Object.defineProperty(r,"className",qi))}t.$$typeof=As,Qi&&Qi(t)};var Ji=S.__r;S.__r=function(t){Ji&&Ji(t),Cs=t.__c};var Ls={ReactCurrentDispatcher:{current:{readContext:function(t){return Cs.__n[t.__c].props.value}}}},wl="17.0.2";function ks(t){return ke.bind(null,t)}function Vr(t){return!!t&&t.$$typeof===As}function Os(t){return Vr(t)?il.apply(null,arguments):t}function Ds(t){return!!t.__k&&(gt(null,t),!0)}function Is(t){return t&&(t.base||t.nodeType===1&&t)||null}var Rs=function(t,e){return t(e)},Fs=function(t,e){return t(e)},Bs=Oe;function Hr(t){t()}function $s(t){return t}function js(){return[!1,Hr]}var zs=Qt;function Ns(t,e){var n=e(),r=Bn({h:{__:n,v:e}}),i=r[0].h,o=r[1];return Qt(function(){i.__=n,i.v=e,Jn(i.__,e())||o({h:i})},[t,n,e]),yt(function(){return Jn(i.__,i.v())||o({h:i}),t(function(){Jn(i.__,i.v())||o({h:i})})},[t]),n}var bl={useState:Bn,useId:gs,useReducer:zr,useEffect:yt,useLayoutEffect:Qt,useInsertionEffect:zs,useTransition:js,useDeferredValue:$s,useSyncExternalStore:Ns,startTransition:Hr,useRef:Vt,useImperativeHandle:hs,useMemo:$n,useCallback:ds,useContext:ms,useDebugValue:Nr,version:"17.0.2",Children:bs,render:Ts,hydrate:Ms,unmountComponentAtNode:Ds,createPortal:Ss,createElement:ke,createContext:fs,createFactory:ks,cloneElement:Os,createRef:ns,Fragment:Oe,isValidElement:Vr,findDOMNode:Is,Component:Ae,PureComponent:Sn,memo:_s,forwardRef:ws,flushSync:Fs,unstable_batchedUpdates:Rs,StrictMode:Bs,Suspense:et,SuspenseList:mt,lazy:le,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:Ls};const xl=Object.freeze(Object.defineProperty({__proto__:null,Children:bs,PureComponent:Sn,StrictMode:Bs,Suspense:et,SuspenseList:mt,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:Ls,cloneElement:Os,createFactory:ks,createPortal:Ss,default:bl,findDOMNode:Is,flushSync:Fs,forwardRef:ws,hydrate:Ms,isValidElement:Vr,lazy:le,memo:_s,render:Ts,startTransition:Hr,unmountComponentAtNode:Ds,unstable_batchedUpdates:Rs,useDeferredValue:$s,useInsertionEffect:zs,useSyncExternalStore:Ns,useTransition:js,version:wl,Component:Ae,Fragment:Oe,createContext:fs,createElement:ke,createRef:ns,useCallback:ds,useContext:ms,useDebugValue:Nr,useEffect:yt,useErrorBoundary:al,useId:gs,useImperativeHandle:hs,useLayoutEffect:Qt,useMemo:$n,useReducer:zr,useRef:Vt,useState:Bn},Symbol.toStringTag,{value:"Module"})),El=()=>{const t=Vt(!0);return yt(()=>{t.current=!1},[]),t.current},eo=t=>{let e;const n=new Set,r=(c,u)=>{const a=typeof c=="function"?c(e):c;if(!Object.is(a,e)){const f=e;e=u??typeof a!="object"?a:Object.assign({},e,a),n.forEach(p=>p(e,f))}},i=()=>e,l={setState:r,getState:i,subscribe:c=>(n.add(c),()=>n.delete(c)),destroy:()=>n.clear()};return e=t(r,i,l),l},Pl=t=>t?eo(t):eo;var lt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Sl(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Al(t){var e=t.default;if(typeof e=="function"){var n=function r(){if(this instanceof r){var i=[null];i.push.apply(i,arguments);var o=Function.bind.apply(e,i);return new o}return e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var Us={exports:{}},Vs={};const Hs=Al(xl);var Ws={exports:{}},Gs={};var _t=Hs;function Tl(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Ml=typeof Object.is=="function"?Object.is:Tl,Cl=_t.useState,Ll=_t.useEffect,kl=_t.useLayoutEffect,Ol=_t.useDebugValue;function Dl(t,e){var n=e(),r=Cl({inst:{value:n,getSnapshot:e}}),i=r[0].inst,o=r[1];return kl(function(){i.value=n,i.getSnapshot=e,er(i)&&o({inst:i})},[t,n,e]),Ll(function(){return er(i)&&o({inst:i}),t(function(){er(i)&&o({inst:i})})},[t]),Ol(n),n}function er(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Ml(t,n)}catch{return!0}}function Il(t,e){return e()}var Rl=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?Il:Dl;Gs.useSyncExternalStore=_t.useSyncExternalStore!==void 0?_t.useSyncExternalStore:Rl;(function(t){t.exports=Gs})(Ws);var jn=Hs,Fl=Ws.exports;function Bl(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var $l=typeof Object.is=="function"?Object.is:Bl,jl=Fl.useSyncExternalStore,zl=jn.useRef,Nl=jn.useEffect,Ul=jn.useMemo,Vl=jn.useDebugValue;Vs.useSyncExternalStoreWithSelector=function(t,e,n,r,i){var o=zl(null);if(o.current===null){var s={hasValue:!1,value:null};o.current=s}else s=o.current;o=Ul(function(){function c(h){if(!u){if(u=!0,a=h,h=r(h),i!==void 0&&s.hasValue){var d=s.value;if(i(d,h))return f=d}return f=h}if(d=f,$l(a,h))return d;var m=r(h);return i!==void 0&&i(d,m)?d:(a=h,f=m)}var u=!1,a,f,p=n===void 0?null:n;return[function(){return c(e())},p===null?void 0:function(){return c(p())}]},[e,n,r,i]);var l=jl(t,o[0],o[1]);return Nl(function(){s.hasValue=!0,s.value=l},[l]),Vl(l),l};(function(t){t.exports=Vs})(Us);const Hl=Sl(Us.exports),{useSyncExternalStoreWithSelector:Wl}=Hl;function Gl(t,e=t.getState,n){const r=Wl(t.subscribe,t.getState,t.getServerState||t.getState,e,n);return Nr(r),r}const to=t=>{const e=typeof t=="function"?Pl(t):t,n=(r,i)=>Gl(e,r,i);return Object.assign(n,e),n},Wr=t=>t?to(t):to;function Se(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];throw Error("[Immer] minified error nr: "+t+(n.length?" "+n.map(function(i){return"'"+i+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function wt(t){return!!t&&!!t[he]}function tt(t){var e;return!!t&&(function(n){if(!n||typeof n!="object")return!1;var r=Object.getPrototypeOf(n);if(r===null)return!0;var i=Object.hasOwnProperty.call(r,"constructor")&&r.constructor;return i===Object||typeof i=="function"&&Function.toString.call(i)===eu}(t)||Array.isArray(t)||!!t[lo]||!!(!((e=t.constructor)===null||e===void 0)&&e[lo])||Gr(t)||Xr(t))}function Ht(t,e,n){n===void 0&&(n=!1),Pt(t)===0?(n?Object.keys:Qr)(t).forEach(function(r){n&&typeof r=="symbol"||e(r,t[r],t)}):t.forEach(function(r,i){return e(i,r,t)})}function Pt(t){var e=t[he];return e?e.i>3?e.i-4:e.i:Array.isArray(t)?1:Gr(t)?2:Xr(t)?3:0}function yr(t,e){return Pt(t)===2?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function Xl(t,e){return Pt(t)===2?t.get(e):t[e]}function Xs(t,e,n){var r=Pt(t);r===2?t.set(e,n):r===3?(t.delete(e),t.add(n)):t[e]=n}function Kl(t,e){return t===e?t!==0||1/t==1/e:t!=t&&e!=e}function Gr(t){return Ql&&t instanceof Map}function Xr(t){return Jl&&t instanceof Set}function Qe(t){return t.o||t.t}function Kr(t){if(Array.isArray(t))return Array.prototype.slice.call(t);var e=tu(t);delete e[he];for(var n=Qr(e),r=0;r<n.length;r++){var i=n[r],o=e[i];o.writable===!1&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(e[i]={configurable:!0,writable:!0,enumerable:o.enumerable,value:t[i]})}return Object.create(Object.getPrototypeOf(t),e)}function Yr(t,e){return e===void 0&&(e=!1),Zr(t)||wt(t)||!tt(t)||(Pt(t)>1&&(t.set=t.add=t.clear=t.delete=Yl),Object.freeze(t),e&&Ht(t,function(n,r){return Yr(r,!0)},!0)),t}function Yl(){Se(2)}function Zr(t){return t==null||typeof t!="object"||Object.isFrozen(t)}function Le(t){var e=nu[t];return e||Se(18,t),e}function no(){return Wt}function tr(t,e){e&&(Le("Patches"),t.u=[],t.s=[],t.v=e)}function An(t){_r(t),t.p.forEach(Zl),t.p=null}function _r(t){t===Wt&&(Wt=t.l)}function ro(t){return Wt={p:[],l:Wt,h:t,m:!0,_:0}}function Zl(t){var e=t[he];e.i===0||e.i===1?e.j():e.O=!0}function nr(t,e){e._=e.p.length;var n=e.p[0],r=t!==void 0&&t!==n;return e.h.g||Le("ES5").S(e,t,r),r?(n[he].P&&(An(e),Se(4)),tt(t)&&(t=Tn(e,t),e.l||Mn(e,t)),e.u&&Le("Patches").M(n[he].t,t,e.u,e.s)):t=Tn(e,n,[]),An(e),e.u&&e.v(e.u,e.s),t!==Ks?t:void 0}function Tn(t,e,n){if(Zr(e))return e;var r=e[he];if(!r)return Ht(e,function(o,s){return io(t,r,e,o,s,n)},!0),e;if(r.A!==t)return e;if(!r.P)return Mn(t,r.t,!0),r.t;if(!r.I){r.I=!0,r.A._--;var i=r.i===4||r.i===5?r.o=Kr(r.k):r.o;Ht(r.i===3?new Set(i):i,function(o,s){return io(t,r,i,o,s,n)}),Mn(t,i,!1),n&&t.u&&Le("Patches").R(r,n,t.u,t.s)}return r.o}function io(t,e,n,r,i,o){if(wt(i)){var s=Tn(t,i,o&&e&&e.i!==3&&!yr(e.D,r)?o.concat(r):void 0);if(Xs(n,r,s),!wt(s))return;t.m=!1}if(tt(i)&&!Zr(i)){if(!t.h.F&&t._<1)return;Tn(t,i),e&&e.A.l||Mn(t,i)}}function Mn(t,e,n){n===void 0&&(n=!1),t.h.F&&t.m&&Yr(e,n)}function rr(t,e){var n=t[he];return(n?Qe(n):t)[e]}function oo(t,e){if(e in t)for(var n=Object.getPrototypeOf(t);n;){var r=Object.getOwnPropertyDescriptor(n,e);if(r)return r;n=Object.getPrototypeOf(n)}}function wr(t){t.P||(t.P=!0,t.l&&wr(t.l))}function ir(t){t.o||(t.o=Kr(t.t))}function br(t,e,n){var r=Gr(e)?Le("MapSet").N(e,n):Xr(e)?Le("MapSet").T(e,n):t.g?function(i,o){var s=Array.isArray(i),l={i:s?1:0,A:o?o.A:no(),P:!1,I:!1,D:{},l:o,t:i,k:null,o:null,j:null,C:!1},c=l,u=xr;s&&(c=[l],u=Ft);var a=Proxy.revocable(c,u),f=a.revoke,p=a.proxy;return l.k=p,l.j=f,p}(e,n):Le("ES5").J(e,n);return(n?n.A:no()).p.push(r),r}function ql(t){return wt(t)||Se(22,t),function e(n){if(!tt(n))return n;var r,i=n[he],o=Pt(n);if(i){if(!i.P&&(i.i<4||!Le("ES5").K(i)))return i.t;i.I=!0,r=so(n,o),i.I=!1}else r=so(n,o);return Ht(r,function(s,l){i&&Xl(i.t,s)===l||Xs(r,s,e(l))}),o===3?new Set(r):r}(t)}function so(t,e){switch(e){case 2:return new Map(t);case 3:return Array.from(t)}return Kr(t)}var ao,Wt,qr=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",Ql=typeof Map<"u",Jl=typeof Set<"u",co=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",Ks=qr?Symbol.for("immer-nothing"):((ao={})["immer-nothing"]=!0,ao),lo=qr?Symbol.for("immer-draftable"):"__$immer_draftable",he=qr?Symbol.for("immer-state"):"__$immer_state",eu=""+Object.prototype.constructor,Qr=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Object.getOwnPropertyNames,tu=Object.getOwnPropertyDescriptors||function(t){var e={};return Qr(t).forEach(function(n){e[n]=Object.getOwnPropertyDescriptor(t,n)}),e},nu={},xr={get:function(t,e){if(e===he)return t;var n=Qe(t);if(!yr(n,e))return function(i,o,s){var l,c=oo(o,s);return c?"value"in c?c.value:(l=c.get)===null||l===void 0?void 0:l.call(i.k):void 0}(t,n,e);var r=n[e];return t.I||!tt(r)?r:r===rr(t.t,e)?(ir(t),t.o[e]=br(t.A.h,r,t)):r},has:function(t,e){return e in Qe(t)},ownKeys:function(t){return Reflect.ownKeys(Qe(t))},set:function(t,e,n){var r=oo(Qe(t),e);if(r!=null&&r.set)return r.set.call(t.k,n),!0;if(!t.P){var i=rr(Qe(t),e),o=i==null?void 0:i[he];if(o&&o.t===n)return t.o[e]=n,t.D[e]=!1,!0;if(Kl(n,i)&&(n!==void 0||yr(t.t,e)))return!0;ir(t),wr(t)}return t.o[e]===n&&typeof n!="number"&&(n!==void 0||e in t.o)||(t.o[e]=n,t.D[e]=!0,!0)},deleteProperty:function(t,e){return rr(t.t,e)!==void 0||e in t.t?(t.D[e]=!1,ir(t),wr(t)):delete t.D[e],t.o&&delete t.o[e],!0},getOwnPropertyDescriptor:function(t,e){var n=Qe(t),r=Reflect.getOwnPropertyDescriptor(n,e);return r&&{writable:!0,configurable:t.i!==1||e!=="length",enumerable:r.enumerable,value:n[e]}},defineProperty:function(){Se(11)},getPrototypeOf:function(t){return Object.getPrototypeOf(t.t)},setPrototypeOf:function(){Se(12)}},Ft={};Ht(xr,function(t,e){Ft[t]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}}),Ft.deleteProperty=function(t,e){return Ft.set.call(this,t,e,void 0)},Ft.set=function(t,e,n){return xr.set.call(this,t[0],e,n,t[0])};var ru=function(){function t(n){var r=this;this.g=co,this.F=!0,this.produce=function(i,o,s){if(typeof i=="function"&&typeof o!="function"){var l=o;o=i;var c=r;return function(m){var y=this;m===void 0&&(m=l);for(var _=arguments.length,w=Array(_>1?_-1:0),v=1;v<_;v++)w[v-1]=arguments[v];return c.produce(m,function(E){var b;return(b=o).call.apply(b,[y,E].concat(w))})}}var u;if(typeof o!="function"&&Se(6),s!==void 0&&typeof s!="function"&&Se(7),tt(i)){var a=ro(r),f=br(r,i,void 0),p=!0;try{u=o(f),p=!1}finally{p?An(a):_r(a)}return typeof Promise<"u"&&u instanceof Promise?u.then(function(m){return tr(a,s),nr(m,a)},function(m){throw An(a),m}):(tr(a,s),nr(u,a))}if(!i||typeof i!="object"){if((u=o(i))===void 0&&(u=i),u===Ks&&(u=void 0),r.F&&Yr(u,!0),s){var h=[],d=[];Le("Patches").M(i,u,h,d),s(h,d)}return u}Se(21,i)},this.produceWithPatches=function(i,o){if(typeof i=="function")return function(u){for(var a=arguments.length,f=Array(a>1?a-1:0),p=1;p<a;p++)f[p-1]=arguments[p];return r.produceWithPatches(u,function(h){return i.apply(void 0,[h].concat(f))})};var s,l,c=r.produce(i,o,function(u,a){s=u,l=a});return typeof Promise<"u"&&c instanceof Promise?c.then(function(u){return[u,s,l]}):[c,s,l]},typeof(n==null?void 0:n.useProxies)=="boolean"&&this.setUseProxies(n.useProxies),typeof(n==null?void 0:n.autoFreeze)=="boolean"&&this.setAutoFreeze(n.autoFreeze)}var e=t.prototype;return e.createDraft=function(n){tt(n)||Se(8),wt(n)&&(n=ql(n));var r=ro(this),i=br(this,n,void 0);return i[he].C=!0,_r(r),i},e.finishDraft=function(n,r){var i=n&&n[he],o=i.A;return tr(o,r),nr(void 0,o)},e.setAutoFreeze=function(n){this.F=n},e.setUseProxies=function(n){n&&!co&&Se(20),this.g=n},e.applyPatches=function(n,r){var i;for(i=r.length-1;i>=0;i--){var o=r[i];if(o.path.length===0&&o.op==="replace"){n=o.value;break}}i>-1&&(r=r.slice(i+1));var s=Le("Patches").$;return wt(n)?s(n,r):this.produce(n,function(l){return s(l,r)})},t}(),de=new ru,iu=de.produce;de.produceWithPatches.bind(de);de.setAutoFreeze.bind(de);de.setUseProxies.bind(de);de.applyPatches.bind(de);de.createDraft.bind(de);de.finishDraft.bind(de);const ou=iu,Ys=t=>({indices:[0,0],_indicesCache:{},setIndex:(e,n)=>{t(r=>{const{indices:i,_indicesCache:o}=r;i[e]=n;const s=i.slice(0,e+1).join(),l=o[s]??[],{length:c}=i;for(let f=0;e+1+f<c;f++)i[e+1+f]=l[f]??0;const u=i.slice(e),a=i.slice(0,e).join();a&&(o[a]=u)})},showFilter:!1,toggleFilter:()=>t(e=>{e.showFilter=!e.showFilter}),searchAll:!1,toggleSearchAll:()=>t(e=>{e.searchAll=!e.searchAll})}),uo=t=>t==="true";function Zs(t,e){return t&&e&&Object.keys(e).forEach(n=>{const r=e[n];typeof r=="object"?(t[n]||(t[n]={}),Zs(t[n],r)):t[n]=r}),t}const su=(t,e)=>({category:"Adv",setCategory:n=>t(r=>{r.category=n}),advAni:{category:"home",setCategory:n=>t(r=>{r.advAni.category=n}),home:{gender:"Male",setGender:n=>t(r=>{r.advAni.home.gender=n})},weapon:{type:"Sword",setType:n=>t(r=>{r.advAni.weapon.type=n}),gunMode:"Long",setGunMode:n=>t(r=>{r.advAni.weapon.gunMode=n})},genericSkill:{type:"Sword",setType:n=>t(r=>{r.advAni.genericSkill.type=n})},groupByWeapon:{setGroupWeaponType:(n,r)=>t(i=>{i.advAni.groupByWeapon[n]=r})},uniqueOther:{type:"Sword",setType:n=>t(r=>{r.advAni.uniqueOther.type=n}),selected:"",setSelected:n=>t(r=>{r.advAni.uniqueOther.selected=n})}},extraAni:{category:"Dance",setCategory:n=>t(r=>{r.extraAni.category=n})},personalAni:{source:"",setSource:n=>t(r=>{r.personalAni.source=n}),sourceName:"",setSourceName:n=>t(r=>{r.personalAni.sourceName=n})},getCurrentState:()=>{const n=e();return JSON.parse(JSON.stringify(n))},loadState:(n={})=>{t(r=>Zs(r,n))}}),fo={type:"change"},or={type:"start"},po={type:"end"};class au extends dc{constructor(e,n){super(),this.object=e,this.domElement=n,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new ne,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:st.ROTATE,MIDDLE:st.DOLLY,RIGHT:st.PAN},this.touches={ONE:at.ROTATE,TWO:at.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return l.phi},this.getAzimuthalAngle=function(){return l.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(g){g.addEventListener("keydown",wi),this._domElementKeyEvents=g},this.saveState=function(){r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=function(){r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(fo),r.update(),o=i.NONE},this.update=function(){const g=new ne,T=new ht().setFromUnitVectors(e.up,new ne(0,1,0)),Y=T.clone().invert(),J=new ne,xe=new ht,ot=2*Math.PI;return function(){const Pi=r.object.position;g.copy(Pi).sub(r.target),g.applyQuaternion(T),l.setFromVector3(g),r.autoRotate&&o===i.NONE&&k(A()),r.enableDamping?(l.theta+=c.theta*r.dampingFactor,l.phi+=c.phi*r.dampingFactor):(l.theta+=c.theta,l.phi+=c.phi);let Ie=r.minAzimuthAngle,Re=r.maxAzimuthAngle;return isFinite(Ie)&&isFinite(Re)&&(Ie<-Math.PI?Ie+=ot:Ie>Math.PI&&(Ie-=ot),Re<-Math.PI?Re+=ot:Re>Math.PI&&(Re-=ot),Ie<=Re?l.theta=Math.max(Ie,Math.min(Re,l.theta)):l.theta=l.theta>(Ie+Re)/2?Math.max(Ie,l.theta):Math.min(Re,l.theta)),l.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,l.phi)),l.makeSafe(),l.radius*=u,l.radius=Math.max(r.minDistance,Math.min(r.maxDistance,l.radius)),r.enableDamping===!0?r.target.addScaledVector(a,r.dampingFactor):r.target.add(a),g.setFromSpherical(l),g.applyQuaternion(Y),Pi.copy(r.target).add(g),r.object.lookAt(r.target),r.enableDamping===!0?(c.theta*=1-r.dampingFactor,c.phi*=1-r.dampingFactor,a.multiplyScalar(1-r.dampingFactor)):(c.set(0,0,0),a.set(0,0,0)),u=1,f||J.distanceToSquared(r.object.position)>s||8*(1-xe.dot(r.object.quaternion))>s?(r.dispatchEvent(fo),J.copy(r.object.position),xe.copy(r.object.quaternion),f=!1,!0):!1}}(),this.dispose=function(){r.domElement.removeEventListener("contextmenu",bi),r.domElement.removeEventListener("pointerdown",it),r.domElement.removeEventListener("pointercancel",yi),r.domElement.removeEventListener("wheel",_i),r.domElement.removeEventListener("pointermove",Xn),r.domElement.removeEventListener("pointerup",Kn),r._domElementKeyEvents!==null&&r._domElementKeyEvents.removeEventListener("keydown",wi)};const r=this,i={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let o=i.NONE;const s=1e-6,l=new Si,c=new Si;let u=1;const a=new ne;let f=!1;const p=new te,h=new te,d=new te,m=new te,y=new te,_=new te,w=new te,v=new te,E=new te,b=[],P={};function A(){return 2*Math.PI/60/60*r.autoRotateSpeed}function x(){return Math.pow(.95,r.zoomSpeed)}function k(g){c.theta-=g}function M(g){c.phi-=g}const G=function(){const g=new ne;return function(Y,J){g.setFromMatrixColumn(J,0),g.multiplyScalar(-Y),a.add(g)}}(),I=function(){const g=new ne;return function(Y,J){r.screenSpacePanning===!0?g.setFromMatrixColumn(J,1):(g.setFromMatrixColumn(J,0),g.crossVectors(r.object.up,g)),g.multiplyScalar(Y),a.add(g)}}(),O=function(){const g=new ne;return function(Y,J){const xe=r.domElement;if(r.object.isPerspectiveCamera){const ot=r.object.position;g.copy(ot).sub(r.target);let cn=g.length();cn*=Math.tan(r.object.fov/2*Math.PI/180),G(2*Y*cn/xe.clientHeight,r.object.matrix),I(2*J*cn/xe.clientHeight,r.object.matrix)}else r.object.isOrthographicCamera?(G(Y*(r.object.right-r.object.left)/r.object.zoom/xe.clientWidth,r.object.matrix),I(J*(r.object.top-r.object.bottom)/r.object.zoom/xe.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}}();function D(g){r.object.isPerspectiveCamera?u/=g:r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom*g)),r.object.updateProjectionMatrix(),f=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function j(g){r.object.isPerspectiveCamera?u*=g:r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/g)),r.object.updateProjectionMatrix(),f=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function F(g){p.set(g.clientX,g.clientY)}function z(g){w.set(g.clientX,g.clientY)}function K(g){m.set(g.clientX,g.clientY)}function ee(g){h.set(g.clientX,g.clientY),d.subVectors(h,p).multiplyScalar(r.rotateSpeed);const T=r.domElement;k(2*Math.PI*d.x/T.clientHeight),M(2*Math.PI*d.y/T.clientHeight),p.copy(h),r.update()}function oe(g){v.set(g.clientX,g.clientY),E.subVectors(v,w),E.y>0?D(x()):E.y<0&&j(x()),w.copy(v),r.update()}function q(g){y.set(g.clientX,g.clientY),_.subVectors(y,m).multiplyScalar(r.panSpeed),O(_.x,_.y),m.copy(y),r.update()}function ue(g){g.deltaY<0?j(x()):g.deltaY>0&&D(x()),r.update()}function me(g){let T=!1;switch(g.code){case r.keys.UP:g.ctrlKey||g.metaKey||g.shiftKey?M(2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):O(0,r.keyPanSpeed),T=!0;break;case r.keys.BOTTOM:g.ctrlKey||g.metaKey||g.shiftKey?M(-2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):O(0,-r.keyPanSpeed),T=!0;break;case r.keys.LEFT:g.ctrlKey||g.metaKey||g.shiftKey?k(2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):O(r.keyPanSpeed,0),T=!0;break;case r.keys.RIGHT:g.ctrlKey||g.metaKey||g.shiftKey?k(-2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):O(-r.keyPanSpeed,0),T=!0;break}T&&(g.preventDefault(),r.update())}function Q(){if(b.length===1)p.set(b[0].pageX,b[0].pageY);else{const g=.5*(b[0].pageX+b[1].pageX),T=.5*(b[0].pageY+b[1].pageY);p.set(g,T)}}function X(){if(b.length===1)m.set(b[0].pageX,b[0].pageY);else{const g=.5*(b[0].pageX+b[1].pageX),T=.5*(b[0].pageY+b[1].pageY);m.set(g,T)}}function Ze(){const g=b[0].pageX-b[1].pageX,T=b[0].pageY-b[1].pageY,Y=Math.sqrt(g*g+T*T);w.set(0,Y)}function qe(){r.enableZoom&&Ze(),r.enablePan&&X()}function Ve(){r.enableZoom&&Ze(),r.enableRotate&&Q()}function sn(g){if(b.length==1)h.set(g.pageX,g.pageY);else{const Y=Yn(g),J=.5*(g.pageX+Y.x),xe=.5*(g.pageY+Y.y);h.set(J,xe)}d.subVectors(h,p).multiplyScalar(r.rotateSpeed);const T=r.domElement;k(2*Math.PI*d.x/T.clientHeight),M(2*Math.PI*d.y/T.clientHeight),p.copy(h)}function Dt(g){if(b.length===1)y.set(g.pageX,g.pageY);else{const T=Yn(g),Y=.5*(g.pageX+T.x),J=.5*(g.pageY+T.y);y.set(Y,J)}_.subVectors(y,m).multiplyScalar(r.panSpeed),O(_.x,_.y),m.copy(y)}function It(g){const T=Yn(g),Y=g.pageX-T.x,J=g.pageY-T.y,xe=Math.sqrt(Y*Y+J*J);v.set(0,xe),E.set(0,Math.pow(v.y/w.y,r.zoomSpeed)),D(E.y),w.copy(v)}function an(g){r.enableZoom&&It(g),r.enablePan&&Dt(g)}function sc(g){r.enableZoom&&It(g),r.enableRotate&&sn(g)}function it(g){r.enabled!==!1&&(b.length===0&&(r.domElement.setPointerCapture(g.pointerId),r.domElement.addEventListener("pointermove",Xn),r.domElement.addEventListener("pointerup",Kn)),fc(g),g.pointerType==="touch"?lc(g):ac(g))}function Xn(g){r.enabled!==!1&&(g.pointerType==="touch"?uc(g):cc(g))}function Kn(g){xi(g),b.length===0&&(r.domElement.releasePointerCapture(g.pointerId),r.domElement.removeEventListener("pointermove",Xn),r.domElement.removeEventListener("pointerup",Kn)),r.dispatchEvent(po),o=i.NONE}function yi(g){xi(g)}function ac(g){let T;switch(g.button){case 0:T=r.mouseButtons.LEFT;break;case 1:T=r.mouseButtons.MIDDLE;break;case 2:T=r.mouseButtons.RIGHT;break;default:T=-1}switch(T){case st.DOLLY:if(r.enableZoom===!1)return;z(g),o=i.DOLLY;break;case st.ROTATE:if(g.ctrlKey||g.metaKey||g.shiftKey){if(r.enablePan===!1)return;K(g),o=i.PAN}else{if(r.enableRotate===!1)return;F(g),o=i.ROTATE}break;case st.PAN:if(g.ctrlKey||g.metaKey||g.shiftKey){if(r.enableRotate===!1)return;F(g),o=i.ROTATE}else{if(r.enablePan===!1)return;K(g),o=i.PAN}break;default:o=i.NONE}o!==i.NONE&&r.dispatchEvent(or)}function cc(g){switch(o){case i.ROTATE:if(r.enableRotate===!1)return;ee(g);break;case i.DOLLY:if(r.enableZoom===!1)return;oe(g);break;case i.PAN:if(r.enablePan===!1)return;q(g);break}}function _i(g){r.enabled===!1||r.enableZoom===!1||o!==i.NONE||(g.preventDefault(),r.dispatchEvent(or),ue(g),r.dispatchEvent(po))}function wi(g){r.enabled===!1||r.enablePan===!1||me(g)}function lc(g){switch(Ei(g),b.length){case 1:switch(r.touches.ONE){case at.ROTATE:if(r.enableRotate===!1)return;Q(),o=i.TOUCH_ROTATE;break;case at.PAN:if(r.enablePan===!1)return;X(),o=i.TOUCH_PAN;break;default:o=i.NONE}break;case 2:switch(r.touches.TWO){case at.DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;qe(),o=i.TOUCH_DOLLY_PAN;break;case at.DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;Ve(),o=i.TOUCH_DOLLY_ROTATE;break;default:o=i.NONE}break;default:o=i.NONE}o!==i.NONE&&r.dispatchEvent(or)}function uc(g){switch(Ei(g),o){case i.TOUCH_ROTATE:if(r.enableRotate===!1)return;sn(g),r.update();break;case i.TOUCH_PAN:if(r.enablePan===!1)return;Dt(g),r.update();break;case i.TOUCH_DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;an(g),r.update();break;case i.TOUCH_DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;sc(g),r.update();break;default:o=i.NONE}}function bi(g){r.enabled!==!1&&g.preventDefault()}function fc(g){b.push(g)}function xi(g){delete P[g.pointerId];for(let T=0;T<b.length;T++)if(b[T].pointerId==g.pointerId){b.splice(T,1);return}}function Ei(g){let T=P[g.pointerId];T===void 0&&(T=new te,P[g.pointerId]=T),T.set(g.pageX,g.pageY)}function Yn(g){const T=g.pointerId===b[0].pointerId?b[1]:b[0];return P[T.pointerId]}r.domElement.addEventListener("contextmenu",bi),r.domElement.addEventListener("pointerdown",it),r.domElement.addEventListener("pointercancel",yi),r.domElement.addEventListener("wheel",_i,{passive:!1}),this.update()}}const qs="fbx",Qs="animations",cu="img/textures/matcap",zn="data";var ho={},Er=function(t){return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))},Js=function(t){return new Worker(t)};try{URL.revokeObjectURL(Er(""))}catch{Er=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)},Js=function(e){return new Worker(e,{type:"module"})}}var lu=function(t,e,n,r,i){var o=Js(ho[e]||(ho[e]=Er(t)));return o.onerror=function(s){return i(s.error,null)},o.onmessage=function(s){return i(null,s.data)},o.postMessage(n,r),o},L=Uint8Array,Z=Uint16Array,Ne=Uint32Array,St=new L([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),At=new L([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Gt=new L([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ea=function(t,e){for(var n=new Z(31),r=0;r<31;++r)n[r]=e+=1<<t[r-1];for(var i=new Ne(n[30]),r=1;r<30;++r)for(var o=n[r];o<n[r+1];++o)i[o]=o-n[r]<<5|r;return[n,i]},ta=ea(St,2),Jr=ta[0],Cn=ta[1];Jr[28]=258,Cn[258]=28;var na=ea(At,0),ra=na[0],Pr=na[1],Xt=new Z(32768);for(var $=0;$<32768;++$){var He=($&43690)>>>1|($&21845)<<1;He=(He&52428)>>>2|(He&13107)<<2,He=(He&61680)>>>4|(He&3855)<<4,Xt[$]=((He&65280)>>>8|(He&255)<<8)>>>1}var _e=function(t,e,n){for(var r=t.length,i=0,o=new Z(e);i<r;++i)++o[t[i]-1];var s=new Z(e);for(i=0;i<e;++i)s[i]=s[i-1]+o[i-1]<<1;var l;if(n){l=new Z(1<<e);var c=15-e;for(i=0;i<r;++i)if(t[i])for(var u=i<<4|t[i],a=e-t[i],f=s[t[i]-1]++<<a,p=f|(1<<a)-1;f<=p;++f)l[Xt[f]>>>c]=u}else for(l=new Z(r),i=0;i<r;++i)t[i]&&(l[i]=Xt[s[t[i]-1]++]>>>15-t[i]);return l},Ue=new L(288);for(var $=0;$<144;++$)Ue[$]=8;for(var $=144;$<256;++$)Ue[$]=9;for(var $=256;$<280;++$)Ue[$]=7;for(var $=280;$<288;++$)Ue[$]=8;var bt=new L(32);for(var $=0;$<32;++$)bt[$]=5;var ia=_e(Ue,9,0),oa=_e(Ue,9,1),sa=_e(bt,5,0),aa=_e(bt,5,1),gn=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},ve=function(t,e,n){var r=e/8|0;return(t[r]|t[r+1]<<8)>>(e&7)&n},vn=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(e&7)},Jt=function(t){return(t/8|0)+(t&7&&1)},we=function(t,e,n){(e==null||e<0)&&(e=0),(n==null||n>t.length)&&(n=t.length);var r=new(t instanceof Z?Z:t instanceof Ne?Ne:L)(n-e);return r.set(t.subarray(e,n)),r},en=function(t,e,n){var r=t.length;if(!r||n&&!n.l&&r<5)return e||new L(0);var i=!e||n,o=!n||n.i;n||(n={}),e||(e=new L(r*3));var s=function(Ze){var qe=e.length;if(Ze>qe){var Ve=new L(Math.max(qe*2,Ze));Ve.set(e),e=Ve}},l=n.f||0,c=n.p||0,u=n.b||0,a=n.l,f=n.d,p=n.m,h=n.n,d=r*8;do{if(!a){n.f=l=ve(t,c,1);var m=ve(t,c+1,3);if(c+=3,m)if(m==1)a=oa,f=aa,p=9,h=5;else if(m==2){var v=ve(t,c,31)+257,E=ve(t,c+10,15)+4,b=v+ve(t,c+5,31)+1;c+=14;for(var P=new L(b),A=new L(19),x=0;x<E;++x)A[Gt[x]]=ve(t,c+x*3,7);c+=E*3;for(var k=gn(A),M=(1<<k)-1,G=_e(A,k,1),x=0;x<b;){var I=G[ve(t,c,M)];c+=I&15;var y=I>>>4;if(y<16)P[x++]=y;else{var O=0,D=0;for(y==16?(D=3+ve(t,c,3),c+=2,O=P[x-1]):y==17?(D=3+ve(t,c,7),c+=3):y==18&&(D=11+ve(t,c,127),c+=7);D--;)P[x++]=O}}var j=P.subarray(0,v),F=P.subarray(v);p=gn(j),h=gn(F),a=_e(j,p,1),f=_e(F,h,1)}else throw"invalid block type";else{var y=Jt(c)+4,_=t[y-4]|t[y-3]<<8,w=y+_;if(w>r){if(o)throw"unexpected EOF";break}i&&s(u+_),e.set(t.subarray(y,w),u),n.b=u+=_,n.p=c=w*8;continue}if(c>d){if(o)throw"unexpected EOF";break}}i&&s(u+131072);for(var z=(1<<p)-1,K=(1<<h)-1,ee=c;;ee=c){var O=a[vn(t,c)&z],oe=O>>>4;if(c+=O&15,c>d){if(o)throw"unexpected EOF";break}if(!O)throw"invalid length/literal";if(oe<256)e[u++]=oe;else if(oe==256){ee=c,a=null;break}else{var q=oe-254;if(oe>264){var x=oe-257,ue=St[x];q=ve(t,c,(1<<ue)-1)+Jr[x],c+=ue}var me=f[vn(t,c)&K],Q=me>>>4;if(!me)throw"invalid distance";c+=me&15;var F=ra[Q];if(Q>3){var ue=At[Q];F+=vn(t,c)&(1<<ue)-1,c+=ue}if(c>d){if(o)throw"unexpected EOF";break}i&&s(u+131072);for(var X=u+q;u<X;u+=4)e[u]=e[u-F],e[u+1]=e[u+1-F],e[u+2]=e[u+2-F],e[u+3]=e[u+3-F];u=X}}n.l=a,n.p=ee,n.b=u,a&&(l=1,n.m=p,n.d=f,n.n=h)}while(!l);return u==e.length?e:we(e,0,u)},Te=function(t,e,n){n<<=e&7;var r=e/8|0;t[r]|=n,t[r+1]|=n>>>8},ut=function(t,e,n){n<<=e&7;var r=e/8|0;t[r]|=n,t[r+1]|=n>>>8,t[r+2]|=n>>>16},yn=function(t,e){for(var n=[],r=0;r<t.length;++r)t[r]&&n.push({s:r,f:t[r]});var i=n.length,o=n.slice();if(!i)return[Be,0];if(i==1){var s=new L(n[0].s+1);return s[n[0].s]=1,[s,1]}n.sort(function(b,P){return b.f-P.f}),n.push({s:-1,f:25001});var l=n[0],c=n[1],u=0,a=1,f=2;for(n[0]={s:-1,f:l.f+c.f,l,r:c};a!=i-1;)l=n[n[u].f<n[f].f?u++:f++],c=n[u!=a&&n[u].f<n[f].f?u++:f++],n[a++]={s:-1,f:l.f+c.f,l,r:c};for(var p=o[0].s,r=1;r<i;++r)o[r].s>p&&(p=o[r].s);var h=new Z(p+1),d=Ln(n[a-1],h,0);if(d>e){var r=0,m=0,y=d-e,_=1<<y;for(o.sort(function(P,A){return h[A.s]-h[P.s]||P.f-A.f});r<i;++r){var w=o[r].s;if(h[w]>e)m+=_-(1<<d-h[w]),h[w]=e;else break}for(m>>>=y;m>0;){var v=o[r].s;h[v]<e?m-=1<<e-h[v]++-1:++r}for(;r>=0&&m;--r){var E=o[r].s;h[E]==e&&(--h[E],++m)}d=e}return[new L(h),d]},Ln=function(t,e,n){return t.s==-1?Math.max(Ln(t.l,e,n+1),Ln(t.r,e,n+1)):e[t.s]=n},Sr=function(t){for(var e=t.length;e&&!t[--e];);for(var n=new Z(++e),r=0,i=t[0],o=1,s=function(c){n[r++]=c},l=1;l<=e;++l)if(t[l]==i&&l!=e)++o;else{if(!i&&o>2){for(;o>138;o-=138)s(32754);o>2&&(s(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(s(i),--o;o>6;o-=6)s(8304);o>2&&(s(o-3<<5|8208),o=0)}for(;o--;)s(i);o=1,i=t[l]}return[n.subarray(0,r),e]},ft=function(t,e){for(var n=0,r=0;r<e.length;++r)n+=t[r]*e[r];return n},jt=function(t,e,n){var r=n.length,i=Jt(e+2);t[i]=r&255,t[i+1]=r>>>8,t[i+2]=t[i]^255,t[i+3]=t[i+1]^255;for(var o=0;o<r;++o)t[i+o+4]=n[o];return(i+4+r)*8},Ar=function(t,e,n,r,i,o,s,l,c,u,a){Te(e,a++,n),++i[256];for(var f=yn(i,15),p=f[0],h=f[1],d=yn(o,15),m=d[0],y=d[1],_=Sr(p),w=_[0],v=_[1],E=Sr(m),b=E[0],P=E[1],A=new Z(19),x=0;x<w.length;++x)A[w[x]&31]++;for(var x=0;x<b.length;++x)A[b[x]&31]++;for(var k=yn(A,7),M=k[0],G=k[1],I=19;I>4&&!M[Gt[I-1]];--I);var O=u+5<<3,D=ft(i,Ue)+ft(o,bt)+s,j=ft(i,p)+ft(o,m)+s+14+3*I+ft(A,M)+(2*A[16]+3*A[17]+7*A[18]);if(O<=D&&O<=j)return jt(e,a,t.subarray(c,c+u));var F,z,K,ee;if(Te(e,a,1+(j<D)),a+=2,j<D){F=_e(p,h,0),z=p,K=_e(m,y,0),ee=m;var oe=_e(M,G,0);Te(e,a,v-257),Te(e,a+5,P-1),Te(e,a+10,I-4),a+=14;for(var x=0;x<I;++x)Te(e,a+3*x,M[Gt[x]]);a+=3*I;for(var q=[w,b],ue=0;ue<2;++ue)for(var me=q[ue],x=0;x<me.length;++x){var Q=me[x]&31;Te(e,a,oe[Q]),a+=M[Q],Q>15&&(Te(e,a,me[x]>>>5&127),a+=me[x]>>>12)}}else F=ia,z=Ue,K=sa,ee=bt;for(var x=0;x<l;++x)if(r[x]>255){var Q=r[x]>>>18&31;ut(e,a,F[Q+257]),a+=z[Q+257],Q>7&&(Te(e,a,r[x]>>>23&31),a+=St[Q]);var X=r[x]&31;ut(e,a,K[X]),a+=ee[X],X>3&&(ut(e,a,r[x]>>>5&8191),a+=At[X])}else ut(e,a,F[r[x]]),a+=z[r[x]];return ut(e,a,F[256]),a+z[256]},ca=new Ne([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Be=new L(0),la=function(t,e,n,r,i,o){var s=t.length,l=new L(r+s+5*(1+Math.ceil(s/7e3))+i),c=l.subarray(r,l.length-i),u=0;if(!e||s<8)for(var a=0;a<=s;a+=65535){var f=a+65535;f<s?u=jt(c,u,t.subarray(a,f)):(c[a]=o,u=jt(c,u,t.subarray(a,s)))}else{for(var p=ca[e-1],h=p>>>13,d=p&8191,m=(1<<n)-1,y=new Z(32768),_=new Z(m+1),w=Math.ceil(n/3),v=2*w,E=function(it){return(t[it]^t[it+1]<<w^t[it+2]<<v)&m},b=new Ne(25e3),P=new Z(288),A=new Z(32),x=0,k=0,a=0,M=0,G=0,I=0;a<s;++a){var O=E(a),D=a&32767,j=_[O];if(y[D]=j,_[O]=D,G<=a){var F=s-a;if((x>7e3||M>24576)&&F>423){u=Ar(t,c,0,b,P,A,k,M,I,a-I,u),M=x=k=0,I=a;for(var z=0;z<286;++z)P[z]=0;for(var z=0;z<30;++z)A[z]=0}var K=2,ee=0,oe=d,q=D-j&32767;if(F>2&&O==E(a-q))for(var ue=Math.min(h,F)-1,me=Math.min(32767,a),Q=Math.min(258,F);q<=me&&--oe&&D!=j;){if(t[a+K]==t[a+K-q]){for(var X=0;X<Q&&t[a+X]==t[a+X-q];++X);if(X>K){if(K=X,ee=q,X>ue)break;for(var Ze=Math.min(q,X-2),qe=0,z=0;z<Ze;++z){var Ve=a-q+z+32768&32767,sn=y[Ve],Dt=Ve-sn+32768&32767;Dt>qe&&(qe=Dt,j=Ve)}}}D=j,j=y[D],q+=D-j+32768&32767}if(ee){b[M++]=268435456|Cn[K]<<18|Pr[ee];var It=Cn[K]&31,an=Pr[ee]&31;k+=St[It]+At[an],++P[257+It],++A[an],G=a+K,++x}else b[M++]=t[a],++P[t[a]]}}u=Ar(t,c,o,b,P,A,k,M,I,a-I,u),!o&&u&7&&(u=jt(c,u+1,Be))}return we(l,0,r+Jt(u)+i)},ua=function(){for(var t=new Ne(256),e=0;e<256;++e){for(var n=e,r=9;--r;)n=(n&1&&3988292384)^n>>>1;t[e]=n}return t}(),Tt=function(){var t=-1;return{p:function(e){for(var n=t,r=0;r<e.length;++r)n=ua[n&255^e[r]]^n>>>8;t=n},d:function(){return~t}}},ei=function(){var t=1,e=0;return{p:function(n){for(var r=t,i=e,o=n.length,s=0;s!=o;){for(var l=Math.min(s+2655,o);s<l;++s)i+=r+=n[s];r=(r&65535)+15*(r>>16),i=(i&65535)+15*(i>>16)}t=r,e=i},d:function(){return t%=65521,e%=65521,(t&255)<<24|t>>>8<<16|(e&255)<<8|e>>>8}}},rt=function(t,e,n,r,i){return la(t,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(t.length)))*1.5):12+e.mem,n,r,!i)},tn=function(t,e){var n={};for(var r in t)n[r]=t[r];for(var r in e)n[r]=e[r];return n},mo=function(t,e,n){for(var r=t(),i=t.toString(),o=i.slice(i.indexOf("[")+1,i.lastIndexOf("]")).replace(/ /g,"").split(","),s=0;s<r.length;++s){var l=r[s],c=o[s];if(typeof l=="function"){e+=";"+c+"=";var u=l.toString();if(l.prototype)if(u.indexOf("[native code]")!=-1){var a=u.indexOf(" ",8)+1;e+=u.slice(a,u.indexOf("(",a))}else{e+=u;for(var f in l.prototype)e+=";"+c+".prototype."+f+"="+l.prototype[f].toString()}else e+=u}else n[c]=l}return[e,n]},ln=[],uu=function(t){var e=[];for(var n in t)(t[n]instanceof L||t[n]instanceof Z||t[n]instanceof Ne)&&e.push((t[n]=new t[n].constructor(t[n])).buffer);return e},fa=function(t,e,n,r){var i;if(!ln[n]){for(var o="",s={},l=t.length-1,c=0;c<l;++c)i=mo(t[c],o,s),o=i[0],s=i[1];ln[n]=mo(t[l],o,s)}var u=tn({},ln[n][1]);return lu(ln[n][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",n,u,uu(u),r)},Mt=function(){return[L,Z,Ne,St,At,Gt,Jr,ra,oa,aa,Xt,_e,gn,ve,vn,Jt,we,en,Ot,Ye,ti]},Ct=function(){return[L,Z,Ne,St,At,Gt,Cn,Pr,ia,Ue,sa,bt,Xt,ca,Be,_e,Te,ut,yn,Ln,Sr,ft,jt,Ar,Jt,we,la,rt,nn,Ye]},pa=function(){return[ni,ii,R,Tt,ua]},ha=function(){return[ri,ga]},da=function(){return[oi,R,ei]},ma=function(){return[va]},Ye=function(t){return postMessage(t,[t.buffer])},ti=function(t){return t&&t.size&&new L(t.size)},Lt=function(t,e,n,r,i,o){var s=fa(n,r,i,function(l,c){s.terminate(),o(l,c)});return s.postMessage([t,e],e.consume?[t.buffer]:[]),function(){s.terminate()}},be=function(t){return t.ondata=function(e,n){return postMessage([e,n],[e.buffer])},function(e){return t.push(e.data[0],e.data[1])}},kt=function(t,e,n,r,i){var o,s=fa(t,r,i,function(l,c){l?(s.terminate(),e.ondata.call(e,l)):(c[1]&&s.terminate(),e.ondata.call(e,l,c[0],c[1]))});s.postMessage(n),e.push=function(l,c){if(o)throw"stream finished";if(!e.ondata)throw"no stream handler";s.postMessage([l,o=c],[l.buffer])},e.terminate=function(){s.terminate()}},ie=function(t,e){return t[e]|t[e+1]<<8},H=function(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0},sr=function(t,e){return H(t,e)+H(t,e+4)*4294967296},R=function(t,e,n){for(;n;++e)t[e]=n,n>>>=8},ni=function(t,e){var n=e.filename;if(t[0]=31,t[1]=139,t[2]=8,t[8]=e.level<2?4:e.level==9?2:0,t[9]=3,e.mtime!=0&&R(t,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),n){t[3]=8;for(var r=0;r<=n.length;++r)t[r+10]=n.charCodeAt(r)}},ri=function(t){if(t[0]!=31||t[1]!=139||t[2]!=8)throw"invalid gzip data";var e=t[3],n=10;e&4&&(n+=t[10]|(t[11]<<8)+2);for(var r=(e>>3&1)+(e>>4&1);r>0;r-=!t[n++]);return n+(e&2)},ga=function(t){var e=t.length;return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0},ii=function(t){return 10+(t.filename&&t.filename.length+1||0)},oi=function(t,e){var n=e.level,r=n==0?0:n<6?1:n==9?3:2;t[0]=120,t[1]=r<<6|(r?32-2*r:1)},va=function(t){if((t[0]&15)!=8||t[0]>>>4>7||(t[0]<<8|t[1])%31)throw"invalid zlib data";if(t[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function si(t,e){return!e&&typeof t=="function"&&(e=t,t={}),this.ondata=e,t}var De=function(){function t(e,n){!n&&typeof e=="function"&&(n=e,e={}),this.ondata=n,this.o=e||{}}return t.prototype.p=function(e,n){this.ondata(rt(e,this.o,0,0,!n),n)},t.prototype.push=function(e,n){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=n,this.p(e,n||!1)},t}(),ya=function(){function t(e,n){kt([Ct,function(){return[be,De]}],this,si.call(this,e,n),function(r){var i=new De(r.data);onmessage=be(i)},6)}return t}();function _a(t,e,n){if(n||(n=e,e={}),typeof n!="function")throw"no callback";return Lt(t,e,[Ct],function(r){return Ye(nn(r.data[0],r.data[1]))},0,n)}function nn(t,e){return rt(t,e||{},0,0)}var ce=function(){function t(e){this.s={},this.p=new L(0),this.ondata=e}return t.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var n=this.p.length,r=new L(n+e.length);r.set(this.p),r.set(e,n),this.p=r},t.prototype.c=function(e){this.d=this.s.i=e||!1;var n=this.s.b,r=en(this.p,this.o,this.s);this.ondata(we(r,n,this.s.b),this.d),this.o=we(r,this.s.b-32768),this.s.b=this.o.length,this.p=we(this.p,this.s.p/8|0),this.s.p&=7},t.prototype.push=function(e,n){this.e(e),this.c(n)},t}(),ai=function(){function t(e){this.ondata=e,kt([Mt,function(){return[be,ce]}],this,0,function(){var n=new ce;onmessage=be(n)},7)}return t}();function ci(t,e,n){if(n||(n=e,e={}),typeof n!="function")throw"no callback";return Lt(t,e,[Mt],function(r){return Ye(Ot(r.data[0],ti(r.data[1])))},1,n)}function Ot(t,e){return en(t,e)}var kn=function(){function t(e,n){this.c=Tt(),this.l=0,this.v=1,De.call(this,e,n)}return t.prototype.push=function(e,n){De.prototype.push.call(this,e,n)},t.prototype.p=function(e,n){this.c.p(e),this.l+=e.length;var r=rt(e,this.o,this.v&&ii(this.o),n&&8,!n);this.v&&(ni(r,this.o),this.v=0),n&&(R(r,r.length-8,this.c.d()),R(r,r.length-4,this.l)),this.ondata(r,n)},t}(),go=function(){function t(e,n){kt([Ct,pa,function(){return[be,De,kn]}],this,si.call(this,e,n),function(r){var i=new kn(r.data);onmessage=be(i)},8)}return t}();function vo(t,e,n){if(n||(n=e,e={}),typeof n!="function")throw"no callback";return Lt(t,e,[Ct,pa,function(){return[On]}],function(r){return Ye(On(r.data[0],r.data[1]))},2,n)}function On(t,e){e||(e={});var n=Tt(),r=t.length;n.p(t);var i=rt(t,e,ii(e),8),o=i.length;return ni(i,e),R(i,o-8,n.d()),R(i,o-4,r),i}var Dn=function(){function t(e){this.v=1,ce.call(this,e)}return t.prototype.push=function(e,n){if(ce.prototype.e.call(this,e),this.v){var r=this.p.length>3?ri(this.p):4;if(r>=this.p.length&&!n)return;this.p=this.p.subarray(r),this.v=0}if(n){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}ce.prototype.c.call(this,n)},t}(),wa=function(){function t(e){this.ondata=e,kt([Mt,ha,function(){return[be,ce,Dn]}],this,0,function(){var n=new Dn;onmessage=be(n)},9)}return t}();function ba(t,e,n){if(n||(n=e,e={}),typeof n!="function")throw"no callback";return Lt(t,e,[Mt,ha,function(){return[In]}],function(r){return Ye(In(r.data[0]))},3,n)}function In(t,e){return en(t.subarray(ri(t),-8),e||new L(ga(t)))}var Tr=function(){function t(e,n){this.c=ei(),this.v=1,De.call(this,e,n)}return t.prototype.push=function(e,n){De.prototype.push.call(this,e,n)},t.prototype.p=function(e,n){this.c.p(e);var r=rt(e,this.o,this.v&&2,n&&4,!n);this.v&&(oi(r,this.o),this.v=0),n&&R(r,r.length-4,this.c.d()),this.ondata(r,n)},t}(),fu=function(){function t(e,n){kt([Ct,da,function(){return[be,De,Tr]}],this,si.call(this,e,n),function(r){var i=new Tr(r.data);onmessage=be(i)},10)}return t}();function pu(t,e,n){if(n||(n=e,e={}),typeof n!="function")throw"no callback";return Lt(t,e,[Ct,da,function(){return[Mr]}],function(r){return Ye(Mr(r.data[0],r.data[1]))},4,n)}function Mr(t,e){e||(e={});var n=ei();n.p(t);var r=rt(t,e,2,4);return oi(r,e),R(r,r.length-4,n.d()),r}var Rn=function(){function t(e){this.v=1,ce.call(this,e)}return t.prototype.push=function(e,n){if(ce.prototype.e.call(this,e),this.v){if(this.p.length<2&&!n)return;this.p=this.p.subarray(2),this.v=0}if(n){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}ce.prototype.c.call(this,n)},t}(),xa=function(){function t(e){this.ondata=e,kt([Mt,ma,function(){return[be,ce,Rn]}],this,0,function(){var n=new Rn;onmessage=be(n)},11)}return t}();function Ea(t,e,n){if(n||(n=e,e={}),typeof n!="function")throw"no callback";return Lt(t,e,[Mt,ma,function(){return[Kt]}],function(r){return Ye(Kt(r.data[0],ti(r.data[1])))},5,n)}function Kt(t,e){return en((va(t),t.subarray(2,-4)),e)}var Pa=function(){function t(e){this.G=Dn,this.I=ce,this.Z=Rn,this.ondata=e}return t.prototype.push=function(e,n){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,n);else{if(this.p&&this.p.length){var r=new L(this.p.length+e.length);r.set(this.p),r.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var i=this,o=function(){i.ondata.apply(i,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(o):(this.p[0]&15)!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(o):new this.Z(o),this.s.push(this.p,n),this.p=null}}},t}(),hu=function(){function t(e){this.G=wa,this.I=ai,this.Z=xa,this.ondata=e}return t.prototype.push=function(e,n){Pa.prototype.push.call(this,e,n)},t}();function du(t,e,n){if(n||(n=e,e={}),typeof n!="function")throw"no callback";return t[0]==31&&t[1]==139&&t[2]==8?ba(t,e,n):(t[0]&15)!=8||t[0]>>4>7||(t[0]<<8|t[1])%31?ci(t,e,n):Ea(t,e,n)}function mu(t,e){return t[0]==31&&t[1]==139&&t[2]==8?In(t,e):(t[0]&15)!=8||t[0]>>4>7||(t[0]<<8|t[1])%31?Ot(t,e):Kt(t,e)}var li=function(t,e,n,r){for(var i in t){var o=t[i],s=e+i;o instanceof L?n[s]=[o,r]:Array.isArray(o)?n[s]=[o[0],tn(r,o[1])]:li(o,s+"/",n,r)}},yo=typeof TextEncoder<"u"&&new TextEncoder,Cr=typeof TextDecoder<"u"&&new TextDecoder,Sa=0;try{Cr.decode(Be,{stream:!0}),Sa=1}catch{}var Aa=function(t){for(var e="",n=0;;){var r=t[n++],i=(r>127)+(r>223)+(r>239);if(n+i>t.length)return[e,we(t,n-1)];i?i==3?(r=((r&15)<<18|(t[n++]&63)<<12|(t[n++]&63)<<6|t[n++]&63)-65536,e+=String.fromCharCode(55296|r>>10,56320|r&1023)):i&1?e+=String.fromCharCode((r&31)<<6|t[n++]&63):e+=String.fromCharCode((r&15)<<12|(t[n++]&63)<<6|t[n++]&63):e+=String.fromCharCode(r)}},gu=function(){function t(e){this.ondata=e,Sa?this.t=new TextDecoder:this.p=Be}return t.prototype.push=function(e,n){if(!this.ondata)throw"no callback";if(n=!!n,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),n),n){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}return}if(!this.p)throw"stream finished";var r=new L(this.p.length+e.length);r.set(this.p),r.set(e,this.p.length);var i=Aa(r),o=i[0],s=i[1];if(n){if(s.length)throw"invalid utf-8 data";this.p=null}else this.p=s;this.ondata(o,n)},t}(),vu=function(){function t(e){this.ondata=e}return t.prototype.push=function(e,n){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(Xe(e),this.d=n||!1)},t}();function Xe(t,e){if(e){for(var n=new L(t.length),r=0;r<t.length;++r)n[r]=t.charCodeAt(r);return n}if(yo)return yo.encode(t);for(var i=t.length,o=new L(t.length+(t.length>>1)),s=0,l=function(a){o[s++]=a},r=0;r<i;++r){if(s+5>o.length){var c=new L(s+8+(i-r<<1));c.set(o),o=c}var u=t.charCodeAt(r);u<128||e?l(u):u<2048?(l(192|u>>6),l(128|u&63)):u>55295&&u<57344?(u=65536+(u&1023<<10)|t.charCodeAt(++r)&1023,l(240|u>>18),l(128|u>>12&63),l(128|u>>6&63),l(128|u&63)):(l(224|u>>12),l(128|u>>6&63),l(128|u&63))}return we(o,0,s)}function ui(t,e){if(e){for(var n="",r=0;r<t.length;r+=16384)n+=String.fromCharCode.apply(null,t.subarray(r,r+16384));return n}else{if(Cr)return Cr.decode(t);var i=Aa(t),o=i[0],s=i[1];if(s.length)throw"invalid utf-8 data";return o}}var Ta=function(t){return t==1?3:t<6?2:t==9?1:0},Ma=function(t,e){return e+30+ie(t,e+26)+ie(t,e+28)},Ca=function(t,e,n){var r=ie(t,e+28),i=ui(t.subarray(e+46,e+46+r),!(ie(t,e+8)&2048)),o=e+46+r,s=H(t,e+20),l=n&&s==4294967295?La(t,o):[s,H(t,e+24),H(t,e+42)],c=l[0],u=l[1],a=l[2];return[ie(t,e+10),c,u,i,o+ie(t,e+30)+ie(t,e+32),a]},La=function(t,e){for(;ie(t,e)!=1;e+=4+ie(t,e+2));return[sr(t,e+12),sr(t,e+4),sr(t,e+20)]},Ge=function(t){var e=0;if(t)for(var n in t){var r=t[n].length;if(r>65535)throw"extra field too long";e+=r+4}return e},xt=function(t,e,n,r,i,o,s,l){var c=r.length,u=n.extra,a=l&&l.length,f=Ge(u);R(t,e,s!=null?33639248:67324752),e+=4,s!=null&&(t[e++]=20,t[e++]=n.os),t[e]=20,e+=2,t[e++]=n.flag<<1|(o==null&&8),t[e++]=i&&8,t[e++]=n.compression&255,t[e++]=n.compression>>8;var p=new Date(n.mtime==null?Date.now():n.mtime),h=p.getFullYear()-1980;if(h<0||h>119)throw"date not in range 1980-2099";if(R(t,e,h<<25|p.getMonth()+1<<21|p.getDate()<<16|p.getHours()<<11|p.getMinutes()<<5|p.getSeconds()>>>1),e+=4,o!=null&&(R(t,e,n.crc),R(t,e+4,o),R(t,e+8,n.size)),R(t,e+12,c),R(t,e+14,f),e+=16,s!=null&&(R(t,e,a),R(t,e+6,n.attrs),R(t,e+10,s),e+=14),t.set(r,e),e+=c,f)for(var d in u){var m=u[d],y=m.length;R(t,e,+d),R(t,e+2,y),t.set(m,e+4),e+=4+y}return a&&(t.set(l,e),e+=a),e},fi=function(t,e,n,r,i){R(t,e,101010256),R(t,e+8,n),R(t,e+10,n),R(t,e+12,r),R(t,e+16,i)},Yt=function(){function t(e){this.filename=e,this.c=Tt(),this.size=0,this.compression=0}return t.prototype.process=function(e,n){this.ondata(null,e,n)},t.prototype.push=function(e,n){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,n&&(this.crc=this.c.d()),this.process(e,n||!1)},t}(),yu=function(){function t(e,n){var r=this;n||(n={}),Yt.call(this,e),this.d=new De(n,function(i,o){r.ondata(null,i,o)}),this.compression=8,this.flag=Ta(n.level)}return t.prototype.process=function(e,n){try{this.d.push(e,n)}catch(r){this.ondata(r,null,n)}},t.prototype.push=function(e,n){Yt.prototype.push.call(this,e,n)},t}(),_u=function(){function t(e,n){var r=this;n||(n={}),Yt.call(this,e),this.d=new ya(n,function(i,o,s){r.ondata(i,o,s)}),this.compression=8,this.flag=Ta(n.level),this.terminate=this.d.terminate}return t.prototype.process=function(e,n){this.d.push(e,n)},t.prototype.push=function(e,n){Yt.prototype.push.call(this,e,n)},t}(),wu=function(){function t(e){this.ondata=e,this.u=[],this.d=1}return t.prototype.add=function(e){var n=this;if(this.d&2)throw"stream finished";var r=Xe(e.filename),i=r.length,o=e.comment,s=o&&Xe(o),l=i!=e.filename.length||s&&o.length!=s.length,c=i+Ge(e.extra)+30;if(i>65535)throw"filename too long";var u=new L(c);xt(u,0,e,r,l);var a=[u],f=function(){for(var y=0,_=a;y<_.length;y++){var w=_[y];n.ondata(null,w,!1)}a=[]},p=this.d;this.d=0;var h=this.u.length,d=tn(e,{f:r,u:l,o:s,t:function(){e.terminate&&e.terminate()},r:function(){if(f(),p){var y=n.u[h+1];y?y.r():n.d=1}p=1}}),m=0;e.ondata=function(y,_,w){if(y)n.ondata(y,_,w),n.terminate();else if(m+=_.length,a.push(_),w){var v=new L(16);R(v,0,134695760),R(v,4,e.crc),R(v,8,m),R(v,12,e.size),a.push(v),d.c=m,d.b=c+m+16,d.crc=e.crc,d.size=e.size,p&&d.r(),p=1}else p&&f()},this.u.push(d)},t.prototype.end=function(){var e=this;if(this.d&2)throw this.d&1?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){!(e.d&1)||(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},t.prototype.e=function(){for(var e=0,n=0,r=0,i=0,o=this.u;i<o.length;i++){var s=o[i];r+=46+s.f.length+Ge(s.extra)+(s.o?s.o.length:0)}for(var l=new L(r+22),c=0,u=this.u;c<u.length;c++){var s=u[c];xt(l,e,s,s.f,s.u,s.c,n,s.o),e+=46+s.f.length+Ge(s.extra)+(s.o?s.o.length:0),n+=s.b}fi(l,e,this.u.length,r,n),this.ondata(null,l,!0),this.d=2},t.prototype.terminate=function(){for(var e=0,n=this.u;e<n.length;e++){var r=n[e];r.t()}this.d=2},t}();function bu(t,e,n){if(n||(n=e,e={}),typeof n!="function")throw"no callback";var r={};li(t,"",r,e);var i=Object.keys(r),o=i.length,s=0,l=0,c=o,u=new Array(o),a=[],f=function(){for(var m=0;m<a.length;++m)a[m]()},p=function(){var m=new L(l+22),y=s,_=l-s;l=0;for(var w=0;w<c;++w){var v=u[w];try{var E=v.c.length;xt(m,l,v,v.f,v.u,E);var b=30+v.f.length+Ge(v.extra),P=l+b;m.set(v.c,P),xt(m,s,v,v.f,v.u,E,l,v.m),s+=16+b+(v.m?v.m.length:0),l=P+E}catch(A){return n(A,null)}}fi(m,s,u.length,_,y),n(null,m)};o||p();for(var h=function(m){var y=i[m],_=r[y],w=_[0],v=_[1],E=Tt(),b=w.length;E.p(w);var P=Xe(y),A=P.length,x=v.comment,k=x&&Xe(x),M=k&&k.length,G=Ge(v.extra),I=v.level==0?0:8,O=function(D,j){if(D)f(),n(D,null);else{var F=j.length;u[m]=tn(v,{size:b,crc:E.d(),c:j,f:P,m:k,u:A!=y.length||k&&x.length!=M,compression:I}),s+=30+A+G+F,l+=76+2*(A+G)+(M||0)+F,--o||p()}};if(A>65535&&O("filename too long",null),!I)O(null,w);else if(b<16e4)try{O(null,nn(w,v))}catch(D){O(D,null)}else a.push(_a(w,v,O))},d=0;d<c;++d)h(d);return f}function xu(t,e){e||(e={});var n={},r=[];li(t,"",n,e);var i=0,o=0;for(var s in n){var l=n[s],c=l[0],u=l[1],a=u.level==0?0:8,f=Xe(s),p=f.length,h=u.comment,d=h&&Xe(h),m=d&&d.length,y=Ge(u.extra);if(p>65535)throw"filename too long";var _=a?nn(c,u):c,w=_.length,v=Tt();v.p(c),r.push(tn(u,{size:c.length,crc:v.d(),c:_,f,m:d,u:p!=s.length||d&&h.length!=m,o:i,compression:a})),i+=30+p+y+w,o+=76+2*(p+y)+(m||0)+w}for(var E=new L(o+22),b=i,P=o-i,A=0;A<r.length;++A){var f=r[A];xt(E,f.o,f,f.f,f.u,f.c.length);var x=30+f.f.length+Ge(f.extra);E.set(f.c,f.o+x),xt(E,i,f,f.f,f.u,f.c.length,f.o,f.m),i+=16+x+(f.m?f.m.length:0)}return fi(E,i,r.length,P,b),E}var ka=function(){function t(){}return t.prototype.push=function(e,n){this.ondata(null,e,n)},t.compression=0,t}(),Eu=function(){function t(){var e=this;this.i=new ce(function(n,r){e.ondata(null,n,r)})}return t.prototype.push=function(e,n){try{this.i.push(e,n)}catch(r){this.ondata(r,e,n)}},t.compression=8,t}(),Pu=function(){function t(e,n){var r=this;n<32e4?this.i=new ce(function(i,o){r.ondata(null,i,o)}):(this.i=new ai(function(i,o,s){r.ondata(i,o,s)}),this.terminate=this.i.terminate)}return t.prototype.push=function(e,n){this.i.terminate&&(e=we(e,0)),this.i.push(e,n)},t.compression=8,t}(),Su=function(){function t(e){this.onfile=e,this.k=[],this.o={0:ka},this.p=Be}return t.prototype.push=function(e,n){var r=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var i=Math.min(this.c,e.length),o=e.subarray(0,i);if(this.c-=i,this.d?this.d.push(o,!this.c):this.k[0].push(o),e=e.subarray(i),e.length)return this.push(e,n)}else{var s=0,l=0,c=void 0,u=void 0;this.p.length?e.length?(u=new L(this.p.length+e.length),u.set(this.p),u.set(e,this.p.length)):u=this.p:u=e;for(var a=u.length,f=this.c,p=f&&this.d,h=function(){var _,w=H(u,l);if(w==67324752){s=1,c=l,d.d=null,d.c=0;var v=ie(u,l+6),E=ie(u,l+8),b=v&2048,P=v&8,A=ie(u,l+26),x=ie(u,l+28);if(a>l+30+A+x){var k=[];d.k.unshift(k),s=2;var M=H(u,l+18),G=H(u,l+22),I=ui(u.subarray(l+30,l+=30+A),!b);M==4294967295?(_=P?[-2]:La(u,l),M=_[0],G=_[1]):P&&(M=-1),l+=x,d.c=M;var O,D={name:I,compression:E,start:function(){if(!D.ondata)throw"no callback";if(!M)D.ondata(null,Be,!0);else{var j=r.o[E];if(!j)throw"unknown compression type "+E;O=M<0?new j(I):new j(I,M,G),O.ondata=function(ee,oe,q){D.ondata(ee,oe,q)};for(var F=0,z=k;F<z.length;F++){var K=z[F];O.push(K,!1)}r.k[0]==k&&r.c?r.d=O:O.push(Be,!0)}},terminate:function(){O&&O.terminate&&O.terminate()}};M>=0&&(D.size=M,D.originalSize=G),d.onfile(D)}return"break"}else if(f){if(w==134695760)return c=l+=12+(f==-2&&8),s=3,d.c=0,"break";if(w==33639248)return c=l-=4,s=3,d.c=0,"break"}},d=this;l<a-4;++l){var m=h();if(m==="break")break}if(this.p=Be,f<0){var y=s?u.subarray(0,c-12-(f==-2&&8)-(H(u,c-16)==134695760&&4)):u.subarray(0,l);p?p.push(y,!!s):this.k[+(s==2)].push(y)}if(s&2)return this.push(u.subarray(l),n);this.p=u.subarray(l)}if(n){if(this.c)throw"invalid zip file";this.p=null}},t.prototype.register=function(e){this.o[e.compression]=e},t}();function Au(t,e){if(typeof e!="function")throw"no callback";for(var n=[],r=function(){for(var p=0;p<n.length;++p)n[p]()},i={},o=t.length-22;H(t,o)!=101010256;--o)if(!o||t.length-o>65558){e("invalid zip file",null);return}var s=ie(t,o+8);s||e(null,{});var l=s,c=H(t,o+16),u=c==4294967295;if(u){if(o=H(t,o-12),H(t,o)!=101075792){e("invalid zip file",null);return}l=s=H(t,o+32),c=H(t,o+48)}for(var a=function(p){var h=Ca(t,c,u),d=h[0],m=h[1],y=h[2],_=h[3],w=h[4],v=h[5],E=Ma(t,v);c=w;var b=function(A,x){A?(r(),e(A,null)):(i[_]=x,--s||e(null,i))};if(!d)b(null,we(t,E,E+m));else if(d==8){var P=t.subarray(E,E+m);if(m<32e4)try{b(null,Ot(P,new L(y)))}catch(A){b(A,null)}else n.push(ci(P,{size:y},b))}else b("unknown compression type "+d,null)},f=0;f<l;++f)a();return r}function Tu(t){for(var e={},n=t.length-22;H(t,n)!=101010256;--n)if(!n||t.length-n>65558)throw"invalid zip file";var r=ie(t,n+8);if(!r)return{};var i=H(t,n+16),o=i==4294967295;if(o){if(n=H(t,n-12),H(t,n)!=101075792)throw"invalid zip file";r=H(t,n+32),i=H(t,n+48)}for(var s=0;s<r;++s){var l=Ca(t,i,o),c=l[0],u=l[1],a=l[2],f=l[3],p=l[4],h=l[5],d=Ma(t,h);if(i=p,!c)e[f]=we(t,d,d+u);else if(c==8)e[f]=Ot(t.subarray(d,d+u),new L(a));else throw"unknown compression type "+c}return e}const Mu=Object.freeze(Object.defineProperty({__proto__:null,Deflate:De,AsyncDeflate:ya,deflate:_a,deflateSync:nn,Inflate:ce,AsyncInflate:ai,inflate:ci,inflateSync:Ot,Gzip:kn,AsyncGzip:go,gzip:vo,gzipSync:On,Gunzip:Dn,AsyncGunzip:wa,gunzip:ba,gunzipSync:In,Zlib:Tr,AsyncZlib:fu,zlib:pu,zlibSync:Mr,Unzlib:Rn,AsyncUnzlib:xa,unzlib:Ea,unzlibSync:Kt,compress:vo,AsyncCompress:go,compressSync:On,Compress:kn,Decompress:Pa,AsyncDecompress:hu,decompress:du,decompressSync:mu,DecodeUTF8:gu,EncodeUTF8:vu,strToU8:Xe,strFromU8:ui,ZipPassThrough:Yt,ZipDeflate:yu,AsyncZipDeflate:_u,Zip:wu,zip:bu,zipSync:xu,UnzipPassThrough:ka,UnzipInflate:Eu,AsyncUnzipInflate:Pu,Unzip:Su,unzip:Au,unzipSync:Tu},Symbol.toStringTag,{value:"Module"}));function Oa(t,e,n){const r=n.length-t-1;if(e>=n[r])return r-1;if(e<=n[t])return t;let i=t,o=r,s=Math.floor((i+o)/2);for(;e<n[s]||e>=n[s+1];)e<n[s]?o=s:i=s,s=Math.floor((i+o)/2);return s}function Cu(t,e,n,r){const i=[],o=[],s=[];i[0]=1;for(let l=1;l<=n;++l){o[l]=e-r[t+1-l],s[l]=r[t+l]-e;let c=0;for(let u=0;u<l;++u){const a=s[u+1],f=o[l-u],p=i[u]/(a+f);i[u]=c+a*p,c=f*p}i[l]=c}return i}function Lu(t,e,n,r){const i=Oa(t,r,e),o=Cu(i,r,t,e),s=new Fn(0,0,0,0);for(let l=0;l<=t;++l){const c=n[i-t+l],u=o[l],a=c.w*u;s.x+=c.x*a,s.y+=c.y*a,s.z+=c.z*a,s.w+=c.w*u}return s}function ku(t,e,n,r,i){const o=[];for(let f=0;f<=n;++f)o[f]=0;const s=[];for(let f=0;f<=r;++f)s[f]=o.slice(0);const l=[];for(let f=0;f<=n;++f)l[f]=o.slice(0);l[0][0]=1;const c=o.slice(0),u=o.slice(0);for(let f=1;f<=n;++f){c[f]=e-i[t+1-f],u[f]=i[t+f]-e;let p=0;for(let h=0;h<f;++h){const d=u[h+1],m=c[f-h];l[f][h]=d+m;const y=l[h][f-1]/l[f][h];l[h][f]=p+d*y,p=m*y}l[f][f]=p}for(let f=0;f<=n;++f)s[0][f]=l[f][n];for(let f=0;f<=n;++f){let p=0,h=1;const d=[];for(let m=0;m<=n;++m)d[m]=o.slice(0);d[0][0]=1;for(let m=1;m<=r;++m){let y=0;const _=f-m,w=n-m;f>=m&&(d[h][0]=d[p][0]/l[w+1][_],y=d[h][0]*l[_][w]);const v=_>=-1?1:-_,E=f-1<=w?m-1:n-f;for(let P=v;P<=E;++P)d[h][P]=(d[p][P]-d[p][P-1])/l[w+1][_+P],y+=d[h][P]*l[_+P][w];f<=w&&(d[h][m]=-d[p][m-1]/l[w+1][f],y+=d[h][m]*l[f][w]),s[m][f]=y;const b=p;p=h,h=b}}let a=n;for(let f=1;f<=r;++f){for(let p=0;p<=n;++p)s[f][p]*=a;a*=n-f}return s}function Ou(t,e,n,r,i){const o=i<t?i:t,s=[],l=Oa(t,r,e),c=ku(l,r,t,o,e),u=[];for(let a=0;a<n.length;++a){const f=n[a].clone(),p=f.w;f.x*=p,f.y*=p,f.z*=p,u[a]=f}for(let a=0;a<=o;++a){const f=u[l-t].clone().multiplyScalar(c[a][0]);for(let p=1;p<=t;++p)f.add(u[l-t+p].clone().multiplyScalar(c[a][p]));s[a]=f}for(let a=o+1;a<=i+1;++a)s[a]=new Fn(0,0,0);return s}function Du(t,e){let n=1;for(let i=2;i<=t;++i)n*=i;let r=1;for(let i=2;i<=e;++i)r*=i;for(let i=2;i<=t-e;++i)r*=i;return n/r}function Iu(t){const e=t.length,n=[],r=[];for(let o=0;o<e;++o){const s=t[o];n[o]=new ne(s.x,s.y,s.z),r[o]=s.w}const i=[];for(let o=0;o<e;++o){const s=n[o].clone();for(let l=1;l<=o;++l)s.sub(i[o-l].clone().multiplyScalar(Du(o,l)*r[l]));i[o]=s.divideScalar(r[0])}return i}function Ru(t,e,n,r,i){const o=Ou(t,e,n,r,i);return Iu(o)}class _o extends mc{constructor(e,n,r,i,o){super(),this.degree=e,this.knots=n,this.controlPoints=[],this.startKnot=i||0,this.endKnot=o||this.knots.length-1;for(let s=0;s<r.length;++s){const l=r[s];this.controlPoints[s]=new Fn(l.x,l.y,l.z,l.w)}}getPoint(e,n=new ne){const r=n,i=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),o=Lu(this.degree,this.knots,this.controlPoints,i);return o.w!==1&&o.divideScalar(o.w),r.set(o.x,o.y,o.z)}getTangent(e,n=new ne){const r=n,i=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),o=Ru(this.degree,this.knots,this.controlPoints,i,1);return r.copy(o[1]).normalize(),r}}let C,V,se;class Fu extends gc{constructor(e){super(e)}load(e,n,r,i){const o=this,s=o.path===""?Fr.extractUrlBase(e):o.path,l=new vc(this.manager);l.setPath(o.path),l.setResponseType("arraybuffer"),l.setRequestHeader(o.requestHeader),l.setWithCredentials(o.withCredentials),l.load(e,function(c){try{n(o.parse(c,s))}catch(u){i?i(u):console.error(u),o.manager.itemError(e)}},r,i)}parse(e,n){if(Uu(e))C=new Nu().parse(e);else{const i=Fa(e);if(!Vu(i))throw new Error("THREE.FBXLoader: Unknown format.");if(bo(i)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+bo(i));C=new zu().parse(i)}const r=new Et(this.manager).setPath(this.resourcePath||n).setCrossOrigin(this.crossOrigin);return new Bu(r,this.manager).parse(C)}}class Bu{constructor(e,n){this.textureLoader=e,this.manager=n}parse(){V=this.parseConnections();const e=this.parseImages(),n=this.parseTextures(e),r=this.parseMaterials(n),i=this.parseDeformers(),o=new $u().parse(i);return this.parseScene(i,o,r),se}parseConnections(){const e=new Map;return"Connections"in C&&C.Connections.connections.forEach(function(r){const i=r[0],o=r[1],s=r[2];e.has(i)||e.set(i,{parents:[],children:[]});const l={ID:o,relationship:s};e.get(i).parents.push(l),e.has(o)||e.set(o,{parents:[],children:[]});const c={ID:i,relationship:s};e.get(o).children.push(c)}),e}parseImages(){const e={},n={};if("Video"in C.Objects){const r=C.Objects.Video;for(const i in r){const o=r[i],s=parseInt(i);if(e[s]=o.RelativeFilename||o.Filename,"Content"in o){const l=o.Content instanceof ArrayBuffer&&o.Content.byteLength>0,c=typeof o.Content=="string"&&o.Content!=="";if(l||c){const u=this.parseImage(r[i]);n[o.RelativeFilename||o.Filename]=u}}}}for(const r in e){const i=e[r];n[i]!==void 0?e[r]=n[i]:e[r]=e[r].split("\\").pop()}return e}parseImage(e){const n=e.Content,r=e.RelativeFilename||e.Filename,i=r.slice(r.lastIndexOf(".")+1).toLowerCase();let o;switch(i){case"bmp":o="image/bmp";break;case"jpg":case"jpeg":o="image/jpeg";break;case"png":o="image/png";break;case"tif":o="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",r),o="image/tga";break;default:console.warn('FBXLoader: Image type "'+i+'" is not supported.');return}if(typeof n=="string")return"data:"+o+";base64,"+n;{const s=new Uint8Array(n);return window.URL.createObjectURL(new Blob([s],{type:o}))}}parseTextures(e){const n=new Map;if("Texture"in C.Objects){const r=C.Objects.Texture;for(const i in r){const o=this.parseTexture(r[i],e);n.set(parseInt(i),o)}}return n}parseTexture(e,n){const r=this.loadTexture(e,n);r.ID=e.id,r.name=e.attrName;const i=e.WrapModeU,o=e.WrapModeV,s=i!==void 0?i.value:0,l=o!==void 0?o.value:0;if(r.wrapS=s===0?Ai:Ti,r.wrapT=l===0?Ai:Ti,"Scaling"in e){const c=e.Scaling.value;r.repeat.x=c[0],r.repeat.y=c[1]}if("Translation"in e){const c=e.Translation.value;r.offset.x=c[0],r.offset.y=c[1]}return r}loadTexture(e,n){let r;const i=this.textureLoader.path,o=V.get(e.id).children;o!==void 0&&o.length>0&&n[o[0].ID]!==void 0&&(r=n[o[0].ID],(r.indexOf("blob:")===0||r.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let s;const l=e.FileName.slice(-3).toLowerCase();if(l==="tga"){const c=this.manager.getHandler(".tga");c===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),s=new Mi):(c.setPath(this.textureLoader.path),s=c.load(r))}else l==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),s=new Mi):s=this.textureLoader.load(r);return this.textureLoader.setPath(i),s}parseMaterials(e){const n=new Map;if("Material"in C.Objects){const r=C.Objects.Material;for(const i in r){const o=this.parseMaterial(r[i],e);o!==null&&n.set(parseInt(i),o)}}return n}parseMaterial(e,n){const r=e.id,i=e.attrName;let o=e.ShadingModel;if(typeof o=="object"&&(o=o.value),!V.has(r))return null;const s=this.parseParameters(e,n,r);let l;switch(o.toLowerCase()){case"phong":l=new Zn;break;case"lambert":l=new yc;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',o),l=new Zn;break}return l.setValues(s),l.name=i,l}parseParameters(e,n,r){const i={};e.BumpFactor&&(i.bumpScale=e.BumpFactor.value),e.Diffuse?i.color=new re().fromArray(e.Diffuse.value):e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(i.color=new re().fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(i.displacementScale=e.DisplacementFactor.value),e.Emissive?i.emissive=new re().fromArray(e.Emissive.value):e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(i.emissive=new re().fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(i.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(i.opacity=parseFloat(e.Opacity.value)),i.opacity<1&&(i.transparent=!0),e.ReflectionFactor&&(i.reflectivity=e.ReflectionFactor.value),e.Shininess&&(i.shininess=e.Shininess.value),e.Specular?i.specular=new re().fromArray(e.Specular.value):e.SpecularColor&&e.SpecularColor.type==="Color"&&(i.specular=new re().fromArray(e.SpecularColor.value));const o=this;return V.get(r).children.forEach(function(s){const l=s.relationship;switch(l){case"Bump":i.bumpMap=o.getTexture(n,s.ID);break;case"Maya|TEX_ao_map":i.aoMap=o.getTexture(n,s.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":i.map=o.getTexture(n,s.ID),i.map!==void 0&&(i.map.encoding=ye);break;case"DisplacementColor":i.displacementMap=o.getTexture(n,s.ID);break;case"EmissiveColor":i.emissiveMap=o.getTexture(n,s.ID),i.emissiveMap!==void 0&&(i.emissiveMap.encoding=ye);break;case"NormalMap":case"Maya|TEX_normal_map":i.normalMap=o.getTexture(n,s.ID);break;case"ReflectionColor":i.envMap=o.getTexture(n,s.ID),i.envMap!==void 0&&(i.envMap.mapping=_c,i.envMap.encoding=ye);break;case"SpecularColor":i.specularMap=o.getTexture(n,s.ID),i.specularMap!==void 0&&(i.specularMap.encoding=ye);break;case"TransparentColor":case"TransparencyFactor":i.alphaMap=o.getTexture(n,s.ID),i.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",l);break}}),i}getTexture(e,n){return"LayeredTexture"in C.Objects&&n in C.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),n=V.get(n).children[0].ID),e.get(n)}parseDeformers(){const e={},n={};if("Deformer"in C.Objects){const r=C.Objects.Deformer;for(const i in r){const o=r[i],s=V.get(parseInt(i));if(o.attrType==="Skin"){const l=this.parseSkeleton(s,r);l.ID=i,s.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),l.geometryID=s.parents[0].ID,e[i]=l}else if(o.attrType==="BlendShape"){const l={id:i};l.rawTargets=this.parseMorphTargets(s,r),l.id=i,s.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),n[i]=l}}}return{skeletons:e,morphTargets:n}}parseSkeleton(e,n){const r=[];return e.children.forEach(function(i){const o=n[i.ID];if(o.attrType!=="Cluster")return;const s={ID:i.ID,indices:[],weights:[],transformLink:new U().fromArray(o.TransformLink.a)};"Indexes"in o&&(s.indices=o.Indexes.a,s.weights=o.Weights.a),r.push(s)}),{rawBones:r,bones:[]}}parseMorphTargets(e,n){const r=[];for(let i=0;i<e.children.length;i++){const o=e.children[i],s=n[o.ID],l={name:s.attrName,initialWeight:s.DeformPercent,id:s.id,fullWeights:s.FullWeights.a};if(s.attrType!=="BlendShapeChannel")return;l.geoID=V.get(parseInt(o.ID)).children.filter(function(c){return c.relationship===void 0})[0].ID,r.push(l)}return r}parseScene(e,n,r){se=new Ci;const i=this.parseModels(e.skeletons,n,r),o=C.Objects.Model,s=this;i.forEach(function(c){const u=o[c.ID];s.setLookAtProperties(c,u),V.get(c.ID).parents.forEach(function(f){const p=i.get(f.ID);p!==void 0&&p.add(c)}),c.parent===null&&se.add(c)}),this.bindSkeleton(e.skeletons,n,i),this.createAmbientLight(),se.traverse(function(c){if(c.userData.transformData){c.parent&&(c.userData.transformData.parentMatrix=c.parent.matrix,c.userData.transformData.parentMatrixWorld=c.parent.matrixWorld);const u=Ia(c.userData.transformData);c.applyMatrix4(u),c.updateWorldMatrix()}});const l=new ju().parse();se.children.length===1&&se.children[0].isGroup&&(se.children[0].animations=l,se=se.children[0]),se.animations=l}parseModels(e,n,r){const i=new Map,o=C.Objects.Model;for(const s in o){const l=parseInt(s),c=o[s],u=V.get(l);let a=this.buildSkeleton(u,e,l,c.attrName);if(!a){switch(c.attrType){case"Camera":a=this.createCamera(u);break;case"Light":a=this.createLight(u);break;case"Mesh":a=this.createMesh(u,n,r);break;case"NurbsCurve":a=this.createCurve(u,n);break;case"LimbNode":case"Root":a=new Li;break;case"Null":default:a=new Ci;break}a.name=c.attrName?bn.sanitizeNodeName(c.attrName):"",a.ID=l}this.getTransformData(a,c),i.set(l,a)}return i}buildSkeleton(e,n,r,i){let o=null;return e.parents.forEach(function(s){for(const l in n){const c=n[l];c.rawBones.forEach(function(u,a){if(u.ID===s.ID){const f=o;o=new Li,o.matrixWorld.copy(u.transformLink),o.name=i?bn.sanitizeNodeName(i):"",o.ID=r,c.bones[a]=o,f!==null&&o.add(f)}})}}),o}createCamera(e){let n,r;if(e.children.forEach(function(i){const o=C.Objects.NodeAttribute[i.ID];o!==void 0&&(r=o)}),r===void 0)n=new qn;else{let i=0;r.CameraProjectionType!==void 0&&r.CameraProjectionType.value===1&&(i=1);let o=1;r.NearPlane!==void 0&&(o=r.NearPlane.value/1e3);let s=1e3;r.FarPlane!==void 0&&(s=r.FarPlane.value/1e3);let l=window.innerWidth,c=window.innerHeight;r.AspectWidth!==void 0&&r.AspectHeight!==void 0&&(l=r.AspectWidth.value,c=r.AspectHeight.value);const u=l/c;let a=45;r.FieldOfView!==void 0&&(a=r.FieldOfView.value);const f=r.FocalLength?r.FocalLength.value:null;switch(i){case 0:n=new Ho(a,u,o,s),f!==null&&n.setFocalLength(f);break;case 1:n=new Br(-l/2,l/2,c/2,-c/2,o,s);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+i+"."),n=new qn;break}}return n}createLight(e){let n,r;if(e.children.forEach(function(i){const o=C.Objects.NodeAttribute[i.ID];o!==void 0&&(r=o)}),r===void 0)n=new qn;else{let i;r.LightType===void 0?i=0:i=r.LightType.value;let o=16777215;r.Color!==void 0&&(o=new re().fromArray(r.Color.value));let s=r.Intensity===void 0?1:r.Intensity.value/100;r.CastLightOnObject!==void 0&&r.CastLightOnObject.value===0&&(s=0);let l=0;r.FarAttenuationEnd!==void 0&&(r.EnableFarAttenuation!==void 0&&r.EnableFarAttenuation.value===0?l=0:l=r.FarAttenuationEnd.value);const c=1;switch(i){case 0:n=new dr(o,s,l,c);break;case 1:n=new Wo(o,s);break;case 2:let u=Math.PI/3;r.InnerAngle!==void 0&&(u=Ce.degToRad(r.InnerAngle.value));let a=0;r.OuterAngle!==void 0&&(a=Ce.degToRad(r.OuterAngle.value),a=Math.max(a,1)),n=new wc(o,s,l,u,a,c);break;default:console.warn("THREE.FBXLoader: Unknown light type "+r.LightType.value+", defaulting to a PointLight."),n=new dr(o,s);break}r.CastShadows!==void 0&&r.CastShadows.value===1&&(n.castShadow=!0)}return n}createMesh(e,n,r){let i,o=null,s=null;const l=[];return e.children.forEach(function(c){n.has(c.ID)&&(o=n.get(c.ID)),r.has(c.ID)&&l.push(r.get(c.ID))}),l.length>1?s=l:l.length>0?s=l[0]:(s=new Zn({color:13421772}),l.push(s)),"color"in o.attributes&&l.forEach(function(c){c.vertexColors=!0}),o.FBX_Deformer?(i=new bc(o,s),i.normalizeSkinWeights()):i=new Go(o,s),i}createCurve(e,n){const r=e.children.reduce(function(o,s){return n.has(s.ID)&&(o=n.get(s.ID)),o},null),i=new xc({color:3342591,linewidth:1});return new Ec(r,i)}getTransformData(e,n){const r={};"InheritType"in n&&(r.inheritType=parseInt(n.InheritType.value)),"RotationOrder"in n?r.eulerOrder=Ra(n.RotationOrder.value):r.eulerOrder="ZYX","Lcl_Translation"in n&&(r.translation=n.Lcl_Translation.value),"PreRotation"in n&&(r.preRotation=n.PreRotation.value),"Lcl_Rotation"in n&&(r.rotation=n.Lcl_Rotation.value),"PostRotation"in n&&(r.postRotation=n.PostRotation.value),"Lcl_Scaling"in n&&(r.scale=n.Lcl_Scaling.value),"ScalingOffset"in n&&(r.scalingOffset=n.ScalingOffset.value),"ScalingPivot"in n&&(r.scalingPivot=n.ScalingPivot.value),"RotationOffset"in n&&(r.rotationOffset=n.RotationOffset.value),"RotationPivot"in n&&(r.rotationPivot=n.RotationPivot.value),e.userData.transformData=r}setLookAtProperties(e,n){"LookAtProperty"in n&&V.get(e.ID).children.forEach(function(i){if(i.relationship==="LookAtProperty"){const o=C.Objects.Model[i.ID];if("Lcl_Translation"in o){const s=o.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(s),se.add(e.target)):e.lookAt(new ne().fromArray(s))}}})}bindSkeleton(e,n,r){const i=this.parsePoseNodes();for(const o in e){const s=e[o];V.get(parseInt(s.ID)).parents.forEach(function(c){if(n.has(c.ID)){const u=c.ID;V.get(u).parents.forEach(function(f){r.has(f.ID)&&r.get(f.ID).bind(new Pc(s.bones),i[f.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in C.Objects){const n=C.Objects.Pose;for(const r in n)if(n[r].attrType==="BindPose"&&n[r].NbPoseNodes>0){const i=n[r].PoseNode;Array.isArray(i)?i.forEach(function(o){e[o.Node]=new U().fromArray(o.Matrix.a)}):e[i.Node]=new U().fromArray(i.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in C&&"AmbientColor"in C.GlobalSettings){const e=C.GlobalSettings.AmbientColor.value,n=e[0],r=e[1],i=e[2];if(n!==0||r!==0||i!==0){const o=new re(n,r,i);se.add(new Xo(o,1))}}}}class $u{constructor(){this.negativeMaterialIndices=!1}parse(e){const n=new Map;if("Geometry"in C.Objects){const r=C.Objects.Geometry;for(const i in r){const o=V.get(parseInt(i)),s=this.parseGeometry(o,r[i],e);n.set(parseInt(i),s)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),n}parseGeometry(e,n,r){switch(n.attrType){case"Mesh":return this.parseMeshGeometry(e,n,r);case"NurbsCurve":return this.parseNurbsGeometry(n)}}parseMeshGeometry(e,n,r){const i=r.skeletons,o=[],s=e.parents.map(function(f){return C.Objects.Model[f.ID]});if(s.length===0)return;const l=e.children.reduce(function(f,p){return i[p.ID]!==void 0&&(f=i[p.ID]),f},null);e.children.forEach(function(f){r.morphTargets[f.ID]!==void 0&&o.push(r.morphTargets[f.ID])});const c=s[0],u={};"RotationOrder"in c&&(u.eulerOrder=Ra(c.RotationOrder.value)),"InheritType"in c&&(u.inheritType=parseInt(c.InheritType.value)),"GeometricTranslation"in c&&(u.translation=c.GeometricTranslation.value),"GeometricRotation"in c&&(u.rotation=c.GeometricRotation.value),"GeometricScaling"in c&&(u.scale=c.GeometricScaling.value);const a=Ia(u);return this.genGeometry(n,l,o,a)}genGeometry(e,n,r,i){const o=new dt;e.attrName&&(o.name=e.attrName);const s=this.parseGeoNode(e,n),l=this.genBuffers(s),c=new Me(l.vertex,3);if(c.applyMatrix4(i),o.setAttribute("position",c),l.colors.length>0&&o.setAttribute("color",new Me(l.colors,3)),n&&(o.setAttribute("skinIndex",new Sc(l.weightsIndices,4)),o.setAttribute("skinWeight",new Me(l.vertexWeights,4)),o.FBX_Deformer=n),l.normal.length>0){const u=new Ac().getNormalMatrix(i),a=new Me(l.normal,3);a.applyNormalMatrix(u),o.setAttribute("normal",a)}if(l.uvs.forEach(function(u,a){let f="uv"+(a+1).toString();a===0&&(f="uv"),o.setAttribute(f,new Me(l.uvs[a],2))}),s.material&&s.material.mappingType!=="AllSame"){let u=l.materialIndex[0],a=0;if(l.materialIndex.forEach(function(f,p){f!==u&&(o.addGroup(a,p-a,u),u=f,a=p)}),o.groups.length>0){const f=o.groups[o.groups.length-1],p=f.start+f.count;p!==l.materialIndex.length&&o.addGroup(p,l.materialIndex.length-p,u)}o.groups.length===0&&o.addGroup(0,l.materialIndex.length,l.materialIndex[0])}return this.addMorphTargets(o,e,r,i),o}parseGeoNode(e,n){const r={};if(r.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],r.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(r.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(r.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(r.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){r.uv=[];let i=0;for(;e.LayerElementUV[i];)e.LayerElementUV[i].UV&&r.uv.push(this.parseUVs(e.LayerElementUV[i])),i++}return r.weightTable={},n!==null&&(r.skeleton=n,n.rawBones.forEach(function(i,o){i.indices.forEach(function(s,l){r.weightTable[s]===void 0&&(r.weightTable[s]=[]),r.weightTable[s].push({id:o,weight:i.weights[l]})})})),r}genBuffers(e){const n={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let r=0,i=0,o=!1,s=[],l=[],c=[],u=[],a=[],f=[];const p=this;return e.vertexIndices.forEach(function(h,d){let m,y=!1;h<0&&(h=h^-1,y=!0);let _=[],w=[];if(s.push(h*3,h*3+1,h*3+2),e.color){const v=un(d,r,h,e.color);c.push(v[0],v[1],v[2])}if(e.skeleton){if(e.weightTable[h]!==void 0&&e.weightTable[h].forEach(function(v){w.push(v.weight),_.push(v.id)}),w.length>4){o||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),o=!0);const v=[0,0,0,0],E=[0,0,0,0];w.forEach(function(b,P){let A=b,x=_[P];E.forEach(function(k,M,G){if(A>k){G[M]=A,A=k;const I=v[M];v[M]=x,x=I}})}),_=v,w=E}for(;w.length<4;)w.push(0),_.push(0);for(let v=0;v<4;++v)a.push(w[v]),f.push(_[v])}if(e.normal){const v=un(d,r,h,e.normal);l.push(v[0],v[1],v[2])}e.material&&e.material.mappingType!=="AllSame"&&(m=un(d,r,h,e.material)[0],m<0&&(p.negativeMaterialIndices=!0,m=0)),e.uv&&e.uv.forEach(function(v,E){const b=un(d,r,h,v);u[E]===void 0&&(u[E]=[]),u[E].push(b[0]),u[E].push(b[1])}),i++,y&&(i>4&&console.warn("THREE.FBXLoader: Polygons with more than four sides are not supported. Make sure to triangulate the geometry during export."),p.genFace(n,e,s,m,l,c,u,a,f,i),r++,i=0,s=[],l=[],c=[],u=[],a=[],f=[])}),n}genFace(e,n,r,i,o,s,l,c,u,a){for(let f=2;f<a;f++)e.vertex.push(n.vertexPositions[r[0]]),e.vertex.push(n.vertexPositions[r[1]]),e.vertex.push(n.vertexPositions[r[2]]),e.vertex.push(n.vertexPositions[r[(f-1)*3]]),e.vertex.push(n.vertexPositions[r[(f-1)*3+1]]),e.vertex.push(n.vertexPositions[r[(f-1)*3+2]]),e.vertex.push(n.vertexPositions[r[f*3]]),e.vertex.push(n.vertexPositions[r[f*3+1]]),e.vertex.push(n.vertexPositions[r[f*3+2]]),n.skeleton&&(e.vertexWeights.push(c[0]),e.vertexWeights.push(c[1]),e.vertexWeights.push(c[2]),e.vertexWeights.push(c[3]),e.vertexWeights.push(c[(f-1)*4]),e.vertexWeights.push(c[(f-1)*4+1]),e.vertexWeights.push(c[(f-1)*4+2]),e.vertexWeights.push(c[(f-1)*4+3]),e.vertexWeights.push(c[f*4]),e.vertexWeights.push(c[f*4+1]),e.vertexWeights.push(c[f*4+2]),e.vertexWeights.push(c[f*4+3]),e.weightsIndices.push(u[0]),e.weightsIndices.push(u[1]),e.weightsIndices.push(u[2]),e.weightsIndices.push(u[3]),e.weightsIndices.push(u[(f-1)*4]),e.weightsIndices.push(u[(f-1)*4+1]),e.weightsIndices.push(u[(f-1)*4+2]),e.weightsIndices.push(u[(f-1)*4+3]),e.weightsIndices.push(u[f*4]),e.weightsIndices.push(u[f*4+1]),e.weightsIndices.push(u[f*4+2]),e.weightsIndices.push(u[f*4+3])),n.color&&(e.colors.push(s[0]),e.colors.push(s[1]),e.colors.push(s[2]),e.colors.push(s[(f-1)*3]),e.colors.push(s[(f-1)*3+1]),e.colors.push(s[(f-1)*3+2]),e.colors.push(s[f*3]),e.colors.push(s[f*3+1]),e.colors.push(s[f*3+2])),n.material&&n.material.mappingType!=="AllSame"&&(e.materialIndex.push(i),e.materialIndex.push(i),e.materialIndex.push(i)),n.normal&&(e.normal.push(o[0]),e.normal.push(o[1]),e.normal.push(o[2]),e.normal.push(o[(f-1)*3]),e.normal.push(o[(f-1)*3+1]),e.normal.push(o[(f-1)*3+2]),e.normal.push(o[f*3]),e.normal.push(o[f*3+1]),e.normal.push(o[f*3+2])),n.uv&&n.uv.forEach(function(p,h){e.uvs[h]===void 0&&(e.uvs[h]=[]),e.uvs[h].push(l[h][0]),e.uvs[h].push(l[h][1]),e.uvs[h].push(l[h][(f-1)*2]),e.uvs[h].push(l[h][(f-1)*2+1]),e.uvs[h].push(l[h][f*2]),e.uvs[h].push(l[h][f*2+1])})}addMorphTargets(e,n,r,i){if(r.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const o=this;r.forEach(function(s){s.rawTargets.forEach(function(l){const c=C.Objects.Geometry[l.geoID];c!==void 0&&o.genMorphGeometry(e,n,c,i,l.name)})})}genMorphGeometry(e,n,r,i,o){const s=n.PolygonVertexIndex!==void 0?n.PolygonVertexIndex.a:[],l=r.Vertices!==void 0?r.Vertices.a:[],c=r.Indexes!==void 0?r.Indexes.a:[],u=e.attributes.position.count*3,a=new Float32Array(u);for(let d=0;d<c.length;d++){const m=c[d]*3;a[m]=l[d*3],a[m+1]=l[d*3+1],a[m+2]=l[d*3+2]}const f={vertexIndices:s,vertexPositions:a},p=this.genBuffers(f),h=new Me(p.vertex,3);h.name=o||r.attrName,h.applyMatrix4(i),e.morphAttributes.position.push(h)}parseNormals(e){const n=e.MappingInformationType,r=e.ReferenceInformationType,i=e.Normals.a;let o=[];return r==="IndexToDirect"&&("NormalIndex"in e?o=e.NormalIndex.a:"NormalsIndex"in e&&(o=e.NormalsIndex.a)),{dataSize:3,buffer:i,indices:o,mappingType:n,referenceType:r}}parseUVs(e){const n=e.MappingInformationType,r=e.ReferenceInformationType,i=e.UV.a;let o=[];return r==="IndexToDirect"&&(o=e.UVIndex.a),{dataSize:2,buffer:i,indices:o,mappingType:n,referenceType:r}}parseVertexColors(e){const n=e.MappingInformationType,r=e.ReferenceInformationType,i=e.Colors.a;let o=[];return r==="IndexToDirect"&&(o=e.ColorIndex.a),{dataSize:4,buffer:i,indices:o,mappingType:n,referenceType:r}}parseMaterialIndices(e){const n=e.MappingInformationType,r=e.ReferenceInformationType;if(n==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:r};const i=e.Materials.a,o=[];for(let s=0;s<i.length;++s)o.push(s);return{dataSize:1,buffer:i,indices:o,mappingType:n,referenceType:r}}parseNurbsGeometry(e){if(_o===void 0)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new dt;const n=parseInt(e.Order);if(isNaN(n))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new dt;const r=n-1,i=e.KnotVector.a,o=[],s=e.Points.a;for(let f=0,p=s.length;f<p;f+=4)o.push(new Fn().fromArray(s,f));let l,c;if(e.Form==="Closed")o.push(o[0]);else if(e.Form==="Periodic"){l=r,c=i.length-1-l;for(let f=0;f<r;++f)o.push(o[f])}const a=new _o(r,i,o,l,c).getPoints(o.length*12);return new dt().setFromPoints(a)}}class ju{parse(){const e=[],n=this.parseClips();if(n!==void 0)for(const r in n){const i=n[r],o=this.addClip(i);e.push(o)}return e}parseClips(){if(C.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const n=this.parseAnimationLayers(e);return this.parseAnimStacks(n)}parseAnimationCurveNodes(){const e=C.Objects.AnimationCurveNode,n=new Map;for(const r in e){const i=e[r];if(i.attrName.match(/S|R|T|DeformPercent/)!==null){const o={id:i.id,attr:i.attrName,curves:{}};n.set(o.id,o)}}return n}parseAnimationCurves(e){const n=C.Objects.AnimationCurve;for(const r in n){const i={id:n[r].id,times:n[r].KeyTime.a.map(Hu),values:n[r].KeyValueFloat.a},o=V.get(i.id);if(o!==void 0){const s=o.parents[0].ID,l=o.parents[0].relationship;l.match(/X/)?e.get(s).curves.x=i:l.match(/Y/)?e.get(s).curves.y=i:l.match(/Z/)?e.get(s).curves.z=i:l.match(/d|DeformPercent/)&&e.has(s)&&(e.get(s).curves.morph=i)}}}parseAnimationLayers(e){const n=C.Objects.AnimationLayer,r=new Map;for(const i in n){const o=[],s=V.get(parseInt(i));s!==void 0&&(s.children.forEach(function(c,u){if(e.has(c.ID)){const a=e.get(c.ID);if(a.curves.x!==void 0||a.curves.y!==void 0||a.curves.z!==void 0){if(o[u]===void 0){const f=V.get(c.ID).parents.filter(function(p){return p.relationship!==void 0})[0].ID;if(f!==void 0){const p=C.Objects.Model[f.toString()];if(p===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",c);return}const h={modelName:p.attrName?bn.sanitizeNodeName(p.attrName):"",ID:p.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};se.traverse(function(d){d.ID===p.id&&(h.transform=d.matrix,d.userData.transformData&&(h.eulerOrder=d.userData.transformData.eulerOrder))}),h.transform||(h.transform=new U),"PreRotation"in p&&(h.preRotation=p.PreRotation.value),"PostRotation"in p&&(h.postRotation=p.PostRotation.value),o[u]=h}}o[u]&&(o[u][a.attr]=a)}else if(a.curves.morph!==void 0){if(o[u]===void 0){const f=V.get(c.ID).parents.filter(function(_){return _.relationship!==void 0})[0].ID,p=V.get(f).parents[0].ID,h=V.get(p).parents[0].ID,d=V.get(h).parents[0].ID,m=C.Objects.Model[d],y={modelName:m.attrName?bn.sanitizeNodeName(m.attrName):"",morphName:C.Objects.Deformer[f].attrName};o[u]=y}o[u][a.attr]=a}}}),r.set(parseInt(i),o))}return r}parseAnimStacks(e){const n=C.Objects.AnimationStack,r={};for(const i in n){const o=V.get(parseInt(i)).children;o.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const s=e.get(o[0].ID);r[i]={name:n[i].attrName,layer:s}}return r}addClip(e){let n=[];const r=this;return e.layer.forEach(function(i){n=n.concat(r.generateTracks(i))}),new Ko(e.name,-1,n)}generateTracks(e){const n=[];let r=new ne,i=new ht,o=new ne;if(e.transform&&e.transform.decompose(r,i,o),r=r.toArray(),i=new We().setFromQuaternion(i,e.eulerOrder).toArray(),o=o.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const s=this.generateVectorTrack(e.modelName,e.T.curves,r,"position");s!==void 0&&n.push(s)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const s=this.generateRotationTrack(e.modelName,e.R.curves,i,e.preRotation,e.postRotation,e.eulerOrder);s!==void 0&&n.push(s)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const s=this.generateVectorTrack(e.modelName,e.S.curves,o,"scale");s!==void 0&&n.push(s)}if(e.DeformPercent!==void 0){const s=this.generateMorphTrack(e);s!==void 0&&n.push(s)}return n}generateVectorTrack(e,n,r,i){const o=this.getTimesForAllAxes(n),s=this.getKeyframeTrackValues(o,n,r);return new Tc(e+"."+i,o,s)}generateRotationTrack(e,n,r,i,o,s){n.x!==void 0&&(this.interpolateRotations(n.x),n.x.values=n.x.values.map(Ce.degToRad)),n.y!==void 0&&(this.interpolateRotations(n.y),n.y.values=n.y.values.map(Ce.degToRad)),n.z!==void 0&&(this.interpolateRotations(n.z),n.z.values=n.z.values.map(Ce.degToRad));const l=this.getTimesForAllAxes(n),c=this.getKeyframeTrackValues(l,n,r);i!==void 0&&(i=i.map(Ce.degToRad),i.push(s),i=new We().fromArray(i),i=new ht().setFromEuler(i)),o!==void 0&&(o=o.map(Ce.degToRad),o.push(s),o=new We().fromArray(o),o=new ht().setFromEuler(o).invert());const u=new ht,a=new We,f=[];for(let p=0;p<c.length;p+=3)a.set(c[p],c[p+1],c[p+2],s),u.setFromEuler(a),i!==void 0&&u.premultiply(i),o!==void 0&&u.multiply(o),u.toArray(f,p/3*4);return new Mc(e+".quaternion",l,f)}generateMorphTrack(e){const n=e.DeformPercent.curves.morph,r=n.values.map(function(o){return o/100}),i=se.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new Cc(e.modelName+".morphTargetInfluences["+i+"]",n.times,r)}getTimesForAllAxes(e){let n=[];if(e.x!==void 0&&(n=n.concat(e.x.times)),e.y!==void 0&&(n=n.concat(e.y.times)),e.z!==void 0&&(n=n.concat(e.z.times)),n=n.sort(function(r,i){return r-i}),n.length>1){let r=1,i=n[0];for(let o=1;o<n.length;o++){const s=n[o];s!==i&&(n[r]=s,i=s,r++)}n=n.slice(0,r)}return n}getKeyframeTrackValues(e,n,r){const i=r,o=[];let s=-1,l=-1,c=-1;return e.forEach(function(u){if(n.x&&(s=n.x.times.indexOf(u)),n.y&&(l=n.y.times.indexOf(u)),n.z&&(c=n.z.times.indexOf(u)),s!==-1){const a=n.x.values[s];o.push(a),i[0]=a}else o.push(i[0]);if(l!==-1){const a=n.y.values[l];o.push(a),i[1]=a}else o.push(i[1]);if(c!==-1){const a=n.z.values[c];o.push(a),i[2]=a}else o.push(i[2])}),o}interpolateRotations(e){for(let n=1;n<e.values.length;n++){const r=e.values[n-1],i=e.values[n]-r,o=Math.abs(i);if(o>=180){const s=o/180,l=i/s;let c=r+l;const u=e.times[n-1],f=(e.times[n]-u)/s;let p=u+f;const h=[],d=[];for(;p<e.times[n];)h.push(p),p+=f,d.push(c),c+=l;e.times=xo(e.times,n,h),e.values=xo(e.values,n,d)}}}}class zu{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,n){this.currentProp=e,this.currentPropName=n}parse(e){this.currentIndent=0,this.allNodes=new Da,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const n=this,r=e.split(/[\r\n]+/);return r.forEach(function(i,o){const s=i.match(/^[\s\t]*;/),l=i.match(/^[\s\t]*$/);if(s||l)return;const c=i.match("^\\t{"+n.currentIndent+"}(\\w+):(.*){",""),u=i.match("^\\t{"+n.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),a=i.match("^\\t{"+(n.currentIndent-1)+"}}");c?n.parseNodeBegin(i,c):u?n.parseNodeProperty(i,u,r[++o]):a?n.popStack():i.match(/^[^\s\t}]/)&&n.parseNodePropertyContinued(i)}),this.allNodes}parseNodeBegin(e,n){const r=n[1].trim().replace(/^"/,"").replace(/"$/,""),i=n[2].split(",").map(function(c){return c.trim().replace(/^"/,"").replace(/"$/,"")}),o={name:r},s=this.parseNodeAttr(i),l=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(r,o):r in l?(r==="PoseNode"?l.PoseNode.push(o):l[r].id!==void 0&&(l[r]={},l[r][l[r].id]=l[r]),s.id!==""&&(l[r][s.id]=o)):typeof s.id=="number"?(l[r]={},l[r][s.id]=o):r!=="Properties70"&&(r==="PoseNode"?l[r]=[o]:l[r]=o),typeof s.id=="number"&&(o.id=s.id),s.name!==""&&(o.attrName=s.name),s.type!==""&&(o.attrType=s.type),this.pushStack(o)}parseNodeAttr(e){let n=e[0];e[0]!==""&&(n=parseInt(e[0]),isNaN(n)&&(n=e[0]));let r="",i="";return e.length>1&&(r=e[1].replace(/^(\w+)::/,""),i=e[2]),{id:n,name:r,type:i}}parseNodeProperty(e,n,r){let i=n[1].replace(/^"/,"").replace(/"$/,"").trim(),o=n[2].replace(/^"/,"").replace(/"$/,"").trim();i==="Content"&&o===","&&(o=r.replace(/"/g,"").replace(/,$/,"").trim());const s=this.getCurrentNode();if(s.name==="Properties70"){this.parseNodeSpecialProperty(e,i,o);return}if(i==="C"){const c=o.split(",").slice(1),u=parseInt(c[0]),a=parseInt(c[1]);let f=o.split(",").slice(3);f=f.map(function(p){return p.trim().replace(/^"/,"")}),i="connections",o=[u,a],Gu(o,f),s[i]===void 0&&(s[i]=[])}i==="Node"&&(s.id=o),i in s&&Array.isArray(s[i])?s[i].push(o):i!=="a"?s[i]=o:s.a=o,this.setCurrentProp(s,i),i==="a"&&o.slice(-1)!==","&&(s.a=cr(o))}parseNodePropertyContinued(e){const n=this.getCurrentNode();n.a+=e,e.slice(-1)!==","&&(n.a=cr(n.a))}parseNodeSpecialProperty(e,n,r){const i=r.split('",').map(function(a){return a.trim().replace(/^\"/,"").replace(/\s/,"_")}),o=i[0],s=i[1],l=i[2],c=i[3];let u=i[4];switch(s){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":u=parseFloat(u);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":u=cr(u);break}this.getPrevNode()[o]={type:s,type2:l,flag:c,value:u},this.setCurrentProp(this.getPrevNode(),o)}}class Nu{parse(e){const n=new wo(e);n.skip(23);const r=n.getUint32();if(r<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+r);const i=new Da;for(;!this.endOfContent(n);){const o=this.parseNode(n,r);o!==null&&i.add(o.name,o)}return i}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,n){const r={},i=n>=7500?e.getUint64():e.getUint32(),o=n>=7500?e.getUint64():e.getUint32();n>=7500?e.getUint64():e.getUint32();const s=e.getUint8(),l=e.getString(s);if(i===0)return null;const c=[];for(let p=0;p<o;p++)c.push(this.parseProperty(e));const u=c.length>0?c[0]:"",a=c.length>1?c[1]:"",f=c.length>2?c[2]:"";for(r.singleProperty=o===1&&e.getOffset()===i;i>e.getOffset();){const p=this.parseNode(e,n);p!==null&&this.parseSubNode(l,r,p)}return r.propertyList=c,typeof u=="number"&&(r.id=u),a!==""&&(r.attrName=a),f!==""&&(r.attrType=f),l!==""&&(r.name=l),r}parseSubNode(e,n,r){if(r.singleProperty===!0){const i=r.propertyList[0];Array.isArray(i)?(n[r.name]=r,r.a=i):n[r.name]=i}else if(e==="Connections"&&r.name==="C"){const i=[];r.propertyList.forEach(function(o,s){s!==0&&i.push(o)}),n.connections===void 0&&(n.connections=[]),n.connections.push(i)}else if(r.name==="Properties70")Object.keys(r).forEach(function(o){n[o]=r[o]});else if(e==="Properties70"&&r.name==="P"){let i=r.propertyList[0],o=r.propertyList[1];const s=r.propertyList[2],l=r.propertyList[3];let c;i.indexOf("Lcl ")===0&&(i=i.replace("Lcl ","Lcl_")),o.indexOf("Lcl ")===0&&(o=o.replace("Lcl ","Lcl_")),o==="Color"||o==="ColorRGB"||o==="Vector"||o==="Vector3D"||o.indexOf("Lcl_")===0?c=[r.propertyList[4],r.propertyList[5],r.propertyList[6]]:c=r.propertyList[4],n[i]={type:o,type2:s,flag:l,value:c}}else n[r.name]===void 0?typeof r.id=="number"?(n[r.name]={},n[r.name][r.id]=r):n[r.name]=r:r.name==="PoseNode"?(Array.isArray(n[r.name])||(n[r.name]=[n[r.name]]),n[r.name].push(r)):n[r.name][r.id]===void 0&&(n[r.name][r.id]=r)}parseProperty(e){const n=e.getString(1);let r;switch(n){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return r=e.getUint32(),e.getArrayBuffer(r);case"S":return r=e.getUint32(),e.getString(r);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const i=e.getUint32(),o=e.getUint32(),s=e.getUint32();if(o===0)switch(n){case"b":case"c":return e.getBooleanArray(i);case"d":return e.getFloat64Array(i);case"f":return e.getFloat32Array(i);case"i":return e.getInt32Array(i);case"l":return e.getInt64Array(i)}typeof Mu>"u"&&console.error("THREE.FBXLoader: External library fflate.min.js required.");const l=Kt(new Uint8Array(e.getArrayBuffer(s))),c=new wo(l.buffer);switch(n){case"b":case"c":return c.getBooleanArray(i);case"d":return c.getFloat64Array(i);case"f":return c.getFloat32Array(i);case"i":return c.getInt32Array(i);case"l":return c.getInt64Array(i)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+n)}}}class wo{constructor(e,n){this.dv=new DataView(e),this.offset=0,this.littleEndian=n!==void 0?n:!0}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const n=[];for(let r=0;r<e;r++)n.push(this.getBoolean());return n}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const n=[];for(let r=0;r<e;r++)n.push(this.getInt32());return n}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,n;return this.littleEndian?(e=this.getUint32(),n=this.getUint32()):(n=this.getUint32(),e=this.getUint32()),n&2147483648?(n=~n&4294967295,e=~e&4294967295,e===4294967295&&(n=n+1&4294967295),e=e+1&4294967295,-(n*4294967296+e)):n*4294967296+e}getInt64Array(e){const n=[];for(let r=0;r<e;r++)n.push(this.getInt64());return n}getUint64(){let e,n;return this.littleEndian?(e=this.getUint32(),n=this.getUint32()):(n=this.getUint32(),e=this.getUint32()),n*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const n=[];for(let r=0;r<e;r++)n.push(this.getFloat32());return n}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const n=[];for(let r=0;r<e;r++)n.push(this.getFloat64());return n}getArrayBuffer(e){const n=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,n}getString(e){let n=[];for(let i=0;i<e;i++)n[i]=this.getUint8();const r=n.indexOf(0);return r>=0&&(n=n.slice(0,r)),Fr.decodeText(new Uint8Array(n))}}class Da{add(e,n){this[e]=n}}function Uu(t){const e="Kaydara FBX Binary  \0";return t.byteLength>=e.length&&e===Fa(t,0,e.length)}function Vu(t){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let n=0;function r(i){const o=t[i-1];return t=t.slice(n+i),n++,o}for(let i=0;i<e.length;++i)if(r(1)===e[i])return!1;return!0}function bo(t){const e=/FBXVersion: (\d+)/,n=t.match(e);if(n)return parseInt(n[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function Hu(t){return t/46186158e3}const Wu=[];function un(t,e,n,r){let i;switch(r.mappingType){case"ByPolygonVertex":i=t;break;case"ByPolygon":i=e;break;case"ByVertice":i=n;break;case"AllSame":i=r.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+r.mappingType)}r.referenceType==="IndexToDirect"&&(i=r.indices[i]);const o=i*r.dataSize,s=o+r.dataSize;return Xu(Wu,r.buffer,o,s)}const ar=new We,ct=new ne;function Ia(t){const e=new U,n=new U,r=new U,i=new U,o=new U,s=new U,l=new U,c=new U,u=new U,a=new U,f=new U,p=new U,h=t.inheritType?t.inheritType:0;if(t.translation&&e.setPosition(ct.fromArray(t.translation)),t.preRotation){const M=t.preRotation.map(Ce.degToRad);M.push(t.eulerOrder||We.DefaultOrder),n.makeRotationFromEuler(ar.fromArray(M))}if(t.rotation){const M=t.rotation.map(Ce.degToRad);M.push(t.eulerOrder||We.DefaultOrder),r.makeRotationFromEuler(ar.fromArray(M))}if(t.postRotation){const M=t.postRotation.map(Ce.degToRad);M.push(t.eulerOrder||We.DefaultOrder),i.makeRotationFromEuler(ar.fromArray(M)),i.invert()}t.scale&&o.scale(ct.fromArray(t.scale)),t.scalingOffset&&l.setPosition(ct.fromArray(t.scalingOffset)),t.scalingPivot&&s.setPosition(ct.fromArray(t.scalingPivot)),t.rotationOffset&&c.setPosition(ct.fromArray(t.rotationOffset)),t.rotationPivot&&u.setPosition(ct.fromArray(t.rotationPivot)),t.parentMatrixWorld&&(f.copy(t.parentMatrix),a.copy(t.parentMatrixWorld));const d=n.clone().multiply(r).multiply(i),m=new U;m.extractRotation(a);const y=new U;y.copyPosition(a);const _=y.clone().invert().multiply(a),w=m.clone().invert().multiply(_),v=o,E=new U;if(h===0)E.copy(m).multiply(d).multiply(w).multiply(v);else if(h===1)E.copy(m).multiply(w).multiply(d).multiply(v);else{const G=new U().scale(new ne().setFromMatrixScale(f)).clone().invert(),I=w.clone().multiply(G);E.copy(m).multiply(d).multiply(I).multiply(v)}const b=u.clone().invert(),P=s.clone().invert();let A=e.clone().multiply(c).multiply(u).multiply(n).multiply(r).multiply(i).multiply(b).multiply(l).multiply(s).multiply(o).multiply(P);const x=new U().copyPosition(A),k=a.clone().multiply(x);return p.copyPosition(k),A=p.clone().multiply(E),A.premultiply(a.invert()),A}function Ra(t){t=t||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return t===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[t]}function cr(t){return t.split(",").map(function(n){return parseFloat(n)})}function Fa(t,e,n){return e===void 0&&(e=0),n===void 0&&(n=t.byteLength),Fr.decodeText(new Uint8Array(t,e,n))}function Gu(t,e){for(let n=0,r=t.length,i=e.length;n<i;n++,r++)t[r]=e[n]}function Xu(t,e,n,r){for(let i=n,o=0;i<r;i++,o++)t[o]=e[i];return t}function xo(t,e,n){return t.slice(0,e).concat(n).concat(t.slice(e))}const Ba=t=>t&&new Promise(e=>{new Fu().load(t,e)}),$a=t=>t&&new Promise(e=>{new Et().load(t,e)}),Ku=["px.png","nx.png","py.png","ny.png","pz.png","nz.png"],Yu=t=>t&&new Promise(e=>{new Lc().setPath(`${t}/`).load(Ku,e)}),Zu=["c100007_01","c100007_05","c100007_09","c100034_01","c100035_01","c100036_01","c100037_01","c100041_01"],qu=async t=>await(await fetch(t)).json(),Nn=async t=>(await qu(t)).data,Qu=(...t)=>e=>t.reduce((n,r)=>r(n),e),Ju=t=>[...new Set(t)],$e=t=>t==="false"?!1:!!t,ja=(t,e,n)=>{if(!e.length)return;const r=e.pop(),i=e.reduce((o,s)=>o==null?void 0:o[s],t);i&&(i[r]=n)};function pi(t){return!!/[0-9A-Fa-f]{6}/.test(t)}function _n(t){return pi(t)&&!t.startsWith("#")?new re(`#${t}`):new re(t)}async function ef(t=100){return await new Promise(e=>setTimeout(e,t))}function za(t,e="="){const[n,...r]=t.split(e),i=r.join(e);return[n,i]}const tf=t=>t.startsWith("w302"),Eo=([t,...e])=>`${t.toUpperCase()}${e.join("")}`;function nf(t){return t==="smith"?"dragon":t.endsWith("h")?"story":Zu.includes(t)?"spAdventurer":{c:"adventurer",b:"boss",d:"dragon",e:"enemy",h:"high boss",o:"object",r:"raid boss",w:"weapon"}[t[0]]??"other"}function rf(t=Sf){const e=new kc(t);return e.outputEncoding=ye,e}function of(t={}){const{fov:e,aspect:n,near:r,far:i}={...Tf,...t};return new Ho(e,n,r,i)}async function sf(t){if(t.startsWith("img:")){const e=t.replace("img:",""),n=await $a(e);return n.encoding=ye,n.center.set(.5,0),n}if(t.startsWith("sky:")){const e=t.replace("sky:",""),n=await Yu(e);return n.encoding=ye,n}if(t==="transparent")return null;if(pi(t)){const e=t.startsWith("#")?t:`#${t}`;return new re(e)}}function af(t){var e,n,r,i;(n=(e=t.map)==null?void 0:e.dispose)==null||n.call(e),(i=(r=t.userData.backupMap)==null?void 0:r.dispose)==null||i.call(r),t.dispose()}const Na=t=>{const e=new Et().load(t);return e.encoding=ye,e};function cf(t){const e=[],n=[];return t.traverse(r=>{r.isMesh&&e.push(r),r.isBone&&n.push(r)}),[e,n]}function lf(t){var n,r;if(!t)return;[t.material].flat().forEach(i=>{var o,s,l,c,u,a;(s=(o=i.map)==null?void 0:o.dispose)==null||s.call(o),(u=(c=(l=i.userData)==null?void 0:l.backupMap)==null?void 0:c.dispose)==null||u.call(c),(a=i.dispose)==null||a.call(i)}),(r=(n=t.geometry)==null?void 0:n.dispose)==null||r.call(n)}const uf=()=>{const t=new Date,e=t.toDateString().replaceAll(" ","_"),n=t.toLocaleTimeString().replaceAll(":","-").replaceAll(" ","");return`${e}_${n}`},Ua=t=>t?t.split("/").reduce((n,r)=>{const[i,o]=r.split("=");return i&&o&&(n[i]=o),n},{}):{},ff=`
varying vec3 vViewPosition;

struct BlinnPhongMaterial {

	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;

};

void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {

	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;

	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );

	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;

}

void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {

	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );

}

#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
`,pf=`
#ifdef USE_MATCAP

	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks
	vec4 matcapColor = texture2D( matcap, uv );

	#ifdef MATCAP_BLENDING_MULTIPLY

		outgoingLight *= matcapColor.rgb;

	#elif defined( MATCAP_BLENDING_ADD )

		outgoingLight += matcapColor.rgb;

	#endif

#endif
`,fn={defines:{TOON:!0,MATCAP:!0,MATCAP_BLENDING_ADD:!0},uniforms:$r.merge([Rt.toon.uniforms,Rt.phong.uniforms,Rt.matcap.uniforms]),vertexShader:Rt.phong.vertexShader,fragmentShader:Rt.phong.fragmentShader.replace("#include <common>",`
					#ifdef USE_MATCAP
						uniform sampler2D matcap;
					#endif

					#include <common>
				`).replace("#include <envmap_common_pars_fragment>",`
					#include <gradientmap_pars_fragment>
					#include <envmap_common_pars_fragment>
				`).replace("#include <lights_phong_pars_fragment>",ff).replace("#include <envmap_fragment>",`
					#include <envmap_fragment>
					${pf}
				`)};class Va extends Nt{constructor(e){super(),this._matcapCombine=ki,this.emissiveIntensity=1,this.normalMapType=Oc,this.combine=Oi,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.lights=!0,this.vertexShader=fn.vertexShader,this.fragmentShader=fn.fragmentShader,this.defines=Object.assign({},fn.defines),Object.defineProperty(this,"matcapCombine",{get:function(){return this._matcapCombine},set:function(r){switch(this._matcapCombine=r,r){case Oi:this.defines.MATCAP_BLENDING_MULTIPLY=!0,delete this.defines.MATCAP_BLENDING_ADD;break;default:case ki:this.defines.MATCAP_BLENDING_ADD=!0,delete this.defines.MATCAP_BLENDING_MULTIPLY;break}}}),this.uniforms=$r.clone(fn.uniforms);const n=["specular","shininess","opacity","diffuse","map","matcap","gradientMap","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveMap","bumpMap","bumpScale","normalMap","normalScale","displacemantBias","displacemantMap","displacemantScale","specularMap","alphaMap","envMap","reflectivity","refractionRatio"];for(const r of n)Object.defineProperty(this,r,{get:function(){return this.uniforms[r].value},set:function(i){this.uniforms[r].value=i}});Object.defineProperty(this,"color",Object.getOwnPropertyDescriptor(this,"diffuse")),this.setValues(e)}copy(e){return super.copy(e),this.matcapCombine=e.matcapCombine,this.emissiveIntensity=e.emissiveIntensity,this.normalMapType=e.normalMapType,this.combine=e.combine,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}Va.prototype.isMMDToonMaterial=!0;const hf=["color","emissive","specular"],df=["wireframe","metalness","opacity","roughness","shininess","transparent","emissiveIntensity","transmission","thickness","ior"],Ha=["type","flatShading","showTexture","gradientMap","matcap"],mf=[...hf,...df,...Ha],gf=["transparent","opacity","wireframe","showTexture","color"],vf={Basic:[],Toon:["emissive","emissiveIntensity","gradientMap"],Lambert:["emissive","emissiveIntensity"],Phong:["emissive","emissiveIntensity","specular","shininess","flatShading"],Standard:["emissive","emissiveIntensity","metalness","roughness","flatShading"],Physical:["emissive","emissiveIntensity","metalness","roughness","flatShading","transmission","thickness","ior"],Matcap:["flatShading","matcap"],MMDToon:["emissive","emissiveIntensity","specular","shininess","matcap","gradientMap","flatShading"]},fe=t=>`${t}`,lr=t=>pi(t)?`${t.startsWith("#")?"":"#"}${t}`:t,yf=t=>Array.isArray(t)?t.join(","):t,hi={wireframe:{name:"Wireframe",type:"boolean",default:!1,valueMap:$e,toString:fe},showTexture:{name:"Texture",type:"boolean",default:!0,valueMap:$e,toString:fe},transparent:{name:"Transparent",type:"boolean",default:!1,valueMap:$e,toString:fe},flatShading:{name:"Flat Shading",type:"boolean",default:!1,valueMap:$e,toString:fe},color:{name:"Color",type:"color",default:"#ffffff",valueMap:_n,toString:lr},emissive:{name:"Emissive",type:"color",default:"#000000",valueMap:_n,toString:lr},opacity:{name:"Opacity",type:"percentage",default:1,min:0,max:1,valueMap:parseFloat,toString:fe},emissiveIntensity:{name:"Emissive Intensity",type:"percentage",default:1,min:0,max:1,valueMap:parseFloat,toString:fe},specular:{name:"Specular",type:"color",default:"#111111",valueMap:_n,toString:lr},metalness:{name:"Metalness",type:"percentage",default:0,min:0,max:1,valueMap:parseFloat,toString:fe},roughness:{name:"Roughness",type:"percentage",default:1,min:0,max:1,valueMap:parseFloat,toString:fe},shininess:{name:"Shininess",type:"number",default:30,min:1,max:100,valueMap:parseFloat,toString:fe},gradientMap:{name:"Gradient Map",type:"select",default:"none",valueMap:Wa,toString:yf},matcap:{name:"Matcap",type:"select",default:"matcap_fresnel.jpg",valueMap:Ga,toString:fe},transmission:{name:"Transmission",type:"number",default:1,min:0,max:1,valueMap:parseFloat,toString:fe},thickness:{name:"Thickness",type:"number",default:.01,min:0,max:10,valueMap:parseFloat,toString:fe},ior:{name:"Index-of-refraction",type:"number",default:1.5,min:1,max:2.333,valueMap:parseFloat,toString:fe}},_f=Object.fromEntries(Object.entries(hi).map(([t,{default:e}])=>[t,e])),Je={..._f,type:"Basic"},wf=Object.fromEntries(Object.entries(hi).map(([t,{valueMap:e}])=>[t,e])),bf=Object.fromEntries(Object.entries(hi).map(([t,{toString:e}])=>[t,e])),ur=t=>[...gf,...vf[t]],xf=(t,e={})=>{if(t==="MMDToon")return new Va(e);const n=`Mesh${t}Material`;return new Yo[n](e)},Po=(t,{matType:e="Basic",texturePath:n="",force:r=!1}={})=>{t.forEach(i=>{const o=[i.material].flat(),s=Array.isArray(i.material);if(!r&&!n){const l=`isMesh${e}Material`;if(!o.some(u=>!u[l]))return}o.forEach((l,c)=>{var f,p,h,d;const u=n?new Et().load(n):o[c].map;n&&(u.encoding=ye);const a=xf(e);if(a.name=l.name,a.map=u,a.userData.backupMap=l.userData.backupMap,n&&((p=(f=l.map)==null?void 0:f.dispose)==null||p.call(f),(d=(h=l.userData.backupMap)==null?void 0:h.dispose)==null||d.call(h)),l.dispose(),s){i.material[c]=a;return}i.material=a})})},Ef=t=>Array.isArray(t)?t:t.split(",").map(e=>parseInt(e));function Wa(t){const e=Ef(t),n=e.length;if(n<2)return null;const r=Uint8Array.from(e),i=new Dc(r,n,1,Ic);return i.minFilter=i.magFilter=Rc,i.generateMipmaps=!1,i}const Pf=t=>t.includes("/")||t.includes(":")?t:`${cu}/${t}`;function Ga(t){const e=Pf(t);return e?Na(e):null}const Sf={alpha:!0,antialias:!0},Af="#cccccc",Tf={type:"Perspective",fov:45,aspect:1,far:300,near:.01},Mf="c100001_01",pt={enabled:!0,size:5,color:"#000000",opacity:1},Cf={noBackground:!0,fileName:"screenshot",frameRate:30},Lf={frameRate:30,fileName:"ani",appendDate:!0},So=1,Lr=30,kf={directional:{color:"#ffffff",intensity:.8,position:[1,0,2]},ambient:{color:"#444444",intensity:1},point:{color:"#ffffff",intensity:1}},fr={"No Mapping":Fc,Linear:Bc,Reinhard:$c,Cineon:jc,"ACES Filmic":zc},rn={addEventListener(t,e){if(!e)return;this._listeners??(this._listeners={});const n=this._listeners;return t=t.toLowerCase(),n[t]??(n[t]=[]),n[t].includes(e)||n[t].push(e),e},hasEventListener(t,e){var n,r;return t=t.toLowerCase(),!!((r=(n=this._listeners)==null?void 0:n[t])!=null&&r.includes(e))},removeEventListener(t,e){var i;t=t.toLowerCase();const n=(i=this._listeners)==null?void 0:i[t];if(!n)return;const r=n.indexOf(e);r!==-1&&n.splice(r,1)},dispatchEvent(t){var i,o;const e=(i=t.type)==null?void 0:i.toLowerCase(),n=(o=this._listeners)==null?void 0:o[e];if(!n)return;t.target=this,[...n].forEach(s=>s.call(this,t))},addCountedEventListener(t,e,n=1){const r=this;function i(o){e.call(r,o),n--,n===0&&r.removeEventListener(t,i)}this.addEventListener(t,i)}},Of={face1:[2,1],face2:[0,0],face3:[1,0],face4:[2,0],face5:[3,0],face6:[0,-1],face7:[1,-1],face8:[2,-1],face9:[3,-1]},Xa={},Df=async()=>{const t=await Nn(`${zn}/face-offset.json`);Object.assign(Xa,t)},Ao=t=>Xa[t]||[0,0],kr={},If=async()=>{const t=await Nn(`${zn}/camera-position.json`);Object.assign(kr,t)},Rf=t=>kr[t]??kr[t[0]],Or={},Ff=async()=>{const t=await Nn(`${zn}/control-position.json`);Object.assign(Or,t)},Bf=t=>Or[t]??Or[t[0]],To=t=>Of[`face${t}`],$f=(t,e)=>{const n={x:0,y:0};if(t!==e){const[r,i]=To(e),[o,s]=To(t);n.x=o-r,n.y=s-i}return[n.x,n.y]},jf=(t,e)=>{const n={x:0,y:0};if(t!==e){const[r,i]=Ao(e),[o,s]=Ao(t);n.x=o-r,n.y=s-i}return[n.x,n.y]},Un=t=>new Proxy(Object.assign(t,rn),{get(e,n){return e[n]},set(e,n,r){return e[n]=r,e.dispatchEvent({type:"change",propName:n,value:r}),!0}}),Ka=/mEye_[0-9]/m,Ya=/mMouth_[0-9]/m,zf=/[0-9]{2}/,Za=["eye","mouth"];function Nf(t){const{type:e,meshes:n}=t;return e==="adventurer"?Uf(t):n.some(({name:i})=>i.match(/mEye|mMouth/))?Vf(t):t}function Uf(t){const{meshes:e,id:n}=t,r=u=>`${qs}/${u}/${u}.png`,i=e.find(({name:u})=>u==="mBodyAll"),o={eyeIdx:2,eyeBaseIdx:2,mouthIdx:2,mouthBaseIdx:2,eyeTexture:n,mouthTexture:n},s={type:"uv",reset:function(){this.eyeIdx=this.eyeBaseIdx,this.mouthIdx=this.mouthBaseIdx}},l=u=>([a,f])=>{var w;if(!i)return;const p=`mt${Eo(u)}CH`,h=(w=i.geometry.groups)==null?void 0:w.find(v=>{var E;return((E=i.material[v.materialIndex])==null?void 0:E.name)===p});if(!h)return;const{start:d,count:m}=h,y=d+m,_=i.geometry.attributes.uv;for(let v=d;v<y;v++){const E=_.getX(v)+.25*a,b=_.getY(v)+.25*f;_.setXY(v,E,b)}_.needsUpdate=!0},c=u=>a=>{var d,m;if(!i)return;const f=`mt${Eo(u)}CH`,p=(m=(d=i.material).find)==null?void 0:m.call(d,({name:y})=>y===f);if(!p)return;const h=r(a);p.map.dispose(),p.map=Na(h),p.needsUpdate=!0};return Za.forEach(u=>{Object.defineProperties(s,{[`${u}Idx`]:{get(){return o[`${u}Idx`]},set(a){const f=parseInt(a),p=this[`${u}Idx`];o[`${u}Idx`]=f;const h=$f(f,p);l(u)(h)}},[`${u}BaseIdx`]:{get(){return o[`${u}BaseIdx`]},set(a){o[`${u}BaseIdx`]=a,this[`${u}Idx`]=a}},[`${u}Texture`]:{get(){return o[`${u}Texture`]},set(a){const f=this[`${u}Texture`];o[`${u}Texture`]=a,c(u)(a);const p=jf(a,f);l(u)(p)}}})}),t.face=Un(s),t}function Vf(t){const{meshes:e}=t,[n,r]=Hf(e);[...n,...r].forEach(c=>c.frustumCulled=!1);const i={eye:n,mouth:r},o={eyeIdx:"",eyeBaseIdx:"",mouthIdx:"",mouthBaseIdx:""},s={eyeList:n,mouthList:r,type:"meshes",reset:function(){this.eyeIdx=this.eyeBaseIdx,this.mouthIdx=this.mouthBaseIdx}},l=c=>u=>{i[c].forEach(a=>{const{name:f}=a,p=zf.exec(f)[0];a.visible=parseInt(p)===u})};return Za.forEach(c=>Object.defineProperties(s,{[`${c}Idx`]:{get(){return o[`${c}Idx`]},set(u){const a=parseInt(u);l(c)(a),o[`${c}Idx`]=`${a}`}},[`${c}BaseIdx`]:{get(){return o[`${c}BaseIdx`]},set(u){o[`${c}BaseIdx`]=u,this[`${c}Idx`]=u}}})),s.eyeBaseIdx=So,s.mouthBaseIdx=So,t.face=Un(s),t}function Hf(t){const e=t.filter(({name:r})=>r.match(Ka)),n=t.filter(({name:r})=>r.match(Ya));return[e,n]}function Wf(t){const{model:e,uniqueId:n}=t,[r,i]=cf(e);return Object.defineProperty(i,"list",{value:Ju(i.map(({name:o})=>o))}),Object.defineProperty(r,"visible",{get(){return this.filter(({visible:o})=>o)}}),i.forEach(o=>{o.name=`${n}|${o.name}`}),Object.defineProperties(t,{meshes:{get(){return r}},bones:{get(){return i}}})}const qa={},Gf=async()=>{const t=await Nn(`${zn}/model-parts.json`);Object.assign(qa,t)},Xf=t=>qa[t],Kf=/mParts([A-Za-z]+)/,Mo=/mParts[A-Za-z]+_([A-Za-z]*)/;function Yf(t){const{meshes:e,id:n}=t,r=Xf(n),i=[],o=[];if(e.forEach(u=>{var f;let{name:a}=u;if(!!(a!=null&&a.match)){if((a.includes("Effect")||a.includes("Extension"))&&(u.visible=!1),(f=r==null?void 0:r.custom)!=null&&f[a]&&(a=u.name=r.custom[a]),a.match(/mParts/)){i.push(u);return}!a.match(Ka)&&!a.match(Ya)&&o.push(u)}}),!i.length&&o.length<2)return t;const s=Object.defineProperties({},{list:{get(){return Object.keys(this)},enumerable:!1},reset:{value:function(){this.list.forEach(u=>this[u].reset())},enumerable:!1},others:{get(){return o},enumerable:!1}});if(t.parts=s,!i.length)return t;const l=new Set(i.map(({name:u})=>{var a;return(a=Kf.exec(u))==null?void 0:a[1]}).sort((u,a)=>u>a?1:-1)),c=u=>i.filter(({name:a})=>a.includes(`mParts${u}`)).sort((a,f)=>a.name>f.name?1:-1);return l.forEach(u=>{var y;const a=r==null?void 0:r[u],f=((y=a==null?void 0:a.name)==null?void 0:y.replaceAll(" ","_"))??u,p=a==null?void 0:a.options,h=c(u);h.forEach(_=>_.frustumCulled=!1);const d=h.map(({name:_})=>{var v;const w=((v=Mo.exec(_))==null?void 0:v[1])??"default";return(p==null?void 0:p[w])??w}),m=(a==null?void 0:a.default)??d[0];s[f]={_meshes:h,list:d,default:m??d[0]},Object.defineProperties(s[f],{current:{get(){var b;const _=h.filter(({visible:P})=>P).length;if(_===0)return"None";if(_!==1)return"custom";const v=(b=h.find(({visible:P})=>P).name.match(Mo))==null?void 0:b[1];return(p==null?void 0:p[v??"default"])??v??"default"},set(_){if(_.toLowerCase()==="none"){this._meshes.forEach((v,E)=>{v.visible=!1});return}if(!this.list.includes(_))return;const w=this.list.indexOf(_);this._meshes.forEach((v,E)=>{v.visible=E===w})}},index:{get(){return this.current==="custom"?NaN:this.list.indexOf(this.current)},set(_){this._meshes.forEach((w,v)=>{w.visible=v===Number(_)})}},reset:{value:function(){this.current=this.default}}})}),s.reset(),t.parts=s,t}const Zf=t=>e=>{const n=e.meshes,r={...Je,...t},{type:i}=r;Po(n,{force:!0,matType:i});let o={type:i,showTexture:!0},s=ur(i);const l={get code(){const{type:c,propList:u}=this,a=[];return c!==Je.type&&a.push(`type=${c}`),u.forEach(p=>{const h=bf[p],d=h(this[p]),m=h(Je[p]);d!==m&&a.push(`${p}=${d}`)}),a.join("/").replaceAll("#","")},set code(c){const u=Object.keys(Je),a={...Je,...Ua(c)};u.forEach(f=>{this[f]=a[f]})},toString(){const{code:c}=this;return c?`mat=(${c})`:""},get list(){return n.flatMap(({material:c})=>c)},get propList(){return s},set type(c){if(this.type===c)return;s=ur(c),Po(n,{matType:c}),o.type=c;const u={...o};o={showTexture:u.showTexture},s.forEach(a=>this[a]=u[a]),o=u},set flatShading(c){const u=$e(c);u!==this.flatShading&&(o.flatShading=u,this.propList.includes("flatShading")&&this.list.forEach(a=>{a.flatShading=u,a.needsUpdate=!0}))},set gradientMap(c){var f,p;if(c===this.gradientMap||(o.gradientMap=c,!this.propList.includes("gradientMap")))return;const u=(f=this.list[0])==null?void 0:f.gradientMap;(p=u==null?void 0:u.dispose)==null||p.call(u);const a=c==="none"?null:Wa(c);this.list.forEach(h=>{h.gradientMap=a,h.needsUpdate=!0})},set showTexture(c){const u=$e(c);if(this.showTexture===u)return;o.showTexture=u;const a=u?f=>{f.map=f.userData.backupMap,f.userData.backupMap=null,f.needsUpdate=!0}:f=>{f.userData.backupMap=f.map,f.map=null,f.needsUpdate=!0};this.list.forEach(a)},set matcap(c){var f,p;if(o.matcap===c||(o.matcap=c,!this.propList.includes("matcap")))return;const u=(f=this.list[0])==null?void 0:f.matcap;(p=u==null?void 0:u.dispose)==null||p.call(u);const a=Ga(c);this.list.forEach(h=>{h.matcap=a,h.needsUpdate=!0})}};return mf.forEach(c=>Object.defineProperty(l,c,{get(){return o[c]},...!Ha.includes(c)&&{set(u){u!==this[c]&&(o[c]=u,this.propList.includes(c)&&this.list.forEach(a=>a[c]=wf[c](u)))}}})),ur(i).forEach(c=>l[c]=r[c]),o={...Je,...o},e.material=Un(l),e},qf=`uniform float opacity;\r
uniform vec3 color;\r
\r
void main() {\r
	gl_FragColor = vec4( color, opacity );\r
}\r
`,Qf=`uniform float size;\r
\r
#include <skinning_pars_vertex>\r
\r
void main() {\r
	#include <skinbase_vertex>\r
	\r
    vec3 transformed = position + normal * 0.0005 * size;\r
        \r
	#include <skinning_vertex>\r
	#include <project_vertex>\r
}`,Jf=t=>new Nt({side:Nc,transparent:!0,depthFunc:Uc,vertexShader:Qf,fragmentShader:qf,uniforms:t});function ep(t,e){const{material:n}=t,r=Array.isArray(t.material);[n].flat().forEach(af),t.material=r?new Array(t.material.length).fill(e):e}function tp(t,e){const n=Jf(e),r=[],i=["Eff","Extension"];return t.forEach(o=>{const{name:s}=o;if(i.some(c=>s.includes(c)))return;const l=o.clone();l.name=`outline-${o.name}`,ep(l,n),o.isSkinnedMesh&&l.bind(o.skeleton,o.bindMatrix),o.add(l),r.push(l)}),r}const np={size:parseFloat,opacity:parseFloat,color:_n},rp=t=>e=>{const n={...pt,...t},r=e.meshes,i={size:{value:n.size},opacity:{value:n.opacity},color:{value:new re(n.color)}},o=tp(r,i),s={...n,enabled:!0},l={get propList(){return["enabled","color","size","opacity"]},get enabled(){return s.enabled},set enabled(c){const u=$e(c);o.forEach(a=>a.visible=u),s.enabled=u},get code(){if(!this.enabled)return"none";const c=[];return Object.keys(pt).forEach(u=>{const a=this[u];a!==pt[u]&&c.push(`${u}=${a}`)}),c.join("/").replaceAll("#","")},set code(c){if(c==="none"){this.enabled=!1;return}const u=Object.keys(pt),a={...pt,...Ua(c)};u.forEach(f=>{this[f]=a[f]})},toString(){const{code:c}=this;return c?`ol=(${c})`:""}};return["size","opacity","color"].forEach(c=>Object.defineProperty(l,c,{get(){return s[c]},set(u){u!==this[c]&&(s[c]=u,i[c].value=np[c](u))}})),l.enabled=n.enabled,e.outline=Un(l),e},ip=["push","pop","shift","unshift","splice","reverse","sort"];class je extends Array{constructor(...e){super(...e),Object.assign(this,rn),ip.forEach(n=>{Object.defineProperty(this,n,{value:(...r)=>{Array.prototype[n].call(this,...r),this.dispatchEvent({type:"change",method:n,args:r})},enumerable:!1})})}remove(e){const n=this.indexOf(e);n!==-1&&this.splice(n,1)}}const Co={chainName:"",chainCode:"",chainLength:0,aniIdx:0,clipDuration:0,clipTimeScale:1,action:null,aniAction:[],aniActionPointer:0};function Qa(t){return t.split(">").map(op)}function op(t){const[e,...n]=t.split("&"),r=sp(n);return{aniName:e,...r}}function sp(t){const e={},n=[],r={r:{name:"reps",map:parseInt},ts:{name:"timeScale",map:parseFloat},dur:{name:"duration",map:ap}};return t.forEach(i=>{const[o,s]=za(i);if(o.startsWith("@")){const u=cp(s.replace(/[()]/g,""));u.time=parseFloat(o.slice(1)),n.push(u);return}if(!r[o])return;const{name:l,map:c}=r[o];e[l]=c(s)}),e.aniAction=n.filter(({time:i})=>i<=100&&i>=0).sort((i,o)=>i.time-o.time),e}function ap(t){if(!t)return[0,100];const e=t.split("-").slice(0,2).map(parseFloat),n=e.length===2?e:[0,e[0]];return n.some(r=>r>100||r<0)||n[0]>n[1]?[0,100]:n}function cp(t){return t.split("/").reduce((n,r)=>{const[i,o]=za(r);return{...n,...lp(i,o)}},{})}const Lo={ei:{name:"face.eyeIdx",valueMap:parseInt},mi:{name:"face.mouthIdx",valueMap:parseInt},et:{name:"face.eyeTexture"},mt:{name:"face.mouthTexture"}};function lp(t,e){if(t in Lo){const{name:i,valueMap:o}=Lo[t];return{[i]:(o==null?void 0:o(e))??e}}let n=t,r=e;return t.startsWith("att")&&n.replace("att","attachment"),t.startsWith("parts")&&(n+="index",r=parseInt(e)),{[n]:r}}const up=t=>`${Qs}/${t}.json`;function fp(t,e){if(t.startsWith("fbx:"))return pp(t);if(t.startsWith("ex:")){const[,r]=t.split(":"),i=e==null?void 0:e.find(({uuid:o})=>r===o);return Promise.resolve(i.clone())}const n=up(t);return new Promise(r=>fetch(n).then(i=>i.json()).then(i=>Ko.parse(i)).then(r))}async function pp(t){const e=t.replace("fbx:",""),[n,r]=e.split("+"),{animations:i}=await Ba(n);return r?i.find(({name:o})=>o===r):i[0]}function hp(t,e=null){return Promise.all(t.map(n=>fp(n,e)))}function dp(t,e=[]){return t.map((n,r)=>{const i=e[r];if(!i||i[0]===0&&i[1]===100)return n;const o=n.duration*Lr,[s,l]=i.map(c=>Math.round(c*o/100));return Vc.subclip(n,n.name,s,l,Lr)})}async function mp(t,e=null){const n=Qa(t),r=n.map(({aniName:u})=>u),i=n.map(({duration:u})=>u),o=n.map(({aniName:u,duration:a,...f})=>({...f})),s=await hp(r,e),l=dp(s,i);return{code:t,clips:l,mod:o,get duration(){return o.some(({timeScale:a})=>a===0)?1/0:l.map((a,f)=>a.duration/Math.abs(o[f].timeScale??1)*(o[f].reps??1)).reduce((a,f)=>a+f,0)}}}const gp=/[a-z][0-9]{6}/;function vp(t){const{model:e,uniqueId:n,bones:r,id:i,viewer:o}=t,s=o.userData.ani,l=new Hc(e),c=(r==null?void 0:r.list)??[],u={...rn,mixer:l,chain:{},current:{...Co},toString(){var p;const f=(p=this.chain.default)==null?void 0:p.code;return f?`ani=${f}`:""},async addChain(f,{name:p="default",autoplay:h=!0}={}){var m;if(!f||((m=this.chain[p])==null?void 0:m.code)===f)return;l.stopAllAction();const d=await mp(f,s);d.clips.forEach(y=>{y.tracks=y.tracks.reduce((_,w)=>{let v=w.name.split(".")[0];return gp.test(v)&&(w.name.replace(v,i),v=i),c.includes(v)&&(w.name=`${n}|${w.name}`,_.push(w)),_},[])}),this.chain[p]=d,l.addEventListener("finished",a),h&&this.play(p)},play(f=this.current.chainName||"default"){const p=this.chain[f];!p||(this.current.chainName=f,this.current.chainCode=p.code,this.current.chainLength=p.clips.length,this.aniIdx=0)},pause(){this.current.action&&(this.current.action.paused=!0)},resume(){this.current.action&&(this.current.action.paused=!1)},stop(){l.stopAllAction()},reset(){const f=this.current.chainName;this.stop(),this.current={...Co},this.chain[f]=void 0},update(f){var y;l.update(f);const{current:p}=this,{action:h,aniAction:d,clipDuration:m}=p;if(!(!d[p.aniActionPointer]||!h))for(;(h==null?void 0:h.time)>((y=d[p.aniActionPointer])==null?void 0:y.time)*m/100;)this.applyAniAction(d[p.aniActionPointer]),this.current.aniActionPointer++},applyAniAction(f){t.dispatchEvent({type:"aniAction",id:n,aniAction:f});const{time:p,...h}=f;Object.entries(h).forEach(([d,m])=>{const y=d.split(".");ja(t,y,m)})},nextFrame(f=1,p=Lr){if(!this.isPaused)return;const{clipTimeScale:h,clipDuration:d,action:m}=this.current,y=f*h/p;if(m.time+=y,m.time>=d){const _=m.time-d;a(),this.pause(),this.current.action.time+=_*this.current.clipTimeScale}},setTime(f){const{clipDuration:p,action:h}=this.current;!p||f>p||(h.time=f)},get isPaused(){var f;return(f=this.current.action)==null?void 0:f.paused},get aniIdx(){return this.current.aniIdx},set aniIdx(f){if(f>=this.current.chainLength)return;this.current.aniIdx=f,this.current.aniActionPointer=0;const p={type:f===0?"chainStart":"chainMove",index:f,uniqueId:n,chainName:this.current.chainName};this.dispatchEvent(p),l.stopAllAction();const h=this.chain[this.current.chainName],d=h.mod[f],{timeScale:m,reps:y,aniAction:_}=d,w=h.clips[f],v=l.clipAction(w);v.timeScale=m??1,v.setLoop(Wc,y??1),this.current.clipDuration=w.duration,this.current.action=v,this.current.aniAction=_,this.current.aniActionPointer=0,this.current.clipTimeScale=m??1,v.play()}};function a(){const{aniIdx:f,chainLength:p}=u.current,h=(f+1)%p;if(h===0){u.dispatchEvent({type:"ChainFinished",chainName:u.current.chainName});const{face:d}=t;d&&(d.eyeIdx=d.eyeBaseIdx,d.mouthIdx=d.mouthBaseIdx)}u.aniIdx=h}return t.animation=u,t.addEventListener("TimeUpdated",({dt:f})=>u.update(f)),t}function yp(t){const{model:e,bones:n,uniqueId:r}=t,i={};return Object.defineProperty(i,"list",{get(){return Object.values(this).flat()}}),Object.defineProperty(i,"traverse",{value:function(a){this.list.forEach(f=>{var p,h;a(f),(h=(p=f.attachment)==null?void 0:p.traverse)==null||h.call(p,a)})}}),Object.assign(t,{attachment:i,parent:null,parentBone:"",attach:(a,f="root")=>{i[f]=i[f]??new je;const p=f==="root"?e:n.find(({name:h})=>h===`${r}|${f}`);!(p!=null&&p.add)||(a.detach(),p.add(a.model),i[f].push(a),a.parent=t,a.parentBone=f,t.dispatchEvent({type:"AttachmentChanged"}))},remove:(a,f="")=>{var h,d,m;const p=f||Object.keys(i).find(y=>i[y].indexOf(a)!==-1);!p||((d=(h=i[p]).remove)==null||d.call(h,a),(m=a.model.parent)==null||m.remove(a.model),t.dispatchEvent({type:"AttachmentChanged"}))},detach:()=>{var p;(p=e.parent)==null||p.remove(e);const{parent:a,parentBone:f}=t;!a||(a.remove(t,f),t.parent=t.parentBone=null)},attachTo:(a,f="root")=>{var p;t.detach(),(p=a==null?void 0:a.attach)==null||p.call(a,t,f)}})}function _p(t){const{material:e,id:n}=t,r=zt.source.fbx,i=ko(n);tf(n)&&async function(){const c=l(i),u=new Et().load(c);u.encoding=ye,u.name=i,e.list.forEach(a=>a.map=a.map??u)}();let o=i;Object.defineProperty(t,"texture",{get(){return o},set(c){if(!c){this.texture=i;return}if(c===o)return;const u=l(c),[,a]=s(c),[,f]=s(this.texture),p=e.list.filter(h=>{var d,m,y,_;return((m=(d=h.map)==null?void 0:d.name)==null?void 0:m.includes(f))||((_=(y=h.userData.backupMap)==null?void 0:y.name)==null?void 0:_.includes(f))});!p.length||(async function(){const h=await $a(u);h.name=a,h.encoding=ye,p.forEach(d=>{var m,y,_,w;d.map&&((y=(m=d.map).dispose)==null||y.call(m),d.map=h),d.userData.backupMap&&((w=(_=d.userData.backupMap).dispose)==null||w.call(_),d.userData.backupMap=h)})}(),o=c)}});function s(c){const[u,a]=c.split(">"),f=u||n,p=a||ko(f);return[f,p]}function l(c){const[u,a]=s(c);return`${r}/${u}/${a}.png`}return t}const ko=t=>t.match(/_[0-9]{2}/)||t.startsWith("h")?t:`>${t}_01`,wp=`uniform float uTime;\r
uniform float uSpread;\r
uniform float uThreshold;\r
uniform float uSpeed;\r
uniform float uParticleSize;\r
uniform float uAuraSize;\r
\r
attribute float aRandom;\r
\r
varying float vIsParticle;\r
varying float vRandom;\r
\r
#include <skinning_pars_vertex>\r
void main() {\r
    #include <skinbase_vertex>\r
\r
    vec3 transformed = position + normal * 0.005 * uSpread;\r
\r
    #include <skinning_vertex>\r
\r
    vec3 objectNormal = normal;\r
\r
	#include <skinnormal_vertex>\r
    \r
    vec4 viewPosition = viewMatrix * modelMatrix * vec4(transformed, 1.0);\r
    float yDisplacement = fract( uTime * uSpeed + aRandom ) * 0.1;\r
    viewPosition.y += yDisplacement;\r
    viewPosition.x += sin( uTime * aRandom * uSpeed + aRandom ) * 0.02;\r
    \r
    gl_Position = projectionMatrix * viewPosition;\r
    \r
    objectNormal.z *= objectNormal.z > 0.7 ? -1.0 : 1.0;\r
    vIsParticle = objectNormal.z - uThreshold;\r
\r
    gl_PointSize = vIsParticle > 0.0 ? uParticleSize : uAuraSize;\r
    gl_PointSize /= -viewPosition.z;\r
\r
    vRandom = aRandom;\r
}\r
`,bp=`uniform sampler2D uTexture;\r
\r
uniform float uTime;\r
uniform float uParticleOpacity;\r
uniform float uAuraOpacity;\r
uniform vec3 uColor;\r
uniform vec3 uColor2;\r
\r
varying float vRandom;\r
varying float vIsParticle;\r
\r
void main(){\r
    vec4 textureColor = texture2D( uTexture, gl_PointCoord );\r
    textureColor.a = length( textureColor.rgb ) ;\r
    textureColor.a *= abs( 1.0 - fract( uTime + vRandom ) ) * 0.5;\r
    textureColor.rgb = mix( uColor, uColor2,  textureColor.a * 2.0 );\r
    textureColor.a *= vIsParticle > 0.0 ? uParticleOpacity * 4.0 : uAuraOpacity;\r
\r
    gl_FragColor = textureColor;\r
    gl_FragColor /= vIsParticle > 0.0 ? 2.0 : 4.0;\r
}\r
`,wn=[{name:"time",uName:"uTime",defaultValue:0,valueMap:Number},{name:"speed",uName:"uSpeed",defaultValue:1,valueMap:Number},{name:"particleOpacity",uName:"uParticleOpacity",defaultValue:.3,valueMap:Number},{name:"auraOpacity",uName:"uAuraOpacity",defaultValue:.3,valueMap:Number},{name:"particleSize",uName:"uParticleSize",defaultValue:10,valueMap:Number},{name:"auraSize",uName:"uAuraSize",defaultValue:100,valueMap:Number},{name:"spread",uName:"uSpread",defaultValue:5,valueMap:Number},{name:"threshold",uName:"uThreshold",defaultValue:.3,valueMap:Number},{name:"texture",uName:"uTexture",defaultValue:"img/textures/particle/cloud.png",valueMap:t=>new Et().load(t)},{name:"color",uName:"uColor",defaultValue:"#ffffff",valueMap:t=>new re(t)},{name:"color2",uName:"uColor2",defaultValue:"#33ffff",valueMap:t=>new re(t)}],xp={aura:["visible",...wn.slice(1).map(({name:t})=>t)]},Ep=(t="aura")=>(e,n={})=>{if(!!(e!=null&&e.length)&&t==="aura")return Sp(e,n)};function Pp(t){return new Nt({vertexShader:wp,fragmentShader:bp,uniforms:t,transparent:!0,blending:Kc,depthWrite:!1,side:Yc})}function Sp(t,e){const n=wn.map(c=>{const{uName:u,defaultValue:a,valueMap:f}=c,p=(f==null?void 0:f(a))??a;return[u,{value:p}]}),r=Object.fromEntries(n),i=Pp(r),o=[];t.forEach(c=>{const{name:u}=c.geometry;if(u.startsWith("mEye")||u.startsWith("mMouth"))return;const a=c.geometry.clone(),f=a.attributes.position.count,p=new Float32Array(f).fill(0).map(()=>Math.random()-.5);a.setAttribute("aRandom",new Gc(p,1)),a.deleteAttribute("color"),a.deleteAttribute("uv");const h=new Xc(a,i);h.name="aura",c.isSkinnedMesh&&(h.type="SkinnedMesh",h.isSkinnedMesh=!0,h.skeleton=c.skeleton,h.bindMatrix=c.bindMatrix,h.bindMatrixInverse=c.bindMatrixInverse,h.bindMode=c.bindMode,h.bind=c.bind,h.clone=c.clone,h.initBones=c.initBones,h.normalizeSkinWeights=c.normalizeSkinWeights,h.pose=c.pose,h.updateMatrixWorld=c.updateMatrixWorld),c.add(h),o.push(h)});const s={visible:!0},l={name:"aura",onDispose:()=>{},get list(){return o},get propList(){return xp.aura},get visible(){return s.visible},set visible(c){const u=$e(c);this.list.forEach(a=>a.visible=u),s.visible=u},dispose(){this.onDispose(),this.list.forEach(c=>{var u,a,f,p,h;(u=c.parent)==null||u.remove(c),(f=(a=c.material).dispose)==null||f.call(a),(h=(p=c.geometry).dispose)==null||h.call(p)})},set code(c){c.split("/").forEach(a=>{const[f,p]=a.split("=");!wn.map(({name:h})=>h).includes(f)||(this[f]=p)})}};return wn.forEach(c=>{const{name:u,uName:a,defaultValue:f,valueMap:p}=c;s[u]=f,Object.defineProperty(l,u,{get(){return s[u]},set(h){s[u]=h,r[a].value=(p==null?void 0:p(h))??h}})}),l.onTimeUpdate=({time:c})=>l.time=c,Object.entries(e).forEach(([c,u])=>l[c]=u),l}function Ap(t){const{meshes:e}=t,n={list:new je,dispose(){this.list.forEach(r=>{var i;return(i=r.dispose)==null?void 0:i.call(r)})},add(r="aura",i={}){const o=Ep(r)(e,i);return o.onDispose=()=>this.list.remove(o),this.list.push(o),t.addEventListener("TimeUpdated",o.onTimeUpdate),o}};return t.particle=n,t}const Tp=t=>{var l,c;if(t.dispatchEvent({type:"dispose"}),!t)return;const{model:e,meshes:n,outline:r,particle:i,viewer:o}=t;i==null||i.list.forEach(u=>u.dispose()),(l=e.parent)!=null&&l.isScene&&(e.parent.remove(e),o.loadedModel.remove(t)),(c=t.detach)==null||c.call(t),[n.reverse(),r==null?void 0:r.all].flat().forEach(lf)};function Mp(t){const{x:e,y:n,z:r}=t;return[e,n,r].map(i=>i||"").join()}const Cp={position:",,",rotation:",,",scale:"1,1,1"},Lp={position:"pos",rotation:"rot",scale:"scl"};function kp(t){return Object.assign(t,{...t.isDLModel&&{toString(){const{id:e,animation:n,outline:r,material:i}=this,o=Object.entries(Cp).map(([s,l])=>{const c=Mp(this[s]);return c===l?"":`${Lp[s]}=${c}`});return[`id=${e}`,...o,n,r,i].filter(s=>`${s}`).join("/")}},dispose(){const{attachment:e,parent:n,parentBone:r}=this;e.list.forEach(i=>i.dispose()),n==null||n.remove(this,r),this.dispatchEvent({type:"dispose"}),Tp(this)}})}let di=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((e,n)=>(n&=63,n<36?e+=n.toString(36):n<62?e+=(n-26).toString(36).toUpperCase():n>62?e+="-":e+="_",e),"");function Op(t,e){const{id:n,material:r,outline:i,viewer:o}=e,s=[Wf,Yf,yp,rp(i),Zf(r),_p,Nf,vp,Ap,kp],l={...rn,isDLModel:!0,model:t,id:n,uniqueId:di(),type:nf(n),viewer:o,userData:{},_time:0,update(c){var u;this._time+=c,(u=this.attachment)==null||u.list.forEach(a=>{var f;return(f=a.update)==null?void 0:f.call(a,c)}),this.dispatchEvent({type:"TimeUpdated",dt:c,time:this._time})},set scale(c){var a;if((a=c.includes)!=null&&a.call(c,",")){const[f,p,h]=c.split(",").map(d=>d?parseFloat(d):1);this.model.scale.set(f,p,h);return}const u=Number(c)||1;this.model.scale.set(u,u,u)},get scale(){const{scale:c}=this.model,{x:u,y:a,z:f}=c;return u===a&&u===f?u:[u,a,f].join(",")},set visible(c){this.model.visible=$e(c)}};return["position","rotation","visible"].forEach(c=>Object.defineProperty(l,c,{get(){return this.model[c]},enumerable:!0})),t.userData.container=l,Qu(...s)(l)}const Oo={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );
			gl_FragColor.a *= opacity;


		}`};class Vn{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const Dp=new Br(-1,1,1,-1,0,1),mi=new dt;mi.setAttribute("position",new Me([-1,3,0,-1,-1,0,3,-1,0],3));mi.setAttribute("uv",new Me([0,2,0,0,2,0],2));class Ip{constructor(e){this._mesh=new Go(mi,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,Dp)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class Dr extends Vn{constructor(e,n){super(),this.textureID=n!==void 0?n:"tDiffuse",e instanceof Nt?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=$r.clone(e.uniforms),this.material=new Nt({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new Ip(this.material)}render(e,n,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(n),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}const Rp=Object.freeze(Object.defineProperty({__proto__:null,ShaderPass:Dr},Symbol.toStringTag,{value:"Module"}));class Do extends Vn{constructor(e,n){super(),this.scene=e,this.camera=n,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,n,r){const i=e.getContext(),o=e.state;o.buffers.color.setMask(!1),o.buffers.depth.setMask(!1),o.buffers.color.setLocked(!0),o.buffers.depth.setLocked(!0);let s,l;this.inverse?(s=0,l=1):(s=1,l=0),o.buffers.stencil.setTest(!0),o.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),o.buffers.stencil.setFunc(i.ALWAYS,s,4294967295),o.buffers.stencil.setClear(l),o.buffers.stencil.setLocked(!0),e.setRenderTarget(r),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),o.buffers.color.setLocked(!1),o.buffers.depth.setLocked(!1),o.buffers.stencil.setLocked(!1),o.buffers.stencil.setFunc(i.EQUAL,1,4294967295),o.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),o.buffers.stencil.setLocked(!0)}}class Fp extends Vn{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class Bp{constructor(e,n){if(this.renderer=e,n===void 0){const r=e.getSize(new te);this._pixelRatio=e.getPixelRatio(),this._width=r.width,this._height=r.height,n=new Zo(this._width*this._pixelRatio,this._height*this._pixelRatio),n.texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=n.width,this._height=n.height;this.renderTarget1=n,this.renderTarget2=n.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],Oo===void 0&&console.error("THREE.EffectComposer relies on CopyShader"),Dr===void 0&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new Dr(Oo),this.clock=new qo}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,n){this.passes.splice(n,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const n=this.passes.indexOf(e);n!==-1&&this.passes.splice(n,1)}isLastEnabledPass(e){for(let n=e+1;n<this.passes.length;n++)if(this.passes[n].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const n=this.renderer.getRenderTarget();let r=!1;for(let i=0,o=this.passes.length;i<o;i++){const s=this.passes[i];if(s.enabled!==!1){if(s.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(i),s.render(this.renderer,this.writeBuffer,this.readBuffer,e,r),s.needsSwap){if(r){const l=this.renderer.getContext(),c=this.renderer.state.buffers.stencil;c.setFunc(l.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),c.setFunc(l.EQUAL,1,4294967295)}this.swapBuffers()}Do!==void 0&&(s instanceof Do?r=!0:s instanceof Fp&&(r=!1))}}this.renderer.setRenderTarget(n)}reset(e){if(e===void 0){const n=this.renderer.getSize(new te);this._pixelRatio=this.renderer.getPixelRatio(),this._width=n.width,this._height=n.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,n){this._width=e,this._height=n;const r=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(r,i),this.renderTarget2.setSize(r,i);for(let o=0;o<this.passes.length;o++)this.passes[o].setSize(r,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}new Br(-1,1,1,-1,0,1);const Ja=new dt;Ja.setAttribute("position",new Me([-1,3,0,-1,-1,0,3,-1,0],3));Ja.setAttribute("uv",new Me([0,2,0,0,2,0],2));class $p extends Vn{constructor(e,n,r,i,o){super(),this.scene=e,this.camera=n,this.overrideMaterial=r,this.clearColor=i,this.clearAlpha=o!==void 0?o:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new re}render(e,n,r){const i=e.autoClear;e.autoClear=!1;let o,s;this.overrideMaterial!==void 0&&(s=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),o=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:r),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,o),this.overrideMaterial!==void 0&&(this.scene.overrideMaterial=s),e.autoClear=i}}function Io({renderer:t,scene:e,camera:n}){const r=jp(),i=new Bp(t,r),o=new $p(e,n);return i.addPass(o),i}const jp=()=>new Zo(800,600,{minFilter:Di,magFilter:Di,format:Zc,encoding:ye}),pr={bloom:Np,pixel:Vp,afterimage:Kp,sobel:Hp,halftone:Wp,dotscreen:Gp,bokeh:Xp,smaa:Up};async function zp(t,e){var r;t=t.toLowerCase();const n=await((r=pr[t])==null?void 0:r.call(pr,e));return n.type=t,n.name=gi[t].name,n}function Hn(t,e){Object.defineProperty(t,"propList",{value:e}),e.forEach(n=>{Object.defineProperty(t,n,{get(){return this.uniforms[n].value},set(r){this.uniforms[n].value=r}})})}async function Np({resolution:t=new te(800,600),strength:e=.3,radius:n=.5,threshold:r=.8}={}){const{UnrealBloomPass:i}=await N(()=>import("./UnrealBloomPass-dcf99027.js"),["assets/UnrealBloomPass-dcf99027.js","assets/three-d62902c6.js"]),o=new i(t,e,n,r);return Object.defineProperty(o,"propList",{value:["radius","strength","threshold"],writable:!1}),o}async function Up({renderer:t}){const{SMAAPass:e}=await N(()=>import("./SMAAPass-741292ef.js"),["assets/SMAAPass-741292ef.js","assets/three-d62902c6.js"]),n=new te;t.getSize(n);const r=new e(n.x,n.y);return Object.defineProperty(r,"propList",{value:[],writable:!1}),r}async function Vp({scene:t,camera:e}){const{RenderPixelatedPass:n}=await N(()=>import("./RenderPixelatedPass-e2c2410f.js"),["assets/RenderPixelatedPass-e2c2410f.js","assets/three-d62902c6.js"]),r=new n(5,t,e);return Object.defineProperty(r,"propList",{value:["size"],writable:!1}),Object.defineProperty(r,"size",{get(){return this.pixelSize},set(i){this.setPixelSize(i)}}),r}async function Hp({renderer:t}){const{ShaderPass:e}=await N(()=>Promise.resolve().then(()=>Rp),void 0),{SobelOperatorShader:n}=await N(()=>import("./SobelOperatorShader-6fa91e0b.js"),["assets/SobelOperatorShader-6fa91e0b.js","assets/three-d62902c6.js"]),r=new te;t.getSize(r),r.multiplyScalar(window.devicePixelRatio);const i=new e(n);return i.uniforms.resolution.value.x=r.x,i.uniforms.resolution.value.y=r.y,Object.defineProperty(i,"propList",{value:[],writable:!1}),i}async function Wp({renderer:t}){const{HalftonePass:e}=await N(()=>import("./HalftonePass-0a3851e9.js"),["assets/HalftonePass-0a3851e9.js","assets/three-d62902c6.js"]),n=new te;t.getSize(n);const r=new e(n.x,n.y,{radius:4});return Hn(r,["greyscale","radius","scatter","shape"]),r}async function Gp(){const{DotScreenPass:t}=await N(()=>import("./DotScreenPass-c67274c1.js"),["assets/DotScreenPass-c67274c1.js","assets/three-d62902c6.js"]),e=new t;return Hn(e,["scale","center"]),e}async function Xp({scene:t,camera:e}){const{BokehPass:n}=await N(()=>import("./BokehPass-d6d782da.js"),["assets/BokehPass-d6d782da.js","assets/three-d62902c6.js"]),r=new n(t,e,{});return Hn(r,["focus","aperture","aspect"]),r}async function Kp(){const{AfterimagePass:t}=await N(()=>import("./AfterimagePass-9d3ff737.js"),["assets/AfterimagePass-9d3ff737.js","assets/three-d62902c6.js"]),e=new t(.7);return Hn(e,["damp"]),e}function Yp(t){const{name:e,type:n}=t,r=gi[n].propList??[],i={};return r.forEach(s=>{Object.defineProperty(i,s,{get(){return t[s]},set(l){t[s]=l},enumerable:!0})}),{target:t,name:e,type:n,params:i,id:di()}}const gi={bloom:{name:"Bloom",propList:["enabled","radius","strength","threshold"]},pixel:{name:"Pixelate",propList:["enabled","size"]},afterimage:{name:"Afterimage",propList:["enabled","damp"]},sobel:{name:"Sobel",propList:["enabled"]},halftone:{name:"Halftone",propList:["enabled","greyscale","radius","scatter","shape"]},dotscreen:{name:"Dot Screen",propList:["enabled","scale"]},bokeh:{name:"Bokeh",propList:["enabled","focus","aperture","aspect"]},smaa:{name:"SMAA",propList:["enabled"]}};Object.entries(gi).map(([t,{name:e}])=>({value:t,label:e}));var ec={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(lt,function(){var n=function(){function r(h){return s.appendChild(h.dom),h}function i(h){for(var d=0;d<s.children.length;d++)s.children[d].style.display=d===h?"block":"none";o=h}var o=0,s=document.createElement("div");s.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",s.addEventListener("click",function(h){h.preventDefault(),i(++o%s.children.length)},!1);var l=(performance||Date).now(),c=l,u=0,a=r(new n.Panel("FPS","#0ff","#002")),f=r(new n.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var p=r(new n.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:s,addPanel:r,showPanel:i,begin:function(){l=(performance||Date).now()},end:function(){u++;var h=(performance||Date).now();if(f.update(h-l,200),h>c+1e3&&(a.update(1e3*u/(h-c),100),c=h,u=0,p)){var d=performance.memory;p.update(d.usedJSHeapSize/1048576,d.jsHeapSizeLimit/1048576)}return h},update:function(){l=this.end()},domElement:s,setMode:i}};return n.Panel=function(r,i,o){var s=1/0,l=0,c=Math.round,u=c(window.devicePixelRatio||1),a=80*u,f=48*u,p=3*u,h=2*u,d=3*u,m=15*u,y=74*u,_=30*u,w=document.createElement("canvas");w.width=a,w.height=f,w.style.cssText="width:80px;height:48px";var v=w.getContext("2d");return v.font="bold "+9*u+"px Helvetica,Arial,sans-serif",v.textBaseline="top",v.fillStyle=o,v.fillRect(0,0,a,f),v.fillStyle=i,v.fillText(r,p,h),v.fillRect(d,m,y,_),v.fillStyle=o,v.globalAlpha=.9,v.fillRect(d,m,y,_),{dom:w,update:function(E,b){s=Math.min(s,E),l=Math.max(l,E),v.fillStyle=o,v.globalAlpha=1,v.fillRect(0,0,a,m),v.fillStyle=i,v.fillText(c(E)+" "+r+" ("+c(s)+"-"+c(l)+")",p,h),v.drawImage(w,d+u,m,y-u,_,d,m,y-u,_),v.fillRect(d+y-u,m,u,_),v.fillStyle=o,v.globalAlpha=.9,v.fillRect(d+y-u,m,u,c((1-E/b)*_))}}},n})})(ec);const Zp=ec.exports;var Wn={exports:{}};(function(t,e){(function(n,r){r()})(lt,function(){function n(u,a){return typeof a>"u"?a={autoBom:!1}:typeof a!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),a={autoBom:!a}),a.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(u.type)?new Blob(["\uFEFF",u],{type:u.type}):u}function r(u,a,f){var p=new XMLHttpRequest;p.open("GET",u),p.responseType="blob",p.onload=function(){c(p.response,a,f)},p.onerror=function(){console.error("could not download file")},p.send()}function i(u){var a=new XMLHttpRequest;a.open("HEAD",u,!1);try{a.send()}catch{}return 200<=a.status&&299>=a.status}function o(u){try{u.dispatchEvent(new MouseEvent("click"))}catch{var a=document.createEvent("MouseEvents");a.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),u.dispatchEvent(a)}}var s=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof lt=="object"&&lt.global===lt?lt:void 0,l=s.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),c=s.saveAs||(typeof window!="object"||window!==s?function(){}:"download"in HTMLAnchorElement.prototype&&!l?function(u,a,f){var p=s.URL||s.webkitURL,h=document.createElement("a");a=a||u.name||"download",h.download=a,h.rel="noopener",typeof u=="string"?(h.href=u,h.origin===location.origin?o(h):i(h.href)?r(u,a,f):o(h,h.target="_blank")):(h.href=p.createObjectURL(u),setTimeout(function(){p.revokeObjectURL(h.href)},4e4),setTimeout(function(){o(h)},0))}:"msSaveOrOpenBlob"in navigator?function(u,a,f){if(a=a||u.name||"download",typeof u!="string")navigator.msSaveOrOpenBlob(n(u,f),a);else if(i(u))r(u,a,f);else{var p=document.createElement("a");p.href=u,p.target="_blank",setTimeout(function(){o(p)})}}:function(u,a,f,p){if(p=p||open("","_blank"),p&&(p.document.title=p.document.body.innerText="downloading..."),typeof u=="string")return r(u,a,f);var h=u.type==="application/octet-stream",d=/constructor/i.test(s.HTMLElement)||s.safari,m=/CriOS\/[\d]+/.test(navigator.userAgent);if((m||h&&d||l)&&typeof FileReader<"u"){var y=new FileReader;y.onloadend=function(){var v=y.result;v=m?v:v.replace(/^data:[^;]*;/,"data:attachment/file;"),p?p.location.href=v:location=v,p=null},y.readAsDataURL(u)}else{var _=s.URL||s.webkitURL,w=_.createObjectURL(u);p?p.location=w:location.href=w,p=null,setTimeout(function(){_.revokeObjectURL(w)},4e4)}});s.saveAs=c.saveAs=c,t.exports=c})})(Wn);const qp=["video/mp4;codecs=h264","video/webm;codecs=h264","video/webm;codecs=vp9","video/webm;codecs=vp8","video/webm"],pn=qp.filter(MediaRecorder.isTypeSupported);function Qp(t){if(!pn.length)return;const e=[],n=pn[0],r={settings:{...Lf,mimeType:n},get supportedMimeTypes(){return pn},get mimeType(){return this.settings.mimeType},set mimeType(i){pn.includes(i)&&(this.settings.mimeType=i)},start(){if(this.recorder)return;const{fileName:i,frameRate:o,mimeType:s}=this.settings,l=t.captureStream(o||30),c=l.getTracks()[0],u=new MediaRecorder(l,{mimeType:s});u.onstart=()=>e.length=0,u.ondataavailable=({data:a})=>e.push(a),u.onstop=()=>{c.stop(),this.recorder=void 0;const a=this.settings.mimeType.includes("webm")?"webm":"mp4",f=new Blob(e,{type:`video/${a}`}),p=this.settings.appendDate?`_${uf()}`:"",h=`${i||"ani"}${p}.${a}`;Wn.exports.saveAs(f,h)},u.start(),this.recorder=u},get state(){var i;return((i=this.recorder)==null?void 0:i.state)??"idle"}};return["pause","resume","stop"].forEach(i=>{Object.defineProperty(r,i,{value:()=>{var o;return(o=r.recorder)==null?void 0:o[i]()}})}),r}function Jp(t){let e=1,n=!1,r=!1;const i=()=>{t.stats.begin(),t.controls.update();const u=n?-e:e,a=t.clock.getDelta()*u;r||t.update(a),t.render(),t.stats.end()};let o=!1;const s=()=>{o||(t.render(),o=!0,setTimeout(()=>o=!1,50))};let l="";return{start(){l!=="active"&&(t.renderer.setAnimationLoop(i),t.controls.removeEventListener("change",s),l="active")},stop(){l!=="inactive"&&(t.renderer.setAnimationLoop(null),t.controls.addEventListener("change",s),l="inactive")},pause(){r=!0},resume(){r=!1},get state(){return l},get timeScale(){return e},set timeScale(u){const a=parseFloat(u);e=isNaN(a)?1:Math.abs(a)},get reverse(){return n},set reverse(u){n=!!u},get paused(){return r},set paused(u){r=!!u}}}const eh=async t=>{const{zip:e}=await N(()=>import("./browser-0c3534bf.js"),[]);return new Promise(n=>e(t,{},(r,i)=>n(new Blob([i]))))},th=t=>{const e=t.indexOf(",");return t.slice(e+1,1/0)},nh=async t=>{if(t=await t,t instanceof Blob&&(t=await t.arrayBuffer()),t instanceof ArrayBuffer)return new Uint8Array(t);if(typeof t=="string"){const e=t.startsWith("data")?th(t):t,n=window.atob(e);return Uint8Array.from(n,r=>r.charCodeAt(0))}};async function rh(t){const e=await Promise.all(t.map(({data:r})=>nh(r))),n=Object.fromEntries(t.map(({name:r},i)=>[r,[e[i],{level:0,consume:!0}]]));return eh(n)}async function ih(t,e){const n=t.length.toString().length,r=t.map((i,o)=>{const s=o.toString().padStart(n,"0");return{name:`${e||"ss"}_${s}.png`,data:i}});return rh(r)}function oh(t,e){const n=document.createElement("a");n.style.display="none",n.href=t,n.download=e,document.body.appendChild(n),n.click(),document.body.removeChild(n)}async function Ir(t,e="frames"){const n=await ih(t,e);Wn.exports.saveAs(n,`${e}.zip`)}function sh(t){const{canvas:e,scene:n}=t;return{settings:Cf,downloadFrame(i=1){const{noBackground:o,fileName:s}=this.settings,l=o&&!t.postProcessing.enabled;let c=null;const u=()=>[n.background,c]=[c,n.background];if(t.loop.state==="inactive"||i===1){l&&u(),t.render();const h=e.toDataURL();l&&u(),oh(h,`${s}.png`),t.render();return}let a=0;const f=[];l&&t.addCountedEventListener("beforeRender",u);function p(){const h=e.toDataURL("image/png");f.push(h),++a===i&&(l&&t.addCountedEventListener("beforeRender",u),Ir(f,s))}t.addCountedEventListener("afterRender",p,i)},getFrame(){let i;const{noBackground:o}=this.settings;if(o&&!t.postProcessing.enabled){let l=null;[n.background,l]=[l,n.background],t.render(),i=e.toDataURL("image/png"),[n.background,l]=[l,n.background],t.render()}else t.render(),i=e.toDataURL("image/png");return i},getAllFrames(i){var d,m;const o=i==null?void 0:i.animation.current.chainName;if(!o||i.animation.chain[o].duration===1/0)return;console.info("main thread locked");const l=t.loop.state;t.loop.stop(),(m=(d=i.face)==null?void 0:d.reset)==null||m.call(d),i.animation.stop();const c=[],{frameRate:u,noBackground:a}=this.settings,f=1/(u||30);let p=null,h=!0;for(a&&([n.background,p]=[p,n.background]),i.animation.addCountedEventListener("chainFinished",()=>h=!1),i.animation.play();h;){t.update(f);const y=e.toDataURL();c.push(y)}return console.info("main thread unlocked"),a&&([n.background,p]=[p,n.background]),l==="active"&&t.loop.start(),c},downloadAllFrames(i=0){const o=t.model[i],s=this.getAllFrames(o),{fileName:l}=this.settings;Ir(s,l)},getAllFramesAsArrayBuffer(i){var v,E;const o=i==null?void 0:i.animation.current.chainName;if(!o||i.animation.chain[o].duration===1/0)return;console.info("main thread locked");const l=t.renderer.getContext(),c=t.loop.state;(E=(v=i.face)==null?void 0:v.reset)==null||E.call(v),t.loop.stop(),i.animation.stop();const u=[],{frameRate:a,noBackground:f}=this.settings,p=1/(a||30),{width:h,height:d}=e,y=h*d*4;let _=null,w=!0;for(f&&([n.background,_]=[_,n.background]),i.animation.addCountedEventListener("chainFinished",()=>w=!1),i.animation.play();w;){t.update(p);const b=new Uint8Array(y);l.readPixels(0,0,h,d,l.RGBA,l.UNSIGNED_BYTE,b);const P=ah(b,{width:h,height:d});u.push(P.buffer)}return console.info("main thread unlocked"),f&&([n.background,_]=[_,n.background]),c==="active"&&t.loop.start(),u}}}function ah(t,{width:e,height:n}){const r=n/2|0,i=e*4,o=new Uint8Array(e*4);for(let s=0;s<r;++s){const l=s*i,c=(n-s-1)*i;o.set(t.subarray(l,l+i)),t.copyWithin(l,c,c+i),t.set(o,c)}return t}const ch=()=>Promise.all([Df(),If(),Ff(),Gf()]),lh={directional:Wo,ambient:Xo,point:dr},uh={directional:qc,point:Qc},fh=t=>{var c,u;const e=lh[t];if(!e)return null;const n=kf[t],{color:r,intensity:i,...o}=n,s=new e(r,i);s.name=(u=(c=s.type)==null?void 0:c.replace)==null?void 0:u.call(c,"Light","");const l=uh[t];return l&&(s.helper=new l(s),Object.defineProperty(s,"showHelper",{get(){return s.helper.visible},set(a){s.helper.visible=!!a,s.helper.update()}}),s.showHelper=!1),Object.defineProperty(s,"colorCode",{get(){return"#"+this.color.getHexString()},set(a){var f,p;this.color=new re(a),(p=(f=this.helper)==null?void 0:f.update)==null||p.call(f)}}),Object.entries(o).forEach(([a,f])=>{s[a].isVector3?s[a].set(...f):s[a]=f}),s};function ph(t){const e={list:new je,add:n=>{const r=fh(n);if(!!r)return t.scene.add(r),r.helper&&(t.scene.add(r.helper),r.helper.update()),e.list.push(r),r.remove=()=>{var i,o,s,l,c;e.list.remove(r),r.helper&&((i=r.parent)==null||i.remove(r.helper),(s=(o=r.helper).dispose)==null||s.call(o)),(l=r.parent)==null||l.remove(r),(c=r.dispose)==null||c.call(r)},r}};return e}const Ro={"<":">","(":")","[":"]","{":"}"},hh=t=>{let e="";const n=[],r=[];for(const i of t){if(n.length){e+=i;const o=n.at(-1);i===Ro[o]&&n.pop();continue}if(i==="/"){e&&r.push(e),e="";continue}e+=i,i in Ro&&n.push(i)}return e&&r.push(e),r},tc=t=>hh(t).reduce((n,r)=>{const[i,...o]=r.split("="),s=o==null?void 0:o.join("=");return i&&s&&n.push([i,s]),n},[]),dh={mat:{keys:["material","code"],valueMap:t=>t.slice(1,-1)},ol:{keys:["outline","code"],valueMap:t=>t.slice(1,-1)},ei:{keys:["face","eyeBaseIdx"]},et:{keys:["face","eyeTexture"]},mi:{keys:["face","mouthBaseIdx"]},mt:{keys:["face","mouthTexture"]},tx:{keys:["texture"]},scl:{keys:["scale"]}};async function mh(t){const e=tc(t),n=Object.fromEntries(e),{id:r}=n,i=await this.loadDLModel(r);return await gh(i,n),i}async function gh(t,e){const{ani:n,...r}=e;Object.entries(r).forEach(([i,o])=>{const s=dh[i];if(!s)return;const{keys:l,valueMap:c}=s,u=(c==null?void 0:c(o))??o;ja(t,l,u)}),n&&await t.animation.addChain(n)}const vi=class{constructor(){Ee(this,"userData",{ani:new je});Ee(this,"dataLoaded",!1);Ee(this,"initData",async()=>{await ch(),this.dataLoaded=!0,this.dispatchEvent({type:"dataLoaded"})});Ee(this,"_background","");Ee(this,"model",new je);Ee(this,"loadedModel",new je);Ee(this,"loadModelFromCode",mh);Ee(this,"settings",{outline:pt,material:Je});Ee(this,"viewport",{width:0,height:0,set(e,n){this.width=e,this.height=n}});Object.assign(this,rn);const e=new Jc;this.scene=e,this.background=Af,this.clock=new qo;const n=of();this.camera=n;const r=ph(this);r.add("directional"),r.add("ambient"),this.light=r;const i=rf();this.renderer=i,this.canvas=i.domElement,this.screenshot=sh(this),this.record=Qp(this.canvas),this.controls=new au(this.camera,this.canvas),this.postProcessing={enabled:!1,passes:new je,composer:Io({renderer:i,scene:e,camera:n}),async addPass(o,s={}){const l=await zp(o,{...s,renderer:i,scene:e,camera:n});this.composer.addPass(l);const c=Yp(l),{passes:u}=this,a=this;return c.remove=()=>{u.remove(c),a.refresh()},u.push(c),l},async refresh(){this.composer=Io({renderer:i,scene:e,camera:n});const o=this.passes.map(({type:l,params:c})=>({type:l,params:Object.entries(c)}));this.passes.length=0;const{length:s}=o;for(let l=0;l<s;l++){const{type:c,params:u}=o[l],a=await this.addPass(c);u.forEach(([f,p])=>void(a[f]=p))}},updatePasses(o){this.passes.length=0,this.passes.splice(0,0,...o),this.refresh()}},this.stats=new Zp,this.loop=Jp(this),this.loop.start(),console.info("%cDragalia Lost Model Viewer","color:yellow;background-color:black;font-size:1.5rem;text-shadow: 0 0 0.5rem white")}get background(){return this._background}set background(e){var r,i;if(this._background===e)return;this._background="loading",(i=(r=this.scene.background)==null?void 0:r.dispose)==null||i.call(r);const n=this;(async function(){n.scene.background=await sf(e),n._background=e,e.startsWith("img:")&&n.updateBgAspectRatio()})()}get toneMapping(){var n;const{toneMapping:e}=this.renderer;return((n=Object.entries(fr).find(([,r])=>r===e))==null?void 0:n[0])??"Unknown"}set toneMapping(e){const n=fr[e]?e:"No Mapping";this.renderer.toneMapping=fr[n]}get pixelRatio(){return this.renderer.getPixelRatio()}set pixelRatio(e){this.renderer.setPixelRatio(e),this.postProcessing.composer.setPixelRatio(e)}get unusedModel(){return this.loadedModel.filter(e=>!this.model.includes(e))}async loadDLModel(e=Mf){this.dataLoaded||await new Promise(s=>this.addCountedEventListener("dataLoaded",s));const n=vi.getModelPath(e),r=await Ba(n);r.name=e;const i={id:e,outline:this.settings.outline,material:this.settings.material,viewer:this},o=Op(r,i);return this.loadedModel.push(o),o.addEventListener("dispose",()=>this.loadedModel.remove(o)),o}add(e){var n;(n=e.detach)==null||n.call(e),this.model.push(e),this.scene.add(e.model),e.parent=this}remove(e){this.model.remove(e),this.scene.remove(e.model)}disposeAllModels(){this.loadedModel.forEach(e=>{var n;return(n=e.dispose)==null?void 0:n.call(e)}),this.model.length=0}static getModelPath(e){return`${this.source.fbx}/${e}/${e}.fbx`}async setViewport(e,n){var s;await ef(200);const r=e??window.innerWidth,i=n??window.innerHeight;this.viewport.set(r,i),this.renderer.setSize(r,i);const o=r/i;return this.camera.aspect=o,this.camera.updateProjectionMatrix(),(s=this.postProcessing.composer)==null||s.setSize(r,i),this.background.startsWith("img:")&&this.updateBgAspectRatio(),this}updateBgAspectRatio(){if(!this.background.startsWith("img:"))return;const{width:e,height:n}=this.viewport,r=e/n,{background:i}=this.scene,{naturalWidth:o,naturalHeight:s}=i.image,l=o/s,c=r/l,u=r>l?[1,1/c]:[c,1];i.repeat.set(...u)}update(e){var n;(n=this.animation)==null||n.update(e),this.model.forEach(r=>{var i;return(i=r.update)==null?void 0:i.call(r,e)}),this.loop.state==="inactive"&&this.render(),this.dispatchEvent({type:"timeUpdate",dt:e})}stopAll(){this.model.forEach(e=>{var n,r;return(r=(n=e.animation)==null?void 0:n.stop)==null?void 0:r.call(n)})}playAll(){this.model.forEach(e=>{var n,r;return(r=(n=e.animation)==null?void 0:n.play)==null?void 0:r.call(n)})}render(){this.dispatchEvent({type:"beforeRender"}),this.postProcessing.enabled?this.postProcessing.composer.render():this.renderer.render(this.scene,this.camera),this.dispatchEvent({type:"afterRender"})}toString(){return"Dragalia Lost Model Viewer"}dispose(){var e,n,r;this.model.forEach(i=>i.dispose()),(n=(e=this.scene.background)==null?void 0:e.dispose)==null||n.call(e),(r=this.renderer.renderLists)==null||r.dispose(),this.renderer.dispose()}};let zt=vi;Ee(zt,"source",{fbx:qs,ani:Qs});var pe={fullscreenEnabled:0,fullscreenElement:1,requestFullscreen:2,exitFullscreen:3,fullscreenchange:4,fullscreenerror:5,fullscreen:6},Fo=["webkitFullscreenEnabled","webkitFullscreenElement","webkitRequestFullscreen","webkitExitFullscreen","webkitfullscreenchange","webkitfullscreenerror","-webkit-full-screen"],Bo=["mozFullScreenEnabled","mozFullScreenElement","mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozfullscreenerror","-moz-full-screen"],$o=["msFullscreenEnabled","msFullscreenElement","msRequestFullscreen","msExitFullscreen","MSFullscreenChange","MSFullscreenError","-ms-fullscreen"],ae=typeof window<"u"&&typeof window.document<"u"?window.document:{},ge="fullscreenEnabled"in ae&&Object.keys(pe)||Fo[0]in ae&&Fo||Bo[0]in ae&&Bo||$o[0]in ae&&$o||[],vh={requestFullscreen:function(t){return t[ge[pe.requestFullscreen]]()},requestFullscreenFunction:function(t){return t[ge[pe.requestFullscreen]]},get exitFullscreen(){return ae[ge[pe.exitFullscreen]].bind(ae)},get fullscreenPseudoClass(){return":"+ge[pe.fullscreen]},addEventListener:function(t,e,n){return ae.addEventListener(ge[pe[t]],e,n)},removeEventListener:function(t,e,n){return ae.removeEventListener(ge[pe[t]],e,n)},get fullscreenEnabled(){return Boolean(ae[ge[pe.fullscreenEnabled]])},set fullscreenEnabled(t){},get fullscreenElement(){return ae[ge[pe.fullscreenElement]]},set fullscreenElement(t){},get onfullscreenchange(){return ae[("on"+ge[pe.fullscreenchange]).toLowerCase()]},set onfullscreenchange(t){return ae[("on"+ge[pe.fullscreenchange]).toLowerCase()]=t},get onfullscreenerror(){return ae[("on"+ge[pe.fullscreenerror]).toLowerCase()]},set onfullscreenerror(t){return ae[("on"+ge[pe.fullscreenerror]).toLowerCase()]=t}};const hn=vh,W=new zt;W.initData();W.setViewport();W.userData.specialCapture={frameRate:30,duration:5,program:"rotate"};window.addEventListener("resize",()=>W.setViewport());W.canvas.addEventListener("dblclick",yh);window.viewer=W;window.model=W.model;window.getFrame=W.screenshot.getFrame;window.downloadFrames=Ir;window.saveAs=Wn.exports.saveAs;window.THREE=Yo;window.makeGif=async t=>{const{makeGif:e}=await N(()=>import("./index-de9361df.js"),[]);return await e(t)};function yh(){!hn.fullscreenEnabled||(hn.fullscreenElement?hn.exitFullscreen():hn.requestFullscreen(W.canvas))}function _h(){try{return window.self!==window.top}catch{return!0}}let jo="";const nc=_h(),wh=nc?!1:!window.location.hash.includes("showSettings=false"),bh=nc?!1:!window.location.hash.includes("showAC=false"),xh=t=>({showSettings:wh,toggleSettings:()=>t(e=>{e.showSettings=!e.showSettings}),loadingMsg:"",setLoadingMsg:e=>t(n=>{n.loadingMsg=e}),showTimeControl:bh,toggleTimeControl:()=>t(e=>{e.showTimeControl=!e.showTimeControl}),showFrameRate:!1,toggleFrameRate:()=>t(e=>{e.showFrameRate=!e.showFrameRate}),sidebar:{open:!0,toggle:()=>t(e=>{e.sidebar.open=!e.sidebar.open}),settings:{tab:"Model",setTab:e=>t(n=>{n.sidebar.settings.tab=e})},modal:{mode:"",handleSelect:void 0,open:(e,n)=>{jo=W.loop.state,W.loop.stop(),t(r=>{r.sidebar.modal.mode=e,r.sidebar.modal.handleSelect=n})},close:()=>{jo==="active"&&W.loop.start(),t(e=>{e.sidebar.modal.mode="",e.sidebar.modal.handleSelect=void 0})}},manageMode:"single",setManageMode:e=>t(n=>{n.sidebar.manageMode=e})},chainMaker:{target:null,setTarget:e=>t(n=>{n.chainMaker.target=e})},dock:{mode:"",handleSelect:void 0,open:(e="",n)=>t(r=>{r.dock.mode=e,r.dock.handleSelect=n}),close:()=>t(e=>{e.dock.mode="",e.dock.handleSelect=void 0})}});var Eh=0;function Pe(t,e,n,r,i){var o,s,l={};for(s in e)s=="ref"?o=e[s]:l[s]=e[s];var c={type:t,props:l,key:n,ref:o,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:--Eh,__source:i,__self:r};if(typeof t=="function"&&(o=t.defaultProps))for(s in o)l[s]===void 0&&(l[s]=o[s]);return S.vnode&&S.vnode(c),c}const Ph=le(()=>N(()=>import("./index-15017640.js"),["assets/index-15017640.js","assets/TabBar-be91035c.js","assets/ButtonBase-65f23be8.js","assets/Gallery-82d7f705.js","assets/Popover-a9492b7d.js","assets/createSvgIcon-89ae96d0.js","assets/Box-c4b24945.js","assets/DialogTitle-e8b22d09.js","assets/ColorPicker-f40f3f39.js","assets/ColorButton-9272fa9b.js","assets/Button-2bddaed7.js","assets/ColorPicker-a4b8921d.css","assets/file2dataURL-4cb723a7.js","assets/three-d62902c6.js","assets/index-aa80096d.css"])),Sh=le(()=>N(()=>import("./index-3c9beea5.js"),["assets/index-3c9beea5.js","assets/lists-97601b65.js","assets/createSvgIcon-89ae96d0.js","assets/ButtonBase-65f23be8.js","assets/Gallery-82d7f705.js","assets/Popover-a9492b7d.js","assets/Box-c4b24945.js","assets/DialogTitle-e8b22d09.js","assets/Close-bc9e6819.js","assets/lists-4341b07e.css","assets/filterConfig-d518bebd.js","assets/GlowToggle-fc028802.js","assets/GlowToggle-eb519626.css","assets/filterConfig-ea114570.css","assets/styles-ed149696.js","assets/styles-6d95f099.css","assets/styles-2ff56570.css","assets/index-a6694880.js","assets/three-d62902c6.js"])),Ah=le(()=>N(()=>import("./index-cc84aa30.js"),["assets/index-cc84aa30.js","assets/lists-97601b65.js","assets/createSvgIcon-89ae96d0.js","assets/ButtonBase-65f23be8.js","assets/Gallery-82d7f705.js","assets/Popover-a9492b7d.js","assets/Box-c4b24945.js","assets/DialogTitle-e8b22d09.js","assets/Close-bc9e6819.js","assets/lists-4341b07e.css","assets/Stretcher-67da3b45.js","assets/Stretcher-c7840dc6.css","assets/TabBar-be91035c.js","assets/Button-2bddaed7.js","assets/ModelIcon-464295ef.js","assets/aniFunction-e20db1cb.js","assets/Selector-a65c0fb5.js","assets/GlowToggle-fc028802.js","assets/GlowToggle-eb519626.css","assets/Selector-88a094c7.css","assets/useKey-e1dfeffe.js","assets/file2dataURL-4cb723a7.js","assets/useToggleState-025db8e9.js","assets/Check-31582972.js","assets/three-d62902c6.js","assets/index-a584847b.css","assets/styles-2ff56570.css"])),Th=le(()=>N(()=>import("./index-c95a018a.js"),["assets/index-c95a018a.js","assets/AddWeapon-c248e098.js","assets/lists-97601b65.js","assets/createSvgIcon-89ae96d0.js","assets/ButtonBase-65f23be8.js","assets/Gallery-82d7f705.js","assets/Popover-a9492b7d.js","assets/Box-c4b24945.js","assets/DialogTitle-e8b22d09.js","assets/Close-bc9e6819.js","assets/lists-4341b07e.css","assets/filterConfig-d518bebd.js","assets/GlowToggle-fc028802.js","assets/GlowToggle-eb519626.css","assets/filterConfig-ea114570.css","assets/index-a6694880.js","assets/useToggleState-025db8e9.js","assets/ModelIcon-464295ef.js","assets/AddWeapon-45b642d6.css","assets/styles-2ff56570.css","assets/three-d62902c6.js"])),Mh=le(()=>N(()=>import("./ColorSelect-2691f54b.js"),["assets/ColorSelect-2691f54b.js","assets/ColorPicker-f40f3f39.js","assets/ColorButton-9272fa9b.js","assets/Button-2bddaed7.js","assets/ButtonBase-65f23be8.js","assets/ColorPicker-a4b8921d.css","assets/DialogTitle-e8b22d09.js","assets/three-d62902c6.js"])),Ch=le(()=>N(()=>import("./index-2b1f6a13.js"),["assets/index-2b1f6a13.js","assets/FaceSelect-2582af45.js","assets/useKey-e1dfeffe.js","assets/FacePartSelector-d74bf17e.js","assets/Selector-a65c0fb5.js","assets/GlowToggle-fc028802.js","assets/GlowToggle-eb519626.css","assets/Selector-88a094c7.css","assets/MeshMouthSelect-6142a2f2.js","assets/Box-c4b24945.js","assets/ButtonBase-65f23be8.js","assets/DialogTitle-e8b22d09.js","assets/Button-2bddaed7.js","assets/MeshMouthSelect-7f49998c.css","assets/FaceSelect-febe3778.css","assets/three-d62902c6.js"])),Lh=le(()=>N(()=>import("./index-36d6391e.js"),["assets/index-36d6391e.js","assets/FaceTexture-235c75a3.js","assets/useToggleState-025db8e9.js","assets/lists-97601b65.js","assets/createSvgIcon-89ae96d0.js","assets/ButtonBase-65f23be8.js","assets/Gallery-82d7f705.js","assets/Popover-a9492b7d.js","assets/Box-c4b24945.js","assets/DialogTitle-e8b22d09.js","assets/Close-bc9e6819.js","assets/lists-4341b07e.css","assets/FacePartSelector-d74bf17e.js","assets/Selector-a65c0fb5.js","assets/GlowToggle-fc028802.js","assets/GlowToggle-eb519626.css","assets/Selector-88a094c7.css","assets/filterConfig-d518bebd.js","assets/filterConfig-ea114570.css","assets/styles-ed149696.js","assets/styles-6d95f099.css","assets/styles-2ff56570.css","assets/three-d62902c6.js"])),kh=le(()=>N(()=>import("./index-96e6c438.js"),["assets/index-96e6c438.js","assets/useKey-e1dfeffe.js","assets/Stretcher-67da3b45.js","assets/Stretcher-c7840dc6.css","assets/BoneManager-2ac154a9.js","assets/ModelIcon-464295ef.js","assets/Accordion-998339e3.js","assets/useToggleState-025db8e9.js","assets/createSvgIcon-89ae96d0.js","assets/ButtonBase-65f23be8.js","assets/Accordion-09fd7fc3.css","assets/filterConfig-d518bebd.js","assets/Gallery-82d7f705.js","assets/Popover-a9492b7d.js","assets/Box-c4b24945.js","assets/DialogTitle-e8b22d09.js","assets/GlowToggle-fc028802.js","assets/GlowToggle-eb519626.css","assets/lists-97601b65.js","assets/Close-bc9e6819.js","assets/lists-4341b07e.css","assets/filterConfig-ea114570.css","assets/ColorButton-9272fa9b.js","assets/Button-2bddaed7.js","assets/SkipPrevious-edbc1eca.js","assets/FaceSelect-2582af45.js","assets/FacePartSelector-d74bf17e.js","assets/Selector-a65c0fb5.js","assets/Selector-88a094c7.css","assets/MeshMouthSelect-6142a2f2.js","assets/MeshMouthSelect-7f49998c.css","assets/FaceSelect-febe3778.css","assets/FaceTexture-235c75a3.js","assets/styles-ed149696.js","assets/styles-6d95f099.css","assets/styles-2ff56570.css","assets/AddWeapon-c248e098.js","assets/index-a6694880.js","assets/AddWeapon-45b642d6.css","assets/BoneManager-bf3fbd2c.css","assets/three-d62902c6.js","assets/index-98b9a174.css"])),zo=le(()=>N(()=>import("./index-834b8a21.js"),["assets/index-834b8a21.js","assets/MeshMouthSelect-6142a2f2.js","assets/Box-c4b24945.js","assets/ButtonBase-65f23be8.js","assets/DialogTitle-e8b22d09.js","assets/Button-2bddaed7.js","assets/MeshMouthSelect-7f49998c.css","assets/three-d62902c6.js","assets/index-045f3dd6.css"])),Oh=le(()=>N(()=>import("./index-e79aee13.js"),["assets/index-e79aee13.js","assets/useKey-e1dfeffe.js","assets/Accordion-998339e3.js","assets/useToggleState-025db8e9.js","assets/createSvgIcon-89ae96d0.js","assets/ButtonBase-65f23be8.js","assets/Accordion-09fd7fc3.css","assets/ModelIcon-464295ef.js","assets/Button-2bddaed7.js","assets/Check-31582972.js","assets/DialogTitle-e8b22d09.js","assets/Box-c4b24945.js","assets/three-d62902c6.js","assets/index-79f787e2.css","assets/styles-2ff56570.css"])),No={background:Ph,model:Sh,animation:Ah,weapon:Th,color:Mh,face:Ch,faceTexture:Lh,attachment:kh,target:Oh,eye:({onSelect:t})=>Pe(zo,{part:"eye",onSelect:t}),mouth:({onSelect:t})=>Pe(zo,{part:"mouth",onSelect:t})},Dh=(t,e)=>({Component:void 0,props:void 0,openModal:(n,r)=>t(i=>{i.props=r,i.Component=n}),close:()=>t(n=>{n.Component=void 0}),onClose:void 0,reset:()=>t(n=>{n.Component=n.props=n.onClose=void 0}),getInput:async n=>{if(!No[n])return null;const{close:r,reset:i}=e(),o=new Promise((s,l)=>{const c=(...u)=>s(u);t(u=>{u.onClose=()=>{l(),r()},u.props={onSelect:c,onAfterSelect:r},u.Component=No[n]})});try{return await o}catch{return null}finally{i()}},inputModel:()=>e().getInput("model"),inputAni:()=>e().getInput("animation"),inputColor:async()=>{const n=await e().getInput("color");return n==null?void 0:n[0]},inputTarget:()=>e().getInput("target"),inputEye:()=>e().getInput("eye"),inputMouth:()=>e().getInput("mouth")}),Ih=t=>({activeModel:void 0,setActiveModel:e=>t({activeModel:e})}),Rh=t=>({open:!1,toggle:()=>t(e=>({open:!e.open})),target:null,setTarget:e=>{!e||(e.userData.chain||(e.userData.chain=new je),t({target:e}))}}),Fh=t=>(e,n,r)=>t(i=>e(ou(i)),n,r),on=t=>Wr(Fh(t)),Rr=on(xh),sd=on(Ys),ad=on(Ys),Bh=on(su),cd=on(Dh),ld=Wr(Ih),ud=Wr(Rh);function $h(){return new Worker("/dl-model/assets/fetchWorker-371b1d98.js")}const jh=t=>{const e=new $h;return new Promise(n=>{e.addEventListener("message",r=>{e.terminate(),n(r.data)}),e.postMessage(t)})};function rc(){return new Worker("/dl-model/assets/dbWorker-7a44bd92.js")}const ic=(t,e)=>{const n=new rc;return new Promise(r=>{n.addEventListener("message",()=>{r(),n.terminate()}),n.postMessage({type:"put",store:e,value:t})})};function zh(){return new Worker("/dl-model/assets/searchWorker-266b9caf.js")}async function Nh(t,e="",n=["name"]){if(!e||!n.length)return t;const r=new zh;return new Promise(i=>{r.addEventListener("message",o=>{r.terminate(),i(o.data)}),r.postMessage({fullList:t,query:e,keys:n})})}const fd=async t=>{const e=Object.values(t).flat();await ic(e,"model"),console.info("Model DB Initialized")},pd=t=>Gn({type:"get",store:"model",value:t}),hd=t=>Gn({type:"search",store:"model",index:"name",value:t}),dd=async t=>{const n=(await Gn({type:"getByKeyRange",store:"model",value:"c100000_00-c199999_99"})).filter(({id:r})=>!r.endsWith("h"));return Nh(n,t)},Uh=()=>Gn({type:"getMap",store:"model",index:"name"}),Gn=t=>{const e=new rc;return new Promise(n=>{e.addEventListener("message",r=>{e.terminate(),n(r.data)}),e.postMessage(t)})},Zt={},Vh=async()=>{if(Object.keys(Zt).length)return;const t="ani-personal",e=(await jh([t]))[t];Object.assign(Zt,e)},oc=Vh(),md=t=>Zt[t],Hh=t=>{var e;return((e=Zt[t])==null?void 0:e[0])??(t.startsWith("c")?{name:"Bob",code:"CMN_MWM_03"}:null)},gd=async()=>{const t=await Uh();await oc;const e=Object.entries(Zt).flatMap(([n,r])=>{const i=t.get(n);return r.map(o=>({...o,user:n,fullName:`${i} ${o.name}`}))});await ic(e,"animation")},Wh="cccccc",Gh="c100001_01",Uo=(t,e="Unknown")=>{const n=Qa(t),{length:r}=n,i=n.map((o,s)=>{const{aniName:l,reps:c=1,timeScale:u=1,duration:a=[0,100],aniAction:f}=o,p=r>1?e+` #${s+1}`:e;return{id:di(),name:p,aniName:l,reps:c,timeScale:u,duration:a,aniAction:f}});return je.from(i)},Vo={ts:{key:"timeScale",defaultValue:1},r:{key:"reps",defaultValue:1}},Xh={"face.eyeIdx":"ei","face.mouthIdx":"mi"},vd=t=>t.map(Kh).join(">"),Kh=t=>{const{aniName:e}=t,n=Yh(t),r=Zh(t),i=qh(t);return`${e}${n}${r}${i}`},Yh=t=>{const e=[];return Object.keys(Vo).forEach(n=>{const{key:r,defaultValue:i}=Vo[n];t[r]&&t[r]!==i&&e.push(`&${n}=${t[r]}`)}),e.join("")},Zh=t=>{const{duration:e=[0,100]}=t,[n,r]=e;return n!==0?`&dur=${n}-${r}`:r===100?"":`&dur=${r}`},qh=t=>{const{aniAction:e}=t;return e.length?"&"+e.map(r=>{const{time:i,...o}=r,s=Object.entries(o).map(([l,c])=>`${Xh[l]??l}=${c}`);return`@${i}=(${s.join("/")})`}).join("&"):""};function Qh(t){if(!(t!=null&&t.userData))return;const{type:e,id:n}=t,{name:r}=t.userData;t.userData.aniSelectState={category:e==="adventurer"?"Adv":"Personal",personalAni:{source:n,sourceName:r}}}function hr(){const t=decodeURI(window.location.hash),e=tc(t),n=Object.fromEntries(e);Jh(n),ed(t)}function Jh(t){const{bg:e=Wh,showAC:n="true",showSettings:r="true"}=t;W.background=e,Rr.setState({showTimeControl:uo(n)}),Rr.setState({showSettings:uo(r)})}async function ed(t){W.disposeAllModels(),setTimeout(async()=>{const e=t.includes("id=")?t:t+`/id=${Gh}`,n=await W.loadModelFromCode(e);W.add(n);const r=n.type==="adventurer"?"Adv":"Personal";Bh.getState().setCategory(r),Qh(n);const{id:i}=n;if(!t.includes("camPos=")){const s=Rf(i);W.camera.position.set(...s)}const o=Bf(i);if(W.controls.target.set(...o),t.includes("ani=")){const s=n.animation.current.chainCode??"";s&&(n.userData.chain=Uo(s,"init"))}else{const s=Hh(i);if(s){const{code:l,name:c}=s;n.animation.addChain(l),n.userData.chain=Uo(l,c)}}})}const td=le(()=>N(()=>import("./index-17577ad9.js"),["assets/index-17577ad9.js","assets/createSvgIcon-89ae96d0.js","assets/ButtonBase-65f23be8.js","assets/BoneManager-2ac154a9.js","assets/ModelIcon-464295ef.js","assets/Accordion-998339e3.js","assets/useToggleState-025db8e9.js","assets/Accordion-09fd7fc3.css","assets/filterConfig-d518bebd.js","assets/Gallery-82d7f705.js","assets/Popover-a9492b7d.js","assets/Box-c4b24945.js","assets/DialogTitle-e8b22d09.js","assets/GlowToggle-fc028802.js","assets/GlowToggle-eb519626.css","assets/lists-97601b65.js","assets/Close-bc9e6819.js","assets/lists-4341b07e.css","assets/filterConfig-ea114570.css","assets/ColorButton-9272fa9b.js","assets/Button-2bddaed7.js","assets/SkipPrevious-edbc1eca.js","assets/useKey-e1dfeffe.js","assets/FaceSelect-2582af45.js","assets/FacePartSelector-d74bf17e.js","assets/Selector-a65c0fb5.js","assets/Selector-88a094c7.css","assets/MeshMouthSelect-6142a2f2.js","assets/MeshMouthSelect-7f49998c.css","assets/FaceSelect-febe3778.css","assets/FaceTexture-235c75a3.js","assets/styles-ed149696.js","assets/styles-6d95f099.css","assets/styles-2ff56570.css","assets/AddWeapon-c248e098.js","assets/index-a6694880.js","assets/AddWeapon-45b642d6.css","assets/BoneManager-bf3fbd2c.css","assets/TabBar-be91035c.js","assets/aniFunction-e20db1cb.js","assets/three-d62902c6.js","assets/index-0f03617c.css"])),nd=le(()=>N(()=>import("./index-db3f4778.js"),["assets/index-db3f4778.js","assets/useToggleState-025db8e9.js","assets/GlowToggle-fc028802.js","assets/GlowToggle-eb519626.css","assets/Button-2bddaed7.js","assets/ButtonBase-65f23be8.js","assets/Popover-a9492b7d.js","assets/SkipPrevious-edbc1eca.js","assets/createSvgIcon-89ae96d0.js","assets/Close-bc9e6819.js","assets/three-d62902c6.js","assets/index-0a450c69.css"]));function rd(){const t=El(),e=Vt(),n=Vt(),{loadingMsg:r,showTimeControl:i,showSettings:o,showFrameRate:s}=Rr();return yt(()=>(t&&oc.then(hr),window.addEventListener("hashchange",hr),()=>window.removeEventListener("hashchange",hr))),yt(()=>{e.current.appendChild(W.canvas),W.stats.dom.style.position="",n.current.appendChild(W.stats.dom)},[]),Pe(Oe,{children:[o&&Pe(et,{fallback:null,children:Pe(td,{})}),Pe("div",{className:"mount",ref:l=>e.current=l}),Pe("div",{className:"stats",style:{display:s?"unset":"none"},ref:l=>n.current=l}),r&&Pe("div",{className:"loading-msg",children:r}),i&&Pe(et,{fallback:null,children:Pe(nd,{})})]})}gt(Pe(rd,{}),document.getElementById("app"));export{ic as $,Wn as A,N as B,Eo as C,et as D,ih as E,$n as F,rh as G,cd as H,vd as I,di as J,jh as K,fd as L,oc as M,gd as N,El as O,Tf as P,Ss as Q,xl as R,Ju as S,ds as T,Vr as U,Fs as V,fs as W,bs as X,hs as Y,Wr as Z,Vt as _,ld as a,Gn as a0,ke as a1,_s as a2,ou as a3,Ao as a4,qs as a5,ko as a6,dd as a7,hd as a8,Nh as a9,ad as aa,le as ab,Fu as ac,md as ad,Vn as ae,Oo as af,Ip as ag,lt as ah,Hs as ai,Sn as aj,Ae as ak,Uo as b,Os as c,No as d,Rf as e,Bf as f,Hh as g,yt as h,Qh as i,Bh as j,ws as k,bl as l,sd as m,Bn as n,Pe as o,Oe as p,pd as q,ud as r,Qt as s,fr as t,Rr as u,W as v,ms as w,Rs as x,zr as y,gi as z};
