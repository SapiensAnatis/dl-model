var Zi=Object.defineProperty;var qi=(r,e,t)=>e in r?Zi(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var ge=(r,e,t)=>(qi(r,typeof e!="symbol"?e+"":e,t),t);import{_ as ve}from"./preload-helper-45408441.js";import{E as Qi,V as Q,M as Ve,T as He,Q as Ke,S as Yn,a as q,b as Ht,C as Ji,L as es,c as En,F as ts,d as Qe,R as Kn,e as Zn,f as qn,g as Qt,h as ns,i as J,s as fe,j as rs,k as j,G as Qn,B as Jn,P as Rt,O as Jt,l as Dr,m as Or,n as ln,o as we,p as is,D as kr,q as ss,r as as,t as os,u as cs,v as ls,A as Fr,w as ut,x as Ie,U as us,y as fs,z as Rr,H as De,I as hs,J as ps,N as ds,K as ms,W as gs,X as _r,Y as lt,Z as bn,_ as er,$ as vs,a0 as tr,a1 as ys,a2 as ws,a3 as xs,a4 as Br,a5 as Es,a6 as bs,a7 as Ps,a8 as Ts,a9 as As,aa as Ms,ab as Ls,ac as Ss,ad as Cs,ae as Is,af as Ds,ag as Os,ah as ks,ai as Fs,aj as zr,ak as jr,al as nr,am as Rs,an as _s,ao as Bs,ap as zs}from"./three-5c1cbd72.js";import{C as rr}from"./CopyShader-e27bbfcf.js";import{ShaderPass as ir}from"./ShaderPass-8cbc6b59.js";import{P as Pn}from"./Pass-4a28857e.js";import{c as $e}from"./_commonjsHelpers-35101cd5.js";const sr={type:"change"},en={type:"start"},ar={type:"end"};class js extends Qi{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new Q,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Ve.ROTATE,MIDDLE:Ve.DOLLY,RIGHT:Ve.PAN},this.touches={ONE:He.ROTATE,TWO:He.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return l.phi},this.getAzimuthalAngle=function(){return l.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(m){m.addEventListener("keydown",Hn),this._domElementKeyEvents=m},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(sr),n.update(),s=i.NONE},this.update=function(){const m=new Q,M=new Ke().setFromUnitVectors(e.up,new Q(0,1,0)),$=M.clone().invert(),K=new Q,me=new Ke,Ne=2*Math.PI;return function(){const Wn=n.object.position;m.copy(Wn).sub(n.target),m.applyQuaternion(M),l.setFromVector3(m),n.autoRotate&&s===i.NONE&&O(A()),n.enableDamping?(l.theta+=o.theta*n.dampingFactor,l.phi+=o.phi*n.dampingFactor):(l.theta+=o.theta,l.phi+=o.phi);let Ee=n.minAzimuthAngle,be=n.maxAzimuthAngle;return isFinite(Ee)&&isFinite(be)&&(Ee<-Math.PI?Ee+=Ne:Ee>Math.PI&&(Ee-=Ne),be<-Math.PI?be+=Ne:be>Math.PI&&(be-=Ne),Ee<=be?l.theta=Math.max(Ee,Math.min(be,l.theta)):l.theta=l.theta>(Ee+be)/2?Math.max(Ee,l.theta):Math.min(be,l.theta)),l.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,l.phi)),l.makeSafe(),l.radius*=c,l.radius=Math.max(n.minDistance,Math.min(n.maxDistance,l.radius)),n.enableDamping===!0?n.target.addScaledVector(u,n.dampingFactor):n.target.add(u),m.setFromSpherical(l),m.applyQuaternion($),Wn.copy(n.target).add(m),n.object.lookAt(n.target),n.enableDamping===!0?(o.theta*=1-n.dampingFactor,o.phi*=1-n.dampingFactor,u.multiplyScalar(1-n.dampingFactor)):(o.set(0,0,0),u.set(0,0,0)),c=1,f||K.distanceToSquared(n.object.position)>a||8*(1-me.dot(n.object.quaternion))>a?(n.dispatchEvent(sr),K.copy(n.object.position),me.copy(n.object.quaternion),f=!1,!0):!1}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",Gn),n.domElement.removeEventListener("pointerdown",Ue),n.domElement.removeEventListener("pointercancel",Nn),n.domElement.removeEventListener("wheel",Vn),n.domElement.removeEventListener("pointermove",Kt),n.domElement.removeEventListener("pointerup",Zt),n._domElementKeyEvents!==null&&n._domElementKeyEvents.removeEventListener("keydown",Hn)};const n=this,i={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let s=i.NONE;const a=1e-6,l=new Yn,o=new Yn;let c=1;const u=new Q;let f=!1;const h=new q,p=new q,d=new q,v=new q,y=new q,x=new q,w=new q,g=new q,b=new q,E=[],T={};function A(){return 2*Math.PI/60/60*n.autoRotateSpeed}function P(){return Math.pow(.95,n.zoomSpeed)}function O(m){o.theta-=m}function L(m){o.phi-=m}const V=function(){const m=new Q;return function($,K){m.setFromMatrixColumn(K,0),m.multiplyScalar(-$),u.add(m)}}(),k=function(){const m=new Q;return function($,K){n.screenSpacePanning===!0?m.setFromMatrixColumn(K,1):(m.setFromMatrixColumn(K,0),m.crossVectors(n.object.up,m)),m.multiplyScalar($),u.add(m)}}(),I=function(){const m=new Q;return function($,K){const me=n.domElement;if(n.object.isPerspectiveCamera){const Ne=n.object.position;m.copy(Ne).sub(n.target);let Tt=m.length();Tt*=Math.tan(n.object.fov/2*Math.PI/180),V(2*$*Tt/me.clientHeight,n.object.matrix),k(2*K*Tt/me.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(V($*(n.object.right-n.object.left)/n.object.zoom/me.clientWidth,n.object.matrix),k(K*(n.object.top-n.object.bottom)/n.object.zoom/me.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function D(m){n.object.isPerspectiveCamera?c/=m:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*m)),n.object.updateProjectionMatrix(),f=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function B(m){n.object.isPerspectiveCamera?c*=m:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/m)),n.object.updateProjectionMatrix(),f=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function R(m){h.set(m.clientX,m.clientY)}function z(m){w.set(m.clientX,m.clientY)}function G(m){v.set(m.clientX,m.clientY)}function Z(m){p.set(m.clientX,m.clientY),d.subVectors(p,h).multiplyScalar(n.rotateSpeed);const M=n.domElement;O(2*Math.PI*d.x/M.clientHeight),L(2*Math.PI*d.y/M.clientHeight),h.copy(p),n.update()}function te(m){g.set(m.clientX,m.clientY),b.subVectors(g,w),b.y>0?D(P()):b.y<0&&B(P()),w.copy(g),n.update()}function W(m){y.set(m.clientX,m.clientY),x.subVectors(y,v).multiplyScalar(n.panSpeed),I(x.x,x.y),v.copy(y),n.update()}function se(m){m.deltaY<0?B(P()):m.deltaY>0&&D(P()),n.update()}function ce(m){let M=!1;switch(m.code){case n.keys.UP:m.ctrlKey||m.metaKey||m.shiftKey?L(2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):I(0,n.keyPanSpeed),M=!0;break;case n.keys.BOTTOM:m.ctrlKey||m.metaKey||m.shiftKey?L(-2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):I(0,-n.keyPanSpeed),M=!0;break;case n.keys.LEFT:m.ctrlKey||m.metaKey||m.shiftKey?O(2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):I(n.keyPanSpeed,0),M=!0;break;case n.keys.RIGHT:m.ctrlKey||m.metaKey||m.shiftKey?O(-2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):I(-n.keyPanSpeed,0),M=!0;break}M&&(m.preventDefault(),n.update())}function Y(){if(E.length===1)h.set(E[0].pageX,E[0].pageY);else{const m=.5*(E[0].pageX+E[1].pageX),M=.5*(E[0].pageY+E[1].pageY);h.set(m,M)}}function H(){if(E.length===1)v.set(E[0].pageX,E[0].pageY);else{const m=.5*(E[0].pageX+E[1].pageX),M=.5*(E[0].pageY+E[1].pageY);v.set(m,M)}}function Re(){const m=E[0].pageX-E[1].pageX,M=E[0].pageY-E[1].pageY,$=Math.sqrt(m*m+M*M);w.set(0,$)}function _e(){n.enableZoom&&Re(),n.enablePan&&H()}function Se(){n.enableZoom&&Re(),n.enableRotate&&Y()}function bt(m){if(E.length==1)p.set(m.pageX,m.pageY);else{const $=qt(m),K=.5*(m.pageX+$.x),me=.5*(m.pageY+$.y);p.set(K,me)}d.subVectors(p,h).multiplyScalar(n.rotateSpeed);const M=n.domElement;O(2*Math.PI*d.x/M.clientHeight),L(2*Math.PI*d.y/M.clientHeight),h.copy(p)}function ot(m){if(E.length===1)y.set(m.pageX,m.pageY);else{const M=qt(m),$=.5*(m.pageX+M.x),K=.5*(m.pageY+M.y);y.set($,K)}x.subVectors(y,v).multiplyScalar(n.panSpeed),I(x.x,x.y),v.copy(y)}function ct(m){const M=qt(m),$=m.pageX-M.x,K=m.pageY-M.y,me=Math.sqrt($*$+K*K);g.set(0,me),b.set(0,Math.pow(g.y/w.y,n.zoomSpeed)),D(b.y),w.copy(g)}function Pt(m){n.enableZoom&&ct(m),n.enablePan&&ot(m)}function Gi(m){n.enableZoom&&ct(m),n.enableRotate&&bt(m)}function Ue(m){n.enabled!==!1&&(E.length===0&&(n.domElement.setPointerCapture(m.pointerId),n.domElement.addEventListener("pointermove",Kt),n.domElement.addEventListener("pointerup",Zt)),Ki(m),m.pointerType==="touch"?Wi(m):$i(m))}function Kt(m){n.enabled!==!1&&(m.pointerType==="touch"?Yi(m):Xi(m))}function Zt(m){$n(m),E.length===0&&(n.domElement.releasePointerCapture(m.pointerId),n.domElement.removeEventListener("pointermove",Kt),n.domElement.removeEventListener("pointerup",Zt)),n.dispatchEvent(ar),s=i.NONE}function Nn(m){$n(m)}function $i(m){let M;switch(m.button){case 0:M=n.mouseButtons.LEFT;break;case 1:M=n.mouseButtons.MIDDLE;break;case 2:M=n.mouseButtons.RIGHT;break;default:M=-1}switch(M){case Ve.DOLLY:if(n.enableZoom===!1)return;z(m),s=i.DOLLY;break;case Ve.ROTATE:if(m.ctrlKey||m.metaKey||m.shiftKey){if(n.enablePan===!1)return;G(m),s=i.PAN}else{if(n.enableRotate===!1)return;R(m),s=i.ROTATE}break;case Ve.PAN:if(m.ctrlKey||m.metaKey||m.shiftKey){if(n.enableRotate===!1)return;R(m),s=i.ROTATE}else{if(n.enablePan===!1)return;G(m),s=i.PAN}break;default:s=i.NONE}s!==i.NONE&&n.dispatchEvent(en)}function Xi(m){switch(s){case i.ROTATE:if(n.enableRotate===!1)return;Z(m);break;case i.DOLLY:if(n.enableZoom===!1)return;te(m);break;case i.PAN:if(n.enablePan===!1)return;W(m);break}}function Vn(m){n.enabled===!1||n.enableZoom===!1||s!==i.NONE||(m.preventDefault(),n.dispatchEvent(en),se(m),n.dispatchEvent(ar))}function Hn(m){n.enabled===!1||n.enablePan===!1||ce(m)}function Wi(m){switch(Xn(m),E.length){case 1:switch(n.touches.ONE){case He.ROTATE:if(n.enableRotate===!1)return;Y(),s=i.TOUCH_ROTATE;break;case He.PAN:if(n.enablePan===!1)return;H(),s=i.TOUCH_PAN;break;default:s=i.NONE}break;case 2:switch(n.touches.TWO){case He.DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;_e(),s=i.TOUCH_DOLLY_PAN;break;case He.DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;Se(),s=i.TOUCH_DOLLY_ROTATE;break;default:s=i.NONE}break;default:s=i.NONE}s!==i.NONE&&n.dispatchEvent(en)}function Yi(m){switch(Xn(m),s){case i.TOUCH_ROTATE:if(n.enableRotate===!1)return;bt(m),n.update();break;case i.TOUCH_PAN:if(n.enablePan===!1)return;ot(m),n.update();break;case i.TOUCH_DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;Pt(m),n.update();break;case i.TOUCH_DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;Gi(m),n.update();break;default:s=i.NONE}}function Gn(m){n.enabled!==!1&&m.preventDefault()}function Ki(m){E.push(m)}function $n(m){delete T[m.pointerId];for(let M=0;M<E.length;M++)if(E[M].pointerId==m.pointerId){E.splice(M,1);return}}function Xn(m){let M=T[m.pointerId];M===void 0&&(M=new q,T[m.pointerId]=M),M.set(m.pageX,m.pageY)}function qt(m){const M=m.pointerId===E[0].pointerId?E[1]:E[0];return T[M.pointerId]}n.domElement.addEventListener("contextmenu",Gn),n.domElement.addEventListener("pointerdown",Ue),n.domElement.addEventListener("pointercancel",Nn),n.domElement.addEventListener("wheel",Vn,{passive:!1}),this.update()}}const Ur="fbx",Nr="animations",Us="img/textures/matcap",Gt="data";var or={},un=function(r){return URL.createObjectURL(new Blob([r],{type:"text/javascript"}))},Vr=function(r){return new Worker(r)};try{URL.revokeObjectURL(un(""))}catch{un=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)},Vr=function(e){return new Worker(e,{type:"module"})}}var Ns=function(r,e,t,n,i){var s=Vr(or[e]||(or[e]=un(r)));return s.onerror=function(a){return i(a.error,null)},s.onmessage=function(a){return i(null,a.data)},s.postMessage(t,n),s},C=Uint8Array,X=Uint16Array,Ae=Uint32Array,Je=new C([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),et=new C([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),pt=new C([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Hr=function(r,e){for(var t=new X(31),n=0;n<31;++n)t[n]=e+=1<<r[n-1];for(var i=new Ae(t[30]),n=1;n<30;++n)for(var s=t[n];s<t[n+1];++s)i[s]=s-t[n]<<5|n;return[t,i]},Gr=Hr(Je,2),Tn=Gr[0],_t=Gr[1];Tn[28]=258,_t[258]=28;var $r=Hr(et,0),Xr=$r[0],fn=$r[1],dt=new X(32768);for(var _=0;_<32768;++_){var Ce=(_&43690)>>>1|(_&21845)<<1;Ce=(Ce&52428)>>>2|(Ce&13107)<<2,Ce=(Ce&61680)>>>4|(Ce&3855)<<4,dt[_]=((Ce&65280)>>>8|(Ce&255)<<8)>>>1}var he=function(r,e,t){for(var n=r.length,i=0,s=new X(e);i<n;++i)++s[r[i]-1];var a=new X(e);for(i=0;i<e;++i)a[i]=a[i-1]+s[i-1]<<1;var l;if(t){l=new X(1<<e);var o=15-e;for(i=0;i<n;++i)if(r[i])for(var c=i<<4|r[i],u=e-r[i],f=a[r[i]-1]++<<u,h=f|(1<<u)-1;f<=h;++f)l[dt[f]>>>o]=c}else for(l=new X(n),i=0;i<n;++i)r[i]&&(l[i]=dt[a[r[i]-1]++]>>>15-r[i]);return l},Me=new C(288);for(var _=0;_<144;++_)Me[_]=8;for(var _=144;_<256;++_)Me[_]=9;for(var _=256;_<280;++_)Me[_]=7;for(var _=280;_<288;++_)Me[_]=8;var Ze=new C(32);for(var _=0;_<32;++_)Ze[_]=5;var Wr=he(Me,9,0),Yr=he(Me,9,1),Kr=he(Ze,5,0),Zr=he(Ze,5,1),It=function(r){for(var e=r[0],t=1;t<r.length;++t)r[t]>e&&(e=r[t]);return e},ue=function(r,e,t){var n=e/8|0;return(r[n]|r[n+1]<<8)>>(e&7)&t},Dt=function(r,e){var t=e/8|0;return(r[t]|r[t+1]<<8|r[t+2]<<16)>>(e&7)},vt=function(r){return(r/8|0)+(r&7&&1)},pe=function(r,e,t){(e==null||e<0)&&(e=0),(t==null||t>r.length)&&(t=r.length);var n=new(r instanceof X?X:r instanceof Ae?Ae:C)(t-e);return n.set(r.subarray(e,t)),n},yt=function(r,e,t){var n=r.length;if(!n||t&&!t.l&&n<5)return e||new C(0);var i=!e||t,s=!t||t.i;t||(t={}),e||(e=new C(n*3));var a=function(Re){var _e=e.length;if(Re>_e){var Se=new C(Math.max(_e*2,Re));Se.set(e),e=Se}},l=t.f||0,o=t.p||0,c=t.b||0,u=t.l,f=t.d,h=t.m,p=t.n,d=n*8;do{if(!u){t.f=l=ue(r,o,1);var v=ue(r,o+1,3);if(o+=3,v)if(v==1)u=Yr,f=Zr,h=9,p=5;else if(v==2){var g=ue(r,o,31)+257,b=ue(r,o+10,15)+4,E=g+ue(r,o+5,31)+1;o+=14;for(var T=new C(E),A=new C(19),P=0;P<b;++P)A[pt[P]]=ue(r,o+P*3,7);o+=b*3;for(var O=It(A),L=(1<<O)-1,V=he(A,O,1),P=0;P<E;){var k=V[ue(r,o,L)];o+=k&15;var y=k>>>4;if(y<16)T[P++]=y;else{var I=0,D=0;for(y==16?(D=3+ue(r,o,3),o+=2,I=T[P-1]):y==17?(D=3+ue(r,o,7),o+=3):y==18&&(D=11+ue(r,o,127),o+=7);D--;)T[P++]=I}}var B=T.subarray(0,g),R=T.subarray(g);h=It(B),p=It(R),u=he(B,h,1),f=he(R,p,1)}else throw"invalid block type";else{var y=vt(o)+4,x=r[y-4]|r[y-3]<<8,w=y+x;if(w>n){if(s)throw"unexpected EOF";break}i&&a(c+x),e.set(r.subarray(y,w),c),t.b=c+=x,t.p=o=w*8;continue}if(o>d){if(s)throw"unexpected EOF";break}}i&&a(c+131072);for(var z=(1<<h)-1,G=(1<<p)-1,Z=o;;Z=o){var I=u[Dt(r,o)&z],te=I>>>4;if(o+=I&15,o>d){if(s)throw"unexpected EOF";break}if(!I)throw"invalid length/literal";if(te<256)e[c++]=te;else if(te==256){Z=o,u=null;break}else{var W=te-254;if(te>264){var P=te-257,se=Je[P];W=ue(r,o,(1<<se)-1)+Tn[P],o+=se}var ce=f[Dt(r,o)&G],Y=ce>>>4;if(!ce)throw"invalid distance";o+=ce&15;var R=Xr[Y];if(Y>3){var se=et[Y];R+=Dt(r,o)&(1<<se)-1,o+=se}if(o>d){if(s)throw"unexpected EOF";break}i&&a(c+131072);for(var H=c+W;c<H;c+=4)e[c]=e[c-R],e[c+1]=e[c+1-R],e[c+2]=e[c+2-R],e[c+3]=e[c+3-R];c=H}}t.l=u,t.p=Z,t.b=c,u&&(l=1,t.m=h,t.d=f,t.n=p)}while(!l);return c==e.length?e:pe(e,0,c)},ye=function(r,e,t){t<<=e&7;var n=e/8|0;r[n]|=t,r[n+1]|=t>>>8},Xe=function(r,e,t){t<<=e&7;var n=e/8|0;r[n]|=t,r[n+1]|=t>>>8,r[n+2]|=t>>>16},Ot=function(r,e){for(var t=[],n=0;n<r.length;++n)r[n]&&t.push({s:n,f:r[n]});var i=t.length,s=t.slice();if(!i)return[Pe,0];if(i==1){var a=new C(t[0].s+1);return a[t[0].s]=1,[a,1]}t.sort(function(E,T){return E.f-T.f}),t.push({s:-1,f:25001});var l=t[0],o=t[1],c=0,u=1,f=2;for(t[0]={s:-1,f:l.f+o.f,l,r:o};u!=i-1;)l=t[t[c].f<t[f].f?c++:f++],o=t[c!=u&&t[c].f<t[f].f?c++:f++],t[u++]={s:-1,f:l.f+o.f,l,r:o};for(var h=s[0].s,n=1;n<i;++n)s[n].s>h&&(h=s[n].s);var p=new X(h+1),d=Bt(t[u-1],p,0);if(d>e){var n=0,v=0,y=d-e,x=1<<y;for(s.sort(function(T,A){return p[A.s]-p[T.s]||T.f-A.f});n<i;++n){var w=s[n].s;if(p[w]>e)v+=x-(1<<d-p[w]),p[w]=e;else break}for(v>>>=y;v>0;){var g=s[n].s;p[g]<e?v-=1<<e-p[g]++-1:++n}for(;n>=0&&v;--n){var b=s[n].s;p[b]==e&&(--p[b],++v)}d=e}return[new C(p),d]},Bt=function(r,e,t){return r.s==-1?Math.max(Bt(r.l,e,t+1),Bt(r.r,e,t+1)):e[r.s]=t},hn=function(r){for(var e=r.length;e&&!r[--e];);for(var t=new X(++e),n=0,i=r[0],s=1,a=function(o){t[n++]=o},l=1;l<=e;++l)if(r[l]==i&&l!=e)++s;else{if(!i&&s>2){for(;s>138;s-=138)a(32754);s>2&&(a(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(a(i),--s;s>6;s-=6)a(8304);s>2&&(a(s-3<<5|8208),s=0)}for(;s--;)a(i);s=1,i=r[l]}return[t.subarray(0,n),e]},We=function(r,e){for(var t=0,n=0;n<e.length;++n)t+=r[n]*e[n];return t},ft=function(r,e,t){var n=t.length,i=vt(e+2);r[i]=n&255,r[i+1]=n>>>8,r[i+2]=r[i]^255,r[i+3]=r[i+1]^255;for(var s=0;s<n;++s)r[i+s+4]=t[s];return(i+4+n)*8},pn=function(r,e,t,n,i,s,a,l,o,c,u){ye(e,u++,t),++i[256];for(var f=Ot(i,15),h=f[0],p=f[1],d=Ot(s,15),v=d[0],y=d[1],x=hn(h),w=x[0],g=x[1],b=hn(v),E=b[0],T=b[1],A=new X(19),P=0;P<w.length;++P)A[w[P]&31]++;for(var P=0;P<E.length;++P)A[E[P]&31]++;for(var O=Ot(A,7),L=O[0],V=O[1],k=19;k>4&&!L[pt[k-1]];--k);var I=c+5<<3,D=We(i,Me)+We(s,Ze)+a,B=We(i,h)+We(s,v)+a+14+3*k+We(A,L)+(2*A[16]+3*A[17]+7*A[18]);if(I<=D&&I<=B)return ft(e,u,r.subarray(o,o+c));var R,z,G,Z;if(ye(e,u,1+(B<D)),u+=2,B<D){R=he(h,p,0),z=h,G=he(v,y,0),Z=v;var te=he(L,V,0);ye(e,u,g-257),ye(e,u+5,T-1),ye(e,u+10,k-4),u+=14;for(var P=0;P<k;++P)ye(e,u+3*P,L[pt[P]]);u+=3*k;for(var W=[w,E],se=0;se<2;++se)for(var ce=W[se],P=0;P<ce.length;++P){var Y=ce[P]&31;ye(e,u,te[Y]),u+=L[Y],Y>15&&(ye(e,u,ce[P]>>>5&127),u+=ce[P]>>>12)}}else R=Wr,z=Me,G=Kr,Z=Ze;for(var P=0;P<l;++P)if(n[P]>255){var Y=n[P]>>>18&31;Xe(e,u,R[Y+257]),u+=z[Y+257],Y>7&&(ye(e,u,n[P]>>>23&31),u+=Je[Y]);var H=n[P]&31;Xe(e,u,G[H]),u+=Z[H],H>3&&(Xe(e,u,n[P]>>>5&8191),u+=et[H])}else Xe(e,u,R[n[P]]),u+=z[n[P]];return Xe(e,u,R[256]),u+z[256]},qr=new Ae([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Pe=new C(0),Qr=function(r,e,t,n,i,s){var a=r.length,l=new C(n+a+5*(1+Math.ceil(a/7e3))+i),o=l.subarray(n,l.length-i),c=0;if(!e||a<8)for(var u=0;u<=a;u+=65535){var f=u+65535;f<a?c=ft(o,c,r.subarray(u,f)):(o[u]=s,c=ft(o,c,r.subarray(u,a)))}else{for(var h=qr[e-1],p=h>>>13,d=h&8191,v=(1<<t)-1,y=new X(32768),x=new X(v+1),w=Math.ceil(t/3),g=2*w,b=function(Ue){return(r[Ue]^r[Ue+1]<<w^r[Ue+2]<<g)&v},E=new Ae(25e3),T=new X(288),A=new X(32),P=0,O=0,u=0,L=0,V=0,k=0;u<a;++u){var I=b(u),D=u&32767,B=x[I];if(y[D]=B,x[I]=D,V<=u){var R=a-u;if((P>7e3||L>24576)&&R>423){c=pn(r,o,0,E,T,A,O,L,k,u-k,c),L=P=O=0,k=u;for(var z=0;z<286;++z)T[z]=0;for(var z=0;z<30;++z)A[z]=0}var G=2,Z=0,te=d,W=D-B&32767;if(R>2&&I==b(u-W))for(var se=Math.min(p,R)-1,ce=Math.min(32767,u),Y=Math.min(258,R);W<=ce&&--te&&D!=B;){if(r[u+G]==r[u+G-W]){for(var H=0;H<Y&&r[u+H]==r[u+H-W];++H);if(H>G){if(G=H,Z=W,H>se)break;for(var Re=Math.min(W,H-2),_e=0,z=0;z<Re;++z){var Se=u-W+z+32768&32767,bt=y[Se],ot=Se-bt+32768&32767;ot>_e&&(_e=ot,B=Se)}}}D=B,B=y[D],W+=D-B+32768&32767}if(Z){E[L++]=268435456|_t[G]<<18|fn[Z];var ct=_t[G]&31,Pt=fn[Z]&31;O+=Je[ct]+et[Pt],++T[257+ct],++A[Pt],V=u+G,++P}else E[L++]=r[u],++T[r[u]]}}c=pn(r,o,s,E,T,A,O,L,k,u-k,c),!s&&c&7&&(c=ft(o,c+1,Pe))}return pe(l,0,n+vt(c)+i)},Jr=function(){for(var r=new Ae(256),e=0;e<256;++e){for(var t=e,n=9;--n;)t=(t&1&&3988292384)^t>>>1;r[e]=t}return r}(),tt=function(){var r=-1;return{p:function(e){for(var t=r,n=0;n<e.length;++n)t=Jr[t&255^e[n]]^t>>>8;r=t},d:function(){return~r}}},An=function(){var r=1,e=0;return{p:function(t){for(var n=r,i=e,s=t.length,a=0;a!=s;){for(var l=Math.min(a+2655,s);a<l;++a)i+=n+=t[a];n=(n&65535)+15*(n>>16),i=(i&65535)+15*(i>>16)}r=n,e=i},d:function(){return r%=65521,e%=65521,(r&255)<<24|r>>>8<<16|(e&255)<<8|e>>>8}}},je=function(r,e,t,n,i){return Qr(r,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(r.length)))*1.5):12+e.mem,t,n,!i)},wt=function(r,e){var t={};for(var n in r)t[n]=r[n];for(var n in e)t[n]=e[n];return t},cr=function(r,e,t){for(var n=r(),i=r.toString(),s=i.slice(i.indexOf("[")+1,i.lastIndexOf("]")).replace(/ /g,"").split(","),a=0;a<n.length;++a){var l=n[a],o=s[a];if(typeof l=="function"){e+=";"+o+"=";var c=l.toString();if(l.prototype)if(c.indexOf("[native code]")!=-1){var u=c.indexOf(" ",8)+1;e+=c.slice(u,c.indexOf("(",u))}else{e+=c;for(var f in l.prototype)e+=";"+o+".prototype."+f+"="+l.prototype[f].toString()}else e+=c}else t[o]=l}return[e,t]},At=[],Vs=function(r){var e=[];for(var t in r)(r[t]instanceof C||r[t]instanceof X||r[t]instanceof Ae)&&e.push((r[t]=new r[t].constructor(r[t])).buffer);return e},ei=function(r,e,t,n){var i;if(!At[t]){for(var s="",a={},l=r.length-1,o=0;o<l;++o)i=cr(r[o],s,a),s=i[0],a=i[1];At[t]=cr(r[l],s,a)}var c=wt({},At[t][1]);return Ns(At[t][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",t,c,Vs(c),n)},nt=function(){return[C,X,Ae,Je,et,pt,Tn,Xr,Yr,Zr,dt,he,It,ue,Dt,vt,pe,yt,at,Fe,Mn]},rt=function(){return[C,X,Ae,Je,et,pt,_t,fn,Wr,Me,Kr,Ze,dt,qr,Pe,he,ye,Xe,Ot,Bt,hn,We,ft,pn,vt,pe,Qr,je,xt,Fe]},ti=function(){return[Ln,Cn,F,tt,Jr]},ni=function(){return[Sn,si]},ri=function(){return[In,F,An]},ii=function(){return[ai]},Fe=function(r){return postMessage(r,[r.buffer])},Mn=function(r){return r&&r.size&&new C(r.size)},it=function(r,e,t,n,i,s){var a=ei(t,n,i,function(l,o){a.terminate(),s(l,o)});return a.postMessage([r,e],e.consume?[r.buffer]:[]),function(){a.terminate()}},de=function(r){return r.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(e){return r.push(e.data[0],e.data[1])}},st=function(r,e,t,n,i){var s,a=ei(r,n,i,function(l,o){l?(a.terminate(),e.ondata.call(e,l)):(o[1]&&a.terminate(),e.ondata.call(e,l,o[0],o[1]))});a.postMessage(t),e.push=function(l,o){if(s)throw"stream finished";if(!e.ondata)throw"no stream handler";a.postMessage([l,s=o],[l.buffer])},e.terminate=function(){a.terminate()}},ee=function(r,e){return r[e]|r[e+1]<<8},N=function(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16|r[e+3]<<24)>>>0},tn=function(r,e){return N(r,e)+N(r,e+4)*4294967296},F=function(r,e,t){for(;t;++e)r[e]=t,t>>>=8},Ln=function(r,e){var t=e.filename;if(r[0]=31,r[1]=139,r[2]=8,r[8]=e.level<2?4:e.level==9?2:0,r[9]=3,e.mtime!=0&&F(r,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),t){r[3]=8;for(var n=0;n<=t.length;++n)r[n+10]=t.charCodeAt(n)}},Sn=function(r){if(r[0]!=31||r[1]!=139||r[2]!=8)throw"invalid gzip data";var e=r[3],t=10;e&4&&(t+=r[10]|(r[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!r[t++]);return t+(e&2)},si=function(r){var e=r.length;return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0},Cn=function(r){return 10+(r.filename&&r.filename.length+1||0)},In=function(r,e){var t=e.level,n=t==0?0:t<6?1:t==9?3:2;r[0]=120,r[1]=n<<6|(n?32-2*n:1)},ai=function(r){if((r[0]&15)!=8||r[0]>>>4>7||(r[0]<<8|r[1])%31)throw"invalid zlib data";if(r[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function Dn(r,e){return!e&&typeof r=="function"&&(e=r,r={}),this.ondata=e,r}var xe=function(){function r(e,t){!t&&typeof e=="function"&&(t=e,e={}),this.ondata=t,this.o=e||{}}return r.prototype.p=function(e,t){this.ondata(je(e,this.o,0,0,!t),t)},r.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},r}(),oi=function(){function r(e,t){st([rt,function(){return[de,xe]}],this,Dn.call(this,e,t),function(n){var i=new xe(n.data);onmessage=de(i)},6)}return r}();function ci(r,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return it(r,e,[rt],function(n){return Fe(xt(n.data[0],n.data[1]))},0,t)}function xt(r,e){return je(r,e||{},0,0)}var ie=function(){function r(e){this.s={},this.p=new C(0),this.ondata=e}return r.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,n=new C(t+e.length);n.set(this.p),n.set(e,t),this.p=n},r.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,n=yt(this.p,this.o,this.s);this.ondata(pe(n,t,this.s.b),this.d),this.o=pe(n,this.s.b-32768),this.s.b=this.o.length,this.p=pe(this.p,this.s.p/8|0),this.s.p&=7},r.prototype.push=function(e,t){this.e(e),this.c(t)},r}(),On=function(){function r(e){this.ondata=e,st([nt,function(){return[de,ie]}],this,0,function(){var t=new ie;onmessage=de(t)},7)}return r}();function kn(r,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return it(r,e,[nt],function(n){return Fe(at(n.data[0],Mn(n.data[1])))},1,t)}function at(r,e){return yt(r,e)}var zt=function(){function r(e,t){this.c=tt(),this.l=0,this.v=1,xe.call(this,e,t)}return r.prototype.push=function(e,t){xe.prototype.push.call(this,e,t)},r.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var n=je(e,this.o,this.v&&Cn(this.o),t&&8,!t);this.v&&(Ln(n,this.o),this.v=0),t&&(F(n,n.length-8,this.c.d()),F(n,n.length-4,this.l)),this.ondata(n,t)},r}(),lr=function(){function r(e,t){st([rt,ti,function(){return[de,xe,zt]}],this,Dn.call(this,e,t),function(n){var i=new zt(n.data);onmessage=de(i)},8)}return r}();function ur(r,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return it(r,e,[rt,ti,function(){return[jt]}],function(n){return Fe(jt(n.data[0],n.data[1]))},2,t)}function jt(r,e){e||(e={});var t=tt(),n=r.length;t.p(r);var i=je(r,e,Cn(e),8),s=i.length;return Ln(i,e),F(i,s-8,t.d()),F(i,s-4,n),i}var Ut=function(){function r(e){this.v=1,ie.call(this,e)}return r.prototype.push=function(e,t){if(ie.prototype.e.call(this,e),this.v){var n=this.p.length>3?Sn(this.p):4;if(n>=this.p.length&&!t)return;this.p=this.p.subarray(n),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}ie.prototype.c.call(this,t)},r}(),li=function(){function r(e){this.ondata=e,st([nt,ni,function(){return[de,ie,Ut]}],this,0,function(){var t=new Ut;onmessage=de(t)},9)}return r}();function ui(r,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return it(r,e,[nt,ni,function(){return[Nt]}],function(n){return Fe(Nt(n.data[0]))},3,t)}function Nt(r,e){return yt(r.subarray(Sn(r),-8),e||new C(si(r)))}var dn=function(){function r(e,t){this.c=An(),this.v=1,xe.call(this,e,t)}return r.prototype.push=function(e,t){xe.prototype.push.call(this,e,t)},r.prototype.p=function(e,t){this.c.p(e);var n=je(e,this.o,this.v&&2,t&&4,!t);this.v&&(In(n,this.o),this.v=0),t&&F(n,n.length-4,this.c.d()),this.ondata(n,t)},r}(),Hs=function(){function r(e,t){st([rt,ri,function(){return[de,xe,dn]}],this,Dn.call(this,e,t),function(n){var i=new dn(n.data);onmessage=de(i)},10)}return r}();function Gs(r,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return it(r,e,[rt,ri,function(){return[mn]}],function(n){return Fe(mn(n.data[0],n.data[1]))},4,t)}function mn(r,e){e||(e={});var t=An();t.p(r);var n=je(r,e,2,4);return In(n,e),F(n,n.length-4,t.d()),n}var Vt=function(){function r(e){this.v=1,ie.call(this,e)}return r.prototype.push=function(e,t){if(ie.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}ie.prototype.c.call(this,t)},r}(),fi=function(){function r(e){this.ondata=e,st([nt,ii,function(){return[de,ie,Vt]}],this,0,function(){var t=new Vt;onmessage=de(t)},11)}return r}();function hi(r,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return it(r,e,[nt,ii,function(){return[mt]}],function(n){return Fe(mt(n.data[0],Mn(n.data[1])))},5,t)}function mt(r,e){return yt((ai(r),r.subarray(2,-4)),e)}var pi=function(){function r(e){this.G=Ut,this.I=ie,this.Z=Vt,this.ondata=e}return r.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var n=new C(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var i=this,s=function(){i.ondata.apply(i,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(s):(this.p[0]&15)!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(s):new this.Z(s),this.s.push(this.p,t),this.p=null}}},r}(),$s=function(){function r(e){this.G=li,this.I=On,this.Z=fi,this.ondata=e}return r.prototype.push=function(e,t){pi.prototype.push.call(this,e,t)},r}();function Xs(r,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return r[0]==31&&r[1]==139&&r[2]==8?ui(r,e,t):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?kn(r,e,t):hi(r,e,t)}function Ws(r,e){return r[0]==31&&r[1]==139&&r[2]==8?Nt(r,e):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?at(r,e):mt(r,e)}var Fn=function(r,e,t,n){for(var i in r){var s=r[i],a=e+i;s instanceof C?t[a]=[s,n]:Array.isArray(s)?t[a]=[s[0],wt(n,s[1])]:Fn(s,a+"/",t,n)}},fr=typeof TextEncoder<"u"&&new TextEncoder,gn=typeof TextDecoder<"u"&&new TextDecoder,di=0;try{gn.decode(Pe,{stream:!0}),di=1}catch{}var mi=function(r){for(var e="",t=0;;){var n=r[t++],i=(n>127)+(n>223)+(n>239);if(t+i>r.length)return[e,pe(r,t-1)];i?i==3?(n=((n&15)<<18|(r[t++]&63)<<12|(r[t++]&63)<<6|r[t++]&63)-65536,e+=String.fromCharCode(55296|n>>10,56320|n&1023)):i&1?e+=String.fromCharCode((n&31)<<6|r[t++]&63):e+=String.fromCharCode((n&15)<<12|(r[t++]&63)<<6|r[t++]&63):e+=String.fromCharCode(n)}},Ys=function(){function r(e){this.ondata=e,di?this.t=new TextDecoder:this.p=Pe}return r.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t=!!t,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),t),t){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}return}if(!this.p)throw"stream finished";var n=new C(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length);var i=mi(n),s=i[0],a=i[1];if(t){if(a.length)throw"invalid utf-8 data";this.p=null}else this.p=a;this.ondata(s,t)},r}(),Ks=function(){function r(e){this.ondata=e}return r.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(ke(e),this.d=t||!1)},r}();function ke(r,e){if(e){for(var t=new C(r.length),n=0;n<r.length;++n)t[n]=r.charCodeAt(n);return t}if(fr)return fr.encode(r);for(var i=r.length,s=new C(r.length+(r.length>>1)),a=0,l=function(u){s[a++]=u},n=0;n<i;++n){if(a+5>s.length){var o=new C(a+8+(i-n<<1));o.set(s),s=o}var c=r.charCodeAt(n);c<128||e?l(c):c<2048?(l(192|c>>6),l(128|c&63)):c>55295&&c<57344?(c=65536+(c&1023<<10)|r.charCodeAt(++n)&1023,l(240|c>>18),l(128|c>>12&63),l(128|c>>6&63),l(128|c&63)):(l(224|c>>12),l(128|c>>6&63),l(128|c&63))}return pe(s,0,a)}function Rn(r,e){if(e){for(var t="",n=0;n<r.length;n+=16384)t+=String.fromCharCode.apply(null,r.subarray(n,n+16384));return t}else{if(gn)return gn.decode(r);var i=mi(r),s=i[0],a=i[1];if(a.length)throw"invalid utf-8 data";return s}}var gi=function(r){return r==1?3:r<6?2:r==9?1:0},vi=function(r,e){return e+30+ee(r,e+26)+ee(r,e+28)},yi=function(r,e,t){var n=ee(r,e+28),i=Rn(r.subarray(e+46,e+46+n),!(ee(r,e+8)&2048)),s=e+46+n,a=N(r,e+20),l=t&&a==4294967295?wi(r,s):[a,N(r,e+24),N(r,e+42)],o=l[0],c=l[1],u=l[2];return[ee(r,e+10),o,c,i,s+ee(r,e+30)+ee(r,e+32),u]},wi=function(r,e){for(;ee(r,e)!=1;e+=4+ee(r,e+2));return[tn(r,e+12),tn(r,e+4),tn(r,e+20)]},Oe=function(r){var e=0;if(r)for(var t in r){var n=r[t].length;if(n>65535)throw"extra field too long";e+=n+4}return e},qe=function(r,e,t,n,i,s,a,l){var o=n.length,c=t.extra,u=l&&l.length,f=Oe(c);F(r,e,a!=null?33639248:67324752),e+=4,a!=null&&(r[e++]=20,r[e++]=t.os),r[e]=20,e+=2,r[e++]=t.flag<<1|(s==null&&8),r[e++]=i&&8,r[e++]=t.compression&255,r[e++]=t.compression>>8;var h=new Date(t.mtime==null?Date.now():t.mtime),p=h.getFullYear()-1980;if(p<0||p>119)throw"date not in range 1980-2099";if(F(r,e,p<<25|h.getMonth()+1<<21|h.getDate()<<16|h.getHours()<<11|h.getMinutes()<<5|h.getSeconds()>>>1),e+=4,s!=null&&(F(r,e,t.crc),F(r,e+4,s),F(r,e+8,t.size)),F(r,e+12,o),F(r,e+14,f),e+=16,a!=null&&(F(r,e,u),F(r,e+6,t.attrs),F(r,e+10,a),e+=14),r.set(n,e),e+=o,f)for(var d in c){var v=c[d],y=v.length;F(r,e,+d),F(r,e+2,y),r.set(v,e+4),e+=4+y}return u&&(r.set(l,e),e+=u),e},_n=function(r,e,t,n,i){F(r,e,101010256),F(r,e+8,t),F(r,e+10,t),F(r,e+12,n),F(r,e+16,i)},gt=function(){function r(e){this.filename=e,this.c=tt(),this.size=0,this.compression=0}return r.prototype.process=function(e,t){this.ondata(null,e,t)},r.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},r}(),Zs=function(){function r(e,t){var n=this;t||(t={}),gt.call(this,e),this.d=new xe(t,function(i,s){n.ondata(null,i,s)}),this.compression=8,this.flag=gi(t.level)}return r.prototype.process=function(e,t){try{this.d.push(e,t)}catch(n){this.ondata(n,null,t)}},r.prototype.push=function(e,t){gt.prototype.push.call(this,e,t)},r}(),qs=function(){function r(e,t){var n=this;t||(t={}),gt.call(this,e),this.d=new oi(t,function(i,s,a){n.ondata(i,s,a)}),this.compression=8,this.flag=gi(t.level),this.terminate=this.d.terminate}return r.prototype.process=function(e,t){this.d.push(e,t)},r.prototype.push=function(e,t){gt.prototype.push.call(this,e,t)},r}(),Qs=function(){function r(e){this.ondata=e,this.u=[],this.d=1}return r.prototype.add=function(e){var t=this;if(this.d&2)throw"stream finished";var n=ke(e.filename),i=n.length,s=e.comment,a=s&&ke(s),l=i!=e.filename.length||a&&s.length!=a.length,o=i+Oe(e.extra)+30;if(i>65535)throw"filename too long";var c=new C(o);qe(c,0,e,n,l);var u=[c],f=function(){for(var y=0,x=u;y<x.length;y++){var w=x[y];t.ondata(null,w,!1)}u=[]},h=this.d;this.d=0;var p=this.u.length,d=wt(e,{f:n,u:l,o:a,t:function(){e.terminate&&e.terminate()},r:function(){if(f(),h){var y=t.u[p+1];y?y.r():t.d=1}h=1}}),v=0;e.ondata=function(y,x,w){if(y)t.ondata(y,x,w),t.terminate();else if(v+=x.length,u.push(x),w){var g=new C(16);F(g,0,134695760),F(g,4,e.crc),F(g,8,v),F(g,12,e.size),u.push(g),d.c=v,d.b=o+v+16,d.crc=e.crc,d.size=e.size,h&&d.r(),h=1}else h&&f()},this.u.push(d)},r.prototype.end=function(){var e=this;if(this.d&2)throw this.d&1?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){e.d&1&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},r.prototype.e=function(){for(var e=0,t=0,n=0,i=0,s=this.u;i<s.length;i++){var a=s[i];n+=46+a.f.length+Oe(a.extra)+(a.o?a.o.length:0)}for(var l=new C(n+22),o=0,c=this.u;o<c.length;o++){var a=c[o];qe(l,e,a,a.f,a.u,a.c,t,a.o),e+=46+a.f.length+Oe(a.extra)+(a.o?a.o.length:0),t+=a.b}_n(l,e,this.u.length,n,t),this.ondata(null,l,!0),this.d=2},r.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++){var n=t[e];n.t()}this.d=2},r}();function Js(r,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";var n={};Fn(r,"",n,e);var i=Object.keys(n),s=i.length,a=0,l=0,o=s,c=new Array(s),u=[],f=function(){for(var v=0;v<u.length;++v)u[v]()},h=function(){var v=new C(l+22),y=a,x=l-a;l=0;for(var w=0;w<o;++w){var g=c[w];try{var b=g.c.length;qe(v,l,g,g.f,g.u,b);var E=30+g.f.length+Oe(g.extra),T=l+E;v.set(g.c,T),qe(v,a,g,g.f,g.u,b,l,g.m),a+=16+E+(g.m?g.m.length:0),l=T+b}catch(A){return t(A,null)}}_n(v,a,c.length,x,y),t(null,v)};s||h();for(var p=function(v){var y=i[v],x=n[y],w=x[0],g=x[1],b=tt(),E=w.length;b.p(w);var T=ke(y),A=T.length,P=g.comment,O=P&&ke(P),L=O&&O.length,V=Oe(g.extra),k=g.level==0?0:8,I=function(D,B){if(D)f(),t(D,null);else{var R=B.length;c[v]=wt(g,{size:E,crc:b.d(),c:B,f:T,m:O,u:A!=y.length||O&&P.length!=L,compression:k}),a+=30+A+V+R,l+=76+2*(A+V)+(L||0)+R,--s||h()}};if(A>65535&&I("filename too long",null),!k)I(null,w);else if(E<16e4)try{I(null,xt(w,g))}catch(D){I(D,null)}else u.push(ci(w,g,I))},d=0;d<o;++d)p(d);return f}function ea(r,e){e||(e={});var t={},n=[];Fn(r,"",t,e);var i=0,s=0;for(var a in t){var l=t[a],o=l[0],c=l[1],u=c.level==0?0:8,f=ke(a),h=f.length,p=c.comment,d=p&&ke(p),v=d&&d.length,y=Oe(c.extra);if(h>65535)throw"filename too long";var x=u?xt(o,c):o,w=x.length,g=tt();g.p(o),n.push(wt(c,{size:o.length,crc:g.d(),c:x,f,m:d,u:h!=a.length||d&&p.length!=v,o:i,compression:u})),i+=30+h+y+w,s+=76+2*(h+y)+(v||0)+w}for(var b=new C(s+22),E=i,T=s-i,A=0;A<n.length;++A){var f=n[A];qe(b,f.o,f,f.f,f.u,f.c.length);var P=30+f.f.length+Oe(f.extra);b.set(f.c,f.o+P),qe(b,i,f,f.f,f.u,f.c.length,f.o,f.m),i+=16+P+(f.m?f.m.length:0)}return _n(b,i,n.length,T,E),b}var xi=function(){function r(){}return r.prototype.push=function(e,t){this.ondata(null,e,t)},r.compression=0,r}(),ta=function(){function r(){var e=this;this.i=new ie(function(t,n){e.ondata(null,t,n)})}return r.prototype.push=function(e,t){try{this.i.push(e,t)}catch(n){this.ondata(n,e,t)}},r.compression=8,r}(),na=function(){function r(e,t){var n=this;t<32e4?this.i=new ie(function(i,s){n.ondata(null,i,s)}):(this.i=new On(function(i,s,a){n.ondata(i,s,a)}),this.terminate=this.i.terminate)}return r.prototype.push=function(e,t){this.i.terminate&&(e=pe(e,0)),this.i.push(e,t)},r.compression=8,r}(),ra=function(){function r(e){this.onfile=e,this.k=[],this.o={0:xi},this.p=Pe}return r.prototype.push=function(e,t){var n=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var i=Math.min(this.c,e.length),s=e.subarray(0,i);if(this.c-=i,this.d?this.d.push(s,!this.c):this.k[0].push(s),e=e.subarray(i),e.length)return this.push(e,t)}else{var a=0,l=0,o=void 0,c=void 0;this.p.length?e.length?(c=new C(this.p.length+e.length),c.set(this.p),c.set(e,this.p.length)):c=this.p:c=e;for(var u=c.length,f=this.c,h=f&&this.d,p=function(){var x,w=N(c,l);if(w==67324752){a=1,o=l,d.d=null,d.c=0;var g=ee(c,l+6),b=ee(c,l+8),E=g&2048,T=g&8,A=ee(c,l+26),P=ee(c,l+28);if(u>l+30+A+P){var O=[];d.k.unshift(O),a=2;var L=N(c,l+18),V=N(c,l+22),k=Rn(c.subarray(l+30,l+=30+A),!E);L==4294967295?(x=T?[-2]:wi(c,l),L=x[0],V=x[1]):T&&(L=-1),l+=P,d.c=L;var I,D={name:k,compression:b,start:function(){if(!D.ondata)throw"no callback";if(!L)D.ondata(null,Pe,!0);else{var B=n.o[b];if(!B)throw"unknown compression type "+b;I=L<0?new B(k):new B(k,L,V),I.ondata=function(Z,te,W){D.ondata(Z,te,W)};for(var R=0,z=O;R<z.length;R++){var G=z[R];I.push(G,!1)}n.k[0]==O&&n.c?n.d=I:I.push(Pe,!0)}},terminate:function(){I&&I.terminate&&I.terminate()}};L>=0&&(D.size=L,D.originalSize=V),d.onfile(D)}return"break"}else if(f){if(w==134695760)return o=l+=12+(f==-2&&8),a=3,d.c=0,"break";if(w==33639248)return o=l-=4,a=3,d.c=0,"break"}},d=this;l<u-4;++l){var v=p();if(v==="break")break}if(this.p=Pe,f<0){var y=a?c.subarray(0,o-12-(f==-2&&8)-(N(c,o-16)==134695760&&4)):c.subarray(0,l);h?h.push(y,!!a):this.k[+(a==2)].push(y)}if(a&2)return this.push(c.subarray(l),t);this.p=c.subarray(l)}if(t){if(this.c)throw"invalid zip file";this.p=null}},r.prototype.register=function(e){this.o[e.compression]=e},r}();function ia(r,e){if(typeof e!="function")throw"no callback";for(var t=[],n=function(){for(var h=0;h<t.length;++h)t[h]()},i={},s=r.length-22;N(r,s)!=101010256;--s)if(!s||r.length-s>65558){e("invalid zip file",null);return}var a=ee(r,s+8);a||e(null,{});var l=a,o=N(r,s+16),c=o==4294967295;if(c){if(s=N(r,s-12),N(r,s)!=101075792){e("invalid zip file",null);return}l=a=N(r,s+32),o=N(r,s+48)}for(var u=function(h){var p=yi(r,o,c),d=p[0],v=p[1],y=p[2],x=p[3],w=p[4],g=p[5],b=vi(r,g);o=w;var E=function(A,P){A?(n(),e(A,null)):(i[x]=P,--a||e(null,i))};if(!d)E(null,pe(r,b,b+v));else if(d==8){var T=r.subarray(b,b+v);if(v<32e4)try{E(null,at(T,new C(y)))}catch(A){E(A,null)}else t.push(kn(T,{size:y},E))}else E("unknown compression type "+d,null)},f=0;f<l;++f)u();return n}function sa(r){for(var e={},t=r.length-22;N(r,t)!=101010256;--t)if(!t||r.length-t>65558)throw"invalid zip file";var n=ee(r,t+8);if(!n)return{};var i=N(r,t+16),s=i==4294967295;if(s){if(t=N(r,t-12),N(r,t)!=101075792)throw"invalid zip file";n=N(r,t+32),i=N(r,t+48)}for(var a=0;a<n;++a){var l=yi(r,i,s),o=l[0],c=l[1],u=l[2],f=l[3],h=l[4],p=l[5],d=vi(r,p);if(i=h,!o)e[f]=pe(r,d,d+c);else if(o==8)e[f]=at(r.subarray(d,d+c),new C(u));else throw"unknown compression type "+o}return e}const aa=Object.freeze(Object.defineProperty({__proto__:null,Deflate:xe,AsyncDeflate:oi,deflate:ci,deflateSync:xt,Inflate:ie,AsyncInflate:On,inflate:kn,inflateSync:at,Gzip:zt,AsyncGzip:lr,gzip:ur,gzipSync:jt,Gunzip:Ut,AsyncGunzip:li,gunzip:ui,gunzipSync:Nt,Zlib:dn,AsyncZlib:Hs,zlib:Gs,zlibSync:mn,Unzlib:Vt,AsyncUnzlib:fi,unzlib:hi,unzlibSync:mt,compress:ur,AsyncCompress:lr,compressSync:jt,Compress:zt,Decompress:pi,AsyncDecompress:$s,decompress:Xs,decompressSync:Ws,DecodeUTF8:Ys,EncodeUTF8:Ks,strToU8:ke,strFromU8:Rn,ZipPassThrough:gt,ZipDeflate:Zs,AsyncZipDeflate:qs,Zip:Qs,zip:Js,zipSync:ea,UnzipPassThrough:xi,UnzipInflate:ta,AsyncUnzipInflate:na,Unzip:ra,unzip:ia,unzipSync:sa},Symbol.toStringTag,{value:"Module"}));function Ei(r,e,t){const n=t.length-r-1;if(e>=t[n])return n-1;if(e<=t[r])return r;let i=r,s=n,a=Math.floor((i+s)/2);for(;e<t[a]||e>=t[a+1];)e<t[a]?s=a:i=a,a=Math.floor((i+s)/2);return a}function oa(r,e,t,n){const i=[],s=[],a=[];i[0]=1;for(let l=1;l<=t;++l){s[l]=e-n[r+1-l],a[l]=n[r+l]-e;let o=0;for(let c=0;c<l;++c){const u=a[c+1],f=s[l-c],h=i[c]/(u+f);i[c]=o+u*h,o=f*h}i[l]=o}return i}function ca(r,e,t,n){const i=Ei(r,n,e),s=oa(i,n,r,e),a=new Ht(0,0,0,0);for(let l=0;l<=r;++l){const o=t[i-r+l],c=s[l],u=o.w*c;a.x+=o.x*u,a.y+=o.y*u,a.z+=o.z*u,a.w+=o.w*c}return a}function la(r,e,t,n,i){const s=[];for(let f=0;f<=t;++f)s[f]=0;const a=[];for(let f=0;f<=n;++f)a[f]=s.slice(0);const l=[];for(let f=0;f<=t;++f)l[f]=s.slice(0);l[0][0]=1;const o=s.slice(0),c=s.slice(0);for(let f=1;f<=t;++f){o[f]=e-i[r+1-f],c[f]=i[r+f]-e;let h=0;for(let p=0;p<f;++p){const d=c[p+1],v=o[f-p];l[f][p]=d+v;const y=l[p][f-1]/l[f][p];l[p][f]=h+d*y,h=v*y}l[f][f]=h}for(let f=0;f<=t;++f)a[0][f]=l[f][t];for(let f=0;f<=t;++f){let h=0,p=1;const d=[];for(let v=0;v<=t;++v)d[v]=s.slice(0);d[0][0]=1;for(let v=1;v<=n;++v){let y=0;const x=f-v,w=t-v;f>=v&&(d[p][0]=d[h][0]/l[w+1][x],y=d[p][0]*l[x][w]);const g=x>=-1?1:-x,b=f-1<=w?v-1:t-f;for(let T=g;T<=b;++T)d[p][T]=(d[h][T]-d[h][T-1])/l[w+1][x+T],y+=d[p][T]*l[x+T][w];f<=w&&(d[p][v]=-d[h][v-1]/l[w+1][f],y+=d[p][v]*l[f][w]),a[v][f]=y;const E=h;h=p,p=E}}let u=t;for(let f=1;f<=n;++f){for(let h=0;h<=t;++h)a[f][h]*=u;u*=t-f}return a}function ua(r,e,t,n,i){const s=i<r?i:r,a=[],l=Ei(r,n,e),o=la(l,n,r,s,e),c=[];for(let u=0;u<t.length;++u){const f=t[u].clone(),h=f.w;f.x*=h,f.y*=h,f.z*=h,c[u]=f}for(let u=0;u<=s;++u){const f=c[l-r].clone().multiplyScalar(o[u][0]);for(let h=1;h<=r;++h)f.add(c[l-r+h].clone().multiplyScalar(o[u][h]));a[u]=f}for(let u=s+1;u<=i+1;++u)a[u]=new Ht(0,0,0);return a}function fa(r,e){let t=1;for(let i=2;i<=r;++i)t*=i;let n=1;for(let i=2;i<=e;++i)n*=i;for(let i=2;i<=r-e;++i)n*=i;return t/n}function ha(r){const e=r.length,t=[],n=[];for(let s=0;s<e;++s){const a=r[s];t[s]=new Q(a.x,a.y,a.z),n[s]=a.w}const i=[];for(let s=0;s<e;++s){const a=t[s].clone();for(let l=1;l<=s;++l)a.sub(i[s-l].clone().multiplyScalar(fa(s,l)*n[l]));i[s]=a.divideScalar(n[0])}return i}function pa(r,e,t,n,i){const s=ua(r,e,t,n,i);return ha(s)}class hr extends Ji{constructor(e,t,n,i,s){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=i||0,this.endKnot=s||this.knots.length-1;for(let a=0;a<n.length;++a){const l=n[a];this.controlPoints[a]=new Ht(l.x,l.y,l.z,l.w)}}getPoint(e,t=new Q){const n=t,i=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),s=ca(this.degree,this.knots,this.controlPoints,i);return s.w!==1&&s.divideScalar(s.w),n.set(s.x,s.y,s.z)}getTangent(e,t=new Q){const n=t,i=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),s=pa(this.degree,this.knots,this.controlPoints,i,1);return n.copy(s[1]).normalize(),n}}let S,U,ne;class da extends es{constructor(e){super(e)}load(e,t,n,i){const s=this,a=s.path===""?En.extractUrlBase(e):s.path,l=new ts(this.manager);l.setPath(s.path),l.setResponseType("arraybuffer"),l.setRequestHeader(s.requestHeader),l.setWithCredentials(s.withCredentials),l.load(e,function(o){try{t(s.parse(o,a))}catch(c){i?i(c):console.error(c),s.manager.itemError(e)}},n,i)}parse(e,t){if(xa(e))S=new wa().parse(e);else{const i=Ai(e);if(!Ea(i))throw new Error("THREE.FBXLoader: Unknown format.");if(dr(i)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+dr(i));S=new ya().parse(i)}const n=new Qe(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new ma(n,this.manager).parse(S)}}class ma{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){U=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),i=this.parseDeformers(),s=new ga().parse(i);return this.parseScene(i,s,n),ne}parseConnections(){const e=new Map;return"Connections"in S&&S.Connections.connections.forEach(function(n){const i=n[0],s=n[1],a=n[2];e.has(i)||e.set(i,{parents:[],children:[]});const l={ID:s,relationship:a};e.get(i).parents.push(l),e.has(s)||e.set(s,{parents:[],children:[]});const o={ID:i,relationship:a};e.get(s).children.push(o)}),e}parseImages(){const e={},t={};if("Video"in S.Objects){const n=S.Objects.Video;for(const i in n){const s=n[i],a=parseInt(i);if(e[a]=s.RelativeFilename||s.Filename,"Content"in s){const l=s.Content instanceof ArrayBuffer&&s.Content.byteLength>0,o=typeof s.Content=="string"&&s.Content!=="";if(l||o){const c=this.parseImage(n[i]);t[s.RelativeFilename||s.Filename]=c}}}}for(const n in e){const i=e[n];t[i]!==void 0?e[n]=t[i]:e[n]=e[n].split("\\").pop()}return e}parseImage(e){const t=e.Content,n=e.RelativeFilename||e.Filename,i=n.slice(n.lastIndexOf(".")+1).toLowerCase();let s;switch(i){case"bmp":s="image/bmp";break;case"jpg":case"jpeg":s="image/jpeg";break;case"png":s="image/png";break;case"tif":s="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",n),s="image/tga";break;default:console.warn('FBXLoader: Image type "'+i+'" is not supported.');return}if(typeof t=="string")return"data:"+s+";base64,"+t;{const a=new Uint8Array(t);return window.URL.createObjectURL(new Blob([a],{type:s}))}}parseTextures(e){const t=new Map;if("Texture"in S.Objects){const n=S.Objects.Texture;for(const i in n){const s=this.parseTexture(n[i],e);t.set(parseInt(i),s)}}return t}parseTexture(e,t){const n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;const i=e.WrapModeU,s=e.WrapModeV,a=i!==void 0?i.value:0,l=s!==void 0?s.value:0;if(n.wrapS=a===0?Kn:Zn,n.wrapT=l===0?Kn:Zn,"Scaling"in e){const o=e.Scaling.value;n.repeat.x=o[0],n.repeat.y=o[1]}if("Translation"in e){const o=e.Translation.value;n.offset.x=o[0],n.offset.y=o[1]}return n}loadTexture(e,t){let n;const i=this.textureLoader.path,s=U.get(e.id).children;s!==void 0&&s.length>0&&t[s[0].ID]!==void 0&&(n=t[s[0].ID],(n.indexOf("blob:")===0||n.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let a;const l=e.FileName.slice(-3).toLowerCase();if(l==="tga"){const o=this.manager.getHandler(".tga");o===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),a=new qn):(o.setPath(this.textureLoader.path),a=o.load(n))}else l==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),a=new qn):a=this.textureLoader.load(n);return this.textureLoader.setPath(i),a}parseMaterials(e){const t=new Map;if("Material"in S.Objects){const n=S.Objects.Material;for(const i in n){const s=this.parseMaterial(n[i],e);s!==null&&t.set(parseInt(i),s)}}return t}parseMaterial(e,t){const n=e.id,i=e.attrName;let s=e.ShadingModel;if(typeof s=="object"&&(s=s.value),!U.has(n))return null;const a=this.parseParameters(e,t,n);let l;switch(s.toLowerCase()){case"phong":l=new Qt;break;case"lambert":l=new ns;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',s),l=new Qt;break}return l.setValues(a),l.name=i,l}parseParameters(e,t,n){const i={};e.BumpFactor&&(i.bumpScale=e.BumpFactor.value),e.Diffuse?i.color=new J().fromArray(e.Diffuse.value):e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(i.color=new J().fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(i.displacementScale=e.DisplacementFactor.value),e.Emissive?i.emissive=new J().fromArray(e.Emissive.value):e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(i.emissive=new J().fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(i.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(i.opacity=parseFloat(e.Opacity.value)),i.opacity<1&&(i.transparent=!0),e.ReflectionFactor&&(i.reflectivity=e.ReflectionFactor.value),e.Shininess&&(i.shininess=e.Shininess.value),e.Specular?i.specular=new J().fromArray(e.Specular.value):e.SpecularColor&&e.SpecularColor.type==="Color"&&(i.specular=new J().fromArray(e.SpecularColor.value));const s=this;return U.get(n).children.forEach(function(a){const l=a.relationship;switch(l){case"Bump":i.bumpMap=s.getTexture(t,a.ID);break;case"Maya|TEX_ao_map":i.aoMap=s.getTexture(t,a.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":i.map=s.getTexture(t,a.ID),i.map!==void 0&&(i.map.encoding=fe);break;case"DisplacementColor":i.displacementMap=s.getTexture(t,a.ID);break;case"EmissiveColor":i.emissiveMap=s.getTexture(t,a.ID),i.emissiveMap!==void 0&&(i.emissiveMap.encoding=fe);break;case"NormalMap":case"Maya|TEX_normal_map":i.normalMap=s.getTexture(t,a.ID);break;case"ReflectionColor":i.envMap=s.getTexture(t,a.ID),i.envMap!==void 0&&(i.envMap.mapping=rs,i.envMap.encoding=fe);break;case"SpecularColor":i.specularMap=s.getTexture(t,a.ID),i.specularMap!==void 0&&(i.specularMap.encoding=fe);break;case"TransparentColor":case"TransparencyFactor":i.alphaMap=s.getTexture(t,a.ID),i.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",l);break}}),i}getTexture(e,t){return"LayeredTexture"in S.Objects&&t in S.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=U.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in S.Objects){const n=S.Objects.Deformer;for(const i in n){const s=n[i],a=U.get(parseInt(i));if(s.attrType==="Skin"){const l=this.parseSkeleton(a,n);l.ID=i,a.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),l.geometryID=a.parents[0].ID,e[i]=l}else if(s.attrType==="BlendShape"){const l={id:i};l.rawTargets=this.parseMorphTargets(a,n),l.id=i,a.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[i]=l}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const n=[];return e.children.forEach(function(i){const s=t[i.ID];if(s.attrType!=="Cluster")return;const a={ID:i.ID,indices:[],weights:[],transformLink:new j().fromArray(s.TransformLink.a)};"Indexes"in s&&(a.indices=s.Indexes.a,a.weights=s.Weights.a),n.push(a)}),{rawBones:n,bones:[]}}parseMorphTargets(e,t){const n=[];for(let i=0;i<e.children.length;i++){const s=e.children[i],a=t[s.ID],l={name:a.attrName,initialWeight:a.DeformPercent,id:a.id,fullWeights:a.FullWeights.a};if(a.attrType!=="BlendShapeChannel")return;l.geoID=U.get(parseInt(s.ID)).children.filter(function(o){return o.relationship===void 0})[0].ID,n.push(l)}return n}parseScene(e,t,n){ne=new Qn;const i=this.parseModels(e.skeletons,t,n),s=S.Objects.Model,a=this;i.forEach(function(o){const c=s[o.ID];a.setLookAtProperties(o,c),U.get(o.ID).parents.forEach(function(f){const h=i.get(f.ID);h!==void 0&&h.add(o)}),o.parent===null&&ne.add(o)}),this.bindSkeleton(e.skeletons,t,i),this.createAmbientLight(),ne.traverse(function(o){if(o.userData.transformData){o.parent&&(o.userData.transformData.parentMatrix=o.parent.matrix,o.userData.transformData.parentMatrixWorld=o.parent.matrixWorld);const c=Pi(o.userData.transformData);o.applyMatrix4(c),o.updateWorldMatrix()}});const l=new va().parse();ne.children.length===1&&ne.children[0].isGroup&&(ne.children[0].animations=l,ne=ne.children[0]),ne.animations=l}parseModels(e,t,n){const i=new Map,s=S.Objects.Model;for(const a in s){const l=parseInt(a),o=s[a],c=U.get(l);let u=this.buildSkeleton(c,e,l,o.attrName);if(!u){switch(o.attrType){case"Camera":u=this.createCamera(c);break;case"Light":u=this.createLight(c);break;case"Mesh":u=this.createMesh(c,t,n);break;case"NurbsCurve":u=this.createCurve(c,t);break;case"LimbNode":case"Root":u=new Jn;break;case"Null":default:u=new Qn;break}u.name=o.attrName?Rt.sanitizeNodeName(o.attrName):"",u.ID=l}this.getTransformData(u,o),i.set(l,u)}return i}buildSkeleton(e,t,n,i){let s=null;return e.parents.forEach(function(a){for(const l in t){const o=t[l];o.rawBones.forEach(function(c,u){if(c.ID===a.ID){const f=s;s=new Jn,s.matrixWorld.copy(c.transformLink),s.name=i?Rt.sanitizeNodeName(i):"",s.ID=n,o.bones[u]=s,f!==null&&s.add(f)}})}}),s}createCamera(e){let t,n;if(e.children.forEach(function(i){const s=S.Objects.NodeAttribute[i.ID];s!==void 0&&(n=s)}),n===void 0)t=new Jt;else{let i=0;n.CameraProjectionType!==void 0&&n.CameraProjectionType.value===1&&(i=1);let s=1;n.NearPlane!==void 0&&(s=n.NearPlane.value/1e3);let a=1e3;n.FarPlane!==void 0&&(a=n.FarPlane.value/1e3);let l=window.innerWidth,o=window.innerHeight;n.AspectWidth!==void 0&&n.AspectHeight!==void 0&&(l=n.AspectWidth.value,o=n.AspectHeight.value);const c=l/o;let u=45;n.FieldOfView!==void 0&&(u=n.FieldOfView.value);const f=n.FocalLength?n.FocalLength.value:null;switch(i){case 0:t=new Or(u,c,s,a),f!==null&&t.setFocalLength(f);break;case 1:t=new Dr(-l/2,l/2,o/2,-o/2,s,a);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+i+"."),t=new Jt;break}}return t}createLight(e){let t,n;if(e.children.forEach(function(i){const s=S.Objects.NodeAttribute[i.ID];s!==void 0&&(n=s)}),n===void 0)t=new Jt;else{let i;n.LightType===void 0?i=0:i=n.LightType.value;let s=16777215;n.Color!==void 0&&(s=new J().fromArray(n.Color.value));let a=n.Intensity===void 0?1:n.Intensity.value/100;n.CastLightOnObject!==void 0&&n.CastLightOnObject.value===0&&(a=0);let l=0;n.FarAttenuationEnd!==void 0&&(n.EnableFarAttenuation!==void 0&&n.EnableFarAttenuation.value===0?l=0:l=n.FarAttenuationEnd.value);const o=1;switch(i){case 0:t=new ln(s,a,l,o);break;case 1:t=new kr(s,a);break;case 2:let c=Math.PI/3;n.InnerAngle!==void 0&&(c=we.degToRad(n.InnerAngle.value));let u=0;n.OuterAngle!==void 0&&(u=we.degToRad(n.OuterAngle.value),u=Math.max(u,1)),t=new is(s,a,l,c,u,o);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),t=new ln(s,a);break}n.CastShadows!==void 0&&n.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,n){let i,s=null,a=null;const l=[];return e.children.forEach(function(o){t.has(o.ID)&&(s=t.get(o.ID)),n.has(o.ID)&&l.push(n.get(o.ID))}),l.length>1?a=l:l.length>0?a=l[0]:(a=new Qt({color:13421772}),l.push(a)),"color"in s.attributes&&l.forEach(function(o){o.vertexColors=!0}),s.FBX_Deformer?(i=new ss(s,a),i.normalizeSkinWeights()):i=new as(s,a),i}createCurve(e,t){const n=e.children.reduce(function(s,a){return t.has(a.ID)&&(s=t.get(a.ID)),s},null),i=new os({color:3342591,linewidth:1});return new cs(n,i)}getTransformData(e,t){const n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),"RotationOrder"in t?n.eulerOrder=Ti(t.RotationOrder.value):n.eulerOrder="ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(e,t){"LookAtProperty"in t&&U.get(e.ID).children.forEach(function(i){if(i.relationship==="LookAtProperty"){const s=S.Objects.Model[i.ID];if("Lcl_Translation"in s){const a=s.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(a),ne.add(e.target)):e.lookAt(new Q().fromArray(a))}}})}bindSkeleton(e,t,n){const i=this.parsePoseNodes();for(const s in e){const a=e[s];U.get(parseInt(a.ID)).parents.forEach(function(o){if(t.has(o.ID)){const c=o.ID;U.get(c).parents.forEach(function(f){n.has(f.ID)&&n.get(f.ID).bind(new ls(a.bones),i[f.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in S.Objects){const t=S.Objects.Pose;for(const n in t)if(t[n].attrType==="BindPose"&&t[n].NbPoseNodes>0){const i=t[n].PoseNode;Array.isArray(i)?i.forEach(function(s){e[s.Node]=new j().fromArray(s.Matrix.a)}):e[i.Node]=new j().fromArray(i.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in S&&"AmbientColor"in S.GlobalSettings){const e=S.GlobalSettings.AmbientColor.value,t=e[0],n=e[1],i=e[2];if(t!==0||n!==0||i!==0){const s=new J(t,n,i);ne.add(new Fr(s,1))}}}}class ga{constructor(){this.negativeMaterialIndices=!1}parse(e){const t=new Map;if("Geometry"in S.Objects){const n=S.Objects.Geometry;for(const i in n){const s=U.get(parseInt(i)),a=this.parseGeometry(s,n[i],e);t.set(parseInt(i),a)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),t}parseGeometry(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,n){const i=n.skeletons,s=[],a=e.parents.map(function(f){return S.Objects.Model[f.ID]});if(a.length===0)return;const l=e.children.reduce(function(f,h){return i[h.ID]!==void 0&&(f=i[h.ID]),f},null);e.children.forEach(function(f){n.morphTargets[f.ID]!==void 0&&s.push(n.morphTargets[f.ID])});const o=a[0],c={};"RotationOrder"in o&&(c.eulerOrder=Ti(o.RotationOrder.value)),"InheritType"in o&&(c.inheritType=parseInt(o.InheritType.value)),"GeometricTranslation"in o&&(c.translation=o.GeometricTranslation.value),"GeometricRotation"in o&&(c.rotation=o.GeometricRotation.value),"GeometricScaling"in o&&(c.scale=o.GeometricScaling.value);const u=Pi(c);return this.genGeometry(t,l,s,u)}genGeometry(e,t,n,i){const s=new ut;e.attrName&&(s.name=e.attrName);const a=this.parseGeoNode(e,t),l=this.genBuffers(a),o=new Ie(l.vertex,3);if(o.applyMatrix4(i),s.setAttribute("position",o),l.colors.length>0&&s.setAttribute("color",new Ie(l.colors,3)),t&&(s.setAttribute("skinIndex",new us(l.weightsIndices,4)),s.setAttribute("skinWeight",new Ie(l.vertexWeights,4)),s.FBX_Deformer=t),l.normal.length>0){const c=new fs().getNormalMatrix(i),u=new Ie(l.normal,3);u.applyNormalMatrix(c),s.setAttribute("normal",u)}if(l.uvs.forEach(function(c,u){let f="uv"+(u+1).toString();u===0&&(f="uv"),s.setAttribute(f,new Ie(l.uvs[u],2))}),a.material&&a.material.mappingType!=="AllSame"){let c=l.materialIndex[0],u=0;if(l.materialIndex.forEach(function(f,h){f!==c&&(s.addGroup(u,h-u,c),c=f,u=h)}),s.groups.length>0){const f=s.groups[s.groups.length-1],h=f.start+f.count;h!==l.materialIndex.length&&s.addGroup(h,l.materialIndex.length-h,c)}s.groups.length===0&&s.addGroup(0,l.materialIndex.length,l.materialIndex[0])}return this.addMorphTargets(s,e,n,i),s}parseGeoNode(e,t){const n={};if(n.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],n.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let i=0;for(;e.LayerElementUV[i];)e.LayerElementUV[i].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[i])),i++}return n.weightTable={},t!==null&&(n.skeleton=t,t.rawBones.forEach(function(i,s){i.indices.forEach(function(a,l){n.weightTable[a]===void 0&&(n.weightTable[a]=[]),n.weightTable[a].push({id:s,weight:i.weights[l]})})})),n}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,i=0,s=!1,a=[],l=[],o=[],c=[],u=[],f=[];const h=this;return e.vertexIndices.forEach(function(p,d){let v,y=!1;p<0&&(p=p^-1,y=!0);let x=[],w=[];if(a.push(p*3,p*3+1,p*3+2),e.color){const g=Mt(d,n,p,e.color);o.push(g[0],g[1],g[2])}if(e.skeleton){if(e.weightTable[p]!==void 0&&e.weightTable[p].forEach(function(g){w.push(g.weight),x.push(g.id)}),w.length>4){s||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),s=!0);const g=[0,0,0,0],b=[0,0,0,0];w.forEach(function(E,T){let A=E,P=x[T];b.forEach(function(O,L,V){if(A>O){V[L]=A,A=O;const k=g[L];g[L]=P,P=k}})}),x=g,w=b}for(;w.length<4;)w.push(0),x.push(0);for(let g=0;g<4;++g)u.push(w[g]),f.push(x[g])}if(e.normal){const g=Mt(d,n,p,e.normal);l.push(g[0],g[1],g[2])}e.material&&e.material.mappingType!=="AllSame"&&(v=Mt(d,n,p,e.material)[0],v<0&&(h.negativeMaterialIndices=!0,v=0)),e.uv&&e.uv.forEach(function(g,b){const E=Mt(d,n,p,g);c[b]===void 0&&(c[b]=[]),c[b].push(E[0]),c[b].push(E[1])}),i++,y&&(i>4&&console.warn("THREE.FBXLoader: Polygons with more than four sides are not supported. Make sure to triangulate the geometry during export."),h.genFace(t,e,a,v,l,o,c,u,f,i),n++,i=0,a=[],l=[],o=[],c=[],u=[],f=[])}),t}genFace(e,t,n,i,s,a,l,o,c,u){for(let f=2;f<u;f++)e.vertex.push(t.vertexPositions[n[0]]),e.vertex.push(t.vertexPositions[n[1]]),e.vertex.push(t.vertexPositions[n[2]]),e.vertex.push(t.vertexPositions[n[(f-1)*3]]),e.vertex.push(t.vertexPositions[n[(f-1)*3+1]]),e.vertex.push(t.vertexPositions[n[(f-1)*3+2]]),e.vertex.push(t.vertexPositions[n[f*3]]),e.vertex.push(t.vertexPositions[n[f*3+1]]),e.vertex.push(t.vertexPositions[n[f*3+2]]),t.skeleton&&(e.vertexWeights.push(o[0]),e.vertexWeights.push(o[1]),e.vertexWeights.push(o[2]),e.vertexWeights.push(o[3]),e.vertexWeights.push(o[(f-1)*4]),e.vertexWeights.push(o[(f-1)*4+1]),e.vertexWeights.push(o[(f-1)*4+2]),e.vertexWeights.push(o[(f-1)*4+3]),e.vertexWeights.push(o[f*4]),e.vertexWeights.push(o[f*4+1]),e.vertexWeights.push(o[f*4+2]),e.vertexWeights.push(o[f*4+3]),e.weightsIndices.push(c[0]),e.weightsIndices.push(c[1]),e.weightsIndices.push(c[2]),e.weightsIndices.push(c[3]),e.weightsIndices.push(c[(f-1)*4]),e.weightsIndices.push(c[(f-1)*4+1]),e.weightsIndices.push(c[(f-1)*4+2]),e.weightsIndices.push(c[(f-1)*4+3]),e.weightsIndices.push(c[f*4]),e.weightsIndices.push(c[f*4+1]),e.weightsIndices.push(c[f*4+2]),e.weightsIndices.push(c[f*4+3])),t.color&&(e.colors.push(a[0]),e.colors.push(a[1]),e.colors.push(a[2]),e.colors.push(a[(f-1)*3]),e.colors.push(a[(f-1)*3+1]),e.colors.push(a[(f-1)*3+2]),e.colors.push(a[f*3]),e.colors.push(a[f*3+1]),e.colors.push(a[f*3+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(i),e.materialIndex.push(i),e.materialIndex.push(i)),t.normal&&(e.normal.push(s[0]),e.normal.push(s[1]),e.normal.push(s[2]),e.normal.push(s[(f-1)*3]),e.normal.push(s[(f-1)*3+1]),e.normal.push(s[(f-1)*3+2]),e.normal.push(s[f*3]),e.normal.push(s[f*3+1]),e.normal.push(s[f*3+2])),t.uv&&t.uv.forEach(function(h,p){e.uvs[p]===void 0&&(e.uvs[p]=[]),e.uvs[p].push(l[p][0]),e.uvs[p].push(l[p][1]),e.uvs[p].push(l[p][(f-1)*2]),e.uvs[p].push(l[p][(f-1)*2+1]),e.uvs[p].push(l[p][f*2]),e.uvs[p].push(l[p][f*2+1])})}addMorphTargets(e,t,n,i){if(n.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const s=this;n.forEach(function(a){a.rawTargets.forEach(function(l){const o=S.Objects.Geometry[l.geoID];o!==void 0&&s.genMorphGeometry(e,t,o,i,l.name)})})}genMorphGeometry(e,t,n,i,s){const a=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],l=n.Vertices!==void 0?n.Vertices.a:[],o=n.Indexes!==void 0?n.Indexes.a:[],c=e.attributes.position.count*3,u=new Float32Array(c);for(let d=0;d<o.length;d++){const v=o[d]*3;u[v]=l[d*3],u[v+1]=l[d*3+1],u[v+2]=l[d*3+2]}const f={vertexIndices:a,vertexPositions:u},h=this.genBuffers(f),p=new Ie(h.vertex,3);p.name=s||n.attrName,p.applyMatrix4(i),e.morphAttributes.position.push(p)}parseNormals(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.Normals.a;let s=[];return n==="IndexToDirect"&&("NormalIndex"in e?s=e.NormalIndex.a:"NormalsIndex"in e&&(s=e.NormalsIndex.a)),{dataSize:3,buffer:i,indices:s,mappingType:t,referenceType:n}}parseUVs(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.UV.a;let s=[];return n==="IndexToDirect"&&(s=e.UVIndex.a),{dataSize:2,buffer:i,indices:s,mappingType:t,referenceType:n}}parseVertexColors(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.Colors.a;let s=[];return n==="IndexToDirect"&&(s=e.ColorIndex.a),{dataSize:4,buffer:i,indices:s,mappingType:t,referenceType:n}}parseMaterialIndices(e){const t=e.MappingInformationType,n=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const i=e.Materials.a,s=[];for(let a=0;a<i.length;++a)s.push(a);return{dataSize:1,buffer:i,indices:s,mappingType:t,referenceType:n}}parseNurbsGeometry(e){if(hr===void 0)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new ut;const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new ut;const n=t-1,i=e.KnotVector.a,s=[],a=e.Points.a;for(let f=0,h=a.length;f<h;f+=4)s.push(new Ht().fromArray(a,f));let l,o;if(e.Form==="Closed")s.push(s[0]);else if(e.Form==="Periodic"){l=n,o=i.length-1-l;for(let f=0;f<n;++f)s.push(s[f])}const u=new hr(n,i,s,l,o).getPoints(s.length*12);return new ut().setFromPoints(u)}}class va{parse(){const e=[],t=this.parseClips();if(t!==void 0)for(const n in t){const i=t[n],s=this.addClip(i);e.push(s)}return e}parseClips(){if(S.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=S.Objects.AnimationCurveNode,t=new Map;for(const n in e){const i=e[n];if(i.attrName.match(/S|R|T|DeformPercent/)!==null){const s={id:i.id,attr:i.attrName,curves:{}};t.set(s.id,s)}}return t}parseAnimationCurves(e){const t=S.Objects.AnimationCurve;for(const n in t){const i={id:t[n].id,times:t[n].KeyTime.a.map(ba),values:t[n].KeyValueFloat.a},s=U.get(i.id);if(s!==void 0){const a=s.parents[0].ID,l=s.parents[0].relationship;l.match(/X/)?e.get(a).curves.x=i:l.match(/Y/)?e.get(a).curves.y=i:l.match(/Z/)?e.get(a).curves.z=i:l.match(/d|DeformPercent/)&&e.has(a)&&(e.get(a).curves.morph=i)}}}parseAnimationLayers(e){const t=S.Objects.AnimationLayer,n=new Map;for(const i in t){const s=[],a=U.get(parseInt(i));a!==void 0&&(a.children.forEach(function(o,c){if(e.has(o.ID)){const u=e.get(o.ID);if(u.curves.x!==void 0||u.curves.y!==void 0||u.curves.z!==void 0){if(s[c]===void 0){const f=U.get(o.ID).parents.filter(function(h){return h.relationship!==void 0})[0].ID;if(f!==void 0){const h=S.Objects.Model[f.toString()];if(h===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",o);return}const p={modelName:h.attrName?Rt.sanitizeNodeName(h.attrName):"",ID:h.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};ne.traverse(function(d){d.ID===h.id&&(p.transform=d.matrix,d.userData.transformData&&(p.eulerOrder=d.userData.transformData.eulerOrder))}),p.transform||(p.transform=new j),"PreRotation"in h&&(p.preRotation=h.PreRotation.value),"PostRotation"in h&&(p.postRotation=h.PostRotation.value),s[c]=p}}s[c]&&(s[c][u.attr]=u)}else if(u.curves.morph!==void 0){if(s[c]===void 0){const f=U.get(o.ID).parents.filter(function(x){return x.relationship!==void 0})[0].ID,h=U.get(f).parents[0].ID,p=U.get(h).parents[0].ID,d=U.get(p).parents[0].ID,v=S.Objects.Model[d],y={modelName:v.attrName?Rt.sanitizeNodeName(v.attrName):"",morphName:S.Objects.Deformer[f].attrName};s[c]=y}s[c][u.attr]=u}}}),n.set(parseInt(i),s))}return n}parseAnimStacks(e){const t=S.Objects.AnimationStack,n={};for(const i in t){const s=U.get(parseInt(i)).children;s.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const a=e.get(s[0].ID);n[i]={name:t[i].attrName,layer:a}}return n}addClip(e){let t=[];const n=this;return e.layer.forEach(function(i){t=t.concat(n.generateTracks(i))}),new Rr(e.name,-1,t)}generateTracks(e){const t=[];let n=new Q,i=new Ke,s=new Q;if(e.transform&&e.transform.decompose(n,i,s),n=n.toArray(),i=new De().setFromQuaternion(i,e.eulerOrder).toArray(),s=s.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const a=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");a!==void 0&&t.push(a)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const a=this.generateRotationTrack(e.modelName,e.R.curves,i,e.preRotation,e.postRotation,e.eulerOrder);a!==void 0&&t.push(a)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const a=this.generateVectorTrack(e.modelName,e.S.curves,s,"scale");a!==void 0&&t.push(a)}if(e.DeformPercent!==void 0){const a=this.generateMorphTrack(e);a!==void 0&&t.push(a)}return t}generateVectorTrack(e,t,n,i){const s=this.getTimesForAllAxes(t),a=this.getKeyframeTrackValues(s,t,n);return new hs(e+"."+i,s,a)}generateRotationTrack(e,t,n,i,s,a){t.x!==void 0&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(we.degToRad)),t.y!==void 0&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(we.degToRad)),t.z!==void 0&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(we.degToRad));const l=this.getTimesForAllAxes(t),o=this.getKeyframeTrackValues(l,t,n);i!==void 0&&(i=i.map(we.degToRad),i.push(a),i=new De().fromArray(i),i=new Ke().setFromEuler(i)),s!==void 0&&(s=s.map(we.degToRad),s.push(a),s=new De().fromArray(s),s=new Ke().setFromEuler(s).invert());const c=new Ke,u=new De,f=[];for(let h=0;h<o.length;h+=3)u.set(o[h],o[h+1],o[h+2],a),c.setFromEuler(u),i!==void 0&&c.premultiply(i),s!==void 0&&c.multiply(s),c.toArray(f,h/3*4);return new ps(e+".quaternion",l,f)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,n=t.values.map(function(s){return s/100}),i=ne.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new ds(e.modelName+".morphTargetInfluences["+i+"]",t.times,n)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(n,i){return n-i}),t.length>1){let n=1,i=t[0];for(let s=1;s<t.length;s++){const a=t[s];a!==i&&(t[n]=a,i=a,n++)}t=t.slice(0,n)}return t}getKeyframeTrackValues(e,t,n){const i=n,s=[];let a=-1,l=-1,o=-1;return e.forEach(function(c){if(t.x&&(a=t.x.times.indexOf(c)),t.y&&(l=t.y.times.indexOf(c)),t.z&&(o=t.z.times.indexOf(c)),a!==-1){const u=t.x.values[a];s.push(u),i[0]=u}else s.push(i[0]);if(l!==-1){const u=t.y.values[l];s.push(u),i[1]=u}else s.push(i[1]);if(o!==-1){const u=t.z.values[o];s.push(u),i[2]=u}else s.push(i[2])}),s}interpolateRotations(e){for(let t=1;t<e.values.length;t++){const n=e.values[t-1],i=e.values[t]-n,s=Math.abs(i);if(s>=180){const a=s/180,l=i/a;let o=n+l;const c=e.times[t-1],f=(e.times[t]-c)/a;let h=c+f;const p=[],d=[];for(;h<e.times[t];)p.push(h),h+=f,d.push(o),o+=l;e.times=mr(e.times,t,p),e.values=mr(e.values,t,d)}}}}class ya{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new bi,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,n=e.split(/[\r\n]+/);return n.forEach(function(i,s){const a=i.match(/^[\s\t]*;/),l=i.match(/^[\s\t]*$/);if(a||l)return;const o=i.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),c=i.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),u=i.match("^\\t{"+(t.currentIndent-1)+"}}");o?t.parseNodeBegin(i,o):c?t.parseNodeProperty(i,c,n[++s]):u?t.popStack():i.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(i)}),this.allNodes}parseNodeBegin(e,t){const n=t[1].trim().replace(/^"/,"").replace(/"$/,""),i=t[2].split(",").map(function(o){return o.trim().replace(/^"/,"").replace(/"$/,"")}),s={name:n},a=this.parseNodeAttr(i),l=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(n,s):n in l?(n==="PoseNode"?l.PoseNode.push(s):l[n].id!==void 0&&(l[n]={},l[n][l[n].id]=l[n]),a.id!==""&&(l[n][a.id]=s)):typeof a.id=="number"?(l[n]={},l[n][a.id]=s):n!=="Properties70"&&(n==="PoseNode"?l[n]=[s]:l[n]=s),typeof a.id=="number"&&(s.id=a.id),a.name!==""&&(s.attrName=a.name),a.type!==""&&(s.attrType=a.type),this.pushStack(s)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let n="",i="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),i=e[2]),{id:t,name:n,type:i}}parseNodeProperty(e,t,n){let i=t[1].replace(/^"/,"").replace(/"$/,"").trim(),s=t[2].replace(/^"/,"").replace(/"$/,"").trim();i==="Content"&&s===","&&(s=n.replace(/"/g,"").replace(/,$/,"").trim());const a=this.getCurrentNode();if(a.name==="Properties70"){this.parseNodeSpecialProperty(e,i,s);return}if(i==="C"){const o=s.split(",").slice(1),c=parseInt(o[0]),u=parseInt(o[1]);let f=s.split(",").slice(3);f=f.map(function(h){return h.trim().replace(/^"/,"")}),i="connections",s=[c,u],Ta(s,f),a[i]===void 0&&(a[i]=[])}i==="Node"&&(a.id=s),i in a&&Array.isArray(a[i])?a[i].push(s):i!=="a"?a[i]=s:a.a=s,this.setCurrentProp(a,i),i==="a"&&s.slice(-1)!==","&&(a.a=rn(s))}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=rn(t.a))}parseNodeSpecialProperty(e,t,n){const i=n.split('",').map(function(u){return u.trim().replace(/^\"/,"").replace(/\s/,"_")}),s=i[0],a=i[1],l=i[2],o=i[3];let c=i[4];switch(a){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":c=parseFloat(c);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":c=rn(c);break}this.getPrevNode()[s]={type:a,type2:l,flag:o,value:c},this.setCurrentProp(this.getPrevNode(),s)}}class wa{parse(e){const t=new pr(e);t.skip(23);const n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const i=new bi;for(;!this.endOfContent(t);){const s=this.parseNode(t,n);s!==null&&i.add(s.name,s)}return i}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const n={},i=t>=7500?e.getUint64():e.getUint32(),s=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const a=e.getUint8(),l=e.getString(a);if(i===0)return null;const o=[];for(let h=0;h<s;h++)o.push(this.parseProperty(e));const c=o.length>0?o[0]:"",u=o.length>1?o[1]:"",f=o.length>2?o[2]:"";for(n.singleProperty=s===1&&e.getOffset()===i;i>e.getOffset();){const h=this.parseNode(e,t);h!==null&&this.parseSubNode(l,n,h)}return n.propertyList=o,typeof c=="number"&&(n.id=c),u!==""&&(n.attrName=u),f!==""&&(n.attrType=f),l!==""&&(n.name=l),n}parseSubNode(e,t,n){if(n.singleProperty===!0){const i=n.propertyList[0];Array.isArray(i)?(t[n.name]=n,n.a=i):t[n.name]=i}else if(e==="Connections"&&n.name==="C"){const i=[];n.propertyList.forEach(function(s,a){a!==0&&i.push(s)}),t.connections===void 0&&(t.connections=[]),t.connections.push(i)}else if(n.name==="Properties70")Object.keys(n).forEach(function(s){t[s]=n[s]});else if(e==="Properties70"&&n.name==="P"){let i=n.propertyList[0],s=n.propertyList[1];const a=n.propertyList[2],l=n.propertyList[3];let o;i.indexOf("Lcl ")===0&&(i=i.replace("Lcl ","Lcl_")),s.indexOf("Lcl ")===0&&(s=s.replace("Lcl ","Lcl_")),s==="Color"||s==="ColorRGB"||s==="Vector"||s==="Vector3D"||s.indexOf("Lcl_")===0?o=[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:o=n.propertyList[4],t[i]={type:s,type2:a,flag:l,value:o}}else t[n.name]===void 0?typeof n.id=="number"?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:n.name==="PoseNode"?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):t[n.name][n.id]===void 0&&(t[n.name][n.id]=n)}parseProperty(e){const t=e.getString(1);let n;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const i=e.getUint32(),s=e.getUint32(),a=e.getUint32();if(s===0)switch(t){case"b":case"c":return e.getBooleanArray(i);case"d":return e.getFloat64Array(i);case"f":return e.getFloat32Array(i);case"i":return e.getInt32Array(i);case"l":return e.getInt64Array(i)}typeof aa>"u"&&console.error("THREE.FBXLoader: External library fflate.min.js required.");const l=mt(new Uint8Array(e.getArrayBuffer(a))),o=new pr(l.buffer);switch(t){case"b":case"c":return o.getBooleanArray(i);case"d":return o.getFloat64Array(i);case"f":return o.getFloat32Array(i);case"i":return o.getInt32Array(i);case"l":return o.getInt64Array(i)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class pr{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t!==void 0?t:!0}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const t=[];for(let n=0;n<e;n++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t&2147483648?(t=~t&4294967295,e=~e&4294967295,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(t*4294967296+e)):t*4294967296+e}getInt64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let t=[];for(let i=0;i<e;i++)t[i]=this.getUint8();const n=t.indexOf(0);return n>=0&&(t=t.slice(0,n)),En.decodeText(new Uint8Array(t))}}class bi{add(e,t){this[e]=t}}function xa(r){const e="Kaydara FBX Binary  \0";return r.byteLength>=e.length&&e===Ai(r,0,e.length)}function Ea(r){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let t=0;function n(i){const s=r[i-1];return r=r.slice(t+i),t++,s}for(let i=0;i<e.length;++i)if(n(1)===e[i])return!1;return!0}function dr(r){const e=/FBXVersion: (\d+)/,t=r.match(e);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function ba(r){return r/46186158e3}const Pa=[];function Mt(r,e,t,n){let i;switch(n.mappingType){case"ByPolygonVertex":i=r;break;case"ByPolygon":i=e;break;case"ByVertice":i=t;break;case"AllSame":i=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}n.referenceType==="IndexToDirect"&&(i=n.indices[i]);const s=i*n.dataSize,a=s+n.dataSize;return Aa(Pa,n.buffer,s,a)}const nn=new De,Ge=new Q;function Pi(r){const e=new j,t=new j,n=new j,i=new j,s=new j,a=new j,l=new j,o=new j,c=new j,u=new j,f=new j,h=new j,p=r.inheritType?r.inheritType:0;if(r.translation&&e.setPosition(Ge.fromArray(r.translation)),r.preRotation){const L=r.preRotation.map(we.degToRad);L.push(r.eulerOrder||De.DefaultOrder),t.makeRotationFromEuler(nn.fromArray(L))}if(r.rotation){const L=r.rotation.map(we.degToRad);L.push(r.eulerOrder||De.DefaultOrder),n.makeRotationFromEuler(nn.fromArray(L))}if(r.postRotation){const L=r.postRotation.map(we.degToRad);L.push(r.eulerOrder||De.DefaultOrder),i.makeRotationFromEuler(nn.fromArray(L)),i.invert()}r.scale&&s.scale(Ge.fromArray(r.scale)),r.scalingOffset&&l.setPosition(Ge.fromArray(r.scalingOffset)),r.scalingPivot&&a.setPosition(Ge.fromArray(r.scalingPivot)),r.rotationOffset&&o.setPosition(Ge.fromArray(r.rotationOffset)),r.rotationPivot&&c.setPosition(Ge.fromArray(r.rotationPivot)),r.parentMatrixWorld&&(f.copy(r.parentMatrix),u.copy(r.parentMatrixWorld));const d=t.clone().multiply(n).multiply(i),v=new j;v.extractRotation(u);const y=new j;y.copyPosition(u);const x=y.clone().invert().multiply(u),w=v.clone().invert().multiply(x),g=s,b=new j;if(p===0)b.copy(v).multiply(d).multiply(w).multiply(g);else if(p===1)b.copy(v).multiply(w).multiply(d).multiply(g);else{const V=new j().scale(new Q().setFromMatrixScale(f)).clone().invert(),k=w.clone().multiply(V);b.copy(v).multiply(d).multiply(k).multiply(g)}const E=c.clone().invert(),T=a.clone().invert();let A=e.clone().multiply(o).multiply(c).multiply(t).multiply(n).multiply(i).multiply(E).multiply(l).multiply(a).multiply(s).multiply(T);const P=new j().copyPosition(A),O=u.clone().multiply(P);return h.copyPosition(O),A=h.clone().multiply(b),A.premultiply(u.invert()),A}function Ti(r){r=r||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return r===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[r]}function rn(r){return r.split(",").map(function(t){return parseFloat(t)})}function Ai(r,e,t){return e===void 0&&(e=0),t===void 0&&(t=r.byteLength),En.decodeText(new Uint8Array(r,e,t))}function Ta(r,e){for(let t=0,n=r.length,i=e.length;t<i;t++,n++)r[n]=e[t]}function Aa(r,e,t,n){for(let i=t,s=0;i<n;i++,s++)r[s]=e[i];return r}function mr(r,e,t){return r.slice(0,e).concat(t).concat(r.slice(e))}const Mi=r=>r&&new Promise(e=>{new da().load(r,e)}),Li=r=>r&&new Promise(e=>{new Qe().load(r,e)}),Ma=["px.png","nx.png","py.png","ny.png","pz.png","nz.png"],La=r=>r&&new Promise(e=>{new ms().setPath(`${r}/`).load(Ma,e)}),Sa=["c100007_01","c100007_05","c100007_09","c100034_01","c100035_01","c100036_01","c100037_01","c100041_01"],Ca=async r=>await(await fetch(r)).json(),$t=async r=>(await Ca(r)).data,Ia=(...r)=>e=>r.reduce((t,n)=>n(t),e),Da=r=>[...new Set(r)],Te=r=>r==="false"?!1:!!r,Si=(r,e,t)=>{if(!e.length)return;const n=e.pop(),i=e.reduce((s,a)=>s==null?void 0:s[a],r);i&&(i[n]=t)};function Bn(r){return!!/[0-9A-Fa-f]{6}/.test(r)}function kt(r){return Bn(r)&&!r.startsWith("#")?new J(`#${r}`):new J(r)}async function Oa(r=100){return await new Promise(e=>setTimeout(e,r))}function Ci(r,e="="){const[t,...n]=r.split(e),i=n.join(e);return[t,i]}const ka=r=>r.startsWith("w302"),gr=([r,...e])=>`${r.toUpperCase()}${e.join("")}`;function Fa(r){return r==="smith"?"dragon":r.endsWith("h")?"story":Sa.includes(r)?"spAdventurer":{c:"adventurer",b:"boss",d:"dragon",e:"enemy",h:"high boss",o:"object",r:"raid boss",w:"weapon"}[r[0]]??"other"}function Ra(r=no){const e=new gs(r);return e.outputEncoding=fe,e}function _a(r={}){const{fov:e,aspect:t,near:n,far:i}={...io,...r};return new Or(e,t,n,i)}async function Ba(r){if(r.startsWith("img:")){const e=r.replace("img:",""),t=await Li(e);return t.encoding=fe,t.center.set(.5,0),t}if(r.startsWith("sky:")){const e=r.replace("sky:",""),t=await La(e);return t.encoding=fe,t}if(r==="transparent")return null;if(Bn(r)){const e=r.startsWith("#")?r:`#${r}`;return new J(e)}}function za(r){var e,t,n,i;(t=(e=r.map)==null?void 0:e.dispose)==null||t.call(e),(i=(n=r.userData.backupMap)==null?void 0:n.dispose)==null||i.call(n),r.dispose()}const Ii=r=>{const e=new Qe().load(r);return e.encoding=fe,e};function ja(r){const e=[],t=[];return r.traverse(n=>{n.isMesh&&e.push(n),n.isBone&&t.push(n)}),[e,t]}function Ua(r){var t,n;if(!r)return;[r.material].flat().forEach(i=>{var s,a,l,o,c,u;(a=(s=i.map)==null?void 0:s.dispose)==null||a.call(s),(c=(o=(l=i.userData)==null?void 0:l.backupMap)==null?void 0:o.dispose)==null||c.call(o),(u=i.dispose)==null||u.call(i)}),(n=(t=r.geometry)==null?void 0:t.dispose)==null||n.call(t)}const Na=()=>{const r=new Date,e=r.toDateString().replaceAll(" ","_"),t=r.toLocaleTimeString().replaceAll(":","-").replaceAll(" ","");return`${e}_${t}`},Di=r=>r?r.split("/").reduce((t,n)=>{const[i,s]=n.split("=");return i&&s&&(t[i]=s),t},{}):{},Va=`
varying vec3 vViewPosition;

struct BlinnPhongMaterial {

	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;

};

void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {

	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;

	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );

	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;

}

void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {

	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );

}

#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
`,Ha=`
#ifdef USE_MATCAP

	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks
	vec4 matcapColor = texture2D( matcap, uv );

	#ifdef MATCAP_BLENDING_MULTIPLY

		outgoingLight *= matcapColor.rgb;

	#elif defined( MATCAP_BLENDING_ADD )

		outgoingLight += matcapColor.rgb;

	#endif

#endif
`,Lt={defines:{TOON:!0,MATCAP:!0,MATCAP_BLENDING_ADD:!0},uniforms:_r.merge([lt.toon.uniforms,lt.phong.uniforms,lt.matcap.uniforms]),vertexShader:lt.phong.vertexShader,fragmentShader:lt.phong.fragmentShader.replace("#include <common>",`
					#ifdef USE_MATCAP
						uniform sampler2D matcap;
					#endif

					#include <common>
				`).replace("#include <envmap_common_pars_fragment>",`
					#include <gradientmap_pars_fragment>
					#include <envmap_common_pars_fragment>
				`).replace("#include <lights_phong_pars_fragment>",Va).replace("#include <envmap_fragment>",`
					#include <envmap_fragment>
					${Ha}
				`)};class Oi extends bn{constructor(e){super(),this._matcapCombine=er,this.emissiveIntensity=1,this.normalMapType=vs,this.combine=tr,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.lights=!0,this.vertexShader=Lt.vertexShader,this.fragmentShader=Lt.fragmentShader,this.defines=Object.assign({},Lt.defines),Object.defineProperty(this,"matcapCombine",{get:function(){return this._matcapCombine},set:function(n){switch(this._matcapCombine=n,n){case tr:this.defines.MATCAP_BLENDING_MULTIPLY=!0,delete this.defines.MATCAP_BLENDING_ADD;break;default:case er:this.defines.MATCAP_BLENDING_ADD=!0,delete this.defines.MATCAP_BLENDING_MULTIPLY;break}}}),this.uniforms=_r.clone(Lt.uniforms);const t=["specular","shininess","opacity","diffuse","map","matcap","gradientMap","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveMap","bumpMap","bumpScale","normalMap","normalScale","displacemantBias","displacemantMap","displacemantScale","specularMap","alphaMap","envMap","reflectivity","refractionRatio"];for(const n of t)Object.defineProperty(this,n,{get:function(){return this.uniforms[n].value},set:function(i){this.uniforms[n].value=i}});Object.defineProperty(this,"color",Object.getOwnPropertyDescriptor(this,"diffuse")),this.setValues(e)}copy(e){return super.copy(e),this.matcapCombine=e.matcapCombine,this.emissiveIntensity=e.emissiveIntensity,this.normalMapType=e.normalMapType,this.combine=e.combine,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}Oi.prototype.isMMDToonMaterial=!0;const Ga=["color","emissive","specular"],$a=["wireframe","metalness","opacity","roughness","shininess","transparent","emissiveIntensity","transmission","thickness","ior"],ki=["type","flatShading","showTexture","gradientMap","matcap"],Xa=[...Ga,...$a,...ki],Wa=["transparent","opacity","wireframe","showTexture","color"],Ya={Basic:[],Toon:["emissive","emissiveIntensity","gradientMap"],Lambert:["emissive","emissiveIntensity"],Phong:["emissive","emissiveIntensity","specular","shininess","flatShading"],Standard:["emissive","emissiveIntensity","metalness","roughness","flatShading"],Physical:["emissive","emissiveIntensity","metalness","roughness","flatShading","transmission","thickness","ior"],Matcap:["flatShading","matcap"],MMDToon:["emissive","emissiveIntensity","specular","shininess","matcap","gradientMap","flatShading"]},ae=r=>`${r}`,sn=r=>Bn(r)?`${r.startsWith("#")?"":"#"}${r}`:r,Ka=r=>Array.isArray(r)?r.join(","):r,zn={wireframe:{name:"Wireframe",type:"boolean",default:!1,valueMap:Te,toString:ae},showTexture:{name:"Texture",type:"boolean",default:!0,valueMap:Te,toString:ae},transparent:{name:"Transparent",type:"boolean",default:!1,valueMap:Te,toString:ae},flatShading:{name:"Flat Shading",type:"boolean",default:!1,valueMap:Te,toString:ae},color:{name:"Color",type:"color",default:"#ffffff",valueMap:kt,toString:sn},emissive:{name:"Emissive",type:"color",default:"#000000",valueMap:kt,toString:sn},opacity:{name:"Opacity",type:"percentage",default:1,min:0,max:1,valueMap:parseFloat,toString:ae},emissiveIntensity:{name:"Emissive Intensity",type:"percentage",default:1,min:0,max:1,valueMap:parseFloat,toString:ae},specular:{name:"Specular",type:"color",default:"#111111",valueMap:kt,toString:sn},metalness:{name:"Metalness",type:"percentage",default:0,min:0,max:1,valueMap:parseFloat,toString:ae},roughness:{name:"Roughness",type:"percentage",default:1,min:0,max:1,valueMap:parseFloat,toString:ae},shininess:{name:"Shininess",type:"number",default:30,min:1,max:100,valueMap:parseFloat,toString:ae},gradientMap:{name:"Gradient Map",type:"select",default:"none",valueMap:Fi,toString:Ka},matcap:{name:"Matcap",type:"select",default:"matcap_fresnel.jpg",valueMap:Ri,toString:ae},transmission:{name:"Transmission",type:"number",default:1,min:0,max:1,valueMap:parseFloat,toString:ae},thickness:{name:"Thickness",type:"number",default:.01,min:0,max:10,valueMap:parseFloat,toString:ae},ior:{name:"Index-of-refraction",type:"number",default:1.5,min:1,max:2.333,valueMap:parseFloat,toString:ae}},Za=Object.fromEntries(Object.entries(zn).map(([r,{default:e}])=>[r,e])),Be={...Za,type:"Basic"},qa=Object.fromEntries(Object.entries(zn).map(([r,{valueMap:e}])=>[r,e])),Qa=Object.fromEntries(Object.entries(zn).map(([r,{toString:e}])=>[r,e])),an=r=>[...Wa,...Ya[r]],Ja=(r,e={})=>{if(r==="MMDToon")return new Oi(e);const t=`Mesh${r}Material`;return new Br[t](e)},vr=(r,{matType:e="Basic",texturePath:t="",force:n=!1}={})=>{r.forEach(i=>{const s=[i.material].flat(),a=Array.isArray(i.material);if(!n&&!t){const l=`isMesh${e}Material`;if(!s.some(c=>!c[l]))return}s.forEach((l,o)=>{var f,h,p,d;const c=t?new Qe().load(t):s[o].map;t&&(c.encoding=fe);const u=Ja(e);if(u.name=l.name,u.map=c,u.userData.backupMap=l.userData.backupMap,t&&((h=(f=l.map)==null?void 0:f.dispose)==null||h.call(f),(d=(p=l.userData.backupMap)==null?void 0:p.dispose)==null||d.call(p)),l.dispose(),a){i.material[o]=u;return}i.material=u})})},eo=r=>Array.isArray(r)?r:r.split(",").map(e=>parseInt(e));function Fi(r){const e=eo(r),t=e.length;if(t<2)return null;const n=Uint8Array.from(e),i=new ys(n,t,1,ws);return i.minFilter=i.magFilter=xs,i.generateMipmaps=!1,i}const to=r=>r.includes("/")||r.includes(":")?r:`${Us}/${r}`;function Ri(r){const e=to(r);return e?Ii(e):null}const no={alpha:!0,antialias:!0},ro="#cccccc",io={type:"Perspective",fov:45,aspect:1,far:300,near:.01},so="c100001_01",Ye={enabled:!0,size:5,color:"#000000",opacity:1},ao={noBackground:!0,fileName:"screenshot",frameRate:30},oo={frameRate:30,fileName:"ani",appendDate:!0},yr=1,vn=30,co={directional:{color:"#ffffff",intensity:.8,position:[1,0,2]},ambient:{color:"#444444",intensity:1},point:{color:"#ffffff",intensity:1}},on={"No Mapping":Es,Linear:bs,Reinhard:Ps,Cineon:Ts,"ACES Filmic":As},Et={addEventListener(r,e){if(!e)return;this._listeners??(this._listeners={});const t=this._listeners;return r=r.toLowerCase(),t[r]??(t[r]=[]),t[r].includes(e)||t[r].push(e),e},hasEventListener(r,e){var t,n;return r=r.toLowerCase(),!!((n=(t=this._listeners)==null?void 0:t[r])!=null&&n.includes(e))},removeEventListener(r,e){var i;r=r.toLowerCase();const t=(i=this._listeners)==null?void 0:i[r];if(!t)return;const n=t.indexOf(e);n!==-1&&t.splice(n,1)},dispatchEvent(r){var i,s;const e=(i=r.type)==null?void 0:i.toLowerCase(),t=(s=this._listeners)==null?void 0:s[e];if(!t)return;r.target=this,[...t].forEach(a=>a.call(this,r))},addCountedEventListener(r,e,t=1){const n=this;function i(s){e.call(n,s),t--,t===0&&n.removeEventListener(r,i)}this.addEventListener(r,i)}},lo={face1:[2,1],face2:[0,0],face3:[1,0],face4:[2,0],face5:[3,0],face6:[0,-1],face7:[1,-1],face8:[2,-1],face9:[3,-1]},_i={},uo=async()=>{const r=await $t(`${Gt}/face-offset.json`);Object.assign(_i,r)},wr=r=>_i[r]||[0,0],yn={},fo=async()=>{const r=await $t(`${Gt}/camera-position.json`);Object.assign(yn,r)},tl=r=>yn[r]??yn[r[0]],wn={},ho=async()=>{const r=await $t(`${Gt}/control-position.json`);Object.assign(wn,r)},nl=r=>wn[r]??wn[r[0]],xr=r=>lo[`face${r}`],po=(r,e)=>{const t={x:0,y:0};if(r!==e){const[n,i]=xr(e),[s,a]=xr(r);t.x=s-n,t.y=a-i}return[t.x,t.y]},mo=(r,e)=>{const t={x:0,y:0};if(r!==e){const[n,i]=wr(e),[s,a]=wr(r);t.x=s-n,t.y=a-i}return[t.x,t.y]},Xt=r=>new Proxy(Object.assign(r,Et),{get(e,t){return e[t]},set(e,t,n){return e[t]=n,e.dispatchEvent({type:"change",propName:t,value:n}),!0}}),Bi=/mEye_[0-9]/m,zi=/mMouth_[0-9]/m,go=/[0-9]{2}/,ji=["eye","mouth"];function vo(r){const{type:e,meshes:t}=r;return e==="adventurer"?yo(r):t.some(({name:i})=>i.match(/mEye|mMouth/))?wo(r):r}function yo(r){const{meshes:e,id:t}=r,n=c=>`${Ur}/${c}/${c}.png`,i=e.find(({name:c})=>c==="mBodyAll"),s={eyeIdx:2,eyeBaseIdx:2,mouthIdx:2,mouthBaseIdx:2,eyeTexture:t,mouthTexture:t},a={type:"uv",reset:function(){this.eyeIdx=this.eyeBaseIdx,this.mouthIdx=this.mouthBaseIdx}},l=c=>([u,f])=>{var w;if(!i)return;const h=`mt${gr(c)}CH`,p=(w=i.geometry.groups)==null?void 0:w.find(g=>{var b;return((b=i.material[g.materialIndex])==null?void 0:b.name)===h});if(!p)return;const{start:d,count:v}=p,y=d+v,x=i.geometry.attributes.uv;for(let g=d;g<y;g++){const b=x.getX(g)+.25*u,E=x.getY(g)+.25*f;x.setXY(g,b,E)}x.needsUpdate=!0},o=c=>u=>{var d,v;if(!i)return;const f=`mt${gr(c)}CH`,h=(v=(d=i.material).find)==null?void 0:v.call(d,({name:y})=>y===f);if(!h)return;const p=n(u);h.map.dispose(),h.map=Ii(p),h.needsUpdate=!0};return ji.forEach(c=>{Object.defineProperties(a,{[`${c}Idx`]:{get(){return s[`${c}Idx`]},set(u){const f=parseInt(u),h=this[`${c}Idx`];s[`${c}Idx`]=f;const p=po(f,h);l(c)(p)}},[`${c}BaseIdx`]:{get(){return s[`${c}BaseIdx`]},set(u){s[`${c}BaseIdx`]=u,this[`${c}Idx`]=u}},[`${c}Texture`]:{get(){return s[`${c}Texture`]},set(u){const f=this[`${c}Texture`];s[`${c}Texture`]=u,o(c)(u);const h=mo(u,f);l(c)(h)}}})}),r.face=Xt(a),r}function wo(r){const{meshes:e}=r,[t,n]=xo(e);[...t,...n].forEach(o=>o.frustumCulled=!1);const i={eye:t,mouth:n},s={eyeIdx:"",eyeBaseIdx:"",mouthIdx:"",mouthBaseIdx:""},a={eyeList:t,mouthList:n,type:"meshes",reset:function(){this.eyeIdx=this.eyeBaseIdx,this.mouthIdx=this.mouthBaseIdx}},l=o=>c=>{i[o].forEach(u=>{const{name:f}=u,h=go.exec(f)[0];u.visible=parseInt(h)===c})};return ji.forEach(o=>Object.defineProperties(a,{[`${o}Idx`]:{get(){return s[`${o}Idx`]},set(c){const u=parseInt(c);l(o)(u),s[`${o}Idx`]=`${u}`}},[`${o}BaseIdx`]:{get(){return s[`${o}BaseIdx`]},set(c){s[`${o}BaseIdx`]=c,this[`${o}Idx`]=c}}})),a.eyeBaseIdx=yr,a.mouthBaseIdx=yr,r.face=Xt(a),r}function xo(r){const e=r.filter(({name:n})=>n.match(Bi)),t=r.filter(({name:n})=>n.match(zi));return[e,t]}function Eo(r){const{model:e,uniqueId:t}=r,[n,i]=ja(e);return Object.defineProperty(i,"list",{value:Da(i.map(({name:s})=>s))}),Object.defineProperty(n,"visible",{get(){return this.filter(({visible:s})=>s)}}),i.forEach(s=>{s.name=`${t}|${s.name}`}),Object.defineProperties(r,{meshes:{get(){return n}},bones:{get(){return i}}})}const Ui={},bo=async()=>{const r=await $t(`${Gt}/model-parts.json`);Object.assign(Ui,r)},Po=r=>Ui[r],To=/mParts([A-Za-z]+)/,Er=/mParts[A-Za-z]+_([A-Za-z]*)/;function Ao(r){const{meshes:e,id:t}=r,n=Po(t),i=[],s=[];if(e.forEach(c=>{var f;let{name:u}=c;if(u!=null&&u.match){if((u.includes("Effect")||u.includes("Extension"))&&(c.visible=!1),(f=n==null?void 0:n.custom)!=null&&f[u]&&(u=c.name=n.custom[u]),u.match(/mParts/)){i.push(c);return}!u.match(Bi)&&!u.match(zi)&&s.push(c)}}),!i.length&&s.length<2)return r;const a=Object.defineProperties({},{list:{get(){return Object.keys(this)},enumerable:!1},reset:{value:function(){this.list.forEach(c=>this[c].reset())},enumerable:!1},others:{get(){return s},enumerable:!1}});if(r.parts=a,!i.length)return r;const l=new Set(i.map(({name:c})=>{var u;return(u=To.exec(c))==null?void 0:u[1]}).sort((c,u)=>c>u?1:-1)),o=c=>i.filter(({name:u})=>u.includes(`mParts${c}`)).sort((u,f)=>u.name>f.name?1:-1);return l.forEach(c=>{var y;const u=n==null?void 0:n[c],f=((y=u==null?void 0:u.name)==null?void 0:y.replaceAll(" ","_"))??c,h=u==null?void 0:u.options,p=o(c);p.forEach(x=>x.frustumCulled=!1);const d=p.map(({name:x})=>{var g;const w=((g=Er.exec(x))==null?void 0:g[1])??"default";return(h==null?void 0:h[w])??w}),v=(u==null?void 0:u.default)??d[0];a[f]={_meshes:p,list:d,default:v??d[0]},Object.defineProperties(a[f],{current:{get(){var E;const x=p.filter(({visible:T})=>T).length;if(x===0)return"None";if(x!==1)return"custom";const g=(E=p.find(({visible:T})=>T).name.match(Er))==null?void 0:E[1];return(h==null?void 0:h[g??"default"])??g??"default"},set(x){if(x.toLowerCase()==="none"){this._meshes.forEach((g,b)=>{g.visible=!1});return}if(!this.list.includes(x))return;const w=this.list.indexOf(x);this._meshes.forEach((g,b)=>{g.visible=b===w})}},index:{get(){return this.current==="custom"?NaN:this.list.indexOf(this.current)},set(x){this._meshes.forEach((w,g)=>{w.visible=g===Number(x)})}},reset:{value:function(){this.current=this.default}}})}),a.reset(),r.parts=a,r}const Mo=r=>e=>{const t=e.meshes,n={...Be,...r},{type:i}=n;vr(t,{force:!0,matType:i});let s={type:i,showTexture:!0},a=an(i);const l={get code(){const{type:o,propList:c}=this,u=[];return o!==Be.type&&u.push(`type=${o}`),c.forEach(h=>{const p=Qa[h],d=p(this[h]),v=p(Be[h]);d!==v&&u.push(`${h}=${d}`)}),u.join("/").replaceAll("#","")},set code(o){const c=Object.keys(Be),u={...Be,...Di(o)};c.forEach(f=>{this[f]=u[f]})},toString(){const{code:o}=this;return o?`mat=(${o})`:""},get list(){return t.flatMap(({material:o})=>o)},get propList(){return a},set type(o){if(this.type===o)return;a=an(o),vr(t,{matType:o}),s.type=o;const c={...s};s={showTexture:c.showTexture},a.forEach(u=>this[u]=c[u]),s=c},set flatShading(o){const c=Te(o);c!==this.flatShading&&(s.flatShading=c,this.propList.includes("flatShading")&&this.list.forEach(u=>{u.flatShading=c,u.needsUpdate=!0}))},set gradientMap(o){var f,h;if(o===this.gradientMap||(s.gradientMap=o,!this.propList.includes("gradientMap")))return;const c=(f=this.list[0])==null?void 0:f.gradientMap;(h=c==null?void 0:c.dispose)==null||h.call(c);const u=o==="none"?null:Fi(o);this.list.forEach(p=>{p.gradientMap=u,p.needsUpdate=!0})},set showTexture(o){const c=Te(o);if(this.showTexture===c)return;s.showTexture=c;const u=c?f=>{f.map=f.userData.backupMap,f.userData.backupMap=null,f.needsUpdate=!0}:f=>{f.userData.backupMap=f.map,f.map=null,f.needsUpdate=!0};this.list.forEach(u)},set matcap(o){var f,h;if(s.matcap===o||(s.matcap=o,!this.propList.includes("matcap")))return;const c=(f=this.list[0])==null?void 0:f.matcap;(h=c==null?void 0:c.dispose)==null||h.call(c);const u=Ri(o);this.list.forEach(p=>{p.matcap=u,p.needsUpdate=!0})}};return Xa.forEach(o=>Object.defineProperty(l,o,{get(){return s[o]},...!ki.includes(o)&&{set(c){c!==this[o]&&(s[o]=c,this.propList.includes(o)&&this.list.forEach(u=>u[o]=qa[o](c)))}}})),an(i).forEach(o=>l[o]=n[o]),s={...Be,...s},e.material=Xt(l),e},Lo=`uniform float opacity;\r
uniform vec3 color;\r
\r
void main() {\r
	gl_FragColor = vec4( color, opacity );\r
}\r
`,So=`uniform float size;\r
\r
#include <skinning_pars_vertex>\r
\r
void main() {\r
	#include <skinbase_vertex>\r
	\r
    vec3 transformed = position + normal * 0.0005 * size;\r
        \r
	#include <skinning_vertex>\r
	#include <project_vertex>\r
}`,Co=r=>new bn({side:Ms,transparent:!0,depthFunc:Ls,vertexShader:So,fragmentShader:Lo,uniforms:r});function Io(r,e){const{material:t}=r,n=Array.isArray(r.material);[t].flat().forEach(za),r.material=n?new Array(r.material.length).fill(e):e}function Do(r,e){const t=Co(e),n=[],i=["Eff","Extension"];return r.forEach(s=>{const{name:a}=s;if(i.some(o=>a.includes(o)))return;const l=s.clone();l.name=`outline-${s.name}`,Io(l,t),s.isSkinnedMesh&&l.bind(s.skeleton,s.bindMatrix),s.add(l),n.push(l)}),n}const Oo={size:parseFloat,opacity:parseFloat,color:kt},ko=r=>e=>{const t={...Ye,...r},n=e.meshes,i={size:{value:t.size},opacity:{value:t.opacity},color:{value:new J(t.color)}},s=Do(n,i),a={...t,enabled:!0},l={get propList(){return["enabled","color","size","opacity"]},get enabled(){return a.enabled},set enabled(o){const c=Te(o);s.forEach(u=>u.visible=c),a.enabled=c},get code(){if(!this.enabled)return"none";const o=[];return Object.keys(Ye).forEach(c=>{const u=this[c];u!==Ye[c]&&o.push(`${c}=${u}`)}),o.join("/").replaceAll("#","")},set code(o){if(o==="none"){this.enabled=!1;return}const c=Object.keys(Ye),u={...Ye,...Di(o)};c.forEach(f=>{this[f]=u[f]})},toString(){const{code:o}=this;return o?`ol=(${o})`:""}};return["size","opacity","color"].forEach(o=>Object.defineProperty(l,o,{get(){return a[o]},set(c){c!==this[o]&&(a[o]=c,i[o].value=Oo[o](c))}})),l.enabled=t.enabled,e.outline=Xt(l),e},Fo=["push","pop","shift","unshift","splice","reverse","sort"];class ze extends Array{constructor(...e){super(...e),Object.assign(this,Et),Fo.forEach(t=>{Object.defineProperty(this,t,{value:(...n)=>{Array.prototype[t].call(this,...n),this.dispatchEvent({type:"change",method:t,args:n})},enumerable:!1})})}remove(e){const t=this.indexOf(e);t!==-1&&this.splice(t,1)}}const br={chainName:"",chainCode:"",chainLength:0,aniIdx:0,clipDuration:0,clipTimeScale:1,action:null,aniAction:[],aniActionPointer:0};function Ro(r){return r.split(">").map(_o)}function _o(r){const[e,...t]=r.split("&"),n=Bo(t);return{aniName:e,...n}}function Bo(r){const e={},t=[],n={r:{name:"reps",map:parseInt},ts:{name:"timeScale",map:parseFloat},dur:{name:"duration",map:zo}};return r.forEach(i=>{const[s,a]=Ci(i);if(s.startsWith("@")){const c=jo(a.replace(/[()]/g,""));c.time=parseFloat(s.slice(1)),t.push(c);return}if(!n[s])return;const{name:l,map:o}=n[s];e[l]=o(a)}),e.aniAction=t.filter(({time:i})=>i<=100&&i>=0).sort((i,s)=>i.time-s.time),e}function zo(r){if(!r)return[0,100];const e=r.split("-").slice(0,2).map(parseFloat),t=e.length===2?e:[0,e[0]];return t.some(n=>n>100||n<0)||t[0]>t[1]?[0,100]:t}function jo(r){return r.split("/").reduce((t,n)=>{const[i,s]=Ci(n);return{...t,...Uo(i,s)}},{})}const Pr={ei:{name:"face.eyeIdx",valueMap:parseInt},mi:{name:"face.mouthIdx",valueMap:parseInt},et:{name:"face.eyeTexture"},mt:{name:"face.mouthTexture"}};function Uo(r,e){if(r in Pr){const{name:i,valueMap:s}=Pr[r];return{[i]:(s==null?void 0:s(e))??e}}let t=r,n=e;return r.startsWith("att")&&t.replace("att","attachment"),r.startsWith("parts")&&(t+="index",n=parseInt(e)),{[t]:n}}const No=r=>`${Nr}/${r}.json`;function Vo(r,e){if(r.startsWith("fbx:"))return Ho(r);if(r.startsWith("ex:")){const[,n]=r.split(":"),i=e==null?void 0:e.find(({uuid:s})=>n===s);return Promise.resolve(i.clone())}const t=No(r);return new Promise(n=>fetch(t).then(i=>i.json()).then(i=>Rr.parse(i)).then(n))}async function Ho(r){const e=r.replace("fbx:",""),[t,n]=e.split("+"),{animations:i}=await Mi(t);return n?i.find(({name:s})=>s===n):i[0]}function Go(r,e=null){return Promise.all(r.map(t=>Vo(t,e)))}function $o(r,e=[]){return r.map((t,n)=>{const i=e[n];if(!i||i[0]===0&&i[1]===100)return t;const s=t.duration*vn,[a,l]=i.map(o=>Math.round(o*s/100));return Ss.subclip(t,t.name,a,l,vn)})}async function Xo(r,e=null){const t=Ro(r),n=t.map(({aniName:c})=>c),i=t.map(({duration:c})=>c),s=t.map(({aniName:c,duration:u,...f})=>({...f})),a=await Go(n,e),l=$o(a,i);return{code:r,clips:l,mod:s,get duration(){return s.some(({timeScale:u})=>u===0)?1/0:l.map((u,f)=>u.duration/Math.abs(s[f].timeScale??1)*(s[f].reps??1)).reduce((u,f)=>u+f,0)}}}const Wo=/[a-z][0-9]{6}/;function Yo(r){const{model:e,uniqueId:t,bones:n,id:i,viewer:s}=r,a=s.userData.ani,l=new Cs(e),o=(n==null?void 0:n.list)??[],c={...Et,mixer:l,chain:{},current:{...br},toString(){var h;const f=(h=this.chain.default)==null?void 0:h.code;return f?`ani=${f}`:""},async addChain(f,{name:h="default",autoplay:p=!0}={}){var v;if(!f||((v=this.chain[h])==null?void 0:v.code)===f)return;l.stopAllAction();const d=await Xo(f,a);d.clips.forEach(y=>{y.tracks=y.tracks.reduce((x,w)=>{let g=w.name.split(".")[0];return Wo.test(g)&&(w.name.replace(g,i),g=i),o.includes(g)&&(w.name=`${t}|${w.name}`,x.push(w)),x},[])}),this.chain[h]=d,l.addEventListener("finished",u),p&&this.play(h)},play(f=this.current.chainName||"default"){const h=this.chain[f];h&&(this.current.chainName=f,this.current.chainCode=h.code,this.current.chainLength=h.clips.length,this.aniIdx=0)},pause(){this.current.action&&(this.current.action.paused=!0)},resume(){this.current.action&&(this.current.action.paused=!1)},stop(){l.stopAllAction()},reset(){const f=this.current.chainName;this.stop(),this.current={...br},this.chain[f]=void 0},update(f){var y;l.update(f);const{current:h}=this,{action:p,aniAction:d,clipDuration:v}=h;if(!(!d[h.aniActionPointer]||!p))for(;(p==null?void 0:p.time)>((y=d[h.aniActionPointer])==null?void 0:y.time)*v/100;)this.applyAniAction(d[h.aniActionPointer]),this.current.aniActionPointer++},applyAniAction(f){r.dispatchEvent({type:"aniAction",id:t,aniAction:f});const{time:h,...p}=f;Object.entries(p).forEach(([d,v])=>{const y=d.split(".");Si(r,y,v)})},nextFrame(f=1,h=vn){if(!this.isPaused)return;const{clipTimeScale:p,clipDuration:d,action:v}=this.current,y=f*p/h;if(v.time+=y,v.time>=d){const x=v.time-d;u(),this.pause(),this.current.action.time+=x*this.current.clipTimeScale}},setTime(f){const{clipDuration:h,action:p}=this.current;!h||f>h||(p.time=f)},get isPaused(){var f;return(f=this.current.action)==null?void 0:f.paused},get aniIdx(){return this.current.aniIdx},set aniIdx(f){if(f>=this.current.chainLength)return;this.current.aniIdx=f,this.current.aniActionPointer=0;const h={type:f===0?"chainStart":"chainMove",index:f,uniqueId:t,chainName:this.current.chainName};this.dispatchEvent(h),l.stopAllAction();const p=this.chain[this.current.chainName],d=p.mod[f],{timeScale:v,reps:y,aniAction:x}=d,w=p.clips[f],g=l.clipAction(w);g.timeScale=v??1,g.setLoop(Is,y??1),this.current.clipDuration=w.duration,this.current.action=g,this.current.aniAction=x,this.current.aniActionPointer=0,this.current.clipTimeScale=v??1,g.play()}};function u(){const{aniIdx:f,chainLength:h}=c.current,p=(f+1)%h;if(p===0){c.dispatchEvent({type:"ChainFinished",chainName:c.current.chainName});const{face:d}=r;d&&(d.eyeIdx=d.eyeBaseIdx,d.mouthIdx=d.mouthBaseIdx)}c.aniIdx=p}return r.animation=c,r.addEventListener("TimeUpdated",({dt:f})=>c.update(f)),r}function Ko(r){const{model:e,bones:t,uniqueId:n}=r,i={};return Object.defineProperty(i,"list",{get(){return Object.values(this).flat()}}),Object.defineProperty(i,"traverse",{value:function(u){this.list.forEach(f=>{var h,p;u(f),(p=(h=f.attachment)==null?void 0:h.traverse)==null||p.call(h,u)})}}),Object.assign(r,{attachment:i,parent:null,parentBone:"",attach:(u,f="root")=>{i[f]=i[f]??new ze;const h=f==="root"?e:t.find(({name:p})=>p===`${n}|${f}`);h!=null&&h.add&&(u.detach(),h.add(u.model),i[f].push(u),u.parent=r,u.parentBone=f,r.dispatchEvent({type:"AttachmentChanged"}))},remove:(u,f="")=>{var p,d,v;const h=f||Object.keys(i).find(y=>i[y].indexOf(u)!==-1);h&&((d=(p=i[h]).remove)==null||d.call(p,u),(v=u.model.parent)==null||v.remove(u.model),r.dispatchEvent({type:"AttachmentChanged"}))},detach:()=>{var h;(h=e.parent)==null||h.remove(e);const{parent:u,parentBone:f}=r;u&&(u.remove(r,f),r.parent=r.parentBone=null)},attachTo:(u,f="root")=>{var h;r.detach(),(h=u==null?void 0:u.attach)==null||h.call(u,r,f)}})}function Zo(r){const{material:e,id:t}=r,n=ht.source.fbx,i=Tr(t);ka(t)&&async function(){const o=l(i),c=new Qe().load(o);c.encoding=fe,c.name=i,e.list.forEach(u=>u.map=u.map??c)}();let s=i;Object.defineProperty(r,"texture",{get(){return s},set(o){if(!o){this.texture=i;return}if(o===s)return;const c=l(o),[,u]=a(o),[,f]=a(this.texture),h=e.list.filter(p=>{var d,v,y,x;return((v=(d=p.map)==null?void 0:d.name)==null?void 0:v.includes(f))||((x=(y=p.userData.backupMap)==null?void 0:y.name)==null?void 0:x.includes(f))});h.length&&(async function(){const p=await Li(c);p.name=u,p.encoding=fe,h.forEach(d=>{var v,y,x,w;d.map&&((y=(v=d.map).dispose)==null||y.call(v),d.map=p),d.userData.backupMap&&((w=(x=d.userData.backupMap).dispose)==null||w.call(x),d.userData.backupMap=p)})}(),s=o)}});function a(o){const[c,u]=o.split(">"),f=c||t,h=u||Tr(f);return[f,h]}function l(o){const[c,u]=a(o);return`${n}/${c}/${u}.png`}return r}const Tr=r=>r.match(/_[0-9]{2}/)||r.startsWith("h")?r:`>${r}_01`,qo=`uniform float uTime;\r
uniform float uSpread;\r
uniform float uThreshold;\r
uniform float uSpeed;\r
uniform float uParticleSize;\r
uniform float uAuraSize;\r
\r
attribute float aRandom;\r
\r
varying float vIsParticle;\r
varying float vRandom;\r
\r
#include <skinning_pars_vertex>\r
void main() {\r
    #include <skinbase_vertex>\r
\r
    vec3 transformed = position + normal * 0.005 * uSpread;\r
\r
    #include <skinning_vertex>\r
\r
    vec3 objectNormal = normal;\r
\r
	#include <skinnormal_vertex>\r
    \r
    vec4 viewPosition = viewMatrix * modelMatrix * vec4(transformed, 1.0);\r
    float yDisplacement = fract( uTime * uSpeed + aRandom ) * 0.1;\r
    viewPosition.y += yDisplacement;\r
    viewPosition.x += sin( uTime * aRandom * uSpeed + aRandom ) * 0.02;\r
    \r
    gl_Position = projectionMatrix * viewPosition;\r
    \r
    objectNormal.z *= objectNormal.z > 0.7 ? -1.0 : 1.0;\r
    vIsParticle = objectNormal.z - uThreshold;\r
\r
    gl_PointSize = vIsParticle > 0.0 ? uParticleSize : uAuraSize;\r
    gl_PointSize /= -viewPosition.z;\r
\r
    vRandom = aRandom;\r
}\r
`,Qo=`uniform sampler2D uTexture;\r
\r
uniform float uTime;\r
uniform float uParticleOpacity;\r
uniform float uAuraOpacity;\r
uniform vec3 uColor;\r
uniform vec3 uColor2;\r
\r
varying float vRandom;\r
varying float vIsParticle;\r
\r
void main(){\r
    vec4 textureColor = texture2D( uTexture, gl_PointCoord );\r
    textureColor.a = length( textureColor.rgb ) ;\r
    textureColor.a *= abs( 1.0 - fract( uTime + vRandom ) ) * 0.5;\r
    textureColor.rgb = mix( uColor, uColor2,  textureColor.a * 2.0 );\r
    textureColor.a *= vIsParticle > 0.0 ? uParticleOpacity * 4.0 : uAuraOpacity;\r
\r
    gl_FragColor = textureColor;\r
    gl_FragColor /= vIsParticle > 0.0 ? 2.0 : 4.0;\r
}\r
`,Ft=[{name:"time",uName:"uTime",defaultValue:0,valueMap:Number},{name:"speed",uName:"uSpeed",defaultValue:1,valueMap:Number},{name:"particleOpacity",uName:"uParticleOpacity",defaultValue:.3,valueMap:Number},{name:"auraOpacity",uName:"uAuraOpacity",defaultValue:.3,valueMap:Number},{name:"particleSize",uName:"uParticleSize",defaultValue:10,valueMap:Number},{name:"auraSize",uName:"uAuraSize",defaultValue:100,valueMap:Number},{name:"spread",uName:"uSpread",defaultValue:5,valueMap:Number},{name:"threshold",uName:"uThreshold",defaultValue:.3,valueMap:Number},{name:"texture",uName:"uTexture",defaultValue:"img/textures/particle/cloud.png",valueMap:r=>new Qe().load(r)},{name:"color",uName:"uColor",defaultValue:"#ffffff",valueMap:r=>new J(r)},{name:"color2",uName:"uColor2",defaultValue:"#33ffff",valueMap:r=>new J(r)}],Jo={aura:["visible",...Ft.slice(1).map(({name:r})=>r)]},ec=(r="aura")=>(e,t={})=>{if(e!=null&&e.length&&r==="aura")return nc(e,t)};function tc(r){return new bn({vertexShader:qo,fragmentShader:Qo,uniforms:r,transparent:!0,blending:ks,depthWrite:!1,side:Fs})}function nc(r,e){const t=Ft.map(o=>{const{uName:c,defaultValue:u,valueMap:f}=o,h=(f==null?void 0:f(u))??u;return[c,{value:h}]}),n=Object.fromEntries(t),i=tc(n),s=[];r.forEach(o=>{const{name:c}=o.geometry;if(c.startsWith("mEye")||c.startsWith("mMouth"))return;const u=o.geometry.clone(),f=u.attributes.position.count,h=new Float32Array(f).fill(0).map(()=>Math.random()-.5);u.setAttribute("aRandom",new Ds(h,1)),u.deleteAttribute("color"),u.deleteAttribute("uv");const p=new Os(u,i);p.name="aura",o.isSkinnedMesh&&(p.type="SkinnedMesh",p.isSkinnedMesh=!0,p.skeleton=o.skeleton,p.bindMatrix=o.bindMatrix,p.bindMatrixInverse=o.bindMatrixInverse,p.bindMode=o.bindMode,p.bind=o.bind,p.clone=o.clone,p.initBones=o.initBones,p.normalizeSkinWeights=o.normalizeSkinWeights,p.pose=o.pose,p.updateMatrixWorld=o.updateMatrixWorld),o.add(p),s.push(p)});const a={visible:!0},l={name:"aura",onDispose:()=>{},get list(){return s},get propList(){return Jo.aura},get visible(){return a.visible},set visible(o){const c=Te(o);this.list.forEach(u=>u.visible=c),a.visible=c},dispose(){this.onDispose(),this.list.forEach(o=>{var c,u,f,h,p;(c=o.parent)==null||c.remove(o),(f=(u=o.material).dispose)==null||f.call(u),(p=(h=o.geometry).dispose)==null||p.call(h)})},set code(o){o.split("/").forEach(u=>{const[f,h]=u.split("=");Ft.map(({name:p})=>p).includes(f)&&(this[f]=h)})}};return Ft.forEach(o=>{const{name:c,uName:u,defaultValue:f,valueMap:h}=o;a[c]=f,Object.defineProperty(l,c,{get(){return a[c]},set(p){a[c]=p,n[u].value=(h==null?void 0:h(p))??p}})}),l.onTimeUpdate=({time:o})=>l.time=o,Object.entries(e).forEach(([o,c])=>l[o]=c),l}function rc(r){const{meshes:e}=r,t={list:new ze,dispose(){this.list.forEach(n=>{var i;return(i=n.dispose)==null?void 0:i.call(n)})},add(n="aura",i={}){const s=ec(n)(e,i);return s.onDispose=()=>this.list.remove(s),this.list.push(s),r.addEventListener("TimeUpdated",s.onTimeUpdate),s}};return r.particle=t,r}const ic=r=>{var l,o;if(r.dispatchEvent({type:"dispose"}),!r)return;const{model:e,meshes:t,outline:n,particle:i,viewer:s}=r;i==null||i.list.forEach(c=>c.dispose()),(l=e.parent)!=null&&l.isScene&&(e.parent.remove(e),s.loadedModel.remove(r)),(o=r.detach)==null||o.call(r),[t.reverse(),n==null?void 0:n.all].flat().forEach(Ua)};function sc(r){const{x:e,y:t,z:n}=r;return[e,t,n].map(i=>i||"").join()}const ac={position:",,",rotation:",,",scale:"1,1,1"},oc={position:"pos",rotation:"rot",scale:"scl"};function cc(r){return Object.assign(r,{...r.isDLModel&&{toString(){const{id:e,animation:t,outline:n,material:i}=this,s=Object.entries(ac).map(([a,l])=>{const o=sc(this[a]);return o===l?"":`${oc[a]}=${o}`});return[`id=${e}`,...s,t,n,i].filter(a=>`${a}`).join("/")}},dispose(){const{attachment:e,parent:t,parentBone:n}=this;e.list.forEach(i=>i.dispose()),t==null||t.remove(this,n),this.dispatchEvent({type:"dispose"}),ic(this)}})}let Ni=(r=21)=>crypto.getRandomValues(new Uint8Array(r)).reduce((e,t)=>(t&=63,t<36?e+=t.toString(36):t<62?e+=(t-26).toString(36).toUpperCase():t>62?e+="-":e+="_",e),"");function lc(r,e){const{id:t,material:n,outline:i,viewer:s}=e,a=[Eo,Ao,Ko,ko(i),Mo(n),Zo,vo,Yo,rc,cc],l={...Et,isDLModel:!0,model:r,id:t,uniqueId:Ni(),type:Fa(t),viewer:s,userData:{},_time:0,update(o){var c;this._time+=o,(c=this.attachment)==null||c.list.forEach(u=>{var f;return(f=u.update)==null?void 0:f.call(u,o)}),this.dispatchEvent({type:"TimeUpdated",dt:o,time:this._time})},set scale(o){var u;if((u=o.includes)!=null&&u.call(o,",")){const[f,h,p]=o.split(",").map(d=>d?parseFloat(d):1);this.model.scale.set(f,h,p);return}const c=Number(o)||1;this.model.scale.set(c,c,c)},get scale(){const{scale:o}=this.model,{x:c,y:u,z:f}=o;return c===u&&c===f?c:[c,u,f].join(",")},set visible(o){this.model.visible=Te(o)}};return["position","rotation","visible"].forEach(o=>Object.defineProperty(l,o,{get(){return this.model[o]},enumerable:!0})),r.userData.container=l,Ia(...a)(l)}class Ar extends Pn{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,n){const i=e.getContext(),s=e.state;s.buffers.color.setMask(!1),s.buffers.depth.setMask(!1),s.buffers.color.setLocked(!0),s.buffers.depth.setLocked(!0);let a,l;this.inverse?(a=0,l=1):(a=1,l=0),s.buffers.stencil.setTest(!0),s.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),s.buffers.stencil.setFunc(i.ALWAYS,a,4294967295),s.buffers.stencil.setClear(l),s.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),s.buffers.color.setLocked(!1),s.buffers.depth.setLocked(!1),s.buffers.stencil.setLocked(!1),s.buffers.stencil.setFunc(i.EQUAL,1,4294967295),s.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),s.buffers.stencil.setLocked(!0)}}class uc extends Pn{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class fc{constructor(e,t){if(this.renderer=e,t===void 0){const n=e.getSize(new q);this._pixelRatio=e.getPixelRatio(),this._width=n.width,this._height=n.height,t=new zr(this._width*this._pixelRatio,this._height*this._pixelRatio),t.texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],rr===void 0&&console.error("THREE.EffectComposer relies on CopyShader"),ir===void 0&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new ir(rr),this.clock=new jr}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let n=!1;for(let i=0,s=this.passes.length;i<s;i++){const a=this.passes[i];if(a.enabled!==!1){if(a.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(i),a.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),a.needsSwap){if(n){const l=this.renderer.getContext(),o=this.renderer.state.buffers.stencil;o.setFunc(l.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),o.setFunc(l.EQUAL,1,4294967295)}this.swapBuffers()}Ar!==void 0&&(a instanceof Ar?n=!0:a instanceof uc&&(n=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new q);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const n=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(n,i),this.renderTarget2.setSize(n,i);for(let s=0;s<this.passes.length;s++)this.passes[s].setSize(n,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}new Dr(-1,1,1,-1,0,1);const Vi=new ut;Vi.setAttribute("position",new Ie([-1,3,0,-1,-1,0,3,-1,0],3));Vi.setAttribute("uv",new Ie([0,2,0,0,2,0],2));class hc extends Pn{constructor(e,t,n,i,s){super(),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=i,this.clearAlpha=s!==void 0?s:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new J}render(e,t,n){const i=e.autoClear;e.autoClear=!1;let s,a;this.overrideMaterial!==void 0&&(a=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),s=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,s),this.overrideMaterial!==void 0&&(this.scene.overrideMaterial=a),e.autoClear=i}}function Mr({renderer:r,scene:e,camera:t}){const n=pc(),i=new fc(r,n),s=new hc(e,t);return i.addPass(s),i}const pc=()=>new zr(800,600,{minFilter:nr,magFilter:nr,format:Rs,encoding:fe}),cn={bloom:mc,pixel:vc,afterimage:bc,sobel:yc,halftone:wc,dotscreen:xc,bokeh:Ec,smaa:gc};async function dc(r,e){var n;r=r.toLowerCase();const t=await((n=cn[r])==null?void 0:n.call(cn,e));return t.type=r,t.name=jn[r].name,t}function Wt(r,e){Object.defineProperty(r,"propList",{value:e}),e.forEach(t=>{Object.defineProperty(r,t,{get(){return this.uniforms[t].value},set(n){this.uniforms[t].value=n}})})}async function mc({resolution:r=new q(800,600),strength:e=.3,radius:t=.5,threshold:n=.8}={}){const{UnrealBloomPass:i}=await ve(()=>import("./UnrealBloomPass-f26e8860.js"),["assets/UnrealBloomPass-f26e8860.js","assets/three-5c1cbd72.js","assets/Pass-4a28857e.js","assets/CopyShader-e27bbfcf.js"]),s=new i(r,e,t,n);return Object.defineProperty(s,"propList",{value:["radius","strength","threshold"],writable:!1}),s}async function gc({renderer:r}){const{SMAAPass:e}=await ve(()=>import("./SMAAPass-651d813e.js"),["assets/SMAAPass-651d813e.js","assets/three-5c1cbd72.js","assets/Pass-4a28857e.js"]),t=new q;r.getSize(t);const n=new e(t.x,t.y);return Object.defineProperty(n,"propList",{value:[],writable:!1}),n}async function vc({scene:r,camera:e}){const{RenderPixelatedPass:t}=await ve(()=>import("./RenderPixelatedPass-8f5101dd.js"),["assets/RenderPixelatedPass-8f5101dd.js","assets/three-5c1cbd72.js","assets/Pass-4a28857e.js"]),n=new t(5,r,e);return Object.defineProperty(n,"propList",{value:["size"],writable:!1}),Object.defineProperty(n,"size",{get(){return this.pixelSize},set(i){this.setPixelSize(i)}}),n}async function yc({renderer:r}){const{ShaderPass:e}=await ve(()=>import("./ShaderPass-8cbc6b59.js"),["assets/ShaderPass-8cbc6b59.js","assets/three-5c1cbd72.js","assets/Pass-4a28857e.js"]),{SobelOperatorShader:t}=await ve(()=>import("./SobelOperatorShader-aff5c039.js"),["assets/SobelOperatorShader-aff5c039.js","assets/three-5c1cbd72.js"]),n=new q;r.getSize(n),n.multiplyScalar(window.devicePixelRatio);const i=new e(t);return i.uniforms.resolution.value.x=n.x,i.uniforms.resolution.value.y=n.y,Object.defineProperty(i,"propList",{value:[],writable:!1}),i}async function wc({renderer:r}){const{HalftonePass:e}=await ve(()=>import("./HalftonePass-46d20e26.js"),["assets/HalftonePass-46d20e26.js","assets/three-5c1cbd72.js","assets/Pass-4a28857e.js"]),t=new q;r.getSize(t);const n=new e(t.x,t.y,{radius:4});return Wt(n,["greyscale","radius","scatter","shape"]),n}async function xc(){const{DotScreenPass:r}=await ve(()=>import("./DotScreenPass-5feabc0e.js"),["assets/DotScreenPass-5feabc0e.js","assets/three-5c1cbd72.js","assets/Pass-4a28857e.js"]),e=new r;return Wt(e,["scale","center"]),e}async function Ec({scene:r,camera:e}){const{BokehPass:t}=await ve(()=>import("./BokehPass-e5a436d4.js"),["assets/BokehPass-e5a436d4.js","assets/three-5c1cbd72.js","assets/Pass-4a28857e.js"]),n=new t(r,e,{});return Wt(n,["focus","aperture","aspect"]),n}async function bc(){const{AfterimagePass:r}=await ve(()=>import("./AfterimagePass-d7816a10.js"),["assets/AfterimagePass-d7816a10.js","assets/three-5c1cbd72.js","assets/Pass-4a28857e.js"]),e=new r(.7);return Wt(e,["damp"]),e}function Pc(r){const{name:e,type:t}=r,n=jn[t].propList??[],i={};return n.forEach(a=>{Object.defineProperty(i,a,{get(){return r[a]},set(l){r[a]=l},enumerable:!0})}),{target:r,name:e,type:t,params:i,id:Ni()}}const jn={bloom:{name:"Bloom",propList:["enabled","radius","strength","threshold"]},pixel:{name:"Pixelate",propList:["enabled","size"]},afterimage:{name:"Afterimage",propList:["enabled","damp"]},sobel:{name:"Sobel",propList:["enabled"]},halftone:{name:"Halftone",propList:["enabled","greyscale","radius","scatter","shape"]},dotscreen:{name:"Dot Screen",propList:["enabled","scale"]},bokeh:{name:"Bokeh",propList:["enabled","focus","aperture","aspect"]},smaa:{name:"SMAA",propList:["enabled"]}};Object.entries(jn).map(([r,{name:e}])=>({value:r,label:e}));var Hi={exports:{}};(function(r,e){(function(t,n){r.exports=n()})($e,function(){var t=function(){function n(p){return a.appendChild(p.dom),p}function i(p){for(var d=0;d<a.children.length;d++)a.children[d].style.display=d===p?"block":"none";s=p}var s=0,a=document.createElement("div");a.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",a.addEventListener("click",function(p){p.preventDefault(),i(++s%a.children.length)},!1);var l=(performance||Date).now(),o=l,c=0,u=n(new t.Panel("FPS","#0ff","#002")),f=n(new t.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var h=n(new t.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:a,addPanel:n,showPanel:i,begin:function(){l=(performance||Date).now()},end:function(){c++;var p=(performance||Date).now();if(f.update(p-l,200),p>o+1e3&&(u.update(1e3*c/(p-o),100),o=p,c=0,h)){var d=performance.memory;h.update(d.usedJSHeapSize/1048576,d.jsHeapSizeLimit/1048576)}return p},update:function(){l=this.end()},domElement:a,setMode:i}};return t.Panel=function(n,i,s){var a=1/0,l=0,o=Math.round,c=o(window.devicePixelRatio||1),u=80*c,f=48*c,h=3*c,p=2*c,d=3*c,v=15*c,y=74*c,x=30*c,w=document.createElement("canvas");w.width=u,w.height=f,w.style.cssText="width:80px;height:48px";var g=w.getContext("2d");return g.font="bold "+9*c+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=s,g.fillRect(0,0,u,f),g.fillStyle=i,g.fillText(n,h,p),g.fillRect(d,v,y,x),g.fillStyle=s,g.globalAlpha=.9,g.fillRect(d,v,y,x),{dom:w,update:function(b,E){a=Math.min(a,b),l=Math.max(l,b),g.fillStyle=s,g.globalAlpha=1,g.fillRect(0,0,u,v),g.fillStyle=i,g.fillText(o(b)+" "+n+" ("+o(a)+"-"+o(l)+")",h,p),g.drawImage(w,d+c,v,y-c,x,d,v,y-c,x),g.fillRect(d+y-c,v,c,x),g.fillStyle=s,g.globalAlpha=.9,g.fillRect(d+y-c,v,c,o((1-b/E)*x))}}},t})})(Hi);const Tc=Hi.exports;var Yt={exports:{}};(function(r,e){(function(t,n){n()})($e,function(){function t(c,u){return typeof u>"u"?u={autoBom:!1}:typeof u!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),u={autoBom:!u}),u.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(c.type)?new Blob(["\uFEFF",c],{type:c.type}):c}function n(c,u,f){var h=new XMLHttpRequest;h.open("GET",c),h.responseType="blob",h.onload=function(){o(h.response,u,f)},h.onerror=function(){console.error("could not download file")},h.send()}function i(c){var u=new XMLHttpRequest;u.open("HEAD",c,!1);try{u.send()}catch{}return 200<=u.status&&299>=u.status}function s(c){try{c.dispatchEvent(new MouseEvent("click"))}catch{var u=document.createEvent("MouseEvents");u.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),c.dispatchEvent(u)}}var a=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof $e=="object"&&$e.global===$e?$e:void 0,l=a.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),o=a.saveAs||(typeof window!="object"||window!==a?function(){}:"download"in HTMLAnchorElement.prototype&&!l?function(c,u,f){var h=a.URL||a.webkitURL,p=document.createElement("a");u=u||c.name||"download",p.download=u,p.rel="noopener",typeof c=="string"?(p.href=c,p.origin===location.origin?s(p):i(p.href)?n(c,u,f):s(p,p.target="_blank")):(p.href=h.createObjectURL(c),setTimeout(function(){h.revokeObjectURL(p.href)},4e4),setTimeout(function(){s(p)},0))}:"msSaveOrOpenBlob"in navigator?function(c,u,f){if(u=u||c.name||"download",typeof c!="string")navigator.msSaveOrOpenBlob(t(c,f),u);else if(i(c))n(c,u,f);else{var h=document.createElement("a");h.href=c,h.target="_blank",setTimeout(function(){s(h)})}}:function(c,u,f,h){if(h=h||open("","_blank"),h&&(h.document.title=h.document.body.innerText="downloading..."),typeof c=="string")return n(c,u,f);var p=c.type==="application/octet-stream",d=/constructor/i.test(a.HTMLElement)||a.safari,v=/CriOS\/[\d]+/.test(navigator.userAgent);if((v||p&&d||l)&&typeof FileReader<"u"){var y=new FileReader;y.onloadend=function(){var g=y.result;g=v?g:g.replace(/^data:[^;]*;/,"data:attachment/file;"),h?h.location.href=g:location=g,h=null},y.readAsDataURL(c)}else{var x=a.URL||a.webkitURL,w=x.createObjectURL(c);h?h.location=w:location.href=w,h=null,setTimeout(function(){x.revokeObjectURL(w)},4e4)}});a.saveAs=o.saveAs=o,r.exports=o})})(Yt);const Ac=["video/mp4;codecs=h264","video/webm;codecs=h264","video/webm;codecs=vp9","video/webm;codecs=vp8","video/webm"],St=Ac.filter(MediaRecorder.isTypeSupported);function Mc(r){if(!St.length)return;const e=[],t=St[0],n={settings:{...oo,mimeType:t},get supportedMimeTypes(){return St},get mimeType(){return this.settings.mimeType},set mimeType(i){St.includes(i)&&(this.settings.mimeType=i)},start(){if(this.recorder)return;const{fileName:i,frameRate:s,mimeType:a}=this.settings,l=r.captureStream(s||30),o=l.getTracks()[0],c=new MediaRecorder(l,{mimeType:a});c.onstart=()=>e.length=0,c.ondataavailable=({data:u})=>e.push(u),c.onstop=()=>{o.stop(),this.recorder=void 0;const u=this.settings.mimeType.includes("webm")?"webm":"mp4",f=new Blob(e,{type:`video/${u}`}),h=this.settings.appendDate?`_${Na()}`:"",p=`${i||"ani"}${h}.${u}`;Yt.exports.saveAs(f,p)},c.start(),this.recorder=c},get state(){var i;return((i=this.recorder)==null?void 0:i.state)??"idle"}};return["pause","resume","stop"].forEach(i=>{Object.defineProperty(n,i,{value:()=>{var s;return(s=n.recorder)==null?void 0:s[i]()}})}),n}function Lc(r){let e=1,t=!1,n=!1;const i=()=>{r.stats.begin(),r.controls.update();const c=t?-e:e,u=r.clock.getDelta()*c;n||r.update(u),r.render(),r.stats.end()};let s=!1;const a=()=>{s||(r.render(),s=!0,setTimeout(()=>s=!1,50))};let l="";return{start(){l!=="active"&&(r.renderer.setAnimationLoop(i),r.controls.removeEventListener("change",a),l="active")},stop(){l!=="inactive"&&(r.renderer.setAnimationLoop(null),r.controls.addEventListener("change",a),l="inactive")},pause(){n=!0},resume(){n=!1},get state(){return l},get timeScale(){return e},set timeScale(c){const u=parseFloat(c);e=isNaN(u)?1:Math.abs(u)},get reverse(){return t},set reverse(c){t=!!c},get paused(){return n},set paused(c){n=!!c}}}const Sc=async r=>{const{zip:e}=await ve(()=>import("./browser-1aaa63f0.js"),[]);return new Promise(t=>e(r,{},(n,i)=>t(new Blob([i]))))},Cc=r=>{const e=r.indexOf(",");return r.slice(e+1,1/0)},Ic=async r=>{if(r=await r,r instanceof Blob&&(r=await r.arrayBuffer()),r instanceof ArrayBuffer)return new Uint8Array(r);if(typeof r=="string"){const e=r.startsWith("data")?Cc(r):r,t=window.atob(e);return Uint8Array.from(t,n=>n.charCodeAt(0))}};async function Dc(r){const e=await Promise.all(r.map(({data:n})=>Ic(n))),t=Object.fromEntries(r.map(({name:n},i)=>[n,[e[i],{level:0,consume:!0}]]));return Sc(t)}async function Oc(r,e){const t=r.length.toString().length,n=r.map((i,s)=>{const a=s.toString().padStart(t,"0");return{name:`${e||"ss"}_${a}.png`,data:i}});return Dc(n)}function kc(r,e){const t=document.createElement("a");t.style.display="none",t.href=r,t.download=e,document.body.appendChild(t),t.click(),document.body.removeChild(t)}async function xn(r,e="frames"){const t=await Oc(r,e);Yt.exports.saveAs(t,`${e}.zip`)}function Fc(r){const{canvas:e,scene:t}=r;return{settings:ao,downloadFrame(i=1){const{noBackground:s,fileName:a}=this.settings,l=s&&!r.postProcessing.enabled;let o=null;const c=()=>[t.background,o]=[o,t.background];if(r.loop.state==="inactive"||i===1){l&&c(),r.render();const p=e.toDataURL();l&&c(),kc(p,`${a}.png`),r.render();return}let u=0;const f=[];l&&r.addCountedEventListener("beforeRender",c);function h(){const p=e.toDataURL("image/png");f.push(p),++u===i&&(l&&r.addCountedEventListener("beforeRender",c),xn(f,a))}r.addCountedEventListener("afterRender",h,i)},getFrame(){let i;const{noBackground:s}=this.settings;if(s&&!r.postProcessing.enabled){let l=null;[t.background,l]=[l,t.background],r.render(),i=e.toDataURL("image/png"),[t.background,l]=[l,t.background],r.render()}else r.render(),i=e.toDataURL("image/png");return i},getAllFrames(i){var d,v;const s=i==null?void 0:i.animation.current.chainName;if(!s||i.animation.chain[s].duration===1/0)return;console.info("main thread locked");const l=r.loop.state;r.loop.stop(),(v=(d=i.face)==null?void 0:d.reset)==null||v.call(d),i.animation.stop();const o=[],{frameRate:c,noBackground:u}=this.settings,f=1/(c||30);let h=null,p=!0;for(u&&([t.background,h]=[h,t.background]),i.animation.addCountedEventListener("chainFinished",()=>p=!1),i.animation.play();p;){r.update(f);const y=e.toDataURL();o.push(y)}return console.info("main thread unlocked"),u&&([t.background,h]=[h,t.background]),l==="active"&&r.loop.start(),o},downloadAllFrames(i=0){const s=r.model[i],a=this.getAllFrames(s),{fileName:l}=this.settings;xn(a,l)},getAllFramesAsArrayBuffer(i){var g,b;const s=i==null?void 0:i.animation.current.chainName;if(!s||i.animation.chain[s].duration===1/0)return;console.info("main thread locked");const l=r.renderer.getContext(),o=r.loop.state;(b=(g=i.face)==null?void 0:g.reset)==null||b.call(g),r.loop.stop(),i.animation.stop();const c=[],{frameRate:u,noBackground:f}=this.settings,h=1/(u||30),{width:p,height:d}=e,y=p*d*4;let x=null,w=!0;for(f&&([t.background,x]=[x,t.background]),i.animation.addCountedEventListener("chainFinished",()=>w=!1),i.animation.play();w;){r.update(h);const E=new Uint8Array(y);l.readPixels(0,0,p,d,l.RGBA,l.UNSIGNED_BYTE,E);const T=Rc(E,{width:p,height:d});c.push(T.buffer)}return console.info("main thread unlocked"),f&&([t.background,x]=[x,t.background]),o==="active"&&r.loop.start(),c}}}function Rc(r,{width:e,height:t}){const n=t/2|0,i=e*4,s=new Uint8Array(e*4);for(let a=0;a<n;++a){const l=a*i,o=(t-a-1)*i;s.set(r.subarray(l,l+i)),r.copyWithin(l,o,o+i),r.set(s,o)}return r}const _c=()=>Promise.all([uo(),fo(),ho(),bo()]),Bc={directional:kr,ambient:Fr,point:ln},zc={directional:_s,point:Bs},jc=r=>{var o,c;const e=Bc[r];if(!e)return null;const t=co[r],{color:n,intensity:i,...s}=t,a=new e(n,i);a.name=(c=(o=a.type)==null?void 0:o.replace)==null?void 0:c.call(o,"Light","");const l=zc[r];return l&&(a.helper=new l(a),Object.defineProperty(a,"showHelper",{get(){return a.helper.visible},set(u){a.helper.visible=!!u,a.helper.update()}}),a.showHelper=!1),Object.defineProperty(a,"colorCode",{get(){return"#"+this.color.getHexString()},set(u){var f,h;this.color=new J(u),(h=(f=this.helper)==null?void 0:f.update)==null||h.call(f)}}),Object.entries(s).forEach(([u,f])=>{a[u].isVector3?a[u].set(...f):a[u]=f}),a};function Uc(r){const e={list:new ze,add:t=>{const n=jc(t);if(n)return r.scene.add(n),n.helper&&(r.scene.add(n.helper),n.helper.update()),e.list.push(n),n.remove=()=>{var i,s,a,l,o;e.list.remove(n),n.helper&&((i=n.parent)==null||i.remove(n.helper),(a=(s=n.helper).dispose)==null||a.call(s)),(l=n.parent)==null||l.remove(n),(o=n.dispose)==null||o.call(n)},n}};return e}const Lr={"<":">","(":")","[":"]","{":"}"},Nc=r=>{let e="";const t=[],n=[];for(const i of r){if(t.length){e+=i;const s=t.at(-1);i===Lr[s]&&t.pop();continue}if(i==="/"){e&&n.push(e),e="";continue}e+=i,i in Lr&&t.push(i)}return e&&n.push(e),n},Vc=r=>Nc(r).reduce((t,n)=>{const[i,...s]=n.split("="),a=s==null?void 0:s.join("=");return i&&a&&t.push([i,a]),t},[]),Hc={mat:{keys:["material","code"],valueMap:r=>r.slice(1,-1)},ol:{keys:["outline","code"],valueMap:r=>r.slice(1,-1)},ei:{keys:["face","eyeBaseIdx"]},et:{keys:["face","eyeTexture"]},mi:{keys:["face","mouthBaseIdx"]},mt:{keys:["face","mouthTexture"]},tx:{keys:["texture"]},scl:{keys:["scale"]}};async function Gc(r){const e=Vc(r),t=Object.fromEntries(e),{id:n}=t,i=await this.loadDLModel(n);return await $c(i,t),i}async function $c(r,e){const{ani:t,...n}=e;Object.entries(n).forEach(([i,s])=>{const a=Hc[i];if(!a)return;const{keys:l,valueMap:o}=a,c=(o==null?void 0:o(s))??s;Si(r,l,c)}),t&&await r.animation.addChain(t)}const Un=class{constructor(){ge(this,"userData",{ani:new ze});ge(this,"dataLoaded",!1);ge(this,"initData",async()=>{await _c(),this.dataLoaded=!0,this.dispatchEvent({type:"dataLoaded"})});ge(this,"_background","");ge(this,"model",new ze);ge(this,"loadedModel",new ze);ge(this,"loadModelFromCode",Gc);ge(this,"settings",{outline:Ye,material:Be});ge(this,"viewport",{width:0,height:0,set(e,t){this.width=e,this.height=t}});Object.assign(this,Et);const e=new zs;this.scene=e,this.background=ro,this.clock=new jr;const t=_a();this.camera=t;const n=Uc(this);n.add("directional"),n.add("ambient"),this.light=n;const i=Ra();this.renderer=i,this.canvas=i.domElement,this.screenshot=Fc(this),this.record=Mc(this.canvas),this.controls=new js(this.camera,this.canvas),this.postProcessing={enabled:!1,passes:new ze,composer:Mr({renderer:i,scene:e,camera:t}),async addPass(s,a={}){const l=await dc(s,{...a,renderer:i,scene:e,camera:t});this.composer.addPass(l);const o=Pc(l),{passes:c}=this,u=this;return o.remove=()=>{c.remove(o),u.refresh()},c.push(o),l},async refresh(){this.composer=Mr({renderer:i,scene:e,camera:t});const s=this.passes.map(({type:l,params:o})=>({type:l,params:Object.entries(o)}));this.passes.length=0;const{length:a}=s;for(let l=0;l<a;l++){const{type:o,params:c}=s[l],u=await this.addPass(o);c.forEach(([f,h])=>void(u[f]=h))}},updatePasses(s){this.passes.length=0,this.passes.splice(0,0,...s),this.refresh()}},this.stats=new Tc,this.loop=Lc(this),this.loop.start(),console.info("%cDragalia Lost Model Viewer","color:yellow;background-color:black;font-size:1.5rem;text-shadow: 0 0 0.5rem white")}get background(){return this._background}set background(e){var n,i;if(this._background===e)return;this._background="loading",(i=(n=this.scene.background)==null?void 0:n.dispose)==null||i.call(n);const t=this;(async function(){t.scene.background=await Ba(e),t._background=e,e.startsWith("img:")&&t.updateBgAspectRatio()})()}get toneMapping(){var t;const{toneMapping:e}=this.renderer;return((t=Object.entries(on).find(([,n])=>n===e))==null?void 0:t[0])??"Unknown"}set toneMapping(e){const t=on[e]?e:"No Mapping";this.renderer.toneMapping=on[t]}get pixelRatio(){return this.renderer.getPixelRatio()}set pixelRatio(e){this.renderer.setPixelRatio(e),this.postProcessing.composer.setPixelRatio(e)}get unusedModel(){return this.loadedModel.filter(e=>!this.model.includes(e))}async loadDLModel(e=so){this.dataLoaded||await new Promise(a=>this.addCountedEventListener("dataLoaded",a));const t=Un.getModelPath(e),n=await Mi(t);n.name=e;const i={id:e,outline:this.settings.outline,material:this.settings.material,viewer:this},s=lc(n,i);return this.loadedModel.push(s),s.addEventListener("dispose",()=>this.loadedModel.remove(s)),s}add(e){var t;(t=e.detach)==null||t.call(e),this.model.push(e),this.scene.add(e.model),e.parent=this}remove(e){this.model.remove(e),this.scene.remove(e.model)}disposeAllModels(){this.loadedModel.forEach(e=>{var t;return(t=e.dispose)==null?void 0:t.call(e)}),this.model.length=0}static getModelPath(e){return`${this.source.fbx}/${e}/${e}.fbx`}async setViewport(e,t){var a;await Oa(200);const n=e??window.innerWidth,i=t??window.innerHeight;this.viewport.set(n,i),this.renderer.setSize(n,i);const s=n/i;return this.camera.aspect=s,this.camera.updateProjectionMatrix(),(a=this.postProcessing.composer)==null||a.setSize(n,i),this.background.startsWith("img:")&&this.updateBgAspectRatio(),this}updateBgAspectRatio(){if(!this.background.startsWith("img:"))return;const{width:e,height:t}=this.viewport,n=e/t,{background:i}=this.scene,{naturalWidth:s,naturalHeight:a}=i.image,l=s/a,o=n/l,c=n>l?[1,1/o]:[o,1];i.repeat.set(...c)}update(e){var t;(t=this.animation)==null||t.update(e),this.model.forEach(n=>{var i;return(i=n.update)==null?void 0:i.call(n,e)}),this.loop.state==="inactive"&&this.render(),this.dispatchEvent({type:"timeUpdate",dt:e})}stopAll(){this.model.forEach(e=>{var t,n;return(n=(t=e.animation)==null?void 0:t.stop)==null?void 0:n.call(t)})}playAll(){this.model.forEach(e=>{var t,n;return(n=(t=e.animation)==null?void 0:t.play)==null?void 0:n.call(t)})}render(){this.dispatchEvent({type:"beforeRender"}),this.postProcessing.enabled?this.postProcessing.composer.render():this.renderer.render(this.scene,this.camera),this.dispatchEvent({type:"afterRender"})}toString(){return"Dragalia Lost Model Viewer"}dispose(){var e,t,n;this.model.forEach(i=>i.dispose()),(t=(e=this.scene.background)==null?void 0:e.dispose)==null||t.call(e),(n=this.renderer.renderLists)==null||n.dispose(),this.renderer.dispose()}};let ht=Un;ge(ht,"source",{fbx:Ur,ani:Nr});var oe={fullscreenEnabled:0,fullscreenElement:1,requestFullscreen:2,exitFullscreen:3,fullscreenchange:4,fullscreenerror:5,fullscreen:6},Sr=["webkitFullscreenEnabled","webkitFullscreenElement","webkitRequestFullscreen","webkitExitFullscreen","webkitfullscreenchange","webkitfullscreenerror","-webkit-full-screen"],Cr=["mozFullScreenEnabled","mozFullScreenElement","mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozfullscreenerror","-moz-full-screen"],Ir=["msFullscreenEnabled","msFullscreenElement","msRequestFullscreen","msExitFullscreen","MSFullscreenChange","MSFullscreenError","-ms-fullscreen"],re=typeof window<"u"&&typeof window.document<"u"?window.document:{},le="fullscreenEnabled"in re&&Object.keys(oe)||Sr[0]in re&&Sr||Cr[0]in re&&Cr||Ir[0]in re&&Ir||[],Xc={requestFullscreen:function(r){return r[le[oe.requestFullscreen]]()},requestFullscreenFunction:function(r){return r[le[oe.requestFullscreen]]},get exitFullscreen(){return re[le[oe.exitFullscreen]].bind(re)},get fullscreenPseudoClass(){return":"+le[oe.fullscreen]},addEventListener:function(r,e,t){return re.addEventListener(le[oe[r]],e,t)},removeEventListener:function(r,e,t){return re.removeEventListener(le[oe[r]],e,t)},get fullscreenEnabled(){return Boolean(re[le[oe.fullscreenEnabled]])},set fullscreenEnabled(r){},get fullscreenElement(){return re[le[oe.fullscreenElement]]},set fullscreenElement(r){},get onfullscreenchange(){return re[("on"+le[oe.fullscreenchange]).toLowerCase()]},set onfullscreenchange(r){return re[("on"+le[oe.fullscreenchange]).toLowerCase()]=r},get onfullscreenerror(){return re[("on"+le[oe.fullscreenerror]).toLowerCase()]},set onfullscreenerror(r){return re[("on"+le[oe.fullscreenerror]).toLowerCase()]=r}};const Ct=Xc,Le=new ht;Le.initData();Le.setViewport();Le.userData.specialCapture={frameRate:30,duration:5,program:"rotate"};window.addEventListener("resize",()=>Le.setViewport());Le.canvas.addEventListener("dblclick",Wc);window.viewer=Le;window.model=Le.model;window.getFrame=Le.screenshot.getFrame;window.downloadFrames=xn;window.saveAs=Yt.exports.saveAs;window.THREE=Br;window.makeGif=async r=>{const{makeGif:e}=await ve(()=>import("./index-e220d14b.js"),[]);return await e(r)};function Wc(){Ct.fullscreenEnabled&&(Ct.fullscreenElement?Ct.exitFullscreen():Ct.requestFullscreen(Le.canvas))}export{ze as A,Yt as F,io as P,nl as a,Ro as b,jn as c,gr as d,Oc as e,Dc as f,tl as g,Da as h,wr as i,Ur as j,Tr as k,da as l,Ni as n,Vc as p,on as t,Le as v};
